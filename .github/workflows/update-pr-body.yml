# name: Update PR Body with Changed Files
# on:
#   pull_request:
#     types: [opened, synchronize]

# jobs:
#   update-pr:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout Code
#         uses: actions/checkout@v4

#       - name: Get Changed Files
#         id: changed-files
#         run: |
#           git fetch origin ${{ github.event.pull_request.base.ref }} ${{ github.event.pull_request.head.ref }}

#           BASE_SHA=$(git merge-base origin/${{ github.event.pull_request.base.ref }} origin/${{ github.event.pull_request.head.ref }})
#           HEAD_SHA=${{ github.event.pull_request.head.sha }}

#           FILES=$(git diff --name-only "$BASE_SHA" "$HEAD_SHA")
#           FILE_LIST=$(echo "$FILES" | awk '{print "- " $0}' ORS='\n')
#           echo "files=$FILE_LIST" >> $GITHUB_ENV

#       - name: Update PR Body
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#         run: |
#           BODY=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
#             "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}" \
#             | jq -r '.body')

#           # 기존에 '## 변경된 파일' 섹션이 있는지 확인
#           if echo "$BODY" | grep -q "## 변경된 파일"; then
#             # 기존 섹션을 업데이트
#             NEW_BODY=$(echo "$BODY" | sed -E "/## 변경된 파일/{N;d;}" | sed -E "\$a## 변경된 파일\n$FILES")
#           else
#             # 기존 본문 끝에 새로운 섹션 추가
#             NEW_BODY="${BODY}\n\n## 변경된 파일\n$FILES"
#           fi

#           curl -X PATCH -H "Authorization: token $GITHUB_TOKEN" \
#             -H "Content-Type: application/json" \
#             -d "{\"body\": \"${NEW_BODY}\"}" \
#             "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}"
