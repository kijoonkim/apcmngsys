<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : FcltPrgrsMapper.xml                                    				-->
<!-- DESC : 진척도 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2024.07.23  	ljw        		Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper.selectPrgrs				-->
	<!-- DESC : 진척도 테이블 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.23  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectPrgrs" parameterType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO" resultType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO">
		<![CDATA[
			SELECT /* com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper.selectPrgrs */
				AP.CRTR_YR
				, AP.APC_CD
				, (SELECT APC_NM FROM TB_APC_INFO WHERE APC_CD = AP.APC_CD) AS APC_NM
				, AP.PRGRS_SE_CD
				, AP.PRGRS_1
				, AP.PRGRS_2
				, AP.PRGRS_3
				, AP.PRGRS_4
				, AP.PRGRS_5
				, AP.PRGRS_6
				, AP.PRGRS_7
				, AP.PRGRS_8
				, AP.PRGRS_9
				, AP.PRGRS_10
				, AP.PRGRS_11
				, AP.PRGRS_12
				, AP.PRGRS_13
				, AP.PRGRS_14
				, AP.PRGRS_LAST
				, (SELECT  COUNT(VAL) FROM TB_TE_APC_PRGRS
					UNPIVOT (VAL FOR INFO IN (PRGRS_1, PRGRS_2, PRGRS_3, PRGRS_4, PRGRS_5, PRGRS_6, PRGRS_7, PRGRS_8, PRGRS_9, PRGRS_10, PRGRS_11, PRGRS_12, PRGRS_13, PRGRS_14))
					WHERE 1=1
					  AND VAL = 'Y'
					  AND CRTR_YR = AP.CRTR_YR
					  AND APC_CD = AP.APC_CD
					) AS CNT
			FROM TB_TE_APC_PRGRS AP
			WHERE 1=1
			  AND AP.DEL_YN = 'N'
			  AND AP.APC_CD IS NOT NULL
			  AND AP.PRGRS_SE_CD = 'FCLT'
			]]>
			<if test='crtrYr != null and !crtrYr.equals("")'>
			  AND  AP.CRTR_YR = #{crtrYr}
			</if>
			<if test='apcCd != null and !apcCd.equals("")'>
			  AND  AP.APC_CD = #{apcCd}
			</if>
			<if test='apcNm != null and !apcNm.equals("")'>
			  AND AP.APC_CD IN (SELECT APC_CD FROM TB_APC_INFO WHERE APC_NM LIKE '%' || #{apcNm} || '%')
			</if>
			<if test='itemNm != null and !itemNm.equals("")'>
			  AND  EXISTS(SELECT 1
			  				FROM TB_TE_APC_OPER_TRMT_ITEM
			  				WHERE 1=1
			  				  AND APC_CD = AP.APC_CD
			  				  AND OGNZ_SE_CD = '2'
			  				  AND ITEM_NM LIKE '%' || #{itemNm} || '%'
			  				)
			</if>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper.selectPrgrsList			-->
	<!-- DESC : 진척도 테이블 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.23  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectPrgrsList" parameterType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO" resultType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO">
		<![CDATA[
			SELECT /* com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper.selectPrgrsList */
				AP.CRTR_YR
				, AP.APC_CD
				, (SELECT APC_NM FROM TB_APC_INFO WHERE APC_CD = AP.APC_CD) AS APC_NM
				, AP.PRGRS_SE_CD
				, AP.PRGRS_1
				, AP.PRGRS_2
				, AP.PRGRS_3
				, AP.PRGRS_4
				, AP.PRGRS_5
				, AP.PRGRS_6
				, AP.PRGRS_7
				, AP.PRGRS_8
				, AP.PRGRS_9
				, AP.PRGRS_10
				, AP.PRGRS_11
				, AP.PRGRS_12
				, AP.PRGRS_13
				, AP.PRGRS_14
				, AP.PRGRS_LAST
				, AP.APRV_CTPV_STTS
				, AP.APRV_SGG_STTS

			FROM TB_TE_APC_PRGRS AP
			WHERE 1=1
			  AND AP.DEL_YN = 'N'
			  AND AP.APC_CD IS NOT NULL
			  AND AP.PRGRS_SE_CD = 'FCLT'
			]]>
			<if test='crtrYr != null and !crtrYr.equals("")'>
			  AND  AP.CRTR_YR = #{crtrYr}
			</if>
			<if test='apcCd != null and !apcCd.equals("")'>
			  AND  AP.APC_CD = #{apcCd}
			</if>
			<if test='apcNm != null and !apcNm.equals("")'>
			  AND AP.APC_CD IN (SELECT APC_CD FROM TB_APC_INFO WHERE APC_NM LIKE '%' || #{apcNm} || '%')
			</if>
			<if test='itemNm != null and !itemNm.equals("")'>
			  AND EXISTS(SELECT 1
			  				FROM TB_TE_APC_OPER_TRMT_ITEM
			  				WHERE 1=1
			  				  AND APC_CD = AP.APC_CD
			  				  AND OGNZ_SE_CD = '2'
			  				  AND ITEM_NM LIKE '%' || #{itemNm} || '%'
			  				)
			</if>
			<if test='ctpv != null and !ctpv.equals("")'>
				AND AP.APC_CD IN (SELECT APC_CD
									FROM TB_TE_APC_OPER_PRSN_OTLN ROA
									WHERE 1=1
									  AND ROA.CRTR_YR = AP.CRTR_YR
									  AND SUBSTR(ROA.APC_ADM_CD , 0 , 2) = #{ctpv} )
			</if>
			<if test='sgg != null and !sgg.equals("")'>
				AND AP.APC_CD IN (SELECT APC_CD
									FROM TB_TE_APC_OPER_PRSN_OTLN ROB
									WHERE 1=1
									  AND ROB.CRTR_YR = AP.CRTR_YR
									  AND SUBSTR(ROB.APC_ADM_CD , 0 , 4) = SUBSTR(#{sgg} , 0 , 4) )
			</if>
			<if test='userId != null and userId != ""'>
				<if test='userType == "27" or userType == "28"'>
				AND APC_CD IN (SELECT APC_CD
								FROM TB_TE_APC_OPER_PRSN_OTLN RO
								WHERE 1=1
								  AND RO.CRTR_YR = AP.CRTR_YR
								<if test='userType == "27"'>
								  AND SUBSTR(RO.APC_ADM_CD , 0 , 2) = (SELECT CTPV FROM TB_COM_USER WHERE USER_ID = #{userId})
								</if>
								<if test='userType == "28"'>
								  AND SUBSTR(RO.APC_ADM_CD , 0 , 4) = (SELECT SUBSTR(SGG, 0 , 4) FROM TB_COM_USER WHERE USER_ID = #{userId})
								</if>
								)
				</if>
			</if>
	</select>

	<!-- 진척도 갱신 -->
	<update id="insertFcltPrgrs" parameterType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO">
		MERGE INTO TB_TE_APC_PRGRS AP	/* com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper.insertFcltPrgrs */
		USING DUAL
		ON (
			AP.CRTR_YR 		= #{crtrYr}
			AND AP.APC_CD 	= #{apcCd}
			AND AP.PRGRS_SE_CD = 'FCLT'
			)
		WHEN MATCHED THEN
		  UPDATE SET
				SYS_LAST_CHG_DT		=  SYSDATE
				, SYS_LAST_CHG_USER_ID	=  #{sysLastChgUserId}
				, SYS_LAST_CHG_PRGRM_ID	=  #{sysLastChgPrgrmId}
				<if test='prgrsSel.equals("1")'>
				, PRGRS_1			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("2")'>
				, PRGRS_2			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("3")'>
				, PRGRS_3			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("4")'>
				, PRGRS_4			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("5")'>
				, PRGRS_5			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("6")'>
				, PRGRS_6			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("7")'>
				, PRGRS_7			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("8")'>
				, PRGRS_8			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("9")'>
				, PRGRS_9			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("10")'>
				, PRGRS_10			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("11")'>
				, PRGRS_11			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("12")'>
				, PRGRS_12			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("13")'>
				, PRGRS_13			= #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("14")'>
				, PRGRS_14			= #{prgrsVal}
				</if>
				<if test='prgrsLast != null and !prgrsLast.equals("")'>
				, PRGRS_LAST		= #{prgrsLast}
				</if>
		WHEN NOT MATCHED THEN
		  INSERT (
				  CRTR_YR
				  , APC_CD
				  , PRGRS_SE_CD

				<if test='prgrsSel.equals("1")'>
				  , PRGRS_1
				</if>
				<if test='prgrsSel.equals("2")'>
				  , PRGRS_2
				</if>
				<if test='prgrsSel.equals("3")'>
				  , PRGRS_3
				</if>
				<if test='prgrsSel.equals("4")'>
				  , PRGRS_4
				</if>
				<if test='prgrsSel.equals("5")'>
				  , PRGRS_5
				</if>
				<if test='prgrsSel.equals("6")'>
				  , PRGRS_6
				</if>
				<if test='prgrsSel.equals("7")'>
				  , PRGRS_7
				</if>
				<if test='prgrsSel.equals("8")'>
				  , PRGRS_8
				</if>
				<if test='prgrsSel.equals("9")'>
				  , PRGRS_9
				</if>
				<if test='prgrsSel.equals("10")'>
				  , PRGRS_10
				</if>
				<if test='prgrsSel.equals("11")'>
				  , PRGRS_11
				</if>
				<if test='prgrsSel.equals("12")'>
				  , PRGRS_12
				</if>
				<if test='prgrsSel.equals("13")'>
				  , PRGRS_13
				</if>
				<if test='prgrsSel.equals("14")'>
				  , PRGRS_14
				</if>
				<if test='prgrsLast != null and !prgrsLast.equals("")'>
				  , PRGRS_LAST
				</if>

				  , SYS_FRST_INPT_DT
				  , SYS_FRST_INPT_USER_ID
				  , SYS_FRST_INPT_PRGRM_ID
				  , SYS_LAST_CHG_DT
				  , SYS_LAST_CHG_USER_ID
				  , SYS_LAST_CHG_PRGRM_ID
				)
		VALUES
				(
				  #{crtrYr}
				  , #{apcCd}
				  , 'FCLT'

				<if test='prgrsSel.equals("1")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("2")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("3")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("4")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("5")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("6")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("7")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("8")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("9")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("10")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("11")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("12")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("13")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsSel.equals("14")'>
				 , #{prgrsVal}
				</if>
				<if test='prgrsLast != null and !prgrsLast.equals("")'>
				 , #{prgrsLast}
				</if>

				  , SYSDATE
				  , #{sysFrstInptUserId}
				  , #{sysFrstInptPrgrmId}
				  , SYSDATE
				  , #{sysLastChgUserId}
				  , #{sysLastChgPrgrmId}
				)
	</update>

	<!-- 최종제출 여부 업데이트 -->
	<update id="updatePrgrsLast" parameterType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO">
		UPDATE
			TB_TE_APC_PRGRS
		SET
			PRGRS_LAST 				= #{prgrsLast}
			, LAST_USER_ID			= #{sysLastChgUserId}
			, LAST_DT				= SYSDATE

			, SYS_LAST_CHG_DT		= SYSDATE
			, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
			, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}
		WHERE 1=1
		  AND CRTR_YR		= #{crtrYr}
		  AND APC_CD		= #{apcCd}
		  AND PRGRS_SE_CD	= 'FCLT'
	</update>

	<!-- 지자체 승인 업데이트 -->
	<update id="updateAprv" parameterType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO">
		UPDATE
			TB_TE_APC_PRGRS
		SET

			SYS_LAST_CHG_DT			=  SYSDATE
			, SYS_LAST_CHG_USER_ID	=  #{sysLastChgUserId}
			, SYS_LAST_CHG_PRGRM_ID	=  #{sysLastChgPrgrmId}
			<if test='userType.equals("27")'>
				<if test='aprvYn.equals("Y")'>
				, APRV_CTPV_STTS = #{aprvYn}
				, APRV_CTPV_NM = (SELECT USER_ID FROM TB_COM_USER WHERE USER_ID = #{userId})
				, APRV_CTPV_USER_ID = #{userId}
				, APRV_CTPV_DT = SYSDATE
				</if>
				<if test='aprvYn.equals("N")'>
				, APRV_CTPV_STTS = #{aprvYn}
				, RJCT_CTPV_NM = (SELECT USER_ID FROM TB_COM_USER WHERE USER_ID = #{userId})
				, RJCT_CTPV_USER_ID = #{userId}
				, RJCT_CTPV_DT = SYSDATE
				</if>
				<if test='aprvYn.equals("C")'>
				, APRV_CTPV_STTS = null
				</if>
			</if>
			<if test='userType.equals("28")'>
				<if test='aprvYn.equals("Y")'>
				, APRV_SGG_STTS = #{aprvYn}
				, APRV_SGG_NM = (SELECT USER_ID FROM TB_COM_USER WHERE USER_ID = #{userId})
				, APRV_SGG_USER_ID = #{userId}
				, APRV_SGG_DT = SYSDATE
				</if>
				<if test='aprvYn.equals("N")'>
				, APRV_SGG_STTS = #{aprvYn}
				, RJCT_SGG_NM = (SELECT USER_ID FROM TB_COM_USER WHERE USER_ID = #{userId})
				, RJCT_SGG_USER_ID = #{userId}
				, RJCT_SGG_DT = SYSDATE
				</if>
				<if test='aprvYn.equals("C")'>
				, APRV_SGG_STTS = null
				</if>
			</if>
		WHERE 1=1
		  AND CRTR_YR		= #{crtrYr}
		  AND APC_CD		= #{apcCd}
		  AND PRGRS_SE_CD	= 'FCLT'
	</update>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper.selectPrgrsRawData		-->
	<!-- DESC : 진척도 로우데이터 조회                                             			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.18  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectPrgrsRawData" parameterType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO" resultType="com.at.apcss.fm.fclt.vo.FcltPrgrsVO">
		<![CDATA[
			SELECT /* com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper.selectPrgrsRawData */
				AP.CRTR_YR
				, AP.APC_CD
				, (SELECT APC_NM FROM TB_APC_INFO WHERE APC_CD = AP.APC_CD) AS APC_NM
				, AP.PRGRS_SE_CD

				, RO.APC_ADM_CD
				, FN_GET_COM_CD_VL_NM('UNTY_CTPV',SUBSTR(RO.APC_ADM_CD , 0 , 2)) AS CTPV_NM
				, FN_GET_COM_CD_VL_NM('UNTY_SGG',SUBSTR(RO.APC_ADM_CD , 0 , 5)) AS SGG_NM

				, AP.PRGRS_1
				, AP.PRGRS_2
				, AP.PRGRS_3
				, AP.PRGRS_4
				, AP.PRGRS_5
				, AP.PRGRS_6
				, AP.PRGRS_7
				, AP.PRGRS_8
				, AP.PRGRS_9
				, AP.PRGRS_10
				, AP.PRGRS_11
				, AP.PRGRS_12
				, AP.PRGRS_13
				, AP.PRGRS_14
				, AP.PRGRS_LAST
				, AP.APRV_CTPV_STTS
				, TO_CHAR(AP.APRV_CTPV_DT , 'YYYY-MM-DD') AS APRV_CTPV_DT
				, AP.APRV_SGG_STTS
				, TO_CHAR(AP.APRV_SGG_DT , 'YYYY-MM-DD') AS APRV_SGG_DT

				, (SELECT PIC_NM ||' '|| JBPS FROM TB_COM_USER WHERE USER_ID = AP.APRV_CTPV_USER_ID) AS CTPV_PIC_NM
				, (SELECT CO_TELNO FROM TB_COM_USER WHERE USER_ID = AP.APRV_CTPV_USER_ID) AS CTPV_CO_TELNO
				, (SELECT MBL_TELNO FROM TB_COM_USER WHERE USER_ID = AP.APRV_CTPV_USER_ID) AS CTPV_MBL_TELNO
				, AP.APRV_CTPV_USER_ID

				, (SELECT PIC_NM ||' '|| JBPS FROM TB_COM_USER WHERE USER_ID = AP.APRV_SGG_USER_ID) AS SGG_PIC_NM
				, (SELECT CO_TELNO FROM TB_COM_USER WHERE USER_ID = AP.APRV_SGG_USER_ID) AS SGG_CO_TELNO
				, (SELECT MBL_TELNO FROM TB_COM_USER WHERE USER_ID = AP.APRV_SGG_USER_ID) AS SGG_MBL_TELNO
				, AP.APRV_SGG_USER_ID

			FROM TB_TE_APC_PRGRS AP
				,TB_TE_APC_OPER_PRSN_OTLN RO
			WHERE 1=1
			  AND AP.APC_CD = RO.APC_CD(+)
			  AND AP.CRTR_YR = RO.CRTR_YR(+)
			  AND AP.DEL_YN = 'N'
			  AND AP.APC_CD IS NOT NULL
			  AND AP.PRGRS_SE_CD = 'FCLT'
			  AND AP.APC_CD NOT IN ('0857','0859')
			]]>
			<if test='crtrYr != null and !crtrYr.equals("")'>
			  AND  AP.CRTR_YR = #{crtrYr}
			</if>
			<if test='ctpv != null and !ctpv.equals("")'>
				AND AP.APC_CD IN (SELECT APC_CD
									FROM TB_TE_APC_OPER_PRSN_OTLN ROA
									WHERE 1=1
									  AND ROA.CRTR_YR = AP.CRTR_YR
									  AND SUBSTR(ROA.APC_ADM_CD , 0 , 2) = #{ctpv} )
			</if>
			<if test='sgg != null and !sgg.equals("")'>
				AND AP.APC_CD IN (SELECT APC_CD
									FROM TB_TE_APC_OPER_PRSN_OTLN ROB
									WHERE 1=1
									  AND ROB.CRTR_YR = AP.CRTR_YR
									  AND SUBSTR(ROB.APC_ADM_CD , 0 , 4) = SUBSTR(#{sgg} , 0 , 4) )
			</if>
			ORDER BY AP.APC_CD
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.fclt.mapper.FcltPrgrsMapper.selectAllRawData		-->
	<!-- DESC : 전체 로우데이터 조회                                             			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.19  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectAllRawData" parameterType="com.at.apcss.fm.fclt.vo.FcltAllRawDataVO" resultType="com.at.apcss.fm.fclt.vo.FcltAllRawDataVO">
		SELECT
			*
		FROM
			/* 1.운영자개요 */
			(SELECT
					A.CRTR_YR
					, A.APC_CD
					, (SELECT APC_NM FROM TB_APC_INFO WHERE APC_CD = A.APC_CD) AS APC_NM
					, A.APC_BRNO

					, A.OPER_OGNZ_NM
					, A.RPRSV
					, A.OPER_OGNZ_BRNO
					, A.OPER_OGNZ_CRNO

					, A.LOCTN
					, A.LOCTN_DTL

					, A.OPER_OGNZ_ADM_CD
					, A.CTPV_CD
					, FN_GET_COM_CD_VL_NM('UNTY_CTPV', A.CTPV_CD) AS CTPV_NM
					, A.SIGUN_CD
					, FN_GET_COM_CD_VL_NM('UNTY_SGG', A.SIGUN_CD) AS SIGUN_NM

					, A.OPER_OGNZ_ZIP
					, A.OPER_OGNZ_BMNO
					, A.OPER_OGNZ_SLNO
					, A.OPER_OGNZ_ROAD_NM_CD

					, A.APC_LOCTN
					, A.APC_LOCTN_DTL

					, SUBSTR(A.APC_ADM_CD , 0 , 2) AS APC_CTPV_CD
					, FN_GET_COM_CD_VL_NM('UNTY_CTPV', SUBSTR(A.APC_ADM_CD , 0 , 2)) AS APC_CTPV_NM
					, SUBSTR(A.APC_ADM_CD , 0 , 5) AS APC_SIGUN_CD
					, FN_GET_COM_CD_VL_NM('UNTY_SGG', SUBSTR(A.APC_ADM_CD , 0 , 5)) AS APC_SIGUN_NM

					, A.APC_BMNO
					, A.APC_SLNO
					, A.APC_ROAD_NM_CD
					, A.APC_ADM_CD
					, A.APC_ZIP

					, A.OGNZ_TYPE_CD
				FROM TB_TE_APC_OPER_PRSN_OTLN A
				WHERE 1=1
				  AND CRTR_YR = #{crtrYr}
			) OPO
			/* 1.운영자개요 품목 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, MAX(CASE WHEN SN = '1' AND OGNZ_SE_CD = '1'THEN ITEM_CD END) AS OGNZ_ITEM_CD_1
					, MAX(CASE WHEN SN = '1' AND OGNZ_SE_CD = '1'THEN ITEM_NM END) AS OGNZ_ITEM_NM_1
					, MAX(CASE WHEN SN = '2' AND OGNZ_SE_CD = '1'THEN ITEM_CD END) AS OGNZ_ITEM_CD_2
					, MAX(CASE WHEN SN = '2' AND OGNZ_SE_CD = '1'THEN ITEM_NM END) AS OGNZ_ITEM_NM_2
					, MAX(CASE WHEN SN = '3' AND OGNZ_SE_CD = '1'THEN ITEM_CD END) AS OGNZ_ITEM_CD_3
					, MAX(CASE WHEN SN = '3' AND OGNZ_SE_CD = '1'THEN ITEM_NM END) AS OGNZ_ITEM_NM_3
					, MAX(CASE WHEN SN = '4' AND OGNZ_SE_CD = '1'THEN ITEM_NM END) AS OGNZ_ETC_ITEM_NM
					, MAX(CASE WHEN SN = '4' AND OGNZ_SE_CD = '1'THEN FN_GET_COM_CD_VL_NM('ETC_CLS',ETC_CTGRY_CD) END) AS OGNZ_ETC_CTGRY_NM

					, MAX(CASE WHEN SN = '1' AND OGNZ_SE_CD = '2'THEN ITEM_CD END) AS APC_ITEM_CD_1
					, MAX(CASE WHEN SN = '1' AND OGNZ_SE_CD = '2'THEN ITEM_NM END) AS APC_ITEM_NM_1
					, MAX(CASE WHEN SN = '2' AND OGNZ_SE_CD = '2'THEN ITEM_CD END) AS APC_ITEM_CD_2
					, MAX(CASE WHEN SN = '2' AND OGNZ_SE_CD = '2'THEN ITEM_NM END) AS APC_ITEM_NM_2
					, MAX(CASE WHEN SN = '3' AND OGNZ_SE_CD = '2'THEN ITEM_CD END) AS APC_ITEM_CD_3
					, MAX(CASE WHEN SN = '3' AND OGNZ_SE_CD = '2'THEN ITEM_NM END) AS APC_ITEM_NM_3
					, MAX(CASE WHEN SN = '4' AND OGNZ_SE_CD = '2'THEN ITEM_NM END) AS APC_ETC_ITEM_NM
					, MAX(CASE WHEN SN = '4' AND OGNZ_SE_CD = '2'THEN FN_GET_COM_CD_VL_NM('ETC_CLS',ETC_CTGRY_CD) END) AS APC_ETC_CTGRY_NM
				FROM TB_TE_APC_OPER_TRMT_ITEM
				WHERE 1=1
				  AND CRTR_YR = #{crtrYr}
				GROUP BY CRTR_YR , APC_CD
			) ITEM
			/* 3.1 시설 장비 인력 현황 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, CSP_TOT_AREA
					, CSP_TOT_RMRK
					, CSP_CFPP_AREA
					, CSP_CFPP_RMRK
					, CSP_CLN_OPRTNG_PRCS_AREA
					, CSP_CLN_OPRTNG_PRCS_RMRK
					, CSP_NGDS_FCLT_AREA
					, CSP_NGDS_FCLT_RMRK
					, CSP_DTP_AREA
					, CSP_DTP_RMRK
					, STRG_PLC_PRC_PLC_AREA
					, STRG_PLC_PRC_PLC_RMRK
					, STRG_PLC_LWTP_STRG_AREA
					, STRG_PLC_LWTP_STRG_RMRK
					, STRG_PLC_CA_STRG_PLC_AREA
					, STRG_PLC_CA_STRG_PLC_RMRK
					, STRG_PLC_CURN_AREA
					, STRG_PLC_CURN_RMRK
					, STRG_PLC_GNRL_STRG_AREA
					, STRG_PLC_GNRL_STRG_RMRK
					, STRG_PLC_ETC_AREA
					, STRG_PLC_ETC_RMRK
				FROM TB_TE_APC_FCLT_STTS
				WHERE 1=1
				  AND CRTR_YR = #{crtrYr}
			) FS
			/* 3.2 상품화설비현황 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, MAX(CASE WHEN SN = '1' THEN SORT_MCHN_HOLD_YN END) AS SORT_MCHN_HOLD_YN_FSD_1
					, MAX(CASE WHEN SN = '1' THEN SORT_MCHN_SPCFCT END) AS SORT_MCHN_SPCFCT_1
					, MAX(CASE WHEN SN = '1' THEN MKR_NM END) AS MKR_NM_1
					, MAX(CASE WHEN SN = '1' THEN SORT_BRCK_MCHN END) AS SORT_BRCK_MCHN_1
					, MAX(CASE WHEN SN = '1' THEN COLOR_SORT END) AS COLOR_SORT_1
					, MAX(CASE WHEN SN = '1' THEN SHAP_SORT END) AS SHAP_SORT_1
					, MAX(CASE WHEN SN = '1' THEN MNFC_MCHN END) AS MNFC_MCHN_1

					, MAX(CASE WHEN SN = '2' THEN SORT_MCHN_HOLD_YN END) AS SORT_MCHN_HOLD_YN_FSD_2
					, MAX(CASE WHEN SN = '2' THEN SORT_MCHN_SPCFCT END) AS SORT_MCHN_SPCFCT_2
					, MAX(CASE WHEN SN = '2' THEN MKR_NM END) AS MKR_NM_2
					, MAX(CASE WHEN SN = '2' THEN SORT_BRCK_MCHN END) AS SORT_BRCK_MCHN_2
					, MAX(CASE WHEN SN = '2' THEN COLOR_SORT END) AS COLOR_SORT_2
					, MAX(CASE WHEN SN = '2' THEN SHAP_SORT END) AS SHAP_SORT_2
					, MAX(CASE WHEN SN = '2' THEN MNFC_MCHN END) AS MNFC_MCHN_2

					, MAX(CASE WHEN SN = '3' THEN SORT_MCHN_HOLD_YN END) AS SORT_MCHN_HOLD_YN_FSD_3
					, MAX(CASE WHEN SN = '3' THEN SORT_MCHN_SPCFCT END) AS SORT_MCHN_SPCFCT_3
					, MAX(CASE WHEN SN = '3' THEN MKR_NM END) AS MKR_NM_3
					, MAX(CASE WHEN SN = '3' THEN SORT_BRCK_MCHN END) AS SORT_BRCK_MCHN_3
					, MAX(CASE WHEN SN = '3' THEN COLOR_SORT END) AS COLOR_SORT_3
					, MAX(CASE WHEN SN = '3' THEN SHAP_SORT END) AS SHAP_SORT_3
					, MAX(CASE WHEN SN = '3' THEN MNFC_MCHN END) AS MNFC_MCHN_3

					, MAX(CASE WHEN SN = '4' THEN SORT_MCHN_HOLD_YN END) AS SORT_MCHN_HOLD_YN_FSD_4
					, MAX(CASE WHEN SN = '4' THEN SORT_MCHN_SPCFCT END) AS SORT_MCHN_SPCFCT_4
					, MAX(CASE WHEN SN = '4' THEN MKR_NM END) AS MKR_NM_4
					, MAX(CASE WHEN SN = '4' THEN SORT_BRCK_MCHN END) AS SORT_BRCK_MCHN_4
					, MAX(CASE WHEN SN = '4' THEN COLOR_SORT END) AS COLOR_SORT_4
					, MAX(CASE WHEN SN = '4' THEN SHAP_SORT END) AS SHAP_SORT_4
					, MAX(CASE WHEN SN = '4' THEN MNFC_MCHN END) AS MNFC_MCHN_4
				FROM TB_TE_APC_FCLT_STTS_DTL
				WHERE 1=1
				  AND CRTR_YR = #{crtrYr}
				GROUP BY CRTR_YR , APC_CD
			) FSD
			/* 3.3 선별기운영 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, MAX(CASE WHEN SN = '1' THEN SORT_MCHN_HOLD_YN END) AS SORT_MCHN_HOLD_YN_OASM_1
					, MAX(CASE WHEN SN = '1' THEN SORT_PRCS_ABLT END) AS SORT_PRCS_ABLT_1
					, MAX(CASE WHEN SN = '1' THEN SORT_PRCS_PRFMNC END) AS SORT_PRCS_PRFMNC_1
					, MAX(CASE WHEN SN = '1' THEN SORT_OPRTNG_HR END) AS SORT_OPRTNG_HR_1
					, MAX(CASE WHEN SN = '1' THEN SORT_AVG_OPRTNG_DCNT END) AS SORT_AVG_OPRTNG_DCNT_1

					, MAX(CASE WHEN SN = '2' THEN SORT_MCHN_HOLD_YN END) AS SORT_MCHN_HOLD_YN_OASM_2
					, MAX(CASE WHEN SN = '2' THEN SORT_PRCS_ABLT END) AS SORT_PRCS_ABLT_2
					, MAX(CASE WHEN SN = '2' THEN SORT_PRCS_PRFMNC END) AS SORT_PRCS_PRFMNC_2
					, MAX(CASE WHEN SN = '2' THEN SORT_OPRTNG_HR END) AS SORT_OPRTNG_HR_2
					, MAX(CASE WHEN SN = '2' THEN SORT_AVG_OPRTNG_DCNT END) AS SORT_AVG_OPRTNG_DCNT_2

					, MAX(CASE WHEN SN = '3' THEN SORT_MCHN_HOLD_YN END) AS SORT_MCHN_HOLD_YN_OASM_3
					, MAX(CASE WHEN SN = '3' THEN SORT_PRCS_ABLT END) AS SORT_PRCS_ABLT_3
					, MAX(CASE WHEN SN = '3' THEN SORT_PRCS_PRFMNC END) AS SORT_PRCS_PRFMNC_3
					, MAX(CASE WHEN SN = '3' THEN SORT_OPRTNG_HR END) AS SORT_OPRTNG_HR_3
					, MAX(CASE WHEN SN = '3' THEN SORT_AVG_OPRTNG_DCNT END) AS SORT_AVG_OPRTNG_DCNT_3

					, MAX(CASE WHEN SN = '4' THEN SORT_MCHN_HOLD_YN END) AS SORT_MCHN_HOLD_YN_OASM_4
					, MAX(CASE WHEN SN = '4' THEN SORT_PRCS_ABLT END) AS SORT_PRCS_ABLT_4
					, MAX(CASE WHEN SN = '4' THEN SORT_PRCS_PRFMNC END) AS SORT_PRCS_PRFMNC_4
					, MAX(CASE WHEN SN = '4' THEN SORT_OPRTNG_HR END) AS SORT_OPRTNG_HR_4
					, MAX(CASE WHEN SN = '4' THEN SORT_AVG_OPRTNG_DCNT END) AS SORT_AVG_OPRTNG_DCNT_4
				FROM TB_TE_APC_OPER_ABLT_SORT_MCHN
				WHERE 1=1
				  AND CRTR_YR = #{crtrYr}
				GROUP BY CRTR_YR , APC_CD
			) OASM
			/* 3.4 선별기운영기간 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, MAX(CASE WHEN SN = '1' THEN OPER_YN END) AS OPER_YN_SN_1
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_1 END) AS OPER_PERIOD_YN_101
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_2 END) AS OPER_PERIOD_YN_102
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_3 END) AS OPER_PERIOD_YN_103
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_4 END) AS OPER_PERIOD_YN_104
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_5 END) AS OPER_PERIOD_YN_105
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_6 END) AS OPER_PERIOD_YN_106
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_7 END) AS OPER_PERIOD_YN_107
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_8 END) AS OPER_PERIOD_YN_108
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_9 END) AS OPER_PERIOD_YN_109
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_10 END) AS OPER_PERIOD_YN_110
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_11 END) AS OPER_PERIOD_YN_111
					, MAX(CASE WHEN SN = '1' THEN OPER_PERIOD_YN_12 END) AS OPER_PERIOD_YN_112

					, MAX(CASE WHEN SN = '2' THEN OPER_YN END) AS OPER_YN_SN_2
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_1 END) AS OPER_PERIOD_YN_201
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_2 END) AS OPER_PERIOD_YN_202
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_3 END) AS OPER_PERIOD_YN_203
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_4 END) AS OPER_PERIOD_YN_204
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_5 END) AS OPER_PERIOD_YN_205
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_6 END) AS OPER_PERIOD_YN_206
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_7 END) AS OPER_PERIOD_YN_207
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_8 END) AS OPER_PERIOD_YN_208
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_9 END) AS OPER_PERIOD_YN_209
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_10 END) AS OPER_PERIOD_YN_210
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_11 END) AS OPER_PERIOD_YN_211
					, MAX(CASE WHEN SN = '2' THEN OPER_PERIOD_YN_12 END) AS OPER_PERIOD_YN_212

					, MAX(CASE WHEN SN = '3' THEN OPER_YN END) AS OPER_YN_SN_3
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_1 END) AS OPER_PERIOD_YN_301
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_2 END) AS OPER_PERIOD_YN_302
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_3 END) AS OPER_PERIOD_YN_303
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_4 END) AS OPER_PERIOD_YN_304
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_5 END) AS OPER_PERIOD_YN_305
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_6 END) AS OPER_PERIOD_YN_306
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_7 END) AS OPER_PERIOD_YN_307
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_8 END) AS OPER_PERIOD_YN_308
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_9 END) AS OPER_PERIOD_YN_309
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_10 END) AS OPER_PERIOD_YN_310
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_11 END) AS OPER_PERIOD_YN_311
					, MAX(CASE WHEN SN = '3' THEN OPER_PERIOD_YN_12 END) AS OPER_PERIOD_YN_312

					, MAX(CASE WHEN SN = '4' THEN OPER_YN END) AS OPER_YN_SN_4
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_1 END) AS OPER_PERIOD_YN_401
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_2 END) AS OPER_PERIOD_YN_402
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_3 END) AS OPER_PERIOD_YN_403
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_4 END) AS OPER_PERIOD_YN_404
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_5 END) AS OPER_PERIOD_YN_405
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_6 END) AS OPER_PERIOD_YN_406
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_7 END) AS OPER_PERIOD_YN_407
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_8 END) AS OPER_PERIOD_YN_408
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_9 END) AS OPER_PERIOD_YN_409
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_10 END) AS OPER_PERIOD_YN_410
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_11 END) AS OPER_PERIOD_YN_411
					, MAX(CASE WHEN SN = '4' THEN OPER_PERIOD_YN_12 END) AS OPER_PERIOD_YN_412
				  FROM TB_TE_APC_MCHN_OPER_PERIOD
				  WHERE 1=1
				    AND CRTR_YR = #{crtrYr}
				    AND MCHN_SE_CD = '1'
				  GROUP BY CRTR_YR , APC_CD
			) MOP
			/* 3.5 저온저장고운영 - 상세 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, LWTP_STRG_PLC_HLD_YN
					, STRG_PLC_STRG_ABLT
					, STRG_PLC_STRM_STRG_ABLT
					, STRG_PLC_LTRM_STRG_ABLT
					, STRG_PLC_OPRTNG_RT
				FROM TB_TE_APC_OPER_ABLT_STRG_PLC
				WHERE 1=1
				  AND CRTR_YR = #{crtrYr}
			) OASP
			/* 3.5 저온저장고운영 - 운영기간 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, OPER_YN
					, OPER_PERIOD_YN_1
					, OPER_PERIOD_YN_2
					, OPER_PERIOD_YN_3
					, OPER_PERIOD_YN_4
					, OPER_PERIOD_YN_5
					, OPER_PERIOD_YN_6
					, OPER_PERIOD_YN_7
					, OPER_PERIOD_YN_8
					, OPER_PERIOD_YN_9
					, OPER_PERIOD_YN_10
					, OPER_PERIOD_YN_11
					, OPER_PERIOD_YN_12
				FROM TB_TE_APC_MCHN_OPER_PERIOD
				WHERE 1=1
				    AND CRTR_YR = #{crtrYr}
				    AND MCHN_SE_CD = '2'
				    AND SN = '0'
			) MOPA
			/* 3.6 고용인력 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, HIRE_RGLLBR_OFC
					, HIRE_RGLLBR_SPT
					, HIRE_TMPR_WG_TOT_SUM
					, HIRE_TMPR_AVG_WG
					, HIRE_TMPR_MIN
					, HIRE_TMPR_MAX
					, HIRE_FRGNR_MIN
					, HIRE_FRGNR_MAX
					, HIRE_FRGNR_AVG
					, HIRE_FRGNR_TASK_CN
				FROM TB_TE_APC_OPER_ABLT
				WHERE 1=1
				  AND CRTR_YR = #{crtrYr}
			) OA
			/* 4.1 스마트자동화현황 */
			,(SELECT
				CRTR_YR
				, APC_CD
				, MAX(CASE WHEN SN = '1' THEN DECODE(WBG,'1','설치','2','미설치','') END) AS WBG_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(WRHS_BR_QR,'1','설치','2','미설치','') END) AS WRHS_BR_QR_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(KSK_TBLT,'1','설치','2','미설치','') END) AS KSK_TBLT_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(DPTZ,'1','설치','2','미설치','') END) AS DPTZ_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(APM,'1','설치','2','미설치','') END) AS APM_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(ELCTRN_WGHT_SORT_MCHN,'1','설치','2','미설치','') END) AS ELCTRN_WGHT_SORT_MCHN_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(NDST_BRCK_SORT_MCHN,'1','설치','2','미설치','') END) AS NDST_BRCK_SORT_MCHN_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(GRD_RAW_MTR_ATMTC_TRNSF_MCHN,'1','설치','2','미설치','') END) AS GRD_RAW_MTR_ATMTC_TRNSF_MCHN_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(DSHBRD,'1','설치','2','미설치','') END) AS DSHBRD_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(EMPT_BX_ATMTC_EXHST_MCHN,'1','설치','2','미설치','') END) AS EMPT_BX_ATMTC_EXHST_MCHN_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(ATMTC_BX_PCKG_MCHN,'1','설치','2','미설치','') END) AS ATMTC_BX_PCKG_MCHN_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(ATMTC_SS_MCHN,'1','설치','2','미설치','') END) AS ATMTC_SS_MCHN_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(ATMTC_WRAP_MCHN,'1','설치','2','미설치','') END) AS ATMTC_WRAP_MCHN_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(ATMTC_WGHT_CHCK_MCHN,'1','설치','2','미설치','') END) AS ATMTC_WGHT_CHCK_MCHN_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(PTZ,'1','설치','2','미설치','') END) AS PTZ_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(SPMT_BR_QR,'1','설치','2','미설치','') END) AS SPMT_BR_QR_1
				, MAX(CASE WHEN SN = '1' THEN DECODE(TH_AC,'1','설치','2','미설치','') END) AS TH_AC_1
				, MAX(CASE WHEN SN = '1' THEN SPCFCT_CNT END) AS SPCFCT_CNT_1
				, MAX(CASE WHEN SN = '1' THEN SPCFCT_GRP END) AS SPCFCT_GRP_1
				, MAX(CASE WHEN SN = '1' THEN SPCFCT_GRD END) AS SPCFCT_GRD_1

				, MAX(CASE WHEN SN = '2' THEN DECODE(WBG,'1','설치','2','미설치','') END) AS WBG_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(WRHS_BR_QR,'1','설치','2','미설치','') END) AS WRHS_BR_QR_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(KSK_TBLT,'1','설치','2','미설치','') END) AS KSK_TBLT_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(DPTZ,'1','설치','2','미설치','') END) AS DPTZ_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(APM,'1','설치','2','미설치','') END) AS APM_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(ELCTRN_WGHT_SORT_MCHN,'1','설치','2','미설치','') END) AS ELCTRN_WGHT_SORT_MCHN_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(NDST_BRCK_SORT_MCHN,'1','설치','2','미설치','') END) AS NDST_BRCK_SORT_MCHN_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(GRD_RAW_MTR_ATMTC_TRNSF_MCHN,'1','설치','2','미설치','') END) AS GRD_RAW_MTR_ATMTC_TRNSF_MCHN_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(DSHBRD,'1','설치','2','미설치','') END) AS DSHBRD_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(EMPT_BX_ATMTC_EXHST_MCHN,'1','설치','2','미설치','') END) AS EMPT_BX_ATMTC_EXHST_MCHN_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(ATMTC_BX_PCKG_MCHN,'1','설치','2','미설치','') END) AS ATMTC_BX_PCKG_MCHN_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(ATMTC_SS_MCHN,'1','설치','2','미설치','') END) AS ATMTC_SS_MCHN_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(ATMTC_WRAP_MCHN,'1','설치','2','미설치','') END) AS ATMTC_WRAP_MCHN_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(ATMTC_WGHT_CHCK_MCHN,'1','설치','2','미설치','') END) AS ATMTC_WGHT_CHCK_MCHN_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(PTZ,'1','설치','2','미설치','') END) AS PTZ_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(SPMT_BR_QR,'1','설치','2','미설치','') END) AS SPMT_BR_QR_2
				, MAX(CASE WHEN SN = '2' THEN DECODE(TH_AC,'1','설치','2','미설치','') END) AS TH_AC_2
				, MAX(CASE WHEN SN = '2' THEN SPCFCT_CNT END) AS SPCFCT_CNT_2
				, MAX(CASE WHEN SN = '2' THEN SPCFCT_GRP END) AS SPCFCT_GRP_2
				, MAX(CASE WHEN SN = '2' THEN SPCFCT_GRD END) AS SPCFCT_GRD_2

				, MAX(CASE WHEN SN = '3' THEN DECODE(WBG,'1','설치','2','미설치','') END) AS WBG_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(WRHS_BR_QR,'1','설치','2','미설치','') END) AS WRHS_BR_QR_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(KSK_TBLT,'1','설치','2','미설치','') END) AS KSK_TBLT_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(DPTZ,'1','설치','2','미설치','') END) AS DPTZ_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(APM,'1','설치','2','미설치','') END) AS APM_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(ELCTRN_WGHT_SORT_MCHN,'1','설치','2','미설치','') END) AS ELCTRN_WGHT_SORT_MCHN_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(NDST_BRCK_SORT_MCHN,'1','설치','2','미설치','') END) AS NDST_BRCK_SORT_MCHN_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(GRD_RAW_MTR_ATMTC_TRNSF_MCHN,'1','설치','2','미설치','') END) AS GRD_RAW_MTR_ATMTC_TRNSF_MCHN_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(DSHBRD,'1','설치','2','미설치','') END) AS DSHBRD_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(EMPT_BX_ATMTC_EXHST_MCHN,'1','설치','2','미설치','') END) AS EMPT_BX_ATMTC_EXHST_MCHN_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(ATMTC_BX_PCKG_MCHN,'1','설치','2','미설치','') END) AS ATMTC_BX_PCKG_MCHN_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(ATMTC_SS_MCHN,'1','설치','2','미설치','') END) AS ATMTC_SS_MCHN_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(ATMTC_WRAP_MCHN,'1','설치','2','미설치','') END) AS ATMTC_WRAP_MCHN_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(ATMTC_WGHT_CHCK_MCHN,'1','설치','2','미설치','') END) AS ATMTC_WGHT_CHCK_MCHN_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(PTZ,'1','설치','2','미설치','') END) AS PTZ_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(SPMT_BR_QR,'1','설치','2','미설치','') END) AS SPMT_BR_QR_3
				, MAX(CASE WHEN SN = '3' THEN DECODE(TH_AC,'1','설치','2','미설치','') END) AS TH_AC_3
				, MAX(CASE WHEN SN = '3' THEN SPCFCT_CNT END) AS SPCFCT_CNT_3
				, MAX(CASE WHEN SN = '3' THEN SPCFCT_GRP END) AS SPCFCT_GRP_3
				, MAX(CASE WHEN SN = '3' THEN SPCFCT_GRD END) AS SPCFCT_GRD_3
			FROM TB_TE_APC_SMART_PRPLSN_STTN_DTL
			WHERE 1=1
			  AND CRTR_YR = #{crtrYr}
			GROUP BY CRTR_YR , APC_CD
			) SPSD
			/* 4.2 작업단계별 데이터 관리현황 , 4.3 통합관리시스템 활용현황 */
			,(SELECT
				CRTR_YR
				, APC_CD
				, DECODE(PRDCTN_INFO_MNG_MTHD,'1','관리안함','2','수기/엑셀','3','시스템','') AS PRDCTN_INFO_MNG_MTHD
				, DECODE(WRHS_INFO_MNG_MTHD,'1','관리안함','2','수기/엑셀','3','시스템','') AS WRHS_INFO_MNG_MTHD
				, DECODE(SORT_INFO_MNG_MTHD,'1','관리안함','2','수기/엑셀','3','시스템','') AS SORT_INFO_MNG_MTHD
				, DECODE(STRG_INFO_MNG_MTHD,'1','관리안함','2','수기/엑셀','3','시스템','') AS STRG_INFO_MNG_MTHD
				, DECODE(PCKG_INFO_MNG_MTHD,'1','관리안함','2','수기/엑셀','3','시스템','') AS PCKG_INFO_MNG_MTHD
				, DECODE(JOB_INFO_MNG_MTHD,'1','관리안함','2','수기/엑셀','3','시스템','') AS JOB_INFO_MNG_MTHD
				, DECODE(SPMT_INFO_MNG_MTHD,'1','관리안함','2','수기/엑셀','3','시스템','') AS SPMT_INFO_MNG_MTHD

				, UMS_YN
				, UMS_PRDCTN_INFO
				, UMS_WGH_INFO
				, UMS_WRHS_INFO
				, UMS_SORT_INFO
				, UMS_STRG_INFO
				, UMS_PCKG_INFO
				, UMS_SPMT_INFO
				, UMS_CLCLN_INFO
			FROM TB_TE_APC_SMART_PRPLSN_STTN
			WHERE 1=1
			  AND CRTR_YR = #{crtrYr}
			) SPS
			 /* 4.2 작업단계별 데이터 관리현황 - 상세 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, MAX(CASE WHEN DATA_MNG_TYPE = 'PRDCTN' THEN DATA_MNG_TYPE_DTL END) AS PRDCTN_DTL_LIST
					, MAX(CASE WHEN DATA_MNG_TYPE = 'WRHS' THEN DATA_MNG_TYPE_DTL END) AS WRHS_DTL_LIST
					, MAX(CASE WHEN DATA_MNG_TYPE = 'SORT' THEN DATA_MNG_TYPE_DTL END) AS SORT_DTL_LIST
					, MAX(CASE WHEN DATA_MNG_TYPE = 'STRG' THEN DATA_MNG_TYPE_DTL END) AS STRG_DTL_LIST
					, MAX(CASE WHEN DATA_MNG_TYPE = 'PCKG' THEN DATA_MNG_TYPE_DTL END) AS PCKG_DTL_LIST
					, MAX(CASE WHEN DATA_MNG_TYPE = 'JOB' THEN DATA_MNG_TYPE_DTL END) AS JOB_DTL_LIST
					, MAX(CASE WHEN DATA_MNG_TYPE = 'SPMT' THEN DATA_MNG_TYPE_DTL END) AS SPMT_DTL_LIST
				FROM (SELECT
							CRTR_YR
							, APC_CD
							, DATA_MNG_TYPE
							, LISTAGG(FN_GET_COM_CD_VL_NM('DATA_MNG_TYPE_DTL',DATA_MNG_TYPE_DTL),', ') WITHIN GROUP(ORDER BY DATA_MNG_TYPE_DTL) AS DATA_MNG_TYPE_DTL
						FROM TB_TE_APC_SMART_DATA_MNG
						WHERE 1=1
						  AND DATA_MNG_YN = 'Y'
						  AND CRTR_YR = #{crtrYr}
						GROUP BY CRTR_YR , APC_CD , DATA_MNG_TYPE)
				WHERE 1=1
				GROUP BY CRTR_YR , APC_CD
			) SDM
			/* 5.1 유통조직 처리실적 , 5.2 APC 처리실적 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, MAX(CASE WHEN SN = '1' THEN RTL_OGNZ_TOT_TRMT_AMT END) AS RTL_OGNZ_TOT_TRMT_AMT_1
					, MAX(CASE WHEN SN = '1' THEN RTL_OGNZ_GNRL_SUM END) AS RTL_OGNZ_GNRL_SUM_1
					, MAX(CASE WHEN SN = '1' THEN RTL_OGNZ_GNRL_SMPL_TRST END) AS RTL_OGNZ_GNRL_SMPL_TRST_1
					, MAX(CASE WHEN SN = '1' THEN RTL_OGNZ_GNRL_SMPL_EMSPAP END) AS RTL_OGNZ_GNRL_SMPL_EMSPAP_1
					, MAX(CASE WHEN SN = '1' THEN RTL_OGNZ_OGNZ_SUM END) AS RTL_OGNZ_OGNZ_SUM_1
					, MAX(CASE WHEN SN = '1' THEN RTL_OGNZ_OGNZ_CPRTN_SORT_TRST END) AS RTL_OGNZ_OGNZ_CPRTN_SORT_TRST_1
					, MAX(CASE WHEN SN = '1' THEN RTL_OGNZ_OGNZ_CTRT_EMSPAP END) AS RTL_OGNZ_OGNZ_CTRT_EMSPAP_1
					, MAX(CASE WHEN SN = '1' THEN RTL_OGNZ_TOT_TRMT_VLM END) AS RTL_OGNZ_TOT_TRMT_VLM_1

					, MAX(CASE WHEN SN = '2' THEN RTL_OGNZ_TOT_TRMT_AMT END) AS RTL_OGNZ_TOT_TRMT_AMT_2
					, MAX(CASE WHEN SN = '2' THEN RTL_OGNZ_GNRL_SUM END) AS RTL_OGNZ_GNRL_SUM_2
					, MAX(CASE WHEN SN = '2' THEN RTL_OGNZ_GNRL_SMPL_TRST END) AS RTL_OGNZ_GNRL_SMPL_TRST_2
					, MAX(CASE WHEN SN = '2' THEN RTL_OGNZ_GNRL_SMPL_EMSPAP END) AS RTL_OGNZ_GNRL_SMPL_EMSPAP_2
					, MAX(CASE WHEN SN = '2' THEN RTL_OGNZ_OGNZ_SUM END) AS RTL_OGNZ_OGNZ_SUM_2
					, MAX(CASE WHEN SN = '2' THEN RTL_OGNZ_OGNZ_CPRTN_SORT_TRST END) AS RTL_OGNZ_OGNZ_CPRTN_SORT_TRST_2
					, MAX(CASE WHEN SN = '2' THEN RTL_OGNZ_OGNZ_CTRT_EMSPAP END) AS RTL_OGNZ_OGNZ_CTRT_EMSPAP_2
					, MAX(CASE WHEN SN = '2' THEN RTL_OGNZ_TOT_TRMT_VLM END) AS RTL_OGNZ_TOT_TRMT_VLM_2

					, MAX(CASE WHEN SN = '3' THEN RTL_OGNZ_TOT_TRMT_AMT END) AS RTL_OGNZ_TOT_TRMT_AMT_3
					, MAX(CASE WHEN SN = '3' THEN RTL_OGNZ_GNRL_SUM END) AS RTL_OGNZ_GNRL_SUM_3
					, MAX(CASE WHEN SN = '3' THEN RTL_OGNZ_GNRL_SMPL_TRST END) AS RTL_OGNZ_GNRL_SMPL_TRST_3
					, MAX(CASE WHEN SN = '3' THEN RTL_OGNZ_GNRL_SMPL_EMSPAP END) AS RTL_OGNZ_GNRL_SMPL_EMSPAP_3
					, MAX(CASE WHEN SN = '3' THEN RTL_OGNZ_OGNZ_SUM END) AS RTL_OGNZ_OGNZ_SUM_3
					, MAX(CASE WHEN SN = '3' THEN RTL_OGNZ_OGNZ_CPRTN_SORT_TRST END) AS RTL_OGNZ_OGNZ_CPRTN_SORT_TRST_3
					, MAX(CASE WHEN SN = '3' THEN RTL_OGNZ_OGNZ_CTRT_EMSPAP END) AS RTL_OGNZ_OGNZ_CTRT_EMSPAP_3
					, MAX(CASE WHEN SN = '3' THEN RTL_OGNZ_TOT_TRMT_VLM END) AS RTL_OGNZ_TOT_TRMT_VLM_3

					, MAX(CASE WHEN SN = '4' THEN RTL_OGNZ_TOT_TRMT_AMT END) AS RTL_OGNZ_TOT_TRMT_AMT_4
					, MAX(CASE WHEN SN = '4' THEN RTL_OGNZ_GNRL_SUM END) AS RTL_OGNZ_GNRL_SUM_4
					, MAX(CASE WHEN SN = '4' THEN RTL_OGNZ_GNRL_SMPL_TRST END) AS RTL_OGNZ_GNRL_SMPL_TRST_4
					, MAX(CASE WHEN SN = '4' THEN RTL_OGNZ_GNRL_SMPL_EMSPAP END) AS RTL_OGNZ_GNRL_SMPL_EMSPAP_4
					, MAX(CASE WHEN SN = '4' THEN RTL_OGNZ_OGNZ_SUM END) AS RTL_OGNZ_OGNZ_SUM_4
					, MAX(CASE WHEN SN = '4' THEN RTL_OGNZ_OGNZ_CPRTN_SORT_TRST END) AS RTL_OGNZ_OGNZ_CPRTN_SORT_TRST_4
					, MAX(CASE WHEN SN = '4' THEN RTL_OGNZ_OGNZ_CTRT_EMSPAP END) AS RTL_OGNZ_OGNZ_CTRT_EMSPAP_4
					, MAX(CASE WHEN SN = '4' THEN RTL_OGNZ_TOT_TRMT_VLM END) AS RTL_OGNZ_TOT_TRMT_VLM_4

					, MAX(CASE WHEN SN = '1' THEN APC_GNRL_TRMT_AMT END) AS APC_GNRL_TRMT_AMT_1
					, MAX(CASE WHEN SN = '1' THEN APC_OGNZ_CPRTN_SORT_TRST END) AS APC_OGNZ_CPRTN_SORT_TRST_1
					, MAX(CASE WHEN SN = '1' THEN APC_CTRT_EMSPAP END) AS APC_CTRT_EMSPAP_1
					, MAX(CASE WHEN SN = '1' THEN APC_TRMT_AMT END) AS APC_TRMT_AMT_1
					, MAX(CASE WHEN SN = '1' THEN APC_TRMT_VLM END) AS APC_TRMT_VLM_1
					, MAX(CASE WHEN SN = '1' THEN TM_SPMT_AMT END) AS TM_SPMT_AMT_1
					, MAX(CASE WHEN SN = '1' THEN TM_SPMT_RT END) AS TM_SPMT_RT_1

					, MAX(CASE WHEN SN = '2' THEN APC_GNRL_TRMT_AMT END) AS APC_GNRL_TRMT_AMT_2
					, MAX(CASE WHEN SN = '2' THEN APC_OGNZ_CPRTN_SORT_TRST END) AS APC_OGNZ_CPRTN_SORT_TRST_2
					, MAX(CASE WHEN SN = '2' THEN APC_CTRT_EMSPAP END) AS APC_CTRT_EMSPAP_2
					, MAX(CASE WHEN SN = '2' THEN APC_TRMT_AMT END) AS APC_TRMT_AMT_2
					, MAX(CASE WHEN SN = '2' THEN APC_TRMT_VLM END) AS APC_TRMT_VLM_2
					, MAX(CASE WHEN SN = '2' THEN TM_SPMT_AMT END) AS TM_SPMT_AMT_2
					, MAX(CASE WHEN SN = '2' THEN TM_SPMT_RT END) AS TM_SPMT_RT_2

					, MAX(CASE WHEN SN = '3' THEN APC_GNRL_TRMT_AMT END) AS APC_GNRL_TRMT_AMT_3
					, MAX(CASE WHEN SN = '3' THEN APC_OGNZ_CPRTN_SORT_TRST END) AS APC_OGNZ_CPRTN_SORT_TRST_3
					, MAX(CASE WHEN SN = '3' THEN APC_CTRT_EMSPAP END) AS APC_CTRT_EMSPAP_3
					, MAX(CASE WHEN SN = '3' THEN APC_TRMT_AMT END) AS APC_TRMT_AMT_3
					, MAX(CASE WHEN SN = '3' THEN APC_TRMT_VLM END) AS APC_TRMT_VLM_3
					, MAX(CASE WHEN SN = '3' THEN TM_SPMT_AMT END) AS TM_SPMT_AMT_3
					, MAX(CASE WHEN SN = '3' THEN TM_SPMT_RT END) AS TM_SPMT_RT_3

					, MAX(CASE WHEN SN = '4' THEN APC_GNRL_TRMT_AMT END) AS APC_GNRL_TRMT_AMT_4
					, MAX(CASE WHEN SN = '4' THEN APC_OGNZ_CPRTN_SORT_TRST END) AS APC_OGNZ_CPRTN_SORT_TRST_4
					, MAX(CASE WHEN SN = '4' THEN APC_CTRT_EMSPAP END) AS APC_CTRT_EMSPAP_4
					, MAX(CASE WHEN SN = '4' THEN APC_TRMT_AMT END) AS APC_TRMT_AMT_4
					, MAX(CASE WHEN SN = '4' THEN APC_TRMT_VLM END) AS APC_TRMT_VLM_4
					, MAX(CASE WHEN SN = '4' THEN TM_SPMT_AMT END) AS TM_SPMT_AMT_4
					, MAX(CASE WHEN SN = '4' THEN TM_SPMT_RT END) AS TM_SPMT_RT_4
			FROM TB_TE_APC_OPER_PRFMNC_DTL
			WHERE 1=1
			  AND CRTR_YR = #{crtrYr}
			GROUP BY CRTR_YR , APC_CD
			) OPD
			/* 5.3 APC 처리상품 주요판매처 */
			,(SELECT
				CRTR_YR
				, APC_CD
				, APC_NTSL_AMT_LGSZ_RTL
				, APC_NTSL_AMT_FOOD_MTRL
				, APC_NTSL_AMT_WHLSL_MRKT
				, APC_NTSL_AMT_ONLN_WHLSL_MRKT
				, APC_NTSL_AMT_BZENTY
				, APC_NTSL_AMT_EXPRT
				, APC_NTSL_AMT_HMSP
				, APC_NTSL_AMT_ONLN_B2B
				, APC_NTSL_AMT_ONLN_B2C
				, APC_NTSL_AMT_ETC
			FROM TB_TE_APC_OPER_PRFMNC
			WHERE 1=1
			  AND CRTR_YR = #{crtrYr}
			) OP
			/* 전체 진척도 관리 */
			,(SELECT
					CRTR_YR
					, APC_CD
					, PRGRS_LAST
					, PRGRS_1, PRGRS_2, PRGRS_3, PRGRS_4, PRGRS_5
					, PRGRS_6, PRGRS_7, PRGRS_8, PRGRS_9, PRGRS_10
					, PRGRS_11, PRGRS_12, PRGRS_13, PRGRS_14
					, APRV_CTPV_STTS
					, APRV_CTPV_USER_ID
					, APRV_CTPV_DT
					, APRV_SGG_STTS
					, APRV_SGG_USER_ID
					, APRV_SGG_DT
				FROM TB_TE_APC_PRGRS
				WHERE 1=1
				  AND PRGRS_SE_CD = 'FCLT'
				  AND CRTR_YR = #{crtrYr}
			) P
		WHERE 1=1
		  AND OPO.CRTR_YR = ITEM.CRTR_YR(+)
		  AND OPO.APC_CD = ITEM.APC_CD(+)

		  AND OPO.CRTR_YR = FS.CRTR_YR(+)
		  AND OPO.APC_CD = FS.APC_CD(+)

		  AND OPO.CRTR_YR = FSD.CRTR_YR(+)
		  AND OPO.APC_CD = FSD.APC_CD(+)

		  AND OPO.CRTR_YR = OASM.CRTR_YR(+)
		  AND OPO.APC_CD = OASM.APC_CD(+)

		  AND OPO.CRTR_YR = MOP.CRTR_YR(+)
		  AND OPO.APC_CD = MOP.APC_CD(+)

		  AND OPO.CRTR_YR = OASP.CRTR_YR(+)
		  AND OPO.APC_CD = OASP.APC_CD(+)

		  AND OPO.CRTR_YR = MOPA.CRTR_YR(+)
		  AND OPO.APC_CD = MOPA.APC_CD(+)

		  AND OPO.CRTR_YR = OA.CRTR_YR(+)
		  AND OPO.APC_CD = OA.APC_CD(+)

		  AND OPO.CRTR_YR = SPSD.CRTR_YR(+)
		  AND OPO.APC_CD = SPSD.APC_CD(+)

		  AND OPO.CRTR_YR = SPS.CRTR_YR(+)
		  AND OPO.APC_CD = SPS.APC_CD(+)

		  AND OPO.CRTR_YR = SDM.CRTR_YR(+)
		  AND OPO.APC_CD = SDM.APC_CD(+)

		  AND OPO.CRTR_YR = OPD.CRTR_YR(+)
		  AND OPO.APC_CD = OPD.APC_CD(+)

		  AND OPO.CRTR_YR = OP.CRTR_YR(+)
		  AND OPO.APC_CD = OP.APC_CD(+)

		  AND OPO.CRTR_YR = P.CRTR_YR(+)
		  AND OPO.APC_CD = P.APC_CD(+)
	</select>
</mapper>