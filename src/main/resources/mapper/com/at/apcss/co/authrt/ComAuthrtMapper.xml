<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : ComAuthMapper.xml                                    				-->
<!-- DESC : 권한 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.05.25  	jcshin        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.co.authrt.mapper.ComAuthrtMapper">

	<!-- 권한 -->
	<resultMap type="com.at.apcss.co.authrt.vo.ComAuthrtVO" id="comAuthrtMap">
		<result property="authrtId" column="AUTHRT_ID" />
		<result property="authrtNm" column="AUTHRT_NM" />
		<result property="authrtType" column="AUTHRT_TYPE" />
		<result property="authrtRmrk" column="AUTHRT_RMRK" />
	</resultMap>
	
	<!-- 권한메뉴 -->
	<resultMap type="com.at.apcss.co.authrt.vo.ComAuthrtMenuVO" id="comAuthrtMenuMap">
		<result property="menuId" column="MENU_ID" />
		<result property="menuNm" column="MENU_NM" />
		<result property="upMenuId" column="UP_MENU_ID" />
		<result property="menuType" column="MENU_TYPE" />
		<result property="userType" column="USER_TYPE" />
		<result property="pageUrl" column="PAGE_URL" />
		<result property="indctSeq" column="INDCT_SEQ" />
		<result property="apcCd" column="APC_CD" />
		<result property="sysId" column="SYS_ID" />
		<result property="upMenuNm" column="UP_MENU_NM" />
		<result property="menuLvl" column="MENU_LVL" />
		<result property="menuSeq" column="MENU_SEQ" />
		
		<result property="authrtId" column="AUTHRT_ID" />
		<result property="authrtNm" column="AUTHRT_NM" />
		<result property="useYn" column="USE_YN" />
	</resultMap>

	<!-- 권한 UI -->
	<resultMap type="com.at.apcss.co.authrt.vo.ComAuthrtUiVO" id="comAuthrtUiMap">
		<result property="menuId" column="MENU_ID" />
		<result property="menuNm" column="MENU_NM" />
		<result property="upMenuId" column="UP_MENU_ID" />
		<result property="menuType" column="MENU_TYPE" />
		<result property="userType" column="USER_TYPE" />
		<result property="pageUrl" column="PAGE_URL" />
		<result property="indctSeq" column="INDCT_SEQ" />
		<result property="apcCd" column="APC_CD" />
		<result property="sysId" column="SYS_ID" />
		<result property="upMenuNm" column="UP_MENU_NM" />
		<result property="menuLvl" column="MENU_LVL" />
		<result property="menuSeq" column="MENU_SEQ" />
		
		<result property="authrtId" column="AUTHRT_ID" />
		<result property="entyId" column="ENTY_ID" />
		<result property="entyType" column="ENTY_TYPE" />
		<result property="aplcnType" column="APLCN_TYPE" />
		<result property="indctYn" column="INDCT_YN" />
	</resultMap>


	<!-- 권한 User -->
	<resultMap type="com.at.apcss.co.authrt.vo.ComAuthrtUserVO" id="comAuthrtUserMap">
        <result property="userId" column="USER_ID"/>
        <result property="userNm" column="USER_NM"/>
		<result property="userType" column="USER_TYPE" />
		<result property="userStts" column="USER_STTS" />
		<result property="eml" column="EML" />
		<result property="mblTelno" column="MBL_TELNO" />
		<result property="apcCd" column="APC_CD" />
		<result property="ogdpNm" column="OGDP_NM" />
		<result property="chrgdCertYn" column="CHRGD_CERT_YN" />
		<result property="chrgdCertType" column="CHRGD_CERT_TYPE" />
		<result property="lckYn" column="LCK_YN" />
		<result property="lgnFailNmtm" column="LGN_FAIL_NMTM" />
		<result property="endLgnDt" column="END_LGN_DT" />
		<result property="endLgnIp" column="END_LGN_IP" />		

		<result property="authrtId" column="AUTHRT_ID" />
		<result property="authrtNm" column="AUTHRT_NM" />
	</resultMap>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrt		-->
	<!-- DESC : 권한 단건조회.                                             				-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComAuthrt" parameterType="com.at.apcss.co.authrt.vo.ComAuthrtVO" resultMap="comAuthrtMap">
    	<![CDATA[
			SELECT /* com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrt */
				  CA.AUTHRT_ID      AS AUTHRT_ID
		        , CA.AUTHRT_NM      AS AUTHRT_NM
				, CA.AUTHRT_TYPE    AS AUTHRT_TYPE
				, CA.AUTHRT_RMRK    AS AUTHRT_RMRK
				, CA.DEL_YN                 AS DEL_YN
		        , CA.SYS_FRST_INPT_DT       AS SYS_FRST_INPT_DT
		        , CA.SYS_FRST_INPT_USER_ID  AS SYS_FRST_INPT_USER_ID
		        , CA.SYS_FRST_INPT_PRGRM_ID AS SYS_FRST_INPT_PRGRM_ID
		        , CA.SYS_LAST_CHG_DT        AS SYS_LAST_CHG_DT
		        , CA.SYS_LAST_CHG_USER_ID   AS SYS_LAST_CHG_USER_ID
		        , CA.SYS_LAST_CHG_PRGRM_ID  AS SYS_LAST_CHG_PRGRM_ID
			  FROM TB_COM_AUTH CA
			 WHERE CA.AUTHRT_ID = #{authrtId}
    	]]>
    </select>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrtList	-->
	<!-- DESC : 권한 목록 조회.                                             			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComAuthrtList" parameterType="com.at.apcss.co.authrt.vo.ComAuthrtVO" resultMap="comAuthrtMap">
    	<![CDATA[
			SELECT /* com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrtList */
				  CA.AUTHRT_ID      AS AUTHRT_ID
		        , CA.AUTHRT_NM      AS AUTHRT_NM
				, CA.AUTHRT_TYPE    AS AUTHRT_TYPE
				, CA.AUTHRT_RMRK    AS AUTHRT_RMRK
			  FROM TB_COM_AUTH CA
			 WHERE CA.DEL_YN = 'N'
    	]]>
		<if test='authrtId != null and authrtId != ""'>
			   AND CA.AUTHRT_ID = #{authrtId}
		</if>
		<if test='authrtNm != null and authrtNm != ""'>
			   AND CA.AUTHRT_NM LIKE '%' || #{authrtNm} || '%'
		</if>
		<if test='authrtType != null and authrtType != ""'>
			   AND CA.AUTHRT_TYPE = #{authrtType}
		</if>
		<if test='authrtNm != null and authrtNm != ""'>
			   AND CA.AUTHRT_RMRK LIKE '%' || #{authrtNm} || '%'
		</if>
    </select>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrtMenuList	-->
	<!-- DESC : 권한 메뉴 목록 조회.                                             			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComAuthrtMenuList" parameterType="com.at.apcss.co.authrt.vo.ComAuthrtVO" resultMap="comAuthrtMenuMap">
    	<![CDATA[
			SELECT /* com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrtMenuList */
				  CA.AUTHRT_ID      AS AUTHRT_ID
		        , CA.AUTHRT_NM      AS AUTHRT_NM
				, CA.AUTHRT_TYPE    AS AUTHRT_TYPE
				, CA.AUTHRT_RMRK    AS AUTHRT_RMRK
				, CM.MENU_ID    	AS MENU_ID
				, CM.MENU_NM    	AS MENU_NM
				, CM.UP_MENU_ID 	AS UP_MENU_ID
				, CM.MENU_TYPE  	AS MENU_TYPE
				, CM.USER_TYPE  	AS USER_TYPE
				, CM.PAGE_URL   	AS PAGE_URL
				, CM.INDCT_SEQ  	AS INDCT_SEQ
				, CM.APC_CD   		AS APC_CD
			  FROM
			  	  TB_COM_AUTH CA
				, TB_COM_MENU CM
			 WHERE CA.AUTHRT_ID = CM.AUTHRT_ID(+)
			   AND CA.DEL_YN = 'N'
			   AND CM.DEL_YN(+) = 'N'			   
    	]]>
		<if test='authrtId != null and authrtId != ""'>
			   AND CA.AUTHRT_ID = #{authrtId}
		</if>
		<if test='authrtNm != null and authrtNm != ""'>
			   AND CA.AUTHRT_NM LIKE '%' || #{authrtNm} || '%'
		</if>
		<if test='authrtType != null and authrtType != ""'>
			   AND CA.AUTHRT_TYPE = #{authrtType}
		</if>
		<if test='authrtRmrk != null and authrtRmrk != ""'>
			   AND CA.AUTHRT_RMRK LIKE '%' || #{authrtRmrk} || '%'
		</if>
		<if test='menuId != null and menuId != ""'>
			AND CM.MENU_ID = #{menuId}
		</if>
		<if test='menuNm != null and menuNm != ""'>
			AND CM.MENU_NM LIKE '%' || #{menuNm} || '%'
		</if>
    </select>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrtUiList		-->
	<!-- DESC : 권한 화면 목록 조회.                                             			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComAuthrtUiList" parameterType="com.at.apcss.co.authrt.vo.ComAuthrtVO" resultMap="comAuthrtUiMap">
    	<![CDATA[
			SELECT /* com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrtUiList */
				  CA.AUTHRT_ID  	AS AUTHRT_ID
		        , CM.MENU_ID		AS MENU_ID
				, AU.ENTY_ID		AS ENTY_ID
				, AU.APLCN_TYPE 	AS APLCN_TYPE
				, AU.INDCT_YN		AS INDCT_YN
			  FROM
			  	  TB_COM_AUTH CA
				, TB_COM_MENU CM
			  	, TB_COM_AUTH_UI AU
			 WHERE CA.AUTHRT_ID = AU.AUTHRT_ID
			   AND CM.MENU_ID = AU.MENU_ID
			   AND CA.DEL_YN = 'N'
			   AND CM.DEL_YN(+) = 'N'
    	]]>
		<if test='authrtId != null and authrtId != ""'>
			   AND CA.AUTHRT_ID = #{authrtId}
		</if>
		<if test='authrtNm != null and authrtNm != ""'>
			   AND CA.AUTHRT_NM LIKE '%' || #{authrtNm} || '%'
		</if>
		<if test='authrtType != null and authrtType != ""'>
			   AND CA.AUTHRT_TYPE = #{authrtType}
		</if>
		<if test='authrtRmrk != null and authrtRmrk != ""'>
			   AND CA.AUTHRT_RMRK LIKE '%' || #{authrtRmrk} || '%'
		</if>
		<if test='menuId != null and menuId != ""'>
			AND CM.MENU_ID = #{menuId}
		</if>
		<if test='menuNm != null and menuNm != ""'>
			AND CM.MENU_NM LIKE '%' || #{menuNm} || '%'
		</if>
    </select>
    
	<!-- ==============================================================================	-->
	<!-- NAME : com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrtMenuTreeList	-->
	<!-- DESC : 권한 메뉴트리 목록 조회.                                             			-->
	<!-- ==============================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      				-->
	<!-- ===========  	============  	===============================================	-->
	<!-- 2023.05.30  	jcshin        	Initial Creation                            	-->
	<!-- ==============================================================================	-->
    <select id="selectComAuthrtMenuTreeList" parameterType="com.at.apcss.co.authrt.vo.ComAuthrtMenuVO" resultMap="comAuthrtMenuMap">
    	<![CDATA[
			SELECT /* com.at.apcss.co.authrt.mapper.ComAuthMapper.selectComAuthrtMenuTreeList */
				  MN.LVL			AS MENU_LVL
				, MN.SEQ			AS MENU_SEQ
				, MN.SYS_ID			AS SYS_ID
				, MN.UP_MENU_ID		AS UP_MENU_ID
				, UM.MENU_NM		AS UP_MENU_NM
				, MN.MENU_ID		AS MENU_ID
				, MN.MENU_NM		AS MENU_NM
				, MN.MENU_TYPE  	AS MENU_TYPE
				, MN.USER_TYPE		AS USER_TYPE
				, MN.PAGE_URL		AS PAGE_URL
				, MN.APC_CD			AS APC_CD
				, MN.INDCT_SEQ		AS INDCT_SEQ
				, AM.AUTHRT_ID		AS AUTHRT_ID
				, CA.AUTHRT_NM		AS AUTHRT_NM
				, CA.AUTHRT_TYPE	AS AUTHRT_TYPE
				, NVL2(AM.MENU_ID, 'Y', 'N') AS USE_YN
			  FROM (
				SELECT
					  LEVEL		AS LVL
					, ROWNUM 	AS SEQ
					, SUBSTR(MN.MENU_ID, 1, 2) AS SYS_ID
					, MN.UP_MENU_ID	AS UP_MENU_ID
					, MN.MENU_ID	AS MENU_ID
					, MN.MENU_NM	AS MENU_NM
					, MN.MENU_TYPE  AS MENU_TYPE
					, MN.USER_TYPE	AS USER_TYPE
					, MN.PAGE_URL	AS PAGE_URL
					, MN.APC_CD		AS APC_CD
					, MN.INDCT_SEQ	AS INDCT_SEQ					
				  FROM TB_COM_MENU MN
				 WHERE MN.DEL_YN = 'N'
				 START WITH MN.UP_MENU_ID IS NULL
			    CONNECT BY PRIOR MN.MENU_ID = MN.UP_MENU_ID
			     ORDER SIBLINGS BY MN.INDCT_SEQ, MN.MENU_ID
			  	) MN
			  	
			  	LEFT JOIN TB_COM_MENU UM
			  	  ON UM.MENU_ID = MN.UP_MENU_ID
			  	 AND UM.DEL_YN = 'N'
			  	 
			  	LEFT JOIN TB_COM_UI CU
			  	  ON CU.MENU_ID = MN.MENU_ID
			  	 AND CU.DEL_YN = 'N'
			
			  	LEFT JOIN TB_COM_AUTH CA
			  	  ON CA.AUTHRT_ID = #{authrtId}
			  	 AND CA.DEL_YN = 'N'
			  	 
			  	LEFT JOIN TB_COM_AUTH_MENU AM
			  	  ON AM.MENU_ID = MN.MENU_ID
			  	 AND AM.AUTHRT_ID = CA.AUTHRT_ID
			  	 AND AM.DEL_YN = 'N'
			  	     
			  	LEFT JOIN TB_COM_AUTH_UI AU
			  	  ON AU.AUTHRT_ID = AM.AUTHRT_ID
			  	 AND AU.MENU_ID = AM.MENU_ID
			  	 AND AU.ENTY_ID = CU.ENTY_ID
			  	 AND AU.DEL_YN = 'N'
			  	 
			 WHERE 1=1			   
		   
    	]]>    
    </select>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.authrt.mapper.ComAuthrtMapper.selectComAuthrtUserList	-->
	<!-- DESC : 권한 사용자 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComAuthrtUserList" parameterType="com.at.apcss.co.authrt.vo.ComAuthrtUserVO" resultMap="comAuthrtUserMap">
    	<![CDATA[
			SELECT /* com.at.apcss.co.authrt.ComAuthMapper.selectComAuthrtUserList */
				  CA.AUTHRT_ID          AS AUTHRT_ID
			    , CA.AUTHRT_NM          AS AUTHRT_NM
			    , CU.USER_ID            AS USER_ID
			    , CU.USER_NM            AS USER_NM
			    , CU.USER_TYPE          AS USER_TYPE
			    , CU.USER_STTS          AS USER_STTS
			    , CU.EML                AS EML
			    , CU.MBL_TELNO          AS MBL_TELNO
			    , CU.APC_CD             AS APC_CD
			    , CU.OGDP_NM            AS OGDP_NM
			    , CU.CHRGD_CERT_YN      AS CHRGD_CERT_YN
			    , CU.CHRGD_CERT_TYPE    AS CHRGD_CERT_TYPE
			    , CU.LCK_YN             AS LCK_YN
			    , CU.LGN_FAIL_NMTM      AS LGN_FAIL_NMTM
			    , CU.END_LGN_DT         AS END_LGN_DT
			    , CU.END_LGN_IP         AS END_LGN_IP
			  FROM
			      TB_COM_AUTH CA
			  	, TB_COM_AUTH_USER AU
			  	, TB_COM_USER CU
			 WHERE CA.AUTHRT_ID = AU.AUTHRT_ID
			   AND AU.USER_ID = CU.USER_ID
			   AND CA.DEL_YN = 'N'
			   AND AU.DEL_YN = 'N'
			   AND CU.DEL_YN = 'N'
    	]]>
		<if test='authrtId != null and authrtId != ""'>
			   AND CA.AUTHRT_ID = #{authrtId}
		</if>
		<if test='authrtNm != null and authrtNm != ""'>
			   AND CU.AUTHRT_NM LIKE '%' || #{authrtNm} || '%'
		</if>
		<if test='userId != null and userId != ""'>
			   AND CU.USER_ID = #{userId}
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>
		<if test='userType != null and userType != ""'>
			   AND CU.USER_TYPE = #{userType}
		</if>
		<if test='userStts != null and userStts != ""'>
			   AND CU.USER_STTS = #{userStts}
		</if>
		<if test='apcCd != null and apcCd != ""'>
			   AND CU.APC_CD = #{apcCd}
		</if>
		<if test='ogdpNm != null and ogdpNm != ""'>
			   AND CU.OGDP_NM LIKE '%' || #{ogdpNm} || '%'
		</if>
		
    	<![CDATA[
    		 ORDER BY AUTHRT_ID, USER_ID, USER_NM
    	]]>	
    </select>
    
</mapper>