<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : UntyOgnzMapper.xml                                    				-->
<!-- DESC : 통합조직 정보 mapper                                       			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2024.07.22  	신정철        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.co.ognz.mapper.UntyOgnzMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectNewUntyOgnzId		-->
	<!-- DESC : 통합조직 신규ID 조회                                            	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectNewUntyOgnzId" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO" resultType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectNewUntyOgnzId */
				  'N'	AS DEL_YN
				, FN_GET_ID_UNTY_OGNZ()		AS UNTY_OGNZ_ID
			  FROM DUAL
    	]]>
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectUntyOgnz			-->
	<!-- DESC : 통합조직 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectUntyOgnz" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO" resultType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectUntyOgnz */
				  UO.UNTY_OGNZ_ID       AS UNTY_OGNZ_ID
				, UO.UNTY_OGNZ_TYPE     AS UNTY_OGNZ_TYPE
				, UO.UNTY_OGNZ_NM       AS UNTY_OGNZ_NM
				, UO.UP_UNTY_OGNZ_ID    AS UP_UNTY_OGNZ_ID
				, UO.UNTY_OGNZ_LINK_CD  AS UNTY_OGNZ_LINK_CD
				, UO.INDCT_SEQ          AS INDCT_SEQ
				, UO.CTPV               AS CTPV
				, UO.SGG                AS SGG
				, UO.DEL_YN             AS DEL_YN			
			  FROM TB_UNTY_OGNZ UO
			 WHERE UO.UNTY_OGNZ_ID = #{untyOgnzId}
    	]]>
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectUntyOgnzList		-->
	<!-- DESC : 통합조직 목록조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectUntyOgnzList" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO" resultType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectUntyOgnzList */
				  UO.UNTY_OGNZ_ID       AS UNTY_OGNZ_ID
				, UO.UNTY_OGNZ_TYPE     AS UNTY_OGNZ_TYPE
				, UO.UNTY_OGNZ_NM       AS UNTY_OGNZ_NM
				, UO.UP_UNTY_OGNZ_ID    AS UP_UNTY_OGNZ_ID
				, UO.UNTY_OGNZ_LINK_CD  AS UNTY_OGNZ_LINK_CD
				, UO.INDCT_SEQ          AS INDCT_SEQ
				, UO.CTPV               AS CTPV
				, UO.SGG                AS SGG	
				, UO.CRNO				AS CRNO
				, UO.BRNO				AS BRNO
			  FROM TB_UNTY_OGNZ UO
			 WHERE UO.DEL_YN = 'N'
    	]]>
    	
		<if test='untyOgnzType != null and untyOgnzType != ""'>
			   AND UO.UNTY_OGNZ_TYPE = #{untyOgnzType}
		</if>
		<if test='untyOgnzNm != null and untyOgnzNm != ""'>
			   AND UO.UNTY_OGNZ_NM LIKE '%' || #{untyOgnzNm} || '%'
		</if>
		
    	<![CDATA[
    		 ORDER BY UP_UNTY_OGNZ_ID, INDCT_SEQ, UNTY_OGNZ_ID
    	]]>
		
    </select>
    
    
    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectOgnzList			-->
	<!-- DESC : 조직 목록조회.                                             			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectOgnzList" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO" resultType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectOgnzList */
				  UO.UNTY_OGNZ_ID       AS UNTY_OGNZ_ID
				, UO.UNTY_OGNZ_TYPE     AS UNTY_OGNZ_TYPE
				, UO.UNTY_OGNZ_NM       AS UNTY_OGNZ_NM
				, UO.UP_UNTY_OGNZ_ID    AS UP_UNTY_OGNZ_ID
				, UO.UNTY_OGNZ_LINK_CD  AS UNTY_OGNZ_LINK_CD
				, UO.INDCT_SEQ          AS INDCT_SEQ
				, UO.CTPV               AS CTPV
				, UO.SGG                AS SGG	
				, UO.CRNO				AS CRNO
				, UO.BRNO				AS BRNO
				, UO.FILTER_KEY			AS FILTER_KEY	
			  FROM VW_COM_UNTY_OGNZ UO
			 WHERE UO.DEL_YN = 'N'
    	]]>
    	
		<if test='untyOgnzType != null and untyOgnzType != ""'>
			   AND UO.UNTY_OGNZ_TYPE = #{untyOgnzType}
		</if>
		<if test='untyOgnzNm != null and untyOgnzNm != ""'>
			   AND UO.UNTY_OGNZ_NM LIKE '%' || #{untyOgnzNm} || '%'
		</if>
		
    	<![CDATA[
    		 ORDER BY UNTY_OGNZ_NM, INDCT_SEQ, UNTY_OGNZ_ID
    	]]>
		
    </select>
    
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectUntyOgnzTreeList	-->
	<!-- DESC : 통합조직 트리 목록조회.                                       		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectUntyOgnzTreeList" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO" resultType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectUntyOgnzTreeList */
				  UO.UNTY_OGNZ_LVL		AS UNTY_OGNZ_LVL
				, UO.SEQ				AS UNTY_OGNZ_SEQ
				, UO.UNTY_OGNZ_ID       AS UNTY_OGNZ_ID
				, UO.UNTY_OGNZ_TYPE     AS UNTY_OGNZ_TYPE
				, UO.UNTY_OGNZ_NM       AS UNTY_OGNZ_NM
				, UO.UP_UNTY_OGNZ_ID    AS UP_UNTY_OGNZ_ID
				, UUO.UNTY_OGNZ_NM		AS UP_UNTY_OGNZ_NM
				, UUO.UNTY_OGNZ_TYPE	AS UP_UNTY_OGNZ_TYPE
				, UO.UNTY_OGNZ_LINK_CD  AS UNTY_OGNZ_LINK_CD
				, UO.INDCT_SEQ          AS INDCT_SEQ
				, UO.CTPV               AS CTPV
				, UO.SGG                AS SGG
				, UO.CRNO				AS CRNO
				, UO.BRNO				AS BRNO
			  FROM (
				SELECT
					  LEVEL			AS UNTY_OGNZ_LVL
					, ROWNUM		AS SEQ
					, UO.UNTY_OGNZ_ID       AS UNTY_OGNZ_ID
					, UO.UNTY_OGNZ_TYPE     AS UNTY_OGNZ_TYPE
					, UO.UNTY_OGNZ_NM       AS UNTY_OGNZ_NM
					, UO.UP_UNTY_OGNZ_ID    AS UP_UNTY_OGNZ_ID
					, UO.UNTY_OGNZ_LINK_CD  AS UNTY_OGNZ_LINK_CD
					, UO.INDCT_SEQ          AS INDCT_SEQ
					, UO.CTPV               AS CTPV
					, UO.SGG                AS SGG
					, UO.CRNO				AS CRNO
					, UO.BRNO				AS BRNO
				  FROM VW_COM_UNTY_OGNZ UO
				 WHERE UO.DEL_YN = 'N'

				START WITH UO.UP_UNTY_OGNZ_ID = '*'
    	]]>

    	<![CDATA[
			    CONNECT BY PRIOR UO.UNTY_OGNZ_ID = UO.UP_UNTY_OGNZ_ID
			     ORDER SIBLINGS BY UO.INDCT_SEQ, UO.UNTY_OGNZ_ID
			  	) UO
			  	, VW_COM_UNTY_OGNZ UUO
			 WHERE UO.UP_UNTY_OGNZ_ID = UUO.UNTY_OGNZ_ID(+)
			   AND UUO.DEL_YN(+) = 'N'
    	]]>
			<if test='untyOgnzType != null and untyOgnzType != ""'>
				   AND (
					   	UO.UNTY_OGNZ_TYPE = #{untyOgnzType}
					   	OR
					   	UUO.UNTY_OGNZ_TYPE = #{untyOgnzType}
					)
			</if>
			<if test='untyOgnzNm != null and untyOgnzNm != ""'>
				   AND (
					   	UO.UNTY_OGNZ_NM LIKE '%' || #{untyOgnzNm} || '%'
					   	OR
					   	UUO.UNTY_OGNZ_NM LIKE '%' || #{untyOgnzNm} || '%'
					)
			</if>
			<if test='untyOgnzId != null and untyOgnzId != ""'>
				   AND UO.UNTY_OGNZ_ID = #{untyOgnzId}
			</if>
			<if test='ctpv != null and ctpv != ""'>
				   AND UO.CTPV = #{ctpv}
			</if>
			<if test='sgg != null and sgg != ""'>
				   AND UO.SGG = #{sgg}
			</if>
			<if test='brno != null and brno != ""'>
				   AND UO.BRNO = #{brno}
			</if>
			
			
    	<![CDATA[
    		 ORDER BY SUBSTR(UNTY_OGNZ_TYPE, 1, 1), UNTY_OGNZ_SEQ
    	]]>
    </select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectUntyOgnzApcList	-->
	<!-- DESC : 통합조직 APC 목록조회.                                       		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectUntyOgnzApcList" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO" resultType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.selectUntyOgnzApcList */
				  UO.UNTY_OGNZ_LVL		AS UNTY_OGNZ_LVL
				, UO.SEQ				AS UNTY_OGNZ_SEQ
				, UO.UNTY_OGNZ_ID       AS UNTY_OGNZ_ID
				, UO.UNTY_OGNZ_TYPE     AS UNTY_OGNZ_TYPE
				, UO.UNTY_OGNZ_NM       AS UNTY_OGNZ_NM
				, UO.UNTY_OGNZ_LINK_CD  AS UNTY_OGNZ_LINK_CD
				, UO.CTPV               AS CTPV
				, UO.SGG                AS SGG
				, OA.APC_CD				AS APC_CD
				, APC.APC_NM			AS APC_NM
				, APC.BRNO				AS BRNO
				, APC.ADDR				AS ADDR
				, OA.INDCT_SEQ			AS INDCT_SEQ
			  FROM (
				SELECT
					  LEVEL			AS UNTY_OGNZ_LVL
					, ROWNUM		AS SEQ
					, UO.UNTY_OGNZ_ID       AS UNTY_OGNZ_ID
					, UO.UNTY_OGNZ_TYPE     AS UNTY_OGNZ_TYPE
					, UO.UNTY_OGNZ_NM       AS UNTY_OGNZ_NM
					, UO.UP_UNTY_OGNZ_ID    AS UP_UNTY_OGNZ_ID
					, UO.UNTY_OGNZ_LINK_CD  AS UNTY_OGNZ_LINK_CD
					, UO.INDCT_SEQ          AS INDCT_SEQ
					, UO.CTPV               AS CTPV
					, UO.SGG                AS SGG	
				  FROM VW_COM_UNTY_OGNZ UO
				 WHERE UO.DEL_YN = 'N'
				START WITH UO.UP_UNTY_OGNZ_ID = #{upUntyOgnzId} AND UO.UNTY_OGNZ_ID = #{untyOgnzId}
    	]]>

    	<![CDATA[
			    CONNECT BY PRIOR UO.UNTY_OGNZ_ID = UO.UP_UNTY_OGNZ_ID
			     ORDER SIBLINGS BY UO.INDCT_SEQ, UO.UNTY_OGNZ_ID
			  	) UO
			  	, TB_UNTY_OGNZ_APC OA
			  	, TB_APC_INFO APC
			 WHERE UO.UNTY_OGNZ_ID = OA.UNTY_OGNZ_ID
			   AND OA.DEL_YN = 'N'
			   AND OA.APC_CD = APC.APC_CD(+)
			   AND APC.DEL_YN(+) = 'N'
			ORDER BY UO.SEQ, OA.INDCT_SEQ
    	]]>
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.insertUntyOgnz			-->
	<!-- DESC : 통합조직 등록.                                           			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertUntyOgnz" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
			INSERT /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.insertUntyOgnz */
    	 	  INTO TB_UNTY_OGNZ (
    	 	  	  UNTY_OGNZ_ID
				, UNTY_OGNZ_TYPE
				, UNTY_OGNZ_NM
				, UP_UNTY_OGNZ_ID
				, UNTY_OGNZ_LINK_CD
				, INDCT_SEQ
				, CTPV
				, SGG
    		  	, SYS_FRST_INPT_DT
    		  	, SYS_FRST_INPT_USER_ID
    		  	, SYS_FRST_INPT_PRGRM_ID
    		  	, SYS_LAST_CHG_DT
    		  	, SYS_LAST_CHG_USER_ID
    		  	, SYS_LAST_CHG_PRGRM_ID
			) VALUES (
    	 	  	  #{untyOgnzId}
				, #{untyOgnzType}
				, #{untyOgnzNm}
				, #{upUntyOgnzId}
				, #{untyOgnzLinkCd}
				, #{indctSeq}
				, #{ctpv}
				, #{sgg}
   			  	, SYSDATE
   			  	, #{sysFrstInptUserId}
   			  	, #{sysFrstInptPrgrmId}
   			  	, SYSDATE
   			  	, #{sysLastChgUserId}
   			  	, #{sysLastChgPrgrmId}
   			)
		]]>
    </insert>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.updateUntyOgnz			-->
	<!-- DESC : 통합조직 등록.                                           			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <update id="updateUntyOgnz" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.updateUntyOgnz */
	    		TB_UNTY_OGNZ 
			SET
				  SYS_LAST_CHG_DT			= SYSDATE
	    		, SYS_LAST_CHG_USER_ID		= #{sysLastChgUserId}
	    		, SYS_LAST_CHG_PRGRM_ID		= #{sysLastChgPrgrmId}

				, UNTY_OGNZ_TYPE	= #{untyOgnzType}
				, UNTY_OGNZ_NM		= #{untyOgnzNm}
				, UP_UNTY_OGNZ_ID	= #{upUntyOgnzId}
				, UNTY_OGNZ_LINK_CD	= #{untyOgnzLinkCd}
				, INDCT_SEQ			= #{indctSeq}
				, CTPV				= #{ctpv}
				, SGG				= #{sgg}
				
    	 	 WHERE UNTY_OGNZ_ID = #{untyOgnzId}
    	 ]]>
    </update>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.updateUntyOgnzForDelY	-->
	<!-- DESC : 통합조직 변경 (set delYn 'Y')	                         			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <update id="updateUntyOgnzForDelY" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.updateUntyOgnzForDelY */
	    		TB_UNTY_OGNZ 
			SET
				  DEL_YN = 'Y'
				  				
    	 	 WHERE UNTY_OGNZ_ID = #{untyOgnzId}
    	 ]]>
    </update>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.ognz.mapper.UntyOgnzMapper.deleteUntyOgnz			-->
	<!-- DESC : 통합조직 삭제.                                           			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.07.22  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<delete id="deleteUntyOgnz" parameterType="com.at.apcss.co.ognz.vo.UntyOgnzVO">
		<![CDATA[
			DELETE /* com.at.apcss.co.ognz.mapper.UntyOgnzMapper.deleteUntyOgnz */
	    		TB_UNTY_OGNZ
    	 	 WHERE UNTY_OGNZ_ID = #{untyOgnzId}
		]]>
	</delete>
    
</mapper>