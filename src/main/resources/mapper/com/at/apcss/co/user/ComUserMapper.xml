<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : ComUserMapper.xml                                    				-->
<!-- DESC : 사용자 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.co.user.mapper.ComUserMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUser                    -->
	<!-- DESC : 사용자 테이블 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComUser" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectComUser */
				  CU.USER_ID            AS USER_ID
				, CU.USER_NM            AS USER_NM
				, CU.USER_TYPE          AS USER_TYPE
				, CU.USER_STTS          AS USER_STTS
				, CU.EML                AS EML
				, CU.TELNO          	AS TELNO
				, CU.APC_CD             AS APC_CD
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) AS APC_NM
				, CU.OGDP_NM            AS OGDP_NM
				, CU.CHRGD_CERT_YN      AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    AS CHRGD_CERT_TYPE
				, CU.LCK_YN             AS LCK_YN
				, CU.LGN_FAIL_NMTM      AS LGN_FAIL_NMTM
				, CU.END_LGN_DT         AS END_LGN_DT
				, CU.END_LGN_IP         AS END_LGN_IP
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.DEL_YN                 AS DEL_YN
				, CU.SYS_FRST_INPT_DT       AS SYS_FRST_INPT_DT
				, CU.SYS_FRST_INPT_USER_ID  AS SYS_FRST_INPT_USER_ID
				, CU.SYS_FRST_INPT_PRGRM_ID AS SYS_FRST_INPT_PRGRM_ID
				, CU.SYS_LAST_CHG_DT       	AS SYS_LAST_CHG_DT
				, CU.SYS_LAST_CHG_USER_ID  	AS SYS_LAST_CHG_USER_ID
				, CU.SYS_LAST_CHG_USER_ID 	AS SYS_LAST_CHG_USER_ID

			  FROM TB_COM_USER CU
			 WHERE CU.USER_ID = #{userId}
    	]]>
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserList                -->
	<!-- DESC : 사용자 테이블 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComUserList" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[ 
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectComUserList */
    	]]>
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>

    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, 
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
				pt0.*
				, (SELECT FN_GET_COM_CD_VL_NM('USER_TYPE', pt0.USER_TYPE) FROM DUAL) AS USER_TYPE_NM
				, (SELECT FN_GET_COM_CD_VL_NM('USER_STTS', pt0.USER_STTS) FROM DUAL) AS USER_STTS_NM
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = pt0.APC_CD) AS APC_NM
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',pt0.LCK_YN) FROM DUAL) AS REVERSE_LCK_YN
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',pt0.DEL_YN) FROM DUAL) AS REVERSE_YN
				, (SELECT FN_GET_COM_CD_VL_NM('UNTY_CTPV', pt0.CTPV) FROM DUAL) AS CTPV_NM
				, (SELECT FN_GET_COM_CD_VL_NM('UNTY_SGG', pt0.SGG) FROM DUAL) AS SGG_NM
				, (SELECT FN_GET_COM_CD_VL_EXPLN('UNTY_SGG', pt0.SGG) FROM DUAL) AS SGG_EXPLN
				, (SELECT FN_GET_COM_CD_VL_NM('TYPE_CD', pt0.MBR_TYPE_CD) FROM DUAL) AS MBR_TYPE_NM
				, CASE
					WHEN pt0.MBR_TYPE_CD = '1' THEN
						(
							SELECT MAX(X.OGNZ_NM)
							  FROM TB_APC_OGNZ_INFO X
							 WHERE X.OGNZ_CD = pt0.UNTY_OGNZ_CD
						)
					ELSE
						NULL
				  END	AS OGNZ_NM
						
    		  FROM (
			SELECT 
			      CU.USER_ID            	AS USER_ID
				, CU.USER_NM            	AS USER_NM
				, CU.PSWD					AS PSWD
				, CU.USER_TYPE				AS USER_TYPE
				, CU.USER_STTS          	AS USER_STTS
				, CU.TYPE_CD				AS TYPE_CD
				, CU.TYPE_CD				AS MBR_TYPE_CD
				, CU.EML                	AS EML
				, CU.TELNO          	 	AS TELNO
				, CU.APC_CD             	AS APC_CD
				, CU.OGDP_NM            	AS OGDP_NM
				, CU.CHRGD_CERT_YN      	AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    	AS CHRGD_CERT_TYPE
				, CU.LCK_YN 				AS LCK_YN
				, CU.LGN_FAIL_NMTM      	AS LGN_FAIL_NMTM
				, CU.END_LGN_DT         	AS END_LGN_DT
				, CU.END_LGN_IP         	AS END_LGN_IP
				, CU.RMRK				 	AS RMRK
				, CU.JBTTL_NM 				AS JBTTL_NM
				, CU.TKCG_TASK_NM 			AS TKCG_TASK_NM
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.DEL_YN                 AS DEL_YN
				, CU.CRNO                   AS CRNO
				, CU.BRNO					AS BRNO
				, CU.BRDT                   AS BRDT
				
				, CU.JBPS					AS JBPS
				, CU.CO_TELNO				AS CO_TELNO
				, CU.CO_NM					AS CO_NM
				, CU.CTPV					AS CTPV
				, CU.SGG					AS SGG
				, CU.UNTY_OGNZ_CD			AS UNTY_OGNZ_CD
				
				, CU.SYS_FRST_INPT_DT       AS SYS_FRST_INPT_DT
				, CU.SYS_FRST_INPT_USER_ID  AS SYS_FRST_INPT_USER_ID
				, CU.SYS_FRST_INPT_PRGRM_ID AS SYS_FRST_INPT_PRGRM_ID
				, CU.SYS_LAST_CHG_DT       	AS SYS_LAST_CHG_DT
				, CU.SYS_LAST_CHG_USER_ID  	AS SYS_LAST_CHG_USER_ID
				, CU.SYS_LAST_CHG_PRGRM_ID 	AS SYS_LAST_CHG_PRGRM_ID
				
			  FROM TB_COM_USER CU
			 WHERE CU.DEL_YN = 'N'
    	]]>
		<if test='apcCd != null and apcCd != ""'>
			   AND CU.APC_CD = #{apcCd}
		</if>
		<if test='userId != null and userId != ""'>
			   AND CU.USER_ID LIKE '%' || #{userId} || '%'
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>
		<if test='userType != null and userType != ""'>
			   AND CU.USER_TYPE = #{userType}
		</if>
		<if test='userStts != null and userStts != ""'>
			   AND CU.USER_STTS = #{userStts}
		</if>
		<if test='ogdpNm != null and ogdpNm != ""'>
			   AND CU.OGDP_NM LIKE '%' || #{ogdpNm} || '%'
		</if>
		<if test='apcNm != null and apcNm != ""'>
			   AND (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) LIKE #{apcNm}
		</if>
		
		<if test='mbrTypeCd != null and mbrTypeCd != ""'>
			   AND CU.TYPE_CD = #{mbrTypeCd}
		</if>
		
		<if test='ctpv != null and ctpv != ""'>
			   AND CU.CTPV = #{ctpv}
		</if>
		<if test='sgg != null and sgg != ""'>
			   AND CU.SGG = #{sgg}
		</if>
		
		<if test='ognzNm != null and ognzNm != ""'>
			   AND EXISTS (
					SELECT 1
					  FROM TB_APC_OGNZ_INFO X
					 WHERE X.OGNZ_CD = CU.UNTY_OGNZ_CD
					   AND X.OGNZ_NM LIKE '%' || #{ognzNm} || '%'
			   )
		</if>
		
    	<![CDATA[
    		 ORDER BY USER_ID, USER_NM
    		  ) pt0
    	]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserApcList             -->
	<!-- DESC : APC관리자승인등록 테이블 목록 조회.                                         -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.28  	김현호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComUserApcList" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
    		  FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectComUserList */
			      CU.USER_ID            	AS USER_ID
				, CU.USER_NM            	AS USER_NM
				, CU.PSWD					AS PSWD
				, CU.USER_TYPE				AS USER_TYPE
				, (SELECT FN_GET_COM_CD_VL_NM('USER_TYPE', CU.USER_TYPE) FROM DUAL) AS USER_TYPE_NM
				, CU.USER_STTS          	AS USER_STTS
				, (SELECT FN_GET_COM_CD_VL_NM('USER_STTS', CU.USER_STTS) FROM DUAL) AS USER_STTS_NM
				, CU.EML                	AS EML
				, CU.TELNO          	 	AS TELNO
				, CU.APC_CD             	AS APC_CD
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) AS APC_NM
				, CU.OGDP_NM            	AS OGDP_NM
				, CU.CHRGD_CERT_YN      	AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    	AS CHRGD_CERT_TYPE
				, CU.LCK_YN AS LCK_YN
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',CU.LCK_YN) FROM DUAL) AS REVERSE_LCK_YN
				, CU.LGN_FAIL_NMTM      	AS LGN_FAIL_NMTM
				, CU.END_LGN_DT         	AS END_LGN_DT
				, CU.END_LGN_IP         	AS END_LGN_IP
				, CU.RMRK				 	AS RMRK
				, CU.JBTTL_NM 				AS JBTTL_NM
				, CU.TKCG_TASK_NM 			AS TKCG_TASK_NM
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.OD_SBMSN_YN			AS OD_SBMSN_YN
				, CU.APLY_DOC_SBMSN_YN		AS APLY_DOC_SBMSN_YN
				, CU.DEL_YN                 AS DEL_YN
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',CU.DEL_YN) FROM DUAL) AS REVERSE_YN
				, CU.SYS_FRST_INPT_DT       AS SYS_FRST_INPT_DT
				, CU.SYS_FRST_INPT_USER_ID  AS SYS_FRST_INPT_USER_ID
				, CU.SYS_FRST_INPT_PRGRM_ID AS SYS_FRST_INPT_PRGRM_ID
				, CU.SYS_LAST_CHG_DT       AS SYS_LAST_CHG_DT
				, CU.SYS_LAST_CHG_USER_ID  AS SYS_LAST_CHG_USER_ID
				, CU.SYS_LAST_CHG_PRGRM_ID AS SYS_LAST_CHG_PRGRM_ID
			  FROM TB_COM_USER CU
			  WHERE CU.DEL_YN = 'N'
			  AND CU.USER_TYPE IN ('10','11')
    	]]>
		<if test='apcCd != null and apcCd != ""'>
			   AND CU.APC_CD = #{apcCd}
		</if>
		<if test='userId != null and userId != ""'>
			   AND CU.USER_ID LIKE '%' || #{userId} || '%'
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>
		<if test='userStts != null and userStts != ""'>
			   AND CU.USER_STTS = #{userStts}
		</if>
    	<![CDATA[
    		 ORDER BY USER_ID, USER_NM
    	]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		  ) pt0
    		ORDER BY USER_TYPE
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectUntyUserAprvList           -->
	<!-- DESC : 통합사용자승인등록 테이블 목록 조회.                                -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.28  	김현호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectUntyUserAprvList" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	
		<![CDATA[
    		SELECT /* com.at.apcss.co.user.ComUserMapper.selectUntyUserAprvList */
		]]>
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
    			, pt0.*
    		  FROM (
			SELECT
			      CU.USER_ID            	AS USER_ID
				, CU.USER_NM            	AS USER_NM
				, CU.USER_TYPE				AS USER_TYPE
				, (SELECT FN_GET_COM_CD_VL_NM('USER_TYPE', CU.USER_TYPE) FROM DUAL) AS USER_TYPE_NM
				, CU.USER_STTS          	AS USER_STTS
				, (SELECT FN_GET_COM_CD_VL_NM('USER_STTS', CU.USER_STTS) FROM DUAL) AS USER_STTS_NM
				, CU.EML                	AS EML
				, CU.TELNO          	 	AS TELNO
				, CU.APC_CD             	AS APC_CD
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) AS APC_NM
				, CU.OGDP_NM            	AS OGDP_NM
				, CU.CHRGD_CERT_YN      	AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    	AS CHRGD_CERT_TYPE
				, CU.LCK_YN AS LCK_YN
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',CU.LCK_YN) FROM DUAL) AS REVERSE_LCK_YN
				, CU.LGN_FAIL_NMTM      	AS LGN_FAIL_NMTM
				, CU.END_LGN_DT         	AS END_LGN_DT
				, CU.END_LGN_IP         	AS END_LGN_IP
				, CU.RMRK				 	AS RMRK
				, CU.JBTTL_NM 				AS JBTTL_NM
				, CU.TKCG_TASK_NM 			AS TKCG_TASK_NM
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.OD_SBMSN_YN			AS OD_SBMSN_YN
				, CU.APLY_DOC_SBMSN_YN		AS APLY_DOC_SBMSN_YN
				
				, CU.CRNO					AS CRNO
				, CU.BRNO					AS BRNO
				, CU.UNTY_OGNZ_ID			AS UNTY_OGNZ_ID
				, (
					SELECT X.UNTY_OGNZ_NM
					  FROM VW_COM_UNTY_OGNZ X
					 WHERE X.UNTY_OGNZ_TYPE = CU.UNTY_OGNZ_TYPE
					   AND X.UNTY_OGNZ_ID = CU.UNTY_OGNZ_ID
				)							AS UNTY_OGNZ_NM
				--, CU.UNTY_OGNZ_TYPE			AS UNTY_OGNZ_TYPE
				, NVL(
					CU.UNTY_OGNZ_TYPE
					, CASE
						WHEN CU.USER_TYPE = '21' THEN 'C10'						
						WHEN CU.USER_TYPE = '22' THEN 'C20'
						WHEN CU.USER_TYPE = '24' THEN 'C30'
						WHEN CU.USER_TYPE = '27' THEN 'G20'
						WHEN CU.USER_TYPE = '28' THEN 'G30'
						ELSE NULL
					  END
				)							AS UNTY_OGNZ_TYPE
						
				, CU.UNTY_OGNZ_CD			AS UNTY_OGNZ_CD
				, CU.UNTY_AUTHRT_TYPE		AS UNTY_AUTHRT_TYPE
				, CU.UNTY_AUTHRT_MNG_YN		AS UNTY_AUTHRT_MNG_YN
				
				, CU.CTPV	AS CTPV
				, (SELECT FN_GET_COM_CD_VL_NM('UNTY_CTPV', CU.CTPV) FROM DUAL) AS CTPV_NM
				, CU.SGG	AS SGG
				, (SELECT FN_GET_COM_CD_VL_NM('UNTY_SGG', CU.SGG) FROM DUAL) AS SGG_NM
				
				, (
					SELECT MAX(X.USER_ID)	AS USER_ID
					  FROM TB_COM_USER X
					 WHERE X.UNTY_OGNZ_ID = CU.UNTY_OGNZ_ID
					   AND X.UNTY_AUTHRT_MNG_YN = 'Y'
				)	AS UNTY_AUTHRT_MNG_USER_ID
				
				, (
					SELECT COUNT(*)
					  FROM TB_COM_USER X
					 WHERE X.UNTY_OGNZ_ID = CU.UNTY_OGNZ_ID
					   AND X.UNTY_AUTHRT_MNG_YN = 'Y'
				)	AS UNTY_AUTHRT_MNG_USER_CNT
				
			  FROM TB_COM_USER CU
			 WHERE CU.DEL_YN = 'N'
			   AND CU.USER_TYPE IN ('21', '22', '23', '24', '27', '28', '30')
    	]]>
		<if test='userId != null and userId != ""'>
			   AND CU.USER_ID LIKE '%' || #{userId} || '%'
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>
		<if test='userStts != null and userStts != ""'>
			   AND CU.USER_STTS = #{userStts}
		</if>
		<if test='userType != null and userType != ""'>
			   AND CU.USER_TYPE = #{userType}
		</if>
		<if test='untyAuthrtType != null and untyAuthrtType != ""'>
			   AND CU.UNTY_AUTHRT_TYPE = #{untyAuthrtType}
		</if>
		
		<if test='ctpv != null and ctpv != ""'>
			   AND CU.CTPV = #{ctpv}
		</if>
		
		<if test='sgg != null and sgg != ""'>
			   AND CU.SGG = #{sgg}
		</if>
		
		<choose>
    		<when test='superUserYn != null and superUserYn.equals("Y")'>
				
    		</when>
    		<when test='untyOgnzId != null and untyOgnzId != ""'>
    			AND #{untyAuthrtMngYn} = 'Y'
				AND (
						(	
							CU.UNTY_OGNZ_ID IN (
								SELECT
									#{untyOgnzId}		AS UNTY_OGNZ_ID
								  FROM DUAL
								UNION ALL
								SELECT
									UO.UNTY_OGNZ_ID		AS UNTY_OGNZ_ID
								  FROM VW_COM_UNTY_OGNZ UO
								 WHERE UO.DEL_YN = 'N'
								   AND UO.UP_UNTY_OGNZ_ID = #{untyOgnzId}
						   		)
					   	)
					   	OR
					   	(
					   		(
						   		#{untyOgnzType} IN ('C10', 'C20', 'C30')
						   		AND
						   		CU.BRNO IN (
						   			SELECT
										UO.BRNO		AS BRNO
									  FROM VW_COM_UNTY_OGNZ UO
									 WHERE UO.DEL_YN = 'N'
									   AND (
									   		UO.UNTY_OGNZ_ID = #{untyOgnzId}
									   		OR
									   		UO.UP_UNTY_OGNZ_ID = #{untyOgnzId}
									   )
						   		)
						   	)
						   	OR
						   	(
						   		#{untyOgnzType} IN ('G20')
						   		AND
						   		CU.CTPV = (
						   			SELECT 
										UO.UNTY_OGNZ_LINK_CD AS UNTY_OGNZ_LINK_CD
									  FROM VW_COM_UNTY_OGNZ UO
									 WHERE UO.DEL_YN = 'N'
									   AND UO.UNTY_OGNZ_ID = #{untyOgnzId}
						   		)
						   	)
						   	OR
						   	(
						   		#{untyOgnzType} IN ('G30')
						   		AND
						   		CU.SGG = (
						   			SELECT 
										UO.UNTY_OGNZ_LINK_CD AS UNTY_OGNZ_LINK_CD
									  FROM VW_COM_UNTY_OGNZ UO
									 WHERE UO.DEL_YN = 'N'
									   AND UO.UNTY_OGNZ_ID = #{untyOgnzId}
						   		)
						   	)
					   	)
					)
			</when>
    		<otherwise>
			   
    		</otherwise>
    	</choose>
		
    	<![CDATA[
    		 ORDER BY USER_ID, USER_NM
    		  ) pt0
    	]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		ORDER BY USER_TYPE
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectCorpUserAprvList           -->
	<!-- DESC : 법인사용자승인등록 테이블 목록 조회.                                -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.28  	김현호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectCorpUserAprvList" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	
		<![CDATA[
    		SELECT /* com.at.apcss.co.user.ComUserMapper.selectCorpUserAprvList */
		]]>
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
    			, pt0.*
    		  FROM (
			SELECT
			      CU.USER_ID            	AS USER_ID
				, CU.USER_NM            	AS USER_NM
				, CU.USER_TYPE				AS USER_TYPE
				, (SELECT FN_GET_COM_CD_VL_NM('USER_TYPE', CU.USER_TYPE) FROM DUAL) AS USER_TYPE_NM
				, CU.USER_STTS          	AS USER_STTS
				, (SELECT FN_GET_COM_CD_VL_NM('USER_STTS', CU.USER_STTS) FROM DUAL) AS USER_STTS_NM
				, CU.EML                	AS EML
				, CU.TELNO          	 	AS TELNO
				, CU.APC_CD             	AS APC_CD
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) AS APC_NM
				, CU.OGDP_NM            	AS OGDP_NM
				, CU.CHRGD_CERT_YN      	AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    	AS CHRGD_CERT_TYPE
				, CU.RMRK				 	AS RMRK
				, CU.JBTTL_NM 				AS JBTTL_NM
				, CU.TKCG_TASK_NM 			AS TKCG_TASK_NM
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.OD_SBMSN_YN			AS OD_SBMSN_YN
				, CU.APLY_DOC_SBMSN_YN		AS APLY_DOC_SBMSN_YN
				
				--, CU.CRNO					AS CRNO
				, (
					SELECT X.CRNO
					  FROM TB_APC_OGNZ_INFO X
					 WHERE X.OGNZ_CD = CU.UNTY_OGNZ_CD
				)							AS CRNO
				--, CU.BRNO					AS BRNO
				, (
					SELECT X.BRNO
					  FROM TB_APC_OGNZ_INFO X
					 WHERE X.OGNZ_CD = CU.UNTY_OGNZ_CD
				)							AS BRNO
				, CU.CO_TELNO				AS CO_TELNO
				, CU.JBPS					AS JBPS
				, 'UO' || CU.UNTY_OGNZ_CD	AS UNTY_OGNZ_CD
				, (
					SELECT MAX(X.OGNZ_NM)
					  FROM TB_APC_OGNZ_INFO X
					 WHERE X.OGNZ_CD = CU.UNTY_OGNZ_CD
				)							AS OGNZ_NM
				, CASE
					WHEN EXISTS (
							SELECT 1
							  FROM TB_COM_UNTY_MNGR X
							 WHERE X.UNTY_OGNZ_CD = 'UO' || CU.UNTY_OGNZ_CD
							   AND X.USER_ID = CU.USER_ID
						) THEN 'Y'
					ELSE 'N'
				  END						AS AUTHRT_MNGR_YN
				
				, NVL((
					SELECT MAX(X.APLY_YN)		AS APRV_YN
					  FROM TB_COM_USER_SYS_AUTH X
					 WHERE X.USER_ID = CU.USER_ID
					   AND X.SYS_ID = 'AM'
					), 'N')					AS SYS_MES_YN
				, NVL((
					SELECT MAX(X.APRV_YN)		AS APRV_YN
					  FROM TB_COM_USER_SYS_AUTH X
					 WHERE X.USER_ID = CU.USER_ID
					   AND X.SYS_ID = 'FM'
					), 'N')					AS SYS_FM_YN
				, NVL((
					SELECT MAX(X.APRV_YN)		AS APRV_YN
					  FROM TB_COM_USER_SYS_AUTH X
					 WHERE X.USER_ID = CU.USER_ID
					   AND X.SYS_ID = 'PD'
					), 'N')					AS SYS_PD_YN
				, NVL((
					SELECT MAX(X.APRV_YN)		AS APRV_YN
					  FROM TB_COM_USER_SYS_AUTH X
					 WHERE X.USER_ID = CU.USER_ID
					   AND X.SYS_ID = 'CS'
					), 'N')					AS SYS_CS_YN
					
				, CASE
					WHEN EXISTS (
							SELECT 1
							  FROM TB_COM_UNTY_MNGR X
							 WHERE X.UNTY_OGNZ_CD =	'UO' || CU.UNTY_OGNZ_CD
							   AND X.USER_ID = CU.USER_ID
							   AND X.DEL_YN = 'N'
							   AND X.APLY_YN = 'Y'
							   AND X.APRV_YN = 'N'
						) THEN 'Y'
					ELSE 'N'
				  END		AS MNGR_APLY_YN
				, CASE
					WHEN EXISTS (
							SELECT 1
							  FROM TB_COM_USER_SYS_AUTH X
							 WHERE X.USER_ID = CU.USER_ID
							   AND X.DEL_YN = 'N'
							   AND X.APLY_YN = 'Y'
							   AND X.APRV_YN = 'N'	
						) THEN 'Y'
					ELSE 'N'
				  END		AS AUTHRT_APLY_YN
				, (
					SELECT AGGR_CONCAT(X.SYS_ID, ',') 
					  FROM TB_COM_USER_SYS_AUTH X 
					 WHERE X.USER_ID = CU.USER_ID
					   AND X.DEL_YN = 'N'
					   AND X.APLY_YN = 'Y'
					   AND X.APRV_YN = 'N'
				)			AS APLY_SYS_ID
				
				, (
					SELECT MAX(X.FILE_SN) AS FILE_SN
					  FROM TB_COM_BRC_FILE X
					 WHERE X.USER_ID = CU.USER_ID
					   AND X.DEL_YN = 'N'
				)	AS BRC_ATCHFL_SN
				
				, (
					SELECT MAX(X.FILE_NM) KEEP (DENSE_RANK LAST ORDER BY X.FILE_SN) AS FILE_NM
					  FROM TB_COM_BRC_FILE X
					 WHERE X.USER_ID = CU.USER_ID
					   AND X.DEL_YN = 'N'
				)	AS BRC_ATCHFL_NM
									
					
			  FROM TB_COM_USER CU
			 WHERE CU.DEL_YN = 'N'
			   AND CU.TYPE_CD = #{mbrTypeCd}
    	]]>
    	
		<if test='userId != null and userId != ""'>
			   AND CU.USER_ID LIKE '%' || #{userId} || '%'
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>
		<if test='userStts != null and userStts != ""'>
			   AND CU.USER_STTS = #{userStts}
		</if>
		
		<if test='corpNm != null and corpNm != ""'>
			   AND EXISTS (
					SELECT 1
					  FROM TB_APC_OGNZ_INFO X
					 WHERE X.OGNZ_CD = CU.UNTY_OGNZ_CD
					   AND X.OGNZ_NM LIKE '%' || #{corpNm} || '%'
			   )
		</if>
		
		<if test='crno != null and crno != ""'>
			   AND EXISTS (
					SELECT 1
					  FROM TB_APC_OGNZ_INFO X
					 WHERE X.OGNZ_CD = CU.UNTY_OGNZ_CD
					   AND X.CRNO LIKE '%' || REPLACE(#{crno}, '-', '') || '%'
			   )
		</if>

		<choose>
    		<when test='aplyYn != null and aplyYn.equals("Y")'>
				AND EXISTS (
						SELECT 1
						  FROM TB_COM_UNTY_MNGR X
						 WHERE X.UNTY_OGNZ_CD =	'UO' || CU.UNTY_OGNZ_CD
						   AND X.USER_ID = CU.USER_ID
						   AND X.DEL_YN = 'N'
						   AND X.APLY_YN = 'Y'
						   AND X.APRV_YN = 'N'
						UNION ALL
						SELECT 1
						  FROM TB_COM_USER_SYS_AUTH X
						 WHERE X.USER_ID = CU.USER_ID
						   AND X.DEL_YN = 'N'
						   AND X.APLY_YN = 'Y'
						   AND X.APRV_YN = 'N'						
					)
    		</when>
    		<when test='aplyYn != null and aplyYn.equals("N")'>
				AND NOT EXISTS (
						SELECT 1
						  FROM TB_COM_UNTY_MNGR X
						 WHERE X.UNTY_OGNZ_CD =	'UO' || CU.UNTY_OGNZ_CD
						   AND X.USER_ID = CU.USER_ID
						   AND X.DEL_YN = 'N'
						   AND X.APLY_YN = 'Y'
						   AND X.APRV_YN = 'N'
						UNION ALL
						SELECT 1
						  FROM TB_COM_USER_SYS_AUTH X
						 WHERE X.USER_ID = CU.USER_ID
						   AND X.DEL_YN = 'N'
						   AND X.APLY_YN = 'Y'
						   AND X.APRV_YN = 'N'						
					)
			</when>
    		<otherwise>
			   
    		</otherwise>
    	</choose>

		<choose>
    		<when test='superUserYn != null and superUserYn.equals("Y")'>
				
    		</when>
    		<when test='untyOgnzCd != null and untyOgnzCd != ""'>
    			AND #{authrtMngrYn} = 'Y'
				AND CU.UNTY_OGNZ_CD = REPLACE(#{untyOgnzCd}, 'UO', '')
			</when>
    		<otherwise>
			   
    		</otherwise>
    	</choose>
		
    	<![CDATA[
    		 ORDER BY USER_NM, USER_ID
    		  ) pt0
    	]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		ORDER BY USER_TYPE
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectLocgovUserAprvList         -->
	<!-- DESC : 지자체사용자승인등록 테이블 목록 조회.                              -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.28  	김현호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectLocgovUserAprvList" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	
		<![CDATA[
    		SELECT /* com.at.apcss.co.user.ComUserMapper.selectLocgovUserAprvList */
		]]>
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
    			, pt0.*
    		  FROM (
			SELECT
			      CU.USER_ID            	AS USER_ID
				, CU.USER_NM            	AS USER_NM
				, CU.USER_TYPE				AS USER_TYPE
				, (SELECT FN_GET_COM_CD_VL_NM('USER_TYPE', CU.USER_TYPE) FROM DUAL) AS USER_TYPE_NM
				, CU.USER_STTS          	AS USER_STTS
				, (SELECT FN_GET_COM_CD_VL_NM('USER_STTS', CU.USER_STTS) FROM DUAL) AS USER_STTS_NM
				, CU.EML                	AS EML
				, CU.TELNO          	 	AS TELNO
				, CU.APC_CD             	AS APC_CD
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) AS APC_NM
				, CU.OGDP_NM            	AS OGDP_NM
				, CU.CHRGD_CERT_YN      	AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    	AS CHRGD_CERT_TYPE
				, CU.RMRK				 	AS RMRK
				, CU.JBTTL_NM 				AS JBTTL_NM
				, CU.TKCG_TASK_NM 			AS TKCG_TASK_NM
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.OD_SBMSN_YN			AS OD_SBMSN_YN
				, CU.APLY_DOC_SBMSN_YN		AS APLY_DOC_SBMSN_YN
				
				, CU.CRNO					AS CRNO
				, CU.BRNO					AS BRNO
				, CASE
					WHEN CU.SGG IS NOT NULL THEN
						'US' || CU.SGG
					ELSE
						'UC' || CU.CTPV
				  END		AS UNTY_OGNZ_CD
				
				, CASE
					WHEN EXISTS (
							SELECT 1
							  FROM TB_COM_UNTY_MNGR X
							 WHERE X.UNTY_OGNZ_CD = CASE
														WHEN CU.SGG IS NOT NULL THEN
															'US' || CU.SGG
														ELSE
															'UC' || CU.CTPV
													  END
							   AND X.USER_ID = CU.USER_ID
						) THEN 'Y'
					ELSE 'N'
				  END						AS AUTHRT_MNGR_YN
				, CU.CTPV	AS CTPV
				, (SELECT FN_GET_COM_CD_VL_NM('UNTY_CTPV', CU.CTPV) FROM DUAL) AS CTPV_NM
				, CU.SGG	AS SGG
				, (SELECT FN_GET_COM_CD_VL_NM('UNTY_SGG', CU.SGG) FROM DUAL) AS SGG_NM
				, (SELECT X.CD_VL_EXPLN FROM TB_COM_CD_DTL X WHERE X.CD_ID = 'UNTY_SGG' AND X.CD_VL = CU.SGG AND X.APC_CD = '0000')	AS SGG_EXPLN
				, CU.CO_NM	AS CO_NM
				, CU.CO_TELNO	AS CO_TELNO
				, CU.JBPS		AS JBPS
				, CASE
					WHEN EXISTS (
							SELECT 1
							  FROM TB_COM_UNTY_MNGR X
							 WHERE X.UNTY_OGNZ_CD =	CASE
														WHEN CU.SGG IS NOT NULL THEN
															'US' || CU.SGG
														ELSE
															'UC' || CU.CTPV
													  END
							   AND X.USER_ID = CU.USER_ID
							   AND X.DEL_YN = 'N'
							   AND X.APLY_YN = 'Y'
							   AND X.APRV_YN = 'N'
						) THEN 'Y'
					ELSE 'N'
				  END		AS MNGR_APLY_YN
				, CASE
					WHEN EXISTS (
							SELECT 1
							  FROM TB_COM_USER_SYS_AUTH X
							 WHERE X.USER_ID = CU.USER_ID
							   AND X.DEL_YN = 'N'
							   AND X.APLY_YN = 'Y'
							   AND X.APRV_YN = 'N'	
						) THEN 'Y'
					ELSE 'N'
				  END		AS AUTHRT_APLY_YN
				, (
					SELECT AGGR_CONCAT(X.SYS_ID, ',') 
					  FROM TB_COM_USER_SYS_AUTH X 
					 WHERE X.USER_ID = CU.USER_ID
					   AND X.DEL_YN = 'N'
					   AND X.APLY_YN = 'Y'
					   AND X.APRV_YN = 'N'
				)			AS APLY_SYS_ID
				
			  FROM TB_COM_USER CU
			 WHERE CU.DEL_YN = 'N'
			   AND CU.TYPE_CD = #{mbrTypeCd}
    	]]>
    	
		<if test='userId != null and userId != ""'>
			   AND CU.USER_ID LIKE '%' || #{userId} || '%'
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>
		<if test='userStts != null and userStts != ""'>
			   AND CU.USER_STTS = #{userStts}
		</if>
		<if test='ctpv != null and ctpv != ""'>
			   AND CU.CTPV = #{ctpv}
		</if>
		
		<if test='sgg != null and sgg != ""'>
			   AND CU.SGG = #{sgg}
		</if>
		
		<choose>
    		<when test='aplyYn != null and aplyYn.equals("Y")'>
				AND EXISTS (
						SELECT 1
						  FROM TB_COM_UNTY_MNGR X
						 WHERE X.UNTY_OGNZ_CD =	CASE
													WHEN CU.SGG IS NOT NULL THEN
														'US' || CU.SGG
													ELSE
														'UC' || CU.CTPV
												  END
						   AND X.USER_ID = CU.USER_ID
						   AND X.DEL_YN = 'N'
						   AND X.APLY_YN = 'Y'
						   AND X.APRV_YN = 'N'
						UNION ALL
						SELECT 1
						  FROM TB_COM_USER_SYS_AUTH X
						 WHERE X.USER_ID = CU.USER_ID
						   AND X.DEL_YN = 'N'
						   AND X.APLY_YN = 'Y'
						   AND X.APRV_YN = 'N'						
					)
    		</when>
    		<when test='aplyYn != null and aplyYn.equals("N")'>
				AND NOT EXISTS (
						SELECT 1
						  FROM TB_COM_UNTY_MNGR X
						 WHERE X.UNTY_OGNZ_CD =	CASE
													WHEN CU.SGG IS NOT NULL THEN
														'US' || CU.SGG
													ELSE
														'UC' || CU.CTPV
												  END
						   AND X.USER_ID = CU.USER_ID
						   AND X.DEL_YN = 'N'
						   AND X.APLY_YN = 'Y'
						   AND X.APRV_YN = 'N'
						UNION ALL
						SELECT 1
						  FROM TB_COM_USER_SYS_AUTH X
						 WHERE X.USER_ID = CU.USER_ID
						   AND X.DEL_YN = 'N'
						   AND X.APLY_YN = 'Y'
						   AND X.APRV_YN = 'N'						
					)
			</when>
    		<otherwise>
			   
    		</otherwise>
    	</choose>
		
		<choose>
    		<when test='superUserYn != null and superUserYn.equals("Y")'>
				
    		</when>
    		<when test='untyOgnzCd != null and untyOgnzCd != ""'>
    			AND #{authrtMngrYn} = 'Y'
				AND CU.CTPV = SUBSTR(#{untyOgnzCd}, 3, 2)
			</when>
    		<otherwise>
			   
    		</otherwise>
    	</choose>
		
    	<![CDATA[
    		 ORDER BY USER_NM, USER_ID
    		  ) pt0
    	]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		ORDER BY USER_TYPE
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>


    <update id="updateUserType" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.co.user.ComUserMapper.updateUserType */
	    		TB_COM_USER
	    	   SET
	    	   	  USER_TYPE 				= #{userType}
	    	   	, OD_SBMSN_YN 				= #{odSbmsnYn}
	    	   	, APLY_DOC_SBMSN_YN			= #{aplyDocSbmsnYn}
				, SYS_LAST_CHG_DT 			= SYSDATE
	    	    , SYS_LAST_CHG_USER_ID 		= #{sysLastChgUserId}
	    	    , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
	    	 WHERE USER_ID 					= #{userId}
    	]]>
    </update>

    <update id="updateComUserAprv" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
    	UPDATE TB_COM_USER
    	   SET SYS_LAST_CHG_DT 			= SYSDATE
    	     , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	     , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	]]>
    	<if test='userStts != null and userStts != ""'>
    		 , USER_STTS 				= #{userStts}
    	</if>
    	<if test='userType != null and userType != ""'>
    		 , USER_TYPE 				= #{userType}
    	</if>
    	<![CDATA[
    	 WHERE USER_ID 					= #{userId}
    	]]>
    </update>

    <update id="updateComUser" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
    	UPDATE TB_COM_USER
    	   SET
    	     USER_ID 				= #{userId}
    	   , SYS_LAST_CHG_DT 		= SYSDATE
    	   , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	   , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	]]>
    	<if test='mblTelno != null and mblTelno != ""'>
    		 , MBL_TELNO 					= #{mblTelno}
    	</if>
    	<if test='jbps != null and jbps != ""'>
    		 , JBPS 					= #{jbps}
    	</if>
    	<if test='coTelno != null and coTelno != ""'>
    		 , CO_TELNO 					= #{coTelno}
    	</if>
    	<if test='coNm != null and coNm != ""'>
    		 , CO_NM 					= #{coNm}
    	</if>
    	<if test='jbttlNm != null and jbttlNm != ""'>
    		 , JBTTL_NM 				= #{jbttlNm}
    	</if>
    	<if test='tkcgTaskNm != null and tkcgTaskNm != ""'>
    		 , TKCG_TASK_NM 			= #{tkcgTaskNm}
    	</if>
    	<if test='rmrk != null and rmrk != ""'>
    		 , RMRK 					= #{rmrk}
    	</if>
    	<if test='delYn != null and delYn != ""'>
	    	, DEL_YN 					= #{delYn}
    	</if>
    	<if test='eml != null and eml != ""'>
    		 , EML 						= #{eml}
    	</if>
    	<if test='lckYn != null and lckYn != ""'>
    		 , LCK_YN 					= #{lckYn}
    	</if>
    	<if test='lckYn == "N"'>
    		 , LGN_FAIL_NMTM 			= 0
    	</if>
		<![CDATA[
    	 WHERE USER_ID 					= #{userId}
    	]]>
    </update>
    
	<!-- APC관리자승인등록 사용자 승인 -->
	<update id="updateComUserStts" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
    	UPDATE TB_COM_USER
    	   SET
    	     USER_STTS 				= #{userStts}
    	   , SYS_LAST_CHG_DT 		= SYSDATE
    	   , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	   , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	 WHERE USER_ID 					= #{userId}
    	]]>
    </update>

<!--     비밀번호초기화 -->
   <update id="updComUserPwd" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.co.user.ComUserMapper.updComUserPwd */
	    		TB_COM_USER
			   SET
				 PSWD = #{pswd}
				,LCK_YN = 'N'
				,LGN_FAIL_NMTM = 0
				,SYS_LAST_CHG_DT = SYSDATE
				,SYS_LAST_CHG_USER_ID = #{sysLastChgUserId}
				,SYS_LAST_CHG_PRGRM_ID = #{sysLastChgPrgrmId}
			 WHERE USER_ID	= #{userId}
    	]]>
    </update>

<!--  계정추가 -->
   <insert id="insertAccount" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
	    	INSERT INTO /* com.at.apcss.co.user.ComUserMapper.insertAccount */
	    		TB_COM_USER
			   ( USER_ID
			    ,USER_NM
			    ,PSWD
			    ,USER_TYPE
			    ,USER_STTS
			    ,APC_CD
			    ,LGN_FAIL_NMTM
			    ,LCK_YN
			    ,DEL_YN
			    ,SYS_FRST_INPT_DT
			    ,SYS_FRST_INPT_USER_ID
			    ,SYS_FRST_INPT_PRGRM_ID
			    ,SYS_LAST_CHG_DT
			    ,SYS_LAST_CHG_USER_ID
			    ,SYS_LAST_CHG_PRGRM_ID)

			    VALUES(
			    #{userId}
			    ,#{userNm}
			    ,#{pswd}
			    ,#{userType}
			    ,#{userStts}
			    ,#{apcCd}
			    ,'0'
				,'N'
				,'N'
				,SYSDATE
				,#{sysFrstInptUserId}
	    		,#{sysFrstInptPrgrmId}
				,SYSDATE
				,#{sysLastChgUserId}
				,#{sysLastChgPrgrmId}
			    )

    	]]>
    </insert>
<!--  로그인 정책 추가 -->
    <insert id="insertLgnPlcy" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
	    	INSERT INTO /* com.at.apcss.co.user.ComUserMapper.insertinsertLgnPlcy */
	    		TB_COM_LGN_PLCY
			   (USER_ID
			   , DPCN_LGN_PSBLTY_YN
			   , IP_LMT_YN
			   , USE_YN
			   , SYS_FRST_INPT_DT
			   , SYS_FRST_INPT_USER_ID
			   , SYS_FRST_INPT_PRGRM_ID
			   , SYS_LAST_CHG_DT
			   , SYS_LAST_CHG_USER_ID
			   , SYS_LAST_CHG_PRGRM_ID
			   )

			    VALUES(
			    #{userId}
			    ,'N'
			    ,'N'
			    ,'Y'
				,SYSDATE
				,#{sysFrstInptUserId}
	    		,#{sysFrstInptPrgrmId}
				,SYSDATE
				,#{sysLastChgUserId}
				,#{sysLastChgPrgrmId}
			    )

    	]]>
    </insert>
<!--  계정 중복 확인 -->
	<select id="selectAccountDupChk" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
	<![CDATA[
		SELECT
			USER_ID
		  FROM TB_COM_USER
		WHERE
	]]>
	<if test='userId != null and userId != ""'>
		USER_ID	= #{userId}
	</if>
	</select>



	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserPrdcrAprvList             -->
	<!-- DESC : 생산농가 계정관리 요청목록 조회                                          -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectComUserPrdcrAprvList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[

		SELECT
			'APRV_LIST' AS TYPE
			, CU.USER_ID AS USER_ID
			, CU.USER_NM AS USER_NM
			, UPA.APC_CD AS APC_CD
			, UPA.PRDCR_CD AS PRDCR_CD
			, (SELECT FN_GET_PRDCR_NM(UPA.PRDCR_CD,UPA.APC_CD) FROM DUAL) AS PRDCR_NM
			, (SELECT FN_GET_APC_NM(UPA.APC_CD) FROM DUAL) AS APC_NM
			, CU.MNGMST_RGNO AS MNGMST_RGNO
			, CU.EML AS EML
			, UPA.RMRK AS RMRK
			, UPA.APRV_YN AS APRV_YN
			, UPA.REQ_DT AS REQ_DT
			, UPA.APRV_DT AS APRV_DT
			, UPA.DEL_YN AS DEL_YN

		FROM TB_COM_USER CU
				, TB_COM_USER_PRDCR_APRV UPA
		WHERE 1=1

			AND CU.USER_ID = UPA.USER_ID
			AND UPA.DEL_YN = 'N'
			AND UPA.APRV_YN = 'N'
			AND CU.DEL_YN = 'N'
	]]>
	<if test='apcCd != null and apcCd != ""'>
		AND UPA.APC_CD = #{apcCd}
	</if>
	<if test='prdcrCd != null and prdcrCd != ""'>
		AND UPA.PRDCR_CD = #{prdcrCd}
	</if>
	<if test='userId != null and userId != ""'>
		AND CU.USER_ID = #{userId}
	</if>
		<if test='userNm != null and userNm != ""'>
		AND CU.USER_NM = #{userNm}
	</if>


	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserPrdcrList             -->
	<!-- DESC : 생산농가 계정관리 생산농가목록 조회                                          -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectComUserPrdcrList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
					'PRDCR_LIST' AS TYPE
					,CASE WHEN UPA.APRV_YN = 'Y' THEN UPA.USER_ID END USER_ID
					,UPA.APRV_YN
					,UPA.APRV_DT
					,UPA.REQ_DT
					,UPA.RMRK
					,UPA.DEL_YN
					,PI.PRDCR_CD
					,PI.PRDCR_NM
					,PI.TELNO
					,PI.APC_CD
					, CASE
						WHEN USER_ID IS NOT NULL
							THEN (SELECT
											USER_NM
										FROM TB_COM_USER A
									  WHERE 1=1
									  	  AND A.USER_ID = UPA.USER_ID
									  	  AND UPA.APRV_YN = 'Y') END AS USER_NM
					FROM TB_PRDCR_INFO PI
							, TB_COM_USER_PRDCR_APRV UPA
					WHERE 1=1
						AND PI.APC_CD = UPA.APC_CD(+)
						AND PI.PRDCR_CD = UPA.PRDCR_CD(+)
						AND PI.DEL_YN = 'N'
	]]>
	<if test='apcCd != null and apcCd != ""'>
		AND PI.APC_CD = #{apcCd}
	</if>
	<if test='prdcrCd != null and prdcrCd != ""'>
		AND PI.PRDCR_CD = #{prdcrCd}
	</if>
	<if test='prdcrNm != null and prdcrNm != ""'>
		AND PI.PRDCR_NM = #{prdcrNm}
	</if>
	<if test='userId != null and userId != ""'>
		AND UPA.USER_ID = #{userId}
	</if>


	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserPrdcrRegList             -->
	<!-- DESC :  생산농가 계정등록 요청목록 조회                                        -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectComUserPrdcrRegList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[

		SELECT

			CU.USER_ID AS USER_ID
			, CU.USER_NM AS USER_NM
			, CU.APC_CD AS APC_CD
			, PI.PRDCR_CD AS PRDCR_CD
			, PI.PRDCR_NM AS PRDCR_NM
			, PI.TELNO AS TELNO
			, CU.MNGMST_RGNO AS MNGMST_RGNO
			, CU.EML AS EML
			, UPA.RMRK AS RMRK
			, UPA.APRV_YN AS APRV_YN
			, UPA.REQ_DT AS REQ_DT
			, UPA.APRV_DT AS APRV_DT
			, UPA.DEL_YN AS DEL_YN

		FROM TB_COM_USER CU
				, TB_COM_USER_PRDCR_APRV UPA
				, TB_PRDCR_INFO PI
		WHERE 1=1
			AND CU.APC_CD = UPA.APC_CD
			AND CU.USER_ID = UPA.USER_ID
			AND UPA.APC_CD = PI.APC_CD
			AND UPA.PRDCR_CD = PI.PRDCR_CD
			AND PI.DEL_YN = 'N'
			AND UPA.DEL_YN = 'N'
			AND CU.DEL_YN = 'N'
	]]>
	<if test='apcCd != null and apcCd != ""'>
		AND CU.APC_CD = #{apcCd}
	</if>
	<if test='userId != null and userId != ""'>
		AND CU.USER_ID = #{userId}
	</if>
		<if test='userNm != null and userNm != ""'>
		AND CU.USER_NM = #{userNm}
	</if>


	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectAprvPrdcrUserApcList             -->
	<!-- DESC :  생산농가의 사용자 정보 및 APC목록 조회                                   -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.09.30  김기준        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectAprvPrdcrUserApcList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[

		SELECT
			CU.USER_ID AS USER_ID
			, CU.USER_NM AS USER_NM
			, PI.PRDCR_CD AS PRDCR_CD
			, PI.PRDCR_NM AS PRDCR_NM
			, PI.TELNO AS TELNO
			, CU.MNGMST_RGNO AS MNGMST_RGNO
			, CU.EML AS EML
			, UPA.APC_CD AS APC_CD
			, AI.REG_APC_NM AS APC_NM
			, UPA.RMRK AS RMRK
			, UPA.APRV_YN AS APRV_YN
			, UPA.REQ_DT AS REQ_DT
			, UPA.APRV_DT AS APRV_DT
			, UPA.DEL_YN AS DEL_YN
		FROM TB_COM_USER CU
				, TB_COM_USER_PRDCR_APRV UPA
				, TB_PRDCR_INFO PI
				, TB_APC_INFO AI
		WHERE 1=1
			AND CU.USER_ID = UPA.USER_ID
			AND UPA.APC_CD = PI.APC_CD
			AND UPA.APC_CD = AI.APC_CD
			AND UPA.PRDCR_CD = PI.PRDCR_CD
			AND PI.DEL_YN = 'N'
			AND UPA.DEL_YN = 'N'
			AND CU.DEL_YN = 'N'
	]]>
		<if test='apcCd != null and apcCd != ""'>
			AND CU.APC_CD = #{apcCd}
		</if>
		<if test='userId != null and userId != ""'>
			AND CU.USER_ID = #{userId}
		</if>
		<if test='userNm != null and userNm != ""'>
			AND CU.USER_NM = #{userNm}
		</if>
		<if test='aprvYn != null and aprvYn != ""'>
			AND UPA.APRV_YN = #{aprvYn}
		</if>


	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserAprvList             -->
	<!-- DESC :  생산농가 승인,미승인 전체 목록 조회                                         -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectComUserAprvList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[

		SELECT
		UPA.*
		, (SELECT FN_GET_PRDCR_NM(UPA.PRDCR_CD,UPA.APC_CD) FROM DUAL) AS PRDCR_NM
		FROM TB_COM_USER_PRDCR_APRV UPA
		WHERE 1=1
			AND UPA.DEL_YN = 'N'
	]]>
	<if test='apcCd != null and apcCd != ""'>
		AND UPA.APC_CD = #{apcCd}
	</if>
	<if test='userId != null and userId != ""'>
		AND UPA.USER_ID = #{userId}
	</if>



	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.updateUserAprv             -->
	<!-- DESC : 생산농가 계정 승인 업데이트                                          -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<update id="updateUserAprv" parameterType="hashmap">
    	<![CDATA[
    	UPDATE TB_COM_USER_PRDCR_APRV
    	   SET
    	     APRV_YN 				= #{aprvYn}
    	     , PRDCR_CD 			= #{prdcrCd}
   	     ]]>
   	    <if test='aprvYn == "N" '>
			, APRV_DT = ''
		</if>
		<if test='aprvYn == "Y" '>
			, APRV_DT = SYSDATE
		</if>
		<![CDATA[
    	   , SYS_LAST_CHG_DT 		= SYSDATE
    	   , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	   , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	 WHERE USER_ID 					= #{userId}
    	 	  AND APC_CD                     = #{apcCd}
    	]]>
    </update>

<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.insertPrdcrUserId             -->
	<!-- DESC :  생산농가 승인요청 등록                                        -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertPrdcrUserId" parameterType="hashmap">
    	<![CDATA[
	    	INSERT INTO /* com.at.apcss.co.user.ComUserMapper.savePrdcrUserId*/
	    		TB_COM_USER_PRDCR_APRV
			   ( USER_ID
			    ,APC_CD
			    ,APRV_YN
			    ,PRDCR_CD
			    ,REQ_DT
			    ,DEL_YN
			    ,SYS_FRST_INPT_DT
			    ,SYS_FRST_INPT_USER_ID
			    ,SYS_FRST_INPT_PRGRM_ID
			    ,SYS_LAST_CHG_DT
			    ,SYS_LAST_CHG_USER_ID
			    ,SYS_LAST_CHG_PRGRM_ID)

			    VALUES(
			    #{userId}
			    ,#{apcCd}
			    ,#{aprvYn}
			    ,#{prdcrCd}
			    ,SYSDATE
			    ,'N'
				,SYSDATE
				,#{sysFrstInptUserId}
	    		,#{sysFrstInptPrgrmId}
				,SYSDATE
				,#{sysLastChgUserId}
				,#{sysLastChgPrgrmId}
			    )

    	]]>
    </insert>

<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.updatePrdcrUserId             -->
	<!-- DESC :  생산농가 승인요청 APC, 비고 수정                                        -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <update id="updatePrdcrUserId" parameterType="hashmap">
    	<![CDATA[
    	UPDATE TB_COM_USER_PRDCR_APRV
    	   SET
    	     APC_CD				= #{apcCd}
    	   , RMRK 				= #{rmrk}
    	   , SYS_LAST_CHG_DT 		= SYSDATE
    	   , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	   , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	 WHERE USER_ID 					= #{userId}
    	 	 AND APC_CD 						= #{apcCd}

    	]]>
    </update>

<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.deletePrdcrUserId             -->
	<!-- DESC : 생산농가 승인요청 삭제                                         -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <update id="deletePrdcrUserId" parameterType="hashmap">
   	<![CDATA[
    	DELETE FROM TB_COM_USER_PRDCR_APRV
    	 WHERE USER_ID 					= #{userId}
    	 	 AND APC_CD 						= #{apcCd}

    	]]>
    </update>
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectPrdcrList             		-->
	<!-- DESC : 생산농가 계정에 속한 생산자 목록 조회.                              -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.11  	김   호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectUserPrdcrList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
			       PA.USER_ID       AS USER_ID
			     , PA.APC_CD        AS APC_CD
			     , PA.PRDCR_CD      AS PRDCR_CD
			     , PA.RMRK          AS RMRK
			     , PA.APRV_YN       AS APRV_YN
			     , PA.REQ_DT        AS REQ_DT
			     , PA.APRV_DT       AS APRV_DT
			  FROM TB_COM_USER_PRDCR_APRV PA
			 WHERE PA.DEL_YN 	= 'N'
			   AND PA.APRV_YN 	= 'Y'
		]]>
			<if test='userId != null and userId !=""'>
			   AND PA.USER_ID = #{userId}
			</if>
			<if test='apcCd != null and apcCd !=""'>
			   AND PA.APC_CD = #{apcCd}
			</if>
	</select>


		<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectUserAprv                -->
	<!-- DESC : 사용자 승인 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.27  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectUserAprv" parameterType="hashmap" resultType="hashmap">

    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectUserAprv */
			   *
			  FROM TB_COM_USER_PRDCR_APRV CU
			  WHERE CU.DEL_YN = 'N'
			  	  AND CU.APC_CD = #{apcCd}
			  	  AND CU.USER_ID = #{userId}

		]]>
    </select>


    	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectUserAprv                -->
	<!-- DESC : 사용자 승인 삭제.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.06.27  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <delete id="delComUserAprv" parameterType="hashmap">

    	<![CDATA[
			DELETE /* com.at.apcss.co.user.ComUserMapper.delComUserAprv */
			  FROM TB_COM_USER_PRDCR_APRV CU
			  WHERE CU.DEL_YN = 'N'
			  	  AND CU.APC_CD = #{apcCd}
			  	  AND CU.USER_ID = #{apcCd}
			  	  AND CU.PRDCR_CD = #{prdcrCd}

		]]>
    </delete>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.insertSpUntyAuthAprv             -->
	<!-- DESC : 통합사용자 권한승인처리.                                            -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<insert id="insertSpUntyAuthAprv" statementType="CALLABLE" parameterType="com.at.apcss.co.user.vo.ComUserVO">
		<![CDATA[
			{call /* com.at.apcss.co.user.ComUserMapper.insertSpUntyAuthAprv */
                SP_UNTY_AUTH_APRV (
                    #{sysLastChgUserId}
                  , #{sysLastChgPrgrmId}
                  , #{userId}
                  , #{untyOgnzId}
                  , #{untyAuthrtType}
                  , #{untyOgnzType}
                  , #{untyAuthrtMngYn}
                  , #{untyAuthrtId}
                  , #{rtnCd, jdbcType=VARCHAR, mode=OUT}
                  , #{rtnMsg, jdbcType=VARCHAR, mode=OUT}
                )
            }
		]]>
	</insert>
    
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.insertSpUserAuthAprv             -->
	<!-- DESC : 통합사용자 승인(법인, 지자체)                                            		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<insert id="insertSpUserAuthAprv" statementType="CALLABLE" parameterType="com.at.apcss.co.user.vo.ComUserVO">
		<![CDATA[
			{call /* com.at.apcss.co.user.ComUserMapper.insertSpUserAuthAprv */
                SP_USER_AUTH_APRV (
                      #{sysLastChgUserId}
					, #{sysLastChgPrgrmId}
					, #{mbrTypeCd}
					, #{userId}
					, #{authrtMngrYn}
					, #{sysMesYn}
					, #{sysFmYn}
					, #{sysPdYn}
					, #{sysCsYn}
                  	, #{rtnCd, jdbcType=VARCHAR, mode=OUT}
                  	, #{rtnMsg, jdbcType=VARCHAR, mode=OUT}
                )
            }
		]]>
	</insert>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.deleteSpUserAuthAprv             -->
	<!-- DESC : 통합사용자 승인(법인, 지자체) 취소                               	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<insert id="deleteSpUserAuthAprv" statementType="CALLABLE" parameterType="com.at.apcss.co.user.vo.ComUserVO">
		<![CDATA[
			{call /* com.at.apcss.co.user.ComUserMapper.deleteSpUserAuthAprv */
                SP_USER_AUTH_APRV_CNCL (
                      #{sysLastChgUserId}
					, #{sysLastChgPrgrmId}
					, #{mbrTypeCd}
					, #{userId}
                  	, #{rtnCd, jdbcType=VARCHAR, mode=OUT}
                  	, #{rtnMsg, jdbcType=VARCHAR, mode=OUT}
                )
            }
		]]>
	</insert>


    
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectUserApcList             	-->
	<!-- DESC : 사용자별APC 테이블 목록 조회.                                       -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.09.28  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectUserApcList" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
   		<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectUserApcList */
    	]]>
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, 
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
				  pt0.*
				, (SELECT FN_GET_COM_CD_VL_NM('USER_TYPE', pt0.USER_TYPE) FROM DUAL) AS USER_TYPE_NM
				, (SELECT FN_GET_COM_CD_VL_NM('USER_STTS', pt0.USER_STTS) FROM DUAL) AS USER_STTS_NM
				
				, (SELECT FN_GET_COM_CD_VL_NM('UNTY_CTPV', pt0.CTPV) FROM DUAL) AS CTPV_NM
				, (SELECT FN_GET_COM_CD_VL_NM('UNTY_SGG', pt0.SGG) FROM DUAL) AS SGG_NM
				, (SELECT FN_GET_COM_CD_VL_EXPLN('UNTY_SGG', pt0.SGG) FROM DUAL) AS SGG_EXPLN
				
    		  FROM (
			SELECT
			      UA.USER_ID		AS USER_ID
			    , UA.APC_CD			AS APC_CD
				, UA.BSC_APC_YN		AS BSC_APC_YN
			    , UA.APRV_YN		AS APRV_YN
			    , TO_CHAR(UA.APRV_DT, 'YYYY-MM-DD HH24:MI')	AS APRV_DT
			    , UA.APRV_RMRK		AS APRV_RMRK
			    , UA.APLY_YN		AS APLY_YN
			    , TO_CHAR(UA.APLY_DT, 'YYYY-MM-DD HH24:MI')	AS APLY_DT
			    , UA.APLY_RMRK		AS APLY_RMRK
			    
				, CU.USER_NM		AS USER_NM
				, CU.USER_TYPE		AS USER_TYPE
				, CU.USER_STTS      AS USER_STTS
				, CU.EML            AS EML
				, CU.TELNO          AS TELNO
				, CU.MBL_TELNO		AS MBL_TELNO
				, CU.OGDP_NM        AS OGDP_NM
				, CU.CHRGD_CERT_YN      AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    AS CHRGD_CERT_TYPE
				, CU.LCK_YN 			AS LCK_YN
				, CU.JBTTL_NM 			AS JBTTL_NM
				, CU.TKCG_TASK_NM 		AS TKCG_TASK_NM
				, CU.OD_SBMSN_YN		AS OD_SBMSN_YN
				, CU.APLY_DOC_SBMSN_YN	AS APLY_DOC_SBMSN_YN
				
				, AI.APC_NM			AS APC_NM
				, AI.CTPV			AS CTPV
				, AI.SGG			AS SGG
				
			  FROM TB_COM_USER_APC UA
			  
			  JOIN TB_COM_USER CU
			    ON CU.USER_ID = UA.USER_ID
			   AND CU.DEL_YN = 'N'
			  
			  JOIN TB_APC_INFO AI
			    ON AI.APC_CD = UA.APC_CD
			   AND AI.DEL_YN = 'N'
			   
			 WHERE UA.DEL_YN = 'N'
			 
    	]]>
    	
		<choose>
   			<when test='superUserYn != null and superUserYn.equals("Y")'>
			
   			</when>
   			<when test='aplyUserId != null and aplyUserId != ""'>
			   AND UA.USER_ID = #{aplyUserId}
   			</when>
   			<when test='untyOgnzCd != null and untyOgnzCd != ""'>
   			  AND (
   			  	CU.UNTY_OGNZ_CD = REPLACE(#{untyOgnzCd}, 'UO', '')
   			  	OR
   			  	EXISTS (
	   			  		SELECT 1
	   			  		  FROM TB_UNTY_OGNZ_APC X
	   			  		 WHERE X.UNTY_OGNZ_ID = #{untyOgnzCd}
	   			  		   AND X.APC_CD = UA.APC_CD
	   			  		   AND X.APRV_YN = 'Y'
	   			  		   AND X.DEL_YN = 'N'
   			  		)
				)
			</when>
	   		<otherwise>
   			</otherwise>
    	</choose>
    	
		<if test='apcCd != null and apcCd != ""'>
			   AND UA.APC_CD = #{apcCd}
		</if>
		<if test='apcNm != null and apcNm != ""'>
			   AND AI.APC_NM LIKE '%' || #{apcNm} || '%'
		</if>
		
		<if test='aprvYn != null and aprvYn != ""'>
			   AND UA.APRV_YN = #{aprvYn}
		</if>
		<if test='aplyYn != null and aplyYn != ""'>
			   AND UA.APLY_YN = #{aplyYn}
		</if>
		
		
		<if test='userId != null and userId != ""'>
			   AND UA.USER_ID LIKE '%' || #{userId} || '%'
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>

		<if test='corpNm != null and corpNm != ""'>
			   AND EXISTS (
			   		SELECT
			   		  FROM TB_APC_OGNZ_INFO X
			   		 WHERE X.OGNZ_CD = CU.UNTY_OGNZ_CD
			   		   AND X.OGNZ_NM LIKE '%' || #{corpNm} || '%'
			   	)
		</if>
		<if test='crno != null and crno != ""'>
			   AND EXISTS (
			   		SELECT
			   		  FROM TB_APC_OGNZ_INFO X
			   		 WHERE X.OGNZ_CD = CU.UNTY_OGNZ_CD
			   		   AND X.CRNO LIKE '%' || REPLACE(#{crno}, '-', '') || '%'
			   	)
		</if>
		
    	<![CDATA[
    		 ORDER BY USER_NM
    		  ) pt0
    	]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectUserApc	                -->
	<!-- DESC : 사용자 APC 단건조회.                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectUserApc" parameterType="com.at.apcss.co.user.vo.ComUserApcVO" resultType="com.at.apcss.co.user.vo.ComUserApcVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectUserApc */
			      UA.USER_ID		AS USER_ID
			    , UA.APC_CD			AS APC_CD
				, UA.BSC_APC_YN		AS BSC_APC_YN
			    , UA.APRV_YN		AS APRV_YN
			    , UA.APRV_RMRK		AS APRV_RMRK
			    , UA.APLY_YN		AS APLY_YN
			    , UA.APLY_RMRK		AS APLY_RMRK
			  FROM TB_COM_USER_APC UA
			 WHERE UA.USER_ID = #{userId}
			   AND UA.APC_CD = #{apcCd}
    	]]>
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectCorpApc	                -->
	<!-- DESC : 법인 APC 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectCorpApc" parameterType="com.at.apcss.co.user.vo.ComUserApcVO" resultType="com.at.apcss.co.user.vo.ComUserApcVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectCorpApc */
			      OA.APC_CD			AS APC_CD
				, OA.APRV_YN		AS APRV_YN
			  FROM TB_UNTY_OGNZ_APC OA
			 WHERE OA.APC_CD = #{apcCd}
			   AND OA.UNTY_OGNZ_ID = 'UO' || (
			   			SELECT X.UNTY_OGNZ_CD
			   			  FROM TB_COM_USER X
			   			 WHERE X.USER_ID = #{userId}
			   		) 
    	]]>
    </select>
    
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.insertUserApc                    -->
	<!-- DESC : 사용자 APC 사용등록.                                           		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertUserApc" parameterType="com.at.apcss.co.user.vo.ComUserApcVO">
    	<![CDATA[
    		INSERT /* com.at.apcss.co.user.ComUserMapper.insertUserApc */
    		  INTO TB_COM_USER_APC (
				  USER_ID
				, APC_CD
				, APLY_YN
				, APLY_DT
				, APLY_RMRK
				
				, DEL_YN
			    , SYS_FRST_INPT_DT
			    , SYS_FRST_INPT_USER_ID
			    , SYS_FRST_INPT_PRGRM_ID
			    , SYS_LAST_CHG_DT
			    , SYS_LAST_CHG_USER_ID
			    , SYS_LAST_CHG_PRGRM_ID
			) VALUES (
				  #{userId}
				, #{apcCd}
				, 'Y'
				, SYSDATE
				, #{aplyRmrk}
				
				, 'N'
				, SYSDATE
				, #{sysFrstInptUserId}
	    		, #{sysFrstInptPrgrmId}
				, SYSDATE
				, #{sysLastChgUserId}
				, #{sysLastChgPrgrmId}
			)
    	]]>
    </insert>
	
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.deleteUserApc                    -->
	<!-- DESC : 사용자 APC 사용등록 삭제.                                           -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <delete id="deleteUserApc" parameterType="com.at.apcss.co.user.vo.ComUserApcVO">
    	<![CDATA[
	    	DELETE /* com.at.apcss.co.user.ComUserMapper.deleteUserApc */
				TB_COM_USER_APC
			 WHERE USER_ID	= #{userId}
    	 	   AND APC_CD	= #{apcCd}
    	]]>
    </delete>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.updateUserApcAprv                -->
	<!-- DESC : 사용자 APC 사용 승인.                                           	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <update id="updateUserApcAprv" parameterType="com.at.apcss.co.user.vo.ComUserApcVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.co.user.ComUserMapper.updateUserApcAprv */
	    		TB_COM_USER_APC
	    	   SET
				  APRV_DT	= SYSDATE
				, APRV_YN	= 'Y'
				, APRV_RMRK	= #{aprvRmrk}
				
				, SYS_LAST_CHG_DT 			= SYSDATE
	    	    , SYS_LAST_CHG_USER_ID 		= #{sysLastChgUserId}
	    	    , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
			 WHERE USER_ID	= #{userId}
    	 	   AND APC_CD	= #{apcCd}
    	]]>
    </update>
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.updateUserApcAprvCncl          	-->
	<!-- DESC : 사용자 APC 사용 승인 취소.                                          -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <update id="updateUserApcAprvCncl" parameterType="com.at.apcss.co.user.vo.ComUserApcVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.co.user.ComUserMapper.updateUserApcAprvCncl */
	    		TB_COM_USER_APC
	    	   SET
				  APRV_DT	= NULL
				, APRV_YN	= 'N'
				, APRV_RMRK	= #{aprvRmrk}
				
				, SYS_LAST_CHG_DT 			= SYSDATE
	    	    , SYS_LAST_CHG_USER_ID 		= #{sysLastChgUserId}
	    	    , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
			 WHERE USER_ID	= #{userId}
    	 	   AND APC_CD	= #{apcCd}
    	]]>
    </update>
    
    
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.insertUserApcHstry               -->
	<!-- DESC : 사용자 APC 변경이력 등록.                                           -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertUserApcHstry" parameterType="com.at.apcss.co.user.vo.ComUserApcVO">
    	<![CDATA[
    		INSERT /* com.at.apcss.co.user.ComUserMapper.insertUserApcHstry */
    		  INTO TB_COM_USER_APC_HSTRY (
				  USER_ID
				, APC_CD
				, HSTRY_SEQ
				, APRV_PRGRS_CD
				, BSC_APC_YN
				, APRV_YN
				, APRV_DT
				, APRV_RMRK
				, APLY_YN
				, APLY_DT
				, APLY_RMRK
			    , SYS_FRST_INPT_DT
			    , SYS_FRST_INPT_USER_ID
			    , SYS_FRST_INPT_PRGRM_ID
			)
			SELECT
				  A.USER_ID		AS USER_ID
				, A.APC_CD		AS APC_CD
				, NVL((
						SELECT MAX(X.HSTRY_SEQ)
						  FROM TB_COM_USER_APC_HSTRY X
						 WHERE X.USER_ID = A.USER_ID
						   AND X.APC_CD = A.APC_CD
					), 0) + 1		AS HSTRY_SEQ
				, #{aprvPrgrsCd}	AS APRV_PRGRS_CD
				, A.BSC_APC_YN		AS BSC_APC_YN
				, A.APRV_YN			AS APRV_YN
				, A.APRV_DT			AS APRV_DT
				, A.APRV_RMRK		AS APRV_RMRK
				, A.APLY_YN			AS APLY_YN
				, A.APLY_DT			AS APLY_DT
				, A.APLY_RMRK		AS APLY_RMRK
				, SYSDATE				AS SYS_FRST_INPT_DT
				, #{sysLastChgUserId}	AS SYS_FRST_INPT_USER_ID
				, #{sysLastChgPrgrmId}	AS SYS_FRST_INPT_PRGRM_ID
			  FROM TB_COM_USER_APC A
			 WHERE USER_ID	= #{userId}
    	 	   AND APC_CD	= #{apcCd}
    	]]>
    </insert>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserAtchfl              -->
	<!-- DESC : 사용자 첨부파일 단건조회.                                             -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComUserAtchfl" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserAtchflVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectComUserAtchfl */
				  BF.FILE_SN		AS FILE_SN
				, BF.FILE_NM		AS FILE_NM
				, BF.FILE_CN		AS FILE_CN
				, BF.FILE_PATH_NM	AS FILE_PATH_NM
				, BF.SRVR_FILE_NM	AS SRVR_FILE_NM
				, BF.FILE_EXTN_NM	AS FILE_EXTN_NM
			  FROM TB_COM_BRC_FILE BF

			 WHERE BF.FILE_SN = #{brcAtchflSn}
			   AND BF.USER_ID = #{userId}
    	]]>
    </select>
    
</mapper>