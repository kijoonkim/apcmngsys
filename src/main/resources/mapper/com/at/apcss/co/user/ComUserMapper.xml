<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : ComUserMapper.xml                                    				-->
<!-- DESC : 사용자 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.co.user.mapper.ComUserMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUser                    -->
	<!-- DESC : 사용자 테이블 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.17  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComUser" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectComUser */
				  CU.USER_ID            AS USER_ID
				, CU.USER_NM            AS USER_NM
				, CU.USER_TYPE          AS USER_TYPE
				, CU.USER_STTS          AS USER_STTS
				, CU.EML                AS EML
				, CU.TELNO          	AS TELNO
				, CU.APC_CD             AS APC_CD
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) AS APC_NM
				, CU.OGDP_NM            AS OGDP_NM
				, CU.CHRGD_CERT_YN      AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    AS CHRGD_CERT_TYPE
				, CU.LCK_YN             AS LCK_YN
				, CU.LGN_FAIL_NMTM      AS LGN_FAIL_NMTM
				, CU.END_LGN_DT         AS END_LGN_DT
				, CU.END_LGN_IP         AS END_LGN_IP
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.DEL_YN                 AS DEL_YN
				, CU.SYS_FRST_INPT_DT       AS SYS_FRST_INPT_DT
				, CU.SYS_FRST_INPT_USER_ID  AS SYS_FRST_INPT_USER_ID
				, CU.SYS_FRST_INPT_PRGRM_ID AS SYS_FRST_INPT_PRGRM_ID
				, CU.SYS_LAST_CHG_DT       	AS SYS_LAST_CHG_DT
				, CU.SYS_LAST_CHG_USER_ID  	AS SYS_LAST_CHG_USER_ID
				, CU.SYS_LAST_CHG_USER_ID 	AS SYS_LAST_CHG_USER_ID

			  FROM TB_COM_USER CU
			 WHERE CU.USER_ID = #{userId}
    	]]>
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserList                -->
	<!-- DESC : 사용자 테이블 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.05.25  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComUserList" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
    		  FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectComUserList */
			      CU.USER_ID            	AS USER_ID
				, CU.USER_NM            	AS USER_NM
				, CU.PSWD					AS PSWD
				, CU.USER_TYPE				AS USER_TYPE
				, (SELECT FN_GET_COM_CD_VL_NM('USER_TYPE', CU.USER_TYPE) FROM DUAL) AS USER_TYPE_NM
				, CU.USER_STTS          	AS USER_STTS
				, (SELECT FN_GET_COM_CD_VL_NM('USER_STTS', CU.USER_STTS) FROM DUAL) AS USER_STTS_NM
				, CU.EML                	AS EML
				, CU.TELNO          	 	AS TELNO
				, CU.APC_CD             	AS APC_CD
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) AS APC_NM
				, CU.OGDP_NM            	AS OGDP_NM
				, CU.CHRGD_CERT_YN      	AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    	AS CHRGD_CERT_TYPE
				, CU.LCK_YN AS LCK_YN
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',CU.LCK_YN) FROM DUAL) AS REVERSE_LCK_YN
				, CU.LGN_FAIL_NMTM      	AS LGN_FAIL_NMTM
				, CU.END_LGN_DT         	AS END_LGN_DT
				, CU.END_LGN_IP         	AS END_LGN_IP
				, CU.RMRK				 	AS RMRK
				, CU.JBTTL_NM 				AS JBTTL_NM
				, CU.TKCG_TASK_NM 			AS TKCG_TASK_NM
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.DEL_YN                 AS DEL_YN
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',CU.DEL_YN) FROM DUAL) AS REVERSE_YN
				, CU.CRNO                   AS CRNO
				, CU.BRDT                   AS BRDT
				, CU.SYS_FRST_INPT_DT       AS SYS_FRST_INPT_DT
				, CU.SYS_FRST_INPT_USER_ID  AS SYS_FRST_INPT_USER_ID
				, CU.SYS_FRST_INPT_PRGRM_ID AS SYS_FRST_INPT_PRGRM_ID
				, CU.SYS_LAST_CHG_DT       AS SYS_LAST_CHG_DT
				, CU.SYS_LAST_CHG_USER_ID  AS SYS_LAST_CHG_USER_ID
				, CU.SYS_LAST_CHG_PRGRM_ID AS SYS_LAST_CHG_PRGRM_ID
			  FROM TB_COM_USER CU
			  WHERE CU.DEL_YN = 'N'
    	]]>
		<if test='apcCd != null and apcCd != ""'>
			   AND CU.APC_CD = #{apcCd}
		</if>
		<if test='userId != null and userId != ""'>
			   AND CU.USER_ID LIKE '%' || #{userId} || '%'
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>
		<if test='userType != null and userType != ""'>
			   AND CU.USER_TYPE = #{userType}
		</if>
		<if test='userStts != null and userStts != ""'>
			   AND CU.USER_STTS = #{userStts}
		</if>
		<if test='ogdpNm != null and ogdpNm != ""'>
			   AND CU.OGDP_NM LIKE '%' || #{ogdpNm} || '%'
		</if>
		<if test='apcNm != null and apcNm != ""'>
			   AND (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) LIKE #{apcNm}
		</if>
    	<![CDATA[
    		 ORDER BY USER_ID, USER_NM
    	]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.co.user.ComUserMapper.selectComUserApcList             -->
	<!-- DESC : APC관리자승인등록 테이블 목록 조회.                                         -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.28  	김현호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectComUserApcList" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
    		  FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
			SELECT /* com.at.apcss.co.user.ComUserMapper.selectComUserList */
			      CU.USER_ID            	AS USER_ID
				, CU.USER_NM            	AS USER_NM
				, CU.PSWD					AS PSWD
				, CU.USER_TYPE				AS USER_TYPE
				, (SELECT FN_GET_COM_CD_VL_NM('USER_TYPE', CU.USER_TYPE) FROM DUAL) AS USER_TYPE_NM
				, CU.USER_STTS          	AS USER_STTS
				, (SELECT FN_GET_COM_CD_VL_NM('USER_STTS', CU.USER_STTS) FROM DUAL) AS USER_STTS_NM
				, CU.EML                	AS EML
				, CU.TELNO          	 	AS TELNO
				, CU.APC_CD             	AS APC_CD
				, (SELECT X.APC_NM FROM TB_APC_INFO X WHERE X.APC_CD = CU.APC_CD) AS APC_NM
				, CU.OGDP_NM            	AS OGDP_NM
				, CU.CHRGD_CERT_YN      	AS CHRGD_CERT_YN
				, CU.CHRGD_CERT_TYPE    	AS CHRGD_CERT_TYPE
				, CU.LCK_YN AS LCK_YN
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',CU.LCK_YN) FROM DUAL) AS REVERSE_LCK_YN
				, CU.LGN_FAIL_NMTM      	AS LGN_FAIL_NMTM
				, CU.END_LGN_DT         	AS END_LGN_DT
				, CU.END_LGN_IP         	AS END_LGN_IP
				, CU.RMRK				 	AS RMRK
				, CU.JBTTL_NM 				AS JBTTL_NM
				, CU.TKCG_TASK_NM 			AS TKCG_TASK_NM
				, CU.MBL_TELNO              AS MBL_TELNO
				, CU.OD_SBMSN_YN			AS OD_SBMSN_YN
				, CU.APLY_DOC_SBMSN_YN		AS APLY_DOC_SBMSN_YN
				, CU.DEL_YN                 AS DEL_YN
				, (SELECT FN_GET_COM_CD_VL_NM('REVERSE_YN',CU.DEL_YN) FROM DUAL) AS REVERSE_YN
				, CU.SYS_FRST_INPT_DT       AS SYS_FRST_INPT_DT
				, CU.SYS_FRST_INPT_USER_ID  AS SYS_FRST_INPT_USER_ID
				, CU.SYS_FRST_INPT_PRGRM_ID AS SYS_FRST_INPT_PRGRM_ID
				, CU.SYS_LAST_CHG_DT       AS SYS_LAST_CHG_DT
				, CU.SYS_LAST_CHG_USER_ID  AS SYS_LAST_CHG_USER_ID
				, CU.SYS_LAST_CHG_PRGRM_ID AS SYS_LAST_CHG_PRGRM_ID
			  FROM TB_COM_USER CU
			  WHERE CU.DEL_YN = 'N'
			  AND CU.USER_TYPE IN ('10','11')
    	]]>
		<if test='apcCd != null and apcCd != ""'>
			   AND CU.APC_CD = #{apcCd}
		</if>
		<if test='userId != null and userId != ""'>
			   AND CU.USER_ID LIKE '%' || #{userId} || '%'
		</if>
		<if test='userNm != null and userNm != ""'>
			   AND CU.USER_NM LIKE '%' || #{userNm} || '%'
		</if>
		<if test='userStts != null and userStts != ""'>
			   AND CU.USER_STTS = #{userStts}
		</if>
    	<![CDATA[
    		 ORDER BY USER_ID, USER_NM
    	]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		  ) pt0
    		ORDER BY USER_TYPE
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>


    <update id="updateUserType" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.co.user.ComUserMapper.updateUserType */
	    		TB_COM_USER
	    	   SET
	    	   	  USER_TYPE 				= #{userType}
	    	   	, OD_SBMSN_YN 				= #{odSbmsnYn}
	    	   	, APLY_DOC_SBMSN_YN			= #{aplyDocSbmsnYn}
				, SYS_LAST_CHG_DT 			= SYSDATE
	    	    , SYS_LAST_CHG_USER_ID 		= #{sysLastChgUserId}
	    	    , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
	    	 WHERE USER_ID 					= #{userId}
    	]]>
    </update>

    <update id="updateComUserAprv" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
    	UPDATE TB_COM_USER
    	   SET SYS_LAST_CHG_DT 			= SYSDATE
    	     , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	     , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	]]>
    	<if test='userStts != null and userStts != ""'>
    		 , USER_STTS 				= #{userStts}
    	</if>
    	<if test='userType != null and userType != ""'>
    		 , USER_TYPE 				= #{userType}
    	</if>
    	<![CDATA[
    	 WHERE USER_ID 					= #{userId}
    	]]>
    </update>

    <update id="updateComUser" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
    	UPDATE TB_COM_USER
    	   SET
    	     USER_ID 				= #{userId}
    	   , SYS_LAST_CHG_DT 		= SYSDATE
    	   , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	   , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	]]>
    	<if test='mblTelno != null and mblTelno != ""'>
    		 , MBL_TELNO 					= #{mblTelno}
    	</if>
    	<if test='jbttlNm != null and jbttlNm != ""'>
    		 , JBTTL_NM 				= #{jbttlNm}
    	</if>
    	<if test='tkcgTaskNm != null and tkcgTaskNm != ""'>
    		 , TKCG_TASK_NM 			= #{tkcgTaskNm}
    	</if>
    	<if test='rmrk != null and rmrk != ""'>
    		 , RMRK 					= #{rmrk}
    	</if>
    	<if test='delYn != null and delYn != ""'>
	    	, DEL_YN 					= #{delYn}
    	</if>
    	<if test='eml != null and eml != ""'>
    		 , EML 						= #{eml}
    	</if>
    	<if test='lckYn != null and lckYn != ""'>
    		 , LCK_YN 					= #{lckYn}
    	</if>
    	<if test='lckYn == "N"'>
    		 , LGN_FAIL_NMTM 			= 0
    	</if>
		<![CDATA[
    	 WHERE USER_ID 					= #{userId}
    	]]>
    </update>
<!-- APC관리자승인등록 사용자 승인 -->
	<update id="updateComUserStts" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
    	UPDATE TB_COM_USER
    	   SET
    	     USER_STTS 				= #{userStts}
    	   , SYS_LAST_CHG_DT 		= SYSDATE
    	   , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	   , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	 WHERE USER_ID 					= #{userId}
    	]]>
    </update>

<!--     비밀번호초기화 -->
   <update id="updComUserPwd" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.co.user.ComUserMapper.updComUserPwd */
	    		TB_COM_USER
			   SET
				 PSWD = #{pswd}
				,LCK_YN = 'N'
				,LGN_FAIL_NMTM = 0
				,SYS_LAST_CHG_DT = SYSDATE
				,SYS_LAST_CHG_USER_ID = #{sysLastChgUserId}
				,SYS_LAST_CHG_PRGRM_ID = #{sysLastChgPrgrmId}
			 WHERE USER_ID	= #{userId}
    	]]>
    </update>

<!--  계정추가 -->
   <insert id="insertAccount" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
	    	INSERT INTO /* com.at.apcss.co.user.ComUserMapper.insertAccount */
	    		TB_COM_USER
			   ( USER_ID
			    ,USER_NM
			    ,PSWD
			    ,USER_TYPE
			    ,USER_STTS
			    ,APC_CD
			    ,LGN_FAIL_NMTM
			    ,LCK_YN
			    ,DEL_YN
			    ,SYS_FRST_INPT_DT
			    ,SYS_FRST_INPT_USER_ID
			    ,SYS_FRST_INPT_PRGRM_ID
			    ,SYS_LAST_CHG_DT
			    ,SYS_LAST_CHG_USER_ID
			    ,SYS_LAST_CHG_PRGRM_ID)

			    VALUES(
			    #{userId}
			    ,#{userNm}
			    ,#{pswd}
			    ,#{userType}
			    ,#{userStts}
			    ,'0000'
			    ,'0'
				,'N'
				,'N'
				,SYSDATE
				,#{sysFrstInptUserId}
	    		,#{sysFrstInptPrgrmId}
				,SYSDATE
				,#{sysLastChgUserId}
				,#{sysLastChgPrgrmId}
			    )

    	]]>
    </insert>
<!--  로그인 정책 추가 -->
    <insert id="insertLgnPlcy" parameterType="com.at.apcss.co.user.vo.ComUserVO">
    	<![CDATA[
	    	INSERT INTO /* com.at.apcss.co.user.ComUserMapper.insertinsertLgnPlcy */
	    		TB_COM_LGN_PLCY
			   (USER_ID
			   , DPCN_LGN_PSBLTY_YN
			   , IP_LMT_YN
			   , USE_YN
			   , SYS_FRST_INPT_DT
			   , SYS_FRST_INPT_USER_ID
			   , SYS_FRST_INPT_PRGRM_ID
			   , SYS_LAST_CHG_DT
			   , SYS_LAST_CHG_USER_ID
			   , SYS_LAST_CHG_PRGRM_ID
			   )

			    VALUES(
			    #{userId}
			    ,'N'
			    ,'N'
			    ,'Y'
				,SYSDATE
				,#{sysFrstInptUserId}
	    		,#{sysFrstInptPrgrmId}
				,SYSDATE
				,#{sysLastChgUserId}
				,#{sysLastChgPrgrmId}
			    )

    	]]>
    </insert>
<!--  계정 중복 확인 -->
	<select id="selectAccountDupChk" parameterType="com.at.apcss.co.user.vo.ComUserVO" resultType="com.at.apcss.co.user.vo.ComUserVO">
	<![CDATA[
		SELECT
			USER_ID
		  FROM TB_COM_USER
		WHERE
	]]>
	<if test='userId != null and userId != ""'>
		USER_ID	= #{userId}
	</if>
	</select>

	<!-- 생산농가 계정관리 요청목록 조회 -->
	<select id="selectComUserPrdcrAprvList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[

		SELECT
			'APRV_LIST' AS TYPE
			, CU.USER_ID AS USER_ID
			, CU.USER_NM AS USER_NM
			, UPA.APC_CD AS APC_CD
			, UPA.PRDCR_CD AS PRDCR_CD
			, (SELECT FN_GET_PRDCR_NM(UPA.PRDCR_CD,UPA.APC_CD) FROM DUAL) AS PRDCR_NM
			, (SELECT FN_GET_APC_NM(UPA.APC_CD) FROM DUAL) AS APC_NM
			, CU.MNGMST_RGNO AS MNGMST_RGNO
			, CU.EML AS EML
			, UPA.RMRK AS RMRK
			, UPA.APRV_YN AS APRV_YN
			, UPA.REQ_DT AS REQ_DT
			, UPA.APRV_DT AS APRV_DT
			, UPA.DEL_YN AS DEL_YN

		FROM TB_COM_USER CU
				, TB_COM_USER_PRDCR_APRV UPA
		WHERE 1=1

			AND CU.USER_ID = UPA.USER_ID
			AND UPA.DEL_YN = 'N'
			AND UPA.APRV_YN = 'N'
			AND CU.DEL_YN = 'N'
	]]>
	<if test='apcCd != null and apcCd != ""'>
		AND UPA.APC_CD = #{apcCd}
	</if>
	<if test='prdcrCd != null and prdcrCd != ""'>
		AND UPA.PRDCR_CD = #{prdcrCd}
	</if>
	<if test='userId != null and userId != ""'>
		AND CU.USER_ID = #{userId}
	</if>
		<if test='userNm != null and userNm != ""'>
		AND CU.USER_NM = #{userNm}
	</if>


	</select>

	<!-- 생산농가 계정관리 생산농가목록 조회 -->
	<select id="selectComUserPrdcrList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
					'PRDCR_LIST' AS TYPE
					,CASE WHEN UPA.APRV_YN = 'Y' THEN UPA.USER_ID END USER_ID
					,UPA.APRV_YN
					,UPA.APRV_DT
					,UPA.REQ_DT
					,UPA.RMRK
					,UPA.DEL_YN
					,PI.PRDCR_CD
					,PI.PRDCR_NM
					,PI.TELNO
					,PI.APC_CD
					, CASE
						WHEN USER_ID IS NOT NULL
							THEN (SELECT
											USER_NM
										FROM TB_COM_USER A
									  WHERE 1=1
									  	  AND A.USER_ID = UPA.USER_ID
									  	  AND UPA.APRV_YN = 'Y') END AS USER_NM
					FROM TB_PRDCR_INFO PI
							, TB_COM_USER_PRDCR_APRV UPA
					WHERE 1=1
						AND PI.APC_CD = UPA.APC_CD(+)
						AND PI.PRDCR_CD = UPA.PRDCR_CD(+)
						AND PI.DEL_YN = 'N'
	]]>
	<if test='apcCd != null and apcCd != ""'>
		AND PI.APC_CD = #{apcCd}
	</if>
	<if test='prdcrCd != null and prdcrCd != ""'>
		AND PI.PRDCR_CD = #{prdcrCd}
	</if>
	<if test='prdcrNm != null and prdcrNm != ""'>
		AND PI.PRDCR_NM = #{prdcrNm}
	</if>
	<if test='userId != null and userId != ""'>
		AND UPA.USER_ID = #{userId}
	</if>


	</select>

	<!-- 생산농가 계정등록 요청목록 조회 -->
	<select id="selectComUserPrdcrRegList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[

		SELECT

			CU.USER_ID AS USER_ID
			, CU.USER_NM AS USER_NM
			, CU.APC_CD AS APC_CD
			, PI.PRDCR_CD AS PRDCR_CD
			, PI.PRDCR_NM AS PRDCR_NM
			, PI.TELNO AS TELNO
			, CU.MNGMST_RGNO AS MNGMST_RGNO
			, CU.EML AS EML
			, UPA.RMRK AS RMRK
			, UPA.APRV_YN AS APRV_YN
			, UPA.REQ_DT AS REQ_DT
			, UPA.APRV_DT AS APRV_DT
			, UPA.DEL_YN AS DEL_YN

		FROM TB_COM_USER CU
				, TB_COM_USER_PRDCR_APRV UPA
				, TB_PRDCR_INFO PI
		WHERE 1=1
			AND CU.APC_CD = UPA.APC_CD
			AND CU.USER_ID = UPA.USER_ID
			AND UPA.APC_CD = PI.APC_CD
			AND UPA.PRDCR_CD = PI.PRDCR_CD
			AND PI.DEL_YN = 'N'
			AND UPA.DEL_YN = 'N'
			AND CU.DEL_YN = 'N'
	]]>
	<if test='apcCd != null and apcCd != ""'>
		AND CU.APC_CD = #{apcCd}
	</if>
	<if test='userId != null and userId != ""'>
		AND CU.USER_ID = #{userId}
	</if>
		<if test='userNm != null and userNm != ""'>
		AND CU.USER_NM = #{userNm}
	</if>


	</select>

	<select id="selectComUserAprvList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[

		SELECT
		UPA.*
		, (SELECT FN_GET_PRDCR_NM(UPA.PRDCR_CD,UPA.APC_CD) FROM DUAL) AS PRDCR_NM
		FROM TB_COM_USER_PRDCR_APRV UPA
		WHERE 1=1
			AND UPA.DEL_YN = 'N'
	]]>
	<if test='apcCd != null and apcCd != ""'>
		AND UPA.APC_CD = #{apcCd}
	</if>
	<if test='userId != null and userId != ""'>
		AND UPA.USER_ID = #{userId}
	</if>



	</select>

	<!-- 생산농가 계정 승인 업데이트-->
	<update id="updateUserAprv" parameterType="hashmap">
    	<![CDATA[
    	UPDATE TB_COM_USER_PRDCR_APRV
    	   SET
    	     APRV_YN 				= #{aprvYn}
    	     , PRDCR_CD 			= #{prdcrCd}
   	     ]]>
   	    <if test='aprvYn == "N" '>
			, APRV_DT = ''
		</if>
		<if test='aprvYn == "Y" '>
			, APRV_DT = SYSDATE
		</if>
		<![CDATA[
    	   , SYS_LAST_CHG_DT 		= SYSDATE
    	   , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	   , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	 WHERE USER_ID 					= #{userId}
    	 	  AND APC_CD                     = #{apcCd}
    	]]>
    </update>

    <insert id="insertPrdcrUserId" parameterType="hashmap">
    	<![CDATA[
	    	INSERT INTO /* com.at.apcss.co.user.ComUserMapper.savePrdcrUserId*/
	    		TB_COM_USER_PRDCR_APRV
			   ( USER_ID
			    ,APC_CD
			    ,APRV_YN
			    ,REQ_DT
			    ,DEL_YN
			    ,SYS_FRST_INPT_DT
			    ,SYS_FRST_INPT_USER_ID
			    ,SYS_FRST_INPT_PRGRM_ID
			    ,SYS_LAST_CHG_DT
			    ,SYS_LAST_CHG_USER_ID
			    ,SYS_LAST_CHG_PRGRM_ID)

			    VALUES(
			    #{userId}
			    ,#{apcCd}
			    ,#{aprvYn}
			    ,SYSDATE
			    ,'N'
				,SYSDATE
				,#{sysFrstInptUserId}
	    		,#{sysFrstInptPrgrmId}
				,SYSDATE
				,#{sysLastChgUserId}
				,#{sysLastChgPrgrmId}
			    )

    	]]>
    </insert>

    <update id="updatePrdcrUserId" parameterType="hashmap">
    	<![CDATA[
    	UPDATE TB_COM_USER_PRDCR_APRV
    	   SET
    	     APC_CD				= #{apcCd}
    	   , RMRK 				= #{rmrk}
    	   , SYS_LAST_CHG_DT 		= SYSDATE
    	   , SYS_LAST_CHG_USER_ID 	= #{sysLastChgUserId}
    	   , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    	 WHERE USER_ID 					= #{userId}
    	 	 AND APC_CD 						= #{apcCd}

    	]]>
    </update>

    <update id="deletePrdcrUserId" parameterType="hashmap">
   	<![CDATA[
    	DELETE FROM TB_COM_USER_PRDCR_APRV
    	 WHERE USER_ID 					= #{userId}
    	 	 AND APC_CD 						= #{apcCd}

    	]]>
    </update>

</mapper>