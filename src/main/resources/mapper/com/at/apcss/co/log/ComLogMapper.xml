<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : ComLogMapper.xml                           		        			-->
<!-- DESC : 이력조회 mapper                   					                 	-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.08.29  	하민우        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.co.log.mapper.ComLogMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.ordr.mapper.OrdrMapper.selectCntnHstryList			-->
	<!-- DESC : 접속이력 목록 조회.             		           	             	 		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.29  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectCntnHstryList" parameterType="com.at.apcss.co.log.vo.ComLogVO" resultType="com.at.apcss.co.log.vo.ComLogVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
    		 FROM (
    	</if>
    	<if test='pagingYn == null or pagingYn.equals("N")'>
    		SELECT
    			  pt0.*
    		 FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
			    	SELECT /* com.at.apcss.am.ordr.mapper.OrdrMapper.selectCntnHstryList */
					       CMH.MENU_ID          AS MENU_ID
					     , CMH.MENU_NM          AS MENU_NM
					     , CMH.USER_ID          AS USER_ID
					     , CMH.USER_NM          AS USER_NM
					     , CMH.USER_TYPE        AS USER_TYPE
					     , TO_CHAR(CMH.PRSL_DT, 'YYYY-MM-DD')			AS PRSL_DT
    		  	 		 , TO_CHAR(MIN(CMH.PRSL_DT), 'YYYY-MM-DD')		AS FRST_PRSL_DT
					     , CMH.LGN_SCS_YN       AS LGN_SCS_YN
					     , CMH.PRSL_TYPE        AS PRSL_TYPE
					     , CMH.USER_IP          AS USER_IP
					     , CMH.APC_CD           AS APC_CD
					     , (SELECT FN_GET_APC_NM(CMH.APC_CD) FROM DUAL)	AS APC_NM
					FROM TB_COM_MENU_LOG_HSTRY CMH
				   WHERE 1=1
		]]>
			<if test='logYmdFrom != null and logYmdFrom != ""'>
			   	     AND TO_CHAR(CMH.PRSL_DT, 'YYYYMMDD') <![CDATA[>=]]> #{logYmdFrom}
			</if>
			<if test='logYmdTo != null and logYmdTo != ""'>
			         AND TO_CHAR(CMH.PRSL_DT, 'YYYYMMDD') <![CDATA[<=]]> #{logYmdTo}
			</if>
			<if test='userNm != null and userNm != ""'>
			         AND CMH.USER_NM LIKE '%' ||  #{userNm} || '%'
			</if>
			<if test='prslType  != null and prslType != ""'>
			         AND CMH.PRSL_TYPE = #{prslType}
			</if>
    	<![CDATA[
					ORDER BY HSTRY_SN DESC
    		 	) pt0
		]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.ordr.mapper.OrdrMapper.selectMenuHstryList			-->
	<!-- DESC : 화면열람이력 목록 조회.                        	             	 		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.29  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectMenuHstryList" parameterType="com.at.apcss.co.log.vo.ComLogVO" resultType="com.at.apcss.co.log.vo.ComLogVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
    		 FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
			    	SELECT /* com.at.apcss.am.ordr.mapper.OrdrMapper.selectLogMenuHstryList */
					       CMH.MENU_ID          AS MENU_ID
					     , CMH.MENU_NM          AS MENU_NM
					     , CMH.USER_ID          AS USER_ID
					     , CMH.USER_NM          AS USER_NM
					     , CMH.USER_TYPE        AS USER_TYPE
					     , TO_CHAR(CMH.PRSL_DT, 'YYYY-MM-DD')          AS PRSL_DT
					     , CMH.LGN_SCS_YN       AS LGN_SCS_YN
					     , CMH.PRSL_TYPE        AS PRSL_TYPE
					     , CMH.USER_IP          AS USER_IP
					     , CMH.APC_CD           AS APC_CD
					     , (SELECT FN_GET_APC_NM(CMH.APC_CD) FROM DUAL) AS APC_NM
					FROM TB_COM_MENU_LOG_HSTRY CMH
				   WHERE 1=1
		]]>
			<if test='logYmdFrom != null and logYmdFrom != ""'>
			   	     AND TO_CHAR(CMH.PRSL_DT, 'YYYYMMDD') <![CDATA[>=]]> #{logYmdFrom}
			</if>
			<if test='logYmdTo != null and logYmdTo != ""'>
			         AND TO_CHAR(CMH.PRSL_DT, 'YYYYMMDD') <![CDATA[<=]]> #{logYmdTo}
			</if>
			<if test='menuNm != null and menuNm != ""'>
			         AND CMH.MENU_NM LIKE '%' ||  #{menuNm} || '%'
			</if>
			<if test='prslType != null and prslType != ""'>
					AND CMH.PRSL_TYPE	 = #{prslType}
			</if>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.ordr.mapper.OrdrMapper.selectTrsmHstryList			-->
	<!-- DESC : 송수신이력 목록 조회.                        	           		  	 		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.29  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectTrsmHstryList" parameterType="com.at.apcss.co.log.vo.ComLogVO" resultType="com.at.apcss.co.log.vo.ComLogVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
    		 FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
		    	  SELECT /* com.at.apcss.am.ordr.mapper.OrdrMapper.selectTrsmHstryList */
				         CL.LOG_YMD              AS LOG_YMD
				       , CL.LOG_SN               AS LOG_SN
				       , CL.LOG_SE_CD            AS LOG_SE_CD
				       , CL.SEND_RCPTN_SE_CD     AS SEND_RCPTN_SE_CD
				       , CL.PRGRM_ID             AS PRGRM_ID
				       , CL.PRGRM_NM             AS PRGRM_NM
				       , CL.IP_ADDR              AS IP_ADDR
				       , TO_CHAR(CL.PRCS_DT, 'YYYY-MM-DD')              AS PRCS_DT
				       , CL.RMRK                 AS RMRK
				   FROM TB_COM_LOG CL
				  WHERE 1=1
		]]>
		<if test='logYmdFrom != null and logYmdFrom != ""'>
		   	   AND CL.LOG_YMD <![CDATA[>=]]> #{logYmdFrom}
		</if>
		<if test='logYmdTo != null and logYmdTo != ""'>
		       AND CL.LOG_YMD <![CDATA[<=]]> #{logYmdTo}
		</if>
		<if test='sendRcptnSeCd != null and sendRcptnSeCd != ""'>
		   	   AND CL.SEND_RCPTN_SE_CD = #{sendRcptnSeCd}
		</if>
		<if test='prgrmNm != null and prgrmNm != ""'>
		       AND CL.PRGRM_NM LIKE '%' ||  #{prgrmNm} || '%'
		</if>
		<if test='logSeCd != null and logSeCd != ""'>
		       AND CL.LOG_SE_CD = #{logSeCd}
		</if>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<!-- End 페이징 -->
    </select>

       <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.ordr.mapper.OrdrMapper.insertMenuHstry			-->
	<!-- DESC : 화면열람이력 생성.                        	           		  	 		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.07  손민성        	Initial Creation                            -->
	<!-- ==========================================================================	-->

  <insert id="insertMenuHstry" parameterType="com.at.apcss.co.log.vo.ComLogVO">
  	<selectKey keyProperty="hstrySn" resultType="String" order="BEFORE">
  		SELECT SQ_COM_MENU_LOG_HSTRY.NEXTVAL FROM DUAL
  	</selectKey>
			INSERT INTO TB_COM_MENU_LOG_HSTRY
			VALUES (
			#{menuId}
			,#{menuNm}
			,#{userId}
			,#{userNm}
			,#{userType}
			,sysdate
			,#{lgnScsYn}
			,#{prslType}
			,#{userIp}
			,sysdate
			,#{sysFrstInptUserId}
			,#{sysFrstInptPrgrmId}
			,sysdate
			,#{sysLastChgUserId}
			,#{sysLastChgPrgrmId}
			,#{hstrySn}
			,#{apcCd}
			,#{flfmtTaskSeCd})
    </insert>

</mapper>


