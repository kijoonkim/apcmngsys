<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : MobileApiMapper.xml                                    				-->
<!-- DESC : 모바일 입고 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.11.22  	joon        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.mobile.mapper.MobileApiMapper">
	<insert id="addRefreshToken" parameterType="map">
		<![CDATA[
			INSERT INTO TB_REFRESHTOKEN
			(USER_ID, TOKEN, EXPRY_DT, CRT_DT)
			values (#{USER_ID}, #{TOKEN}, #{EXPRY_DT}, SYSDATE)
		]]>
	</insert>
	
	<delete id="delRefreshToken" parameterType="java.lang.String">
		<![CDATA[
		DELETE FROM TB_REFRESHTOKEN
		WHERE USER_ID=#{USER_ID}
		]]>
	</delete>	
	
	<select id="findRefreshToken" parameterType="java.lang.String" resultType="map">
		<![CDATA[
			SELECT *
			FROM TB_REFRESHTOKEN
			WHERE USER_ID=#{USER_ID}
		]]>
	</select>

	<select id="getStatsForOneYearBySearchYmd" parameterType="map" resultType="map">
		<![CDATA[
			SELECT
				SUM(CASE RS.YM WHEN RS.T_0 THEN RS.QNTT ELSE 0 END) AS Q_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.QNTT ELSE 0 END) AS Q_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.QNTT ELSE 0 END) AS Q_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.QNTT ELSE 0 END) AS Q_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.QNTT ELSE 0 END) AS Q_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.QNTT ELSE 0 END) AS Q_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.QNTT ELSE 0 END) AS Q_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.QNTT ELSE 0 END) AS Q_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.QNTT ELSE 0 END) AS Q_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.QNTT ELSE 0 END) AS Q_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.QNTT ELSE 0 END) AS Q_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.QNTT ELSE 0 END) AS Q_11
				, SUM(CASE RS.YM WHEN RS.T_0 THEN RS.WGHT ELSE 0 END) AS W_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.WGHT ELSE 0 END) AS W_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.WGHT ELSE 0 END) AS W_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.WGHT ELSE 0 END) AS W_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.WGHT ELSE 0 END) AS W_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.WGHT ELSE 0 END) AS W_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.WGHT ELSE 0 END) AS W_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.WGHT ELSE 0 END) AS W_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.WGHT ELSE 0 END) AS W_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.WGHT ELSE 0 END) AS W_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.WGHT ELSE 0 END) AS W_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.WGHT ELSE 0 END) AS W_11
				, SUM(CASE RS.YM WHEN RS.T_0 THEN RS.CNT ELSE 0 END) AS C_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.CNT ELSE 0 END) AS C_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.CNT ELSE 0 END) AS C_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.CNT ELSE 0 END) AS C_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.CNT ELSE 0 END) AS C_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.CNT ELSE 0 END) AS C_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.CNT ELSE 0 END) AS C_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.CNT ELSE 0 END) AS C_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.CNT ELSE 0 END) AS C_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.CNT ELSE 0 END) AS C_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.CNT ELSE 0 END) AS C_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.CNT ELSE 0 END) AS C_11
				, SUM(RS.QNTT) AS QNTT
				, SUM(RS.WGHT) AS WGHT
				, SUM(RS.CNT) AS TOT_CNT
				, 'WRHS' AS RS_TYPE
			FROM (
			SELECT
				SUBSTR(RP.WRHS_YMD, 1, 6) AS YM
				, SUM(RP.WRHS_QNTT)    AS QNTT
				, SUM(RP.WRHS_WGHT)    AS WGHT
				, COUNT(APC_CD) AS CNT
				, TO_CHAR(DL.DT, 'YYYYMM')          AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')   AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')   AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')   AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')   AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')   AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')   AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')   AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')   AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')   AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')   AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')   AS T_11
			FROM
				(SELECT TO_DATE(#{SEARCH_YMD}, 'YYYYMMDD')  AS DT FROM DUAL) DL,
				TB_IF_WRHS_PRFMNC RP
			WHERE 1=1
				AND RP.WRHS_YMD BETWEEN #{SEARCH_YMD_FROM} AND #{SEARCH_YMD_TO}
			GROUP BY SUBSTR(RP.WRHS_YMD, 1, 6)
			) RS

			UNION ALL

			SELECT
				SUM(CASE RS.YM WHEN RS.T_0 THEN RS.QNTT ELSE 0 END) AS Q_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.QNTT ELSE 0 END) AS Q_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.QNTT ELSE 0 END) AS Q_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.QNTT ELSE 0 END) AS Q_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.QNTT ELSE 0 END) AS Q_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.QNTT ELSE 0 END) AS Q_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.QNTT ELSE 0 END) AS Q_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.QNTT ELSE 0 END) AS Q_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.QNTT ELSE 0 END) AS Q_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.QNTT ELSE 0 END) AS Q_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.QNTT ELSE 0 END) AS Q_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.QNTT ELSE 0 END) AS Q_11
				, SUM(CASE RS.YM WHEN RS.T_0 THEN RS.WGHT ELSE 0 END) AS W_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.WGHT ELSE 0 END) AS W_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.WGHT ELSE 0 END) AS W_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.WGHT ELSE 0 END) AS W_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.WGHT ELSE 0 END) AS W_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.WGHT ELSE 0 END) AS W_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.WGHT ELSE 0 END) AS W_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.WGHT ELSE 0 END) AS W_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.WGHT ELSE 0 END) AS W_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.WGHT ELSE 0 END) AS W_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.WGHT ELSE 0 END) AS W_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.WGHT ELSE 0 END) AS W_11
				, SUM(CASE RS.YM WHEN RS.T_0 THEN RS.CNT ELSE 0 END) AS C_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.CNT ELSE 0 END) AS C_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.CNT ELSE 0 END) AS C_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.CNT ELSE 0 END) AS C_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.CNT ELSE 0 END) AS C_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.CNT ELSE 0 END) AS C_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.CNT ELSE 0 END) AS C_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.CNT ELSE 0 END) AS C_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.CNT ELSE 0 END) AS C_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.CNT ELSE 0 END) AS C_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.CNT ELSE 0 END) AS C_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.CNT ELSE 0 END) AS C_11
				, SUM(RS.QNTT) AS QNTT
				, SUM(RS.WGHT) AS WGHT
				, SUM(RS.CNT) AS TOT_CNT
				, 'SORT' AS RS_TYPE
			FROM (
			SELECT
				SUBSTR(RP.SORT_YMD, 1, 6) AS YM
	            , SUM(RP.SORT_QNTT)   AS QNTT
	            , SUM(RP.SORT_WGHT)   AS WGHT
	            , COUNT(APC_CD) AS CNT
				, TO_CHAR(DL.DT, 'YYYYMM')          AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')   AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')   AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')   AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')   AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')   AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')   AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')   AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')   AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')   AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')   AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')   AS T_11
			FROM
				(SELECT TO_DATE(#{SEARCH_YMD}, 'YYYYMMDD')  AS DT FROM DUAL) DL,
				TB_IF_SORT_PRFMNC RP
            WHERE 1=1
            	AND RP.SORT_YMD BETWEEN #{SEARCH_YMD_FROM} AND #{SEARCH_YMD_TO}
			GROUP BY SUBSTR(RP.SORT_YMD, 1, 6)
			) RS

			UNION ALL

			SELECT
				SUM(CASE RS.YM WHEN RS.T_0 THEN RS.QNTT ELSE 0 END) AS Q_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.QNTT ELSE 0 END) AS Q_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.QNTT ELSE 0 END) AS Q_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.QNTT ELSE 0 END) AS Q_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.QNTT ELSE 0 END) AS Q_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.QNTT ELSE 0 END) AS Q_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.QNTT ELSE 0 END) AS Q_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.QNTT ELSE 0 END) AS Q_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.QNTT ELSE 0 END) AS Q_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.QNTT ELSE 0 END) AS Q_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.QNTT ELSE 0 END) AS Q_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.QNTT ELSE 0 END) AS Q_11
				, SUM(CASE RS.YM WHEN RS.T_0 THEN RS.WGHT ELSE 0 END) AS W_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.WGHT ELSE 0 END) AS W_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.WGHT ELSE 0 END) AS W_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.WGHT ELSE 0 END) AS W_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.WGHT ELSE 0 END) AS W_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.WGHT ELSE 0 END) AS W_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.WGHT ELSE 0 END) AS W_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.WGHT ELSE 0 END) AS W_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.WGHT ELSE 0 END) AS W_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.WGHT ELSE 0 END) AS W_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.WGHT ELSE 0 END) AS W_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.WGHT ELSE 0 END) AS W_11
				, SUM(CASE RS.YM WHEN RS.T_0 THEN RS.CNT ELSE 0 END) AS C_0
				, SUM(CASE RS.YM WHEN RS.T_1 THEN RS.CNT ELSE 0 END) AS C_1
				, SUM(CASE RS.YM WHEN RS.T_2 THEN RS.CNT ELSE 0 END) AS C_2
				, SUM(CASE RS.YM WHEN RS.T_3 THEN RS.CNT ELSE 0 END) AS C_3
				, SUM(CASE RS.YM WHEN RS.T_4 THEN RS.CNT ELSE 0 END) AS C_4
				, SUM(CASE RS.YM WHEN RS.T_5 THEN RS.CNT ELSE 0 END) AS C_5
				, SUM(CASE RS.YM WHEN RS.T_6 THEN RS.CNT ELSE 0 END) AS C_6
				, SUM(CASE RS.YM WHEN RS.T_7 THEN RS.CNT ELSE 0 END) AS C_7
				, SUM(CASE RS.YM WHEN RS.T_8 THEN RS.CNT ELSE 0 END) AS C_8
				, SUM(CASE RS.YM WHEN RS.T_9 THEN RS.CNT ELSE 0 END) AS C_9
				, SUM(CASE RS.YM WHEN RS.T_10 THEN RS.CNT ELSE 0 END) AS C_10
				, SUM(CASE RS.YM WHEN RS.T_11 THEN RS.CNT ELSE 0 END) AS C_11
				, SUM(RS.QNTT) AS QNTT
				, SUM(RS.WGHT) AS WGHT
				, SUM(RS.CNT) AS TOT_CNT
				, 'WGH' AS RS_TYPE
			FROM (
			SELECT
				SUBSTR(RP.WGH_YMD, 1, 6) AS YM
	            , SUM(NVL(RP.PLT_QNTT, 0) + NVL(RP.BX_QNTT, 0))  AS QNTT
	            , SUM(NVL(RP.PLT_WGHT, 0) + NVL(RP.BX_WGHT, 0))  AS WGHT
	            , COUNT(APC_CD) AS CNT
				, TO_CHAR(DL.DT, 'YYYYMM')          AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')   AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')   AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')   AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')   AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')   AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')   AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')   AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')   AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')   AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')   AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')   AS T_11
			FROM
				(SELECT TO_DATE(#{SEARCH_YMD}, 'YYYYMMDD')  AS DT FROM DUAL) DL,
				TB_IF_WGH_PRFMNC RP
			WHERE 1=1
              AND RP.WGH_YMD BETWEEN #{SEARCH_YMD_FROM} AND #{SEARCH_YMD_TO}
			GROUP BY SUBSTR(RP.WGH_YMD, 1, 6)
			) RS
		]]>
	</select>

    <select id="getApcAgtStats" parameterType="map" resultType="map">
        <![CDATA[
			SELECT
				   LSD.APC_CD AS APC_CD
				 , (SELECT X.APC_NM FROM USRAM.TB_APC_INFO X WHERE X.APC_CD = LSD.APC_CD) AS APC_NM
				 , LSD.AGCO_YN AS AGCO_YN
				 , LSD.XCRD AS XCRD
				 , LSD.YCRD AS YCRD
				 , LSD.WGH_AGT_INSTL_YN AS WGH_AGT_INSTL_YN
				 , LSD.SORT_AGT_INSTL_YN AS SORT_AGT_INSTL_YN
				 , LSD.ORDR_AGT_INSTL_YN AS ORDR_AGT_INSTL_YN
				 , LSD.WRHS_ACTVTN_YN AS WRHS_ACTVTN_YN
				 , LSD.SORT_ACTVTN_YN AS SORT_ACTVTN_YN
				 , LSD.SPMT_ACTVTN_YN AS SPMT_ACTVTN_YN
				 , LSD.INVNTR_ACTVTN_YN AS INVNTR_ACTVTN_YN
				 , LSD.AGRC_ACTVTN_YN AS AGRC_ACTVTN_YN
				 , LSD.CLCLN_ACTVTN_YN AS CLCLN_ACTVTN_YN
				 , LSD.DVC_RMRK AS DVC_RMRK
				 , LSD.DEL_YN AS DEL_YN
				 , LSD.SYS_FRST_INPT_DT AS SYS_FRST_INPT_DT
				 , LSD.SYS_FRST_INPT_USER_ID AS SYS_FRST_INPT_USER_ID
				 , LSD.SYS_FRST_INPT_PRGRM_ID AS SYS_FRST_INPT_PRGRM_ID
				 , LSD.SYS_LAST_CHG_DT AS SYS_LAST_CHG_DT
				 , LSD.SYS_LAST_CHG_USER_ID AS SYS_LAST_CHG_USER_ID
				 , LSD.SYS_LAST_CHG_PRGRM_ID AS SYS_LAST_CHG_PRGRM_ID
				 , LSD.WGH_LAST_USE_DT AS WGH_LAST_USE_DT
				 , LSD.WRHS_LAST_USE_DT AS WRHS_LAST_USE_DT
				 , LSD.SORT_LAST_USE_DT AS SORT_LAST_USE_DT
				 , LSD.PCKG_LAST_USE_DT AS PCKG_LAST_USE_DT
				 , LSD.SPMT_LAST_USE_DT AS SPMT_LAST_USE_DT
				 , LSD.ORDR_LAST_USE_DT AS ORDR_LAST_USE_DT
				 , LSD.CLCLN_LAST_USE_DT AS CLCLN_LAST_USE_DT
				 , LSD.AGRC_LAST_USE_DT AS AGRC_LAST_USE_DT
				 , LSD.INVNTR_LAST_USE_DT AS INVNTR_LAST_USE_DT
			FROM TB_APC_LINK_SRVR_DVC LSD
			WHERE LSD.DEL_YN = 'N'
	]]>
    </select>

	<select id="getCountAllPrdcr" resultType="int">
		SELECT COUNT(PRDCR_CD) PRDCR_CD_CNT
		FROM (
			SELECT T1.APC_CD, T1.PRDCR_CD, NVL(COUNT(T1.PRDCR_CD), 0) PRDCR_CD_CNT
			FROM (
				SELECT APC_CD, PRDCR_CD
				FROM (
					SELECT APC_CD, RPRS_PRDCR_CD AS PRDCR_CD
					FROM TB_IF_SORT_PRFMNC
					WHERE SORT_QNTT > 0
				)
				GROUP BY APC_CD, PRDCR_CD
				UNION ALL
				SELECT APC_CD, PRDCR_CD
				FROM (
					SELECT APC_CD, PRDCR_CD
					FROM TB_IF_WGH_PRFMNC
					WHERE PLT_QNTT > 0
				)
				GROUP BY APC_CD, PRDCR_CD
				UNION ALL
				SELECT APC_CD, PRDCR_CD
				FROM (
					SELECT APC_CD, PRDCR_CD
					FROM TB_IF_WRHS_PRFMNC
					WHERE WRHS_QNTT > 0
				)
				GROUP BY APC_CD, PRDCR_CD
			) T1
			GROUP BY T1.APC_CD, T1.PRDCR_CD
		)
	</select>

	<update id="callSpApcAgtStatsUpdate" statementType="CALLABLE">
		<![CDATA[
			{call /* com.at.apcss.mobile.mapper.MobileApiMapper.callSpApcAgtStatsUpdate */
                SP_APC_AGT_STATS_UPDT()
            }
		]]>
	</update>
</mapper>