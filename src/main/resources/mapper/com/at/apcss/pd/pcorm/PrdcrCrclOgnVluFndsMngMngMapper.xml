<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : BbsMapper.xml                                    				-->
<!-- DESC : 게시판 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper">

	<!-- 활성화 자금 리스트 -->
	<select id="selectScoreList1" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectScoreList1 */
			EAM.YR
			,ETS.SEQ
			,EAM.BRNO
			,'1' AS FUND_ARTCL /*전문품목  총취급액*/
			,(SELECT COMPUT_WAY_CD FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '1' AND USE_YN = 'Y' AND ROWNUM = 1) AS COMPUT_WAY_CD
			,(SELECT COMPUT_WAY_DTL FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '1' AND USE_YN = 'Y' AND ROWNUM = 1) AS COMPUT_WAY_DTL
			,(SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '1' AND USE_YN = 'Y' AND ROWNUM = 1) AS ALT
			,EAM.COMPUT_WAY_RSLT
			,(CASE WHEN ETS.SCR IS NOT NULL THEN ETS.SCR
					ELSE TO_CHAR(EAM.COMPUT_WAY_RSLT)
					END
			) AS SCR
		FROM (SELECT
					YR
					,BRNO
					,(GREATEST(LEAST(
							ROUND(NVL(
									SUM( (NVL(SLS_TOT_AMT , 0) + NVL(ONLN_WHLSL_MRKT_AMT , 0) )
												*  NVL(SLS_TOT_AMT , 0)
												/ NULLIF(PERC_CONT,0)
												/  NULLIF(SLS_TOT_AMT_TOT,0)
											)
								,0),2)* TO_NUMBER(NVL((SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = TOTAL.YR AND FUND_ARTCL = '1' AND USE_YN = 'Y' AND ROWNUM = 1),0))
						, 50) ,0)
					)AS COMPUT_WAY_RSLT
				FROM
				(SELECT
					ITEM.BRNO
					,ITEM.YR
					,ITEM.CTGRY_CD
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.SLS_TOT_AMT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.SLS_TOT_AMT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.SLS_TOT_AMT
							ELSE ''
							END
					)AS SLS_TOT_AMT
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.TOT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.TOT_PERC_CONT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.TOT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.TOT_PERC_CONT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.TOT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.TOT_PERC_CONT
							ELSE ''
							END
					)AS PERC_CONT
					,TOT.SLS_TOT_AMT_TOT
					,NVL((SELECT ROUND(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = ITEM.YR
									AND BRNO = ITEM.BRNO
									AND CTGRY_CD = ITEM.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
				FROM
					(SELECT
							EAM.YR
							,EAM.BRNO
							,YGC.CTGRY_CD
							,(SELECT APRV FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS APRV
						FROM
							(SELECT * FROM TB_EV_APLY_MNG WHERE YR = #{yr} AND APO_SE = '1') EAM
							,(SELECT BRNO , CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = #{yr} GROUP BY BRNO , CTGRY_CD) YGC
						WHERE 1=1
							AND EAM.BRNO = YGC.BRNO
					) ITEM
					,(SELECT BRNO , SUM( NVL( SLS_CNSGN_SLS_AMT , 0 ) ) AS SLS_TOT_AMT_TOT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND YR = #{yr}
								  GROUP BY  BRNO
					) TOT
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '1' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO IN ('5088136321','3038200282'))
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					) TOTAA
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '1' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					) TOTAB
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '2' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO = '5108205885')/*부적합 품목 이지만 예외 처리*/
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTBA
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '2' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTBB
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '3' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO = '4128124086')/*부적합 품목 이지만 예외 처리*/
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTCA
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '3' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 >= 1 THEN FLOOR(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTCB
					WHERE 1=1
						AND ITEM.BRNO = TOT.BRNO(+)
						AND ITEM.BRNO = TOTAA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTAA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTAB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTAB.CTGRY_CD(+)
						AND ITEM.BRNO = TOTBA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTBA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTBB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTBB.CTGRY_CD(+)
						AND ITEM.BRNO = TOTCA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTCA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTCB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTCB.CTGRY_CD(+)
						AND SLS_TOT_AMT_TOT IS NOT NULL
						AND SLS_TOT_AMT_TOT > 0
					) TOTAL
					WHERE 1=1
					  AND BRNO = #{brno}
					GROUP BY YR , BRNO
			) EAM
			, (SELECT * FROM TB_EV_ACTVTN_FUND WHERE BRNO = #{brno} AND YR = #{yr} AND FUND_ARTCL = '1') ETS
		WHERE 1=1
			AND EAM.BRNO = ETS.BRNO(+)

		UNION ALL

		SELECT
			EAM.YR
			,ETS.SEQ
			,EAM.BRNO
			,'2' AS FUND_ARTCL /*전문품목  전속취급율*/
			,(SELECT COMPUT_WAY_CD FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '2' AND USE_YN = 'Y' AND ROWNUM = 1) AS COMPUT_WAY_CD
			,(SELECT COMPUT_WAY_DTL FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '2' AND USE_YN = 'Y' AND ROWNUM = 1) AS COMPUT_WAY_DTL
			,(SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '2' AND USE_YN = 'Y' AND ROWNUM = 1) AS ALT
			,EAM.COMPUT_WAY_RSLT
			,(CASE WHEN ETS.SCR IS NOT NULL THEN ETS.SCR
					ELSE TO_CHAR(EAM.COMPUT_WAY_RSLT)
					END
			) AS SCR
		FROM (SELECT
					YR
					,BRNO
					,(GREATEST(LEAST(
							ROUND(NVL(
											SUM(
												NVL(SLS_TOT_AMT_RT,0)
												*  ( NVL(SLS_TOT_AMT,0) + NVL(ONLN_WHLSL_MRKT_AMT,0) )
												/ NULLIF(PERC_CONT,0)
												/ NULLIF(SLS_TOT_AMT_TOT,0)
												* TO_NUMBER(NVL((SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = TOTAL.YR AND FUND_ARTCL = '2' AND USE_YN = 'Y' AND ROWNUM = 1),0))
												)
									,0),2)
						, 50) ,0)
					)AS COMPUT_WAY_RSLT
				FROM
				(SELECT
					ITEM.BRNO
					,ITEM.YR
					,ITEM.CTGRY_CD
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.SLS_TOT_AMT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.SLS_TOT_AMT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.SLS_TOT_AMT
							ELSE ''
							END
					)AS SLS_TOT_AMT
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.SLS_TOT_AMT_RT
							ELSE ''
							END
					)AS SLS_TOT_AMT_RT
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.RT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.RT_PERC_CONT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.RT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.RT_PERC_CONT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.RT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.RT_PERC_CONT
							ELSE ''
							END
					)AS PERC_CONT
					,TOT.SLS_TOT_AMT_TOT
					,NVL((SELECT ROUND(NVL(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)),0) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = ITEM.YR
									AND BRNO = ITEM.BRNO
									AND CTGRY_CD = ITEM.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
				FROM
					(SELECT
							EAM.YR
							,EAM.BRNO
							,YGC.CTGRY_CD
							,(SELECT APRV FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS APRV
						FROM
							(SELECT * FROM TB_EV_APLY_MNG WHERE YR = #{yr} AND APO_SE = '1') EAM
							,(SELECT BRNO , CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = #{yr} GROUP BY BRNO , CTGRY_CD) YGC
						WHERE 1=1
							AND EAM.BRNO = YGC.BRNO
					) ITEM
					,(SELECT BRNO , SUM( NVL( SLS_CNSGN_SLS_AMT , 0 ) ) AS SLS_TOT_AMT_TOT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND YR = #{yr}
								  GROUP BY  BRNO
					) TOT
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '1' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO IN ('5088136321','3038200282'))
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 >= 1 THEN FLOOR(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					) TOTAA
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '1' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 >= 1 THEN FLOOR(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					) TOTAB
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '2' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO = '5108205885')/*부적합 품목 이지만 예외 처리*/
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 >= 1 THEN FLOOR(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTBA
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '2' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 >= 1 THEN FLOOR(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTBB
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '3' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO = '4128124086')/*부적합 품목 이지만 예외 처리*/
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 >= 1 THEN FLOOR(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTCA
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '3' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 >= 1 THEN FLOOR(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTCB
					WHERE 1=1
						AND ITEM.BRNO = TOT.BRNO(+)
						AND ITEM.BRNO = TOTAA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTAA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTAB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTAB.CTGRY_CD(+)
						AND ITEM.BRNO = TOTBA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTBA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTBB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTBB.CTGRY_CD(+)
						AND ITEM.BRNO = TOTCA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTCA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTCB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTCB.CTGRY_CD(+)
						AND SLS_TOT_AMT_TOT IS NOT NULL
						AND SLS_TOT_AMT_TOT > 0
					) TOTAL
					WHERE 1=1
					  AND BRNO = #{brno}
					GROUP BY YR , BRNO
			) EAM
			, (SELECT * FROM TB_EV_ACTVTN_FUND WHERE BRNO = #{brno} AND YR = #{yr} AND FUND_ARTCL = '2') ETS
		WHERE 1=1
			AND EAM.BRNO = ETS.BRNO(+)
	</select>

	<select id="selectScoreList2" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectScoreList2 */
			ETS.YR
			,ETS.SEQ
			,ETS.BRNO
			,ETS.FUND_ARTCL
			,ETS.COMPUT_WAY_CD
			,ETS.COMPUT_WAY_RSLT
			,(SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = ETS.YR AND FUND_ARTCL = ETS.FUND_ARTCL AND COMPUT_WAY_CD = ETS.COMPUT_WAY_CD) AS ALT
			,ETS.SCR
		FROM TB_EV_ACTVTN_FUND ETS
		WHERE 1=1
		  AND BRNO = #{brno}
		  AND YR = #{yr}
		  AND FUND_ARTCL in ('3','4')
		ORDER BY FUND_ARTCL , COMPUT_WAY_CD
	</select>

	<!-- 산출식 관리 리스트 -->
	<select id="selectComputWayList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectComputWayList */
			YR
			, SEQ
			, COMPUT_WAY_CD
			, COMPUT_WAY_DTL
			, FUND_ARTCL
			, ALT
			, RMRK
			, NVL(USE_YN,'N') AS USE_YN
			, DEL_YN
		FROM TB_EV_ACTVTN_FUND_COMPUT_WAY
		WHERE 1=1
		  AND YR = #{yr}

		<if test='fundArtcl != null and fundArtcl != ""'>
		  AND FUND_ARTCL = #{fundArtcl}
		</if>
		<if test='useYn != null and useYn != ""'>
		  AND USE_YN = #{useYn}
		</if>
		ORDER BY FUND_ARTCL , COMPUT_WAY_CD
	</select>

	<insert id="insertComputWay" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		<![CDATA[
		MERGE INTO TB_EV_ACTVTN_FUND_COMPUT_WAY CLT  /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.insertComputWay */
		USING DUAL
			ON (
					CLT.YR		= #{yr}
				AND CLT.SEQ		= #{seq}
				)
		WHEN MATCHED THEN
				 UPDATE
					   SET
						  COMPUT_WAY_CD			= #{computWayCd}
						, COMPUT_WAY_DTL		= #{computWayDtl}
						, FUND_ARTCL			= #{fundArtcl}
						, ALT					= #{alt}
						, USE_YN				= #{useYn}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}
				]]>
				<![CDATA[

					WHERE 1=1
					  AND CLT.YR		= #{yr}
					  AND CLT.SEQ		= #{seq}

		WHEN NOT MATCHED THEN
			 INSERT
					(
						YR
					  , COMPUT_WAY_CD
					  , COMPUT_WAY_DTL
					  , FUND_ARTCL
					  , ALT
					  , USE_YN
					  , RMRK

					  , SYS_FRST_INPT_DT
					  , SYS_FRST_INPT_USER_ID
					  , SYS_FRST_INPT_PRGRM_ID
					  , SYS_LAST_CHG_DT
					  , SYS_LAST_CHG_USER_ID
					  , SYS_LAST_CHG_PRGRM_ID

					)
				VALUES
					(
						#{yr}
					  , #{computWayCd}
					  , #{computWayDtl}
					  , #{fundArtcl}
					  , #{alt}
					  , #{useYn}
					  , #{rmrk}

					  , SYSDATE
					  , #{sysFrstInptUserId}
					  , #{sysFrstInptPrgrmId}
					  , SYSDATE
					  , #{sysLastChgUserId}
					  , #{sysLastChgPrgrmId}
					)
		]]>
	</insert>

	<insert id="insertActvtnFund" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		<![CDATA[
		MERGE INTO TB_EV_ACTVTN_FUND CLT  /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.insertActvtnFund */
		USING DUAL
			ON (
					CLT.YR		= #{yr}
				AND CLT.SEQ		= #{seq}
				)
		WHEN MATCHED THEN
				 UPDATE
					   SET
						  COMPUT_WAY_CD			= #{computWayCd}
						, COMPUT_WAY_RSLT		= #{computWayRslt}
						, FUND_ARTCL			= #{fundArtcl}
						, ALT					= #{alt}
						, SCR					= #{scr}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}
				]]>
				<![CDATA[

					WHERE 1=1
					  AND CLT.YR		= #{yr}
					  AND CLT.SEQ		= #{seq}

		WHEN NOT MATCHED THEN
			 INSERT
					(
						YR
					  , BRNO
					  , COMPUT_WAY_CD
					  , COMPUT_WAY_RSLT
					  , FUND_ARTCL
					  , ALT
					  , SCR
					  , RMRK

					  , SYS_FRST_INPT_DT
					  , SYS_FRST_INPT_USER_ID
					  , SYS_FRST_INPT_PRGRM_ID
					  , SYS_LAST_CHG_DT
					  , SYS_LAST_CHG_USER_ID
					  , SYS_LAST_CHG_PRGRM_ID

					)
				VALUES
					(
						#{yr}
					  , #{brno}
					  , #{computWayCd}
					  , #{computWayRslt}
					  , #{fundArtcl}
					  , #{alt}
					  , #{scr}
					  , #{rmrk}

					  , SYSDATE
					  , #{sysFrstInptUserId}
					  , #{sysFrstInptPrgrmId}
					  , SYSDATE
					  , #{sysLastChgUserId}
					  , #{sysLastChgPrgrmId}
					)
		]]>
	</insert>
	<select id="selectScrDataList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectScoreList1 */
			EAM.YR
			,ETS.SEQ
			,EAM.BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS CORP_NM
			,'1' AS FUND_ARTCL /*전문품목  총취급액*/
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'FUND_ARTCL' AND CD_VL = '1') AS FUND_ARTCL_NM
			,(SELECT COMPUT_WAY_CD FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '1' AND USE_YN = 'Y' AND ROWNUM = 1) AS COMPUT_WAY_CD
			,(SELECT COMPUT_WAY_DTL FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '1' AND USE_YN = 'Y' AND ROWNUM = 1) AS COMPUT_WAY_DTL
			,(SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '1' AND USE_YN = 'Y' AND ROWNUM = 1) AS ALT
			,EAM.COMPUT_WAY_RSLT
			,(CASE WHEN ETS.SCR IS NOT NULL THEN ETS.SCR
					ELSE TO_CHAR(EAM.COMPUT_WAY_RSLT)
					END
			) AS SCR
		FROM (SELECT
					YR
					,BRNO
					,(GREATEST(LEAST(
							ROUND(NVL(
									SUM( (NVL(SLS_TOT_AMT , 0) + NVL(ONLN_WHLSL_MRKT_AMT , 0) )
												*  NVL(SLS_TOT_AMT , 0)
												/ NULLIF(PERC_CONT,0)
												/  NULLIF(SLS_TOT_AMT_TOT,0)
											)
								,0),2)* TO_NUMBER(NVL((SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = TOTAL.YR AND FUND_ARTCL = '1' AND USE_YN = 'Y' AND ROWNUM = 1),0))
						, 50) ,0)
					)AS COMPUT_WAY_RSLT
				FROM
				(SELECT
					ITEM.BRNO
					,ITEM.YR
					,ITEM.CTGRY_CD
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.SLS_TOT_AMT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.SLS_TOT_AMT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.SLS_TOT_AMT
							ELSE ''
							END
					)AS SLS_TOT_AMT
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.TOT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.TOT_PERC_CONT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.TOT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.TOT_PERC_CONT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.TOT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.TOT_PERC_CONT
							ELSE ''
							END
					)AS PERC_CONT
					,TOT.SLS_TOT_AMT_TOT
					,NVL((SELECT ROUND(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = ITEM.YR
									AND BRNO = ITEM.BRNO
									AND CTGRY_CD = ITEM.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
				FROM
					(SELECT
							EAM.YR
							,EAM.BRNO
							,YGC.CTGRY_CD
							,(SELECT APRV FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS APRV
						FROM
							(SELECT * FROM TB_EV_APLY_MNG WHERE YR = #{yr} AND APO_SE = '1') EAM
							,(SELECT BRNO , CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = #{yr} GROUP BY BRNO , CTGRY_CD) YGC
						WHERE 1=1
							AND EAM.BRNO = YGC.BRNO
					) ITEM
					,(SELECT BRNO , SUM( NVL( SLS_CNSGN_SLS_AMT , 0 ) ) AS SLS_TOT_AMT_TOT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND YR = #{yr}
								  GROUP BY  BRNO
					) TOT
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '1' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO IN ('5088136321','3038200282'))
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 >= 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					) TOTAA
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '1' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					) TOTAB
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '2' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO = '5108205885')/*부적합 품목 이지만 예외 처리*/
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTBA
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '2' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTBB
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '3' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO = '4128124086')/*부적합 품목 이지만 예외 처리*/
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTCA
					,(SELECT BRNO, APRV ,CTGRY_CD ,SLS_TOT_AMT ,PERC.TOT_PERC_CONT
						FROM
							(SELECT BRNO , APRV , '3' AS CTGRY_CD
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
									,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO,APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT BRNO
													,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY BRNO
												  ORDER BY SLS_TOT_AMT_TOT)CCC
								ORDER BY SLS_TOT_AMT_TOT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTCB
					WHERE 1=1
						AND ITEM.BRNO = TOT.BRNO(+)
						AND ITEM.BRNO = TOTAA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTAA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTAB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTAB.CTGRY_CD(+)
						AND ITEM.BRNO = TOTBA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTBA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTBB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTBB.CTGRY_CD(+)
						AND ITEM.BRNO = TOTCA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTCA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTCB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTCB.CTGRY_CD(+)
						AND SLS_TOT_AMT_TOT IS NOT NULL
						AND SLS_TOT_AMT_TOT > 0
					) TOTAL
					WHERE 1=1
					GROUP BY YR , BRNO
			) EAM
			, (SELECT * FROM TB_EV_ACTVTN_FUND WHERE YR = #{yr} AND FUND_ARTCL = '1') ETS
		WHERE 1=1
			AND EAM.BRNO = ETS.BRNO(+)

		UNION ALL

		SELECT
			EAM.YR
			,ETS.SEQ
			,EAM.BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS CORP_NM
			,'2' AS FUND_ARTCL /*전문품목  총취급액*/
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'FUND_ARTCL' AND CD_VL = '2') AS FUND_ARTCL_NM
			,(SELECT COMPUT_WAY_CD FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '2' AND USE_YN = 'Y' AND ROWNUM = 1) AS COMPUT_WAY_CD
			,(SELECT COMPUT_WAY_DTL FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '2' AND USE_YN = 'Y' AND ROWNUM = 1) AS COMPUT_WAY_DTL
			,(SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = EAM.YR AND FUND_ARTCL = '2' AND USE_YN = 'Y' AND ROWNUM = 1) AS ALT
			,EAM.COMPUT_WAY_RSLT
			,(CASE WHEN ETS.SCR IS NOT NULL THEN ETS.SCR
					ELSE TO_CHAR(EAM.COMPUT_WAY_RSLT)
					END
			) AS SCR
		FROM (SELECT
					YR
					,BRNO
					,(GREATEST(LEAST(
							ROUND(NVL(
											SUM(
												NVL(SLS_TOT_AMT_RT,0)
												*  ( NVL(SLS_TOT_AMT,0) + NVL(ONLN_WHLSL_MRKT_AMT,0) )
												/ NULLIF(PERC_CONT,0)
												/ NULLIF(SLS_TOT_AMT_TOT,0)
												* TO_NUMBER(NVL((SELECT ALT FROM TB_EV_ACTVTN_FUND_COMPUT_WAY WHERE YR = TOTAL.YR AND FUND_ARTCL = '2' AND USE_YN = 'Y' AND ROWNUM = 1),0))
												)
									,0),2)
						, 50) ,0)
					)AS COMPUT_WAY_RSLT
				FROM
				(SELECT
					ITEM.BRNO
					,ITEM.YR
					,ITEM.CTGRY_CD
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.SLS_TOT_AMT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.SLS_TOT_AMT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.SLS_TOT_AMT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.SLS_TOT_AMT
							ELSE ''
							END
					)AS SLS_TOT_AMT
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.SLS_TOT_AMT_RT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.SLS_TOT_AMT_RT
							ELSE ''
							END
					)AS SLS_TOT_AMT_RT
					,(CASE WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '1' THEN TOTAA.RT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '1' THEN TOTAB.RT_PERC_CONT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '2' THEN TOTBA.RT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '2' THEN TOTBB.RT_PERC_CONT
							WHEN ITEM.APRV = '1' AND ITEM.CTGRY_CD = '3' THEN TOTCA.RT_PERC_CONT
							WHEN ITEM.APRV = '2' AND ITEM.CTGRY_CD = '3' THEN TOTCB.RT_PERC_CONT
							ELSE ''
							END
					)AS PERC_CONT
					,TOT.SLS_TOT_AMT_TOT
					,NVL((SELECT ROUND(NVL(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)),0) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = ITEM.YR
									AND BRNO = ITEM.BRNO
									AND CTGRY_CD = ITEM.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
				FROM
					(SELECT
							EAM.YR
							,EAM.BRNO
							,YGC.CTGRY_CD
							,(SELECT APRV FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS APRV
						FROM
							(SELECT * FROM TB_EV_APLY_MNG WHERE YR = #{yr} AND APO_SE = '1') EAM
							,(SELECT BRNO , CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = #{yr} GROUP BY BRNO , CTGRY_CD) YGC
						WHERE 1=1
							AND EAM.BRNO = YGC.BRNO
					) ITEM
					,(SELECT BRNO , SUM( NVL( SLS_CNSGN_SLS_AMT , 0 ) ) AS SLS_TOT_AMT_TOT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND YR = #{yr}
								  GROUP BY  BRNO
					) TOT
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '1' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO IN ('5088136321','3038200282'))
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					) TOTAA
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '1' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					) TOTAB
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '2' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO = '5108205885')/*부적합 품목 이지만 예외 처리*/
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTBA
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '2' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTBB
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '3' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '1'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND (STBLT_YN = 'Y' OR BRNO = '4128124086')/*부적합 품목 이지만 예외 처리*/
												  AND APRV = '1'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTCA
					,(SELECT BRNO , APRV ,CTGRY_CD , SLS_TOT_AMT ,SLS_TOT_AMT_RT ,PERC.RT_PERC_CONT
						FROM
							(SELECT BRNO , APRV  , '3' AS CTGRY_CD
								,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
													,2) ,0
								) AS SLS_TOT_AMT_RT
								,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
								FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO IN ('2','3','6','7')
								  AND STBLT_YN = 'Y'
								  AND APRV = '2'
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
								  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
								  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
								  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																	THEN ERR.MNGR_ICPT_RSN_CD
																	ELSE ERR.ICPT_RSN_CD
																	END)
															FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
								  AND YR = #{yr}
								  GROUP BY  BRNO , APRV)
							,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
								FROM
									(SELECT
											CCC.*
											,ROWNUM AS A
											,COUNT(*) OVER () AS TOTAL_ROWS
										FROM
											(SELECT
													BRNO
													,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
													) AS SLS_TOT_AMT_RT
												FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
												WHERE 1=1
												  AND APO_SE = '1'
												  AND TYPE_SE_NO IN ('2','3','6','7')
												  AND STBLT_YN = 'Y'
												  AND APRV = '2'
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
												  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
												  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
												  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
												  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																					THEN ERR.MNGR_ICPT_RSN_CD
																					ELSE ERR.ICPT_RSN_CD
																					END)
																			FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
												  AND YR = #{yr}
												  GROUP BY  BRNO
												  ORDER BY SLS_TOT_AMT_RT)CCC
								ORDER BY SLS_TOT_AMT_RT)
								WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
							) PERC
					)TOTCB
					WHERE 1=1
						AND ITEM.BRNO = TOT.BRNO(+)
						AND ITEM.BRNO = TOTAA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTAA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTAB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTAB.CTGRY_CD(+)
						AND ITEM.BRNO = TOTBA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTBA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTBB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTBB.CTGRY_CD(+)
						AND ITEM.BRNO = TOTCA.BRNO(+)
						AND ITEM.CTGRY_CD = TOTCA.CTGRY_CD(+)
						AND ITEM.BRNO = TOTCB.BRNO(+)
						AND ITEM.CTGRY_CD = TOTCB.CTGRY_CD(+)
						AND SLS_TOT_AMT_TOT IS NOT NULL
						AND SLS_TOT_AMT_TOT > 0
					) TOTAL
					WHERE 1=1
					GROUP BY YR , BRNO
			) EAM
			, (SELECT * FROM TB_EV_ACTVTN_FUND WHERE YR = #{yr} AND FUND_ARTCL = '2') ETS
		WHERE 1=1
			AND EAM.BRNO = ETS.BRNO(+)
	</select>
	<select id="selectRtDataList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		/* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectRtDataList */
		/* CTGRY_CD ='1'  APRV = '2' */
		SELECT YR, BRNO ,CTGRY_CD
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = CCA.BRNO) AS CORP_NM
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = CCA.CTGRY_CD) AS CTGRY_NM
			,NVL(SLS_TOT_AMT, 0) AS SLS_TOT_AMT
			,NVL(SLS_TOT_AMT_TOT, 0) AS SLS_TOT_AMT_TOT
			,NVL(SLS_TOT_AMT_RT, 0) AS SLS_TOT_AMT_RT
			,NVL((SELECT ROUND(NVL(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)),0) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = CCA.YR
									AND BRNO = CCA.BRNO
									AND CTGRY_CD = CCA.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
			,TOT.TOT_PERC_CONT
			,RT.RT_PERC_CONT
							FROM
								(SELECT YR, BRNO , '1' AS CTGRY_CD
										,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																		/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
										) AS SLS_TOT_AMT_RT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
										FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
										WHERE 1=1
										  AND APO_SE = '1'
										  AND TYPE_SE_NO IN ('2','3','6','7')
										  AND STBLT_YN = 'Y'
										  AND APRV = '1'
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
										  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																			THEN ERR.MNGR_ICPT_RSN_CD
																			ELSE ERR.ICPT_RSN_CD
																			END)
																	FROM TB_EV_REG_RSLT ERR WHERE  APO_SE = '1' AND  YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
										  AND YR = #{yr}
										  GROUP BY  YR, BRNO
								) CCA
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND (STBLT_YN = 'Y' OR BRNO IN ('5088136321','3038200282'))
													  AND APRV = '1'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE  APO_SE = '1' AND  YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_TOT)CCCC
									ORDER BY SLS_TOT_AMT_TOT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) TOT
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																	/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
																,2) ,0
														) AS SLS_TOT_AMT_RT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND (STBLT_YN = 'Y' OR BRNO IN ('5088136321','3038200282'))
													  AND APRV = '1'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE  APO_SE = '1' AND  YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_RT)CCCC
									ORDER BY SLS_TOT_AMT_RT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) RT
		UNION ALL
		/* CTGRY_CD ='1'  APRV = '2' */
		SELECT YR, BRNO ,CTGRY_CD  /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectRtDataList */
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = CCA.BRNO) AS CORP_NM
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = CCA.CTGRY_CD) AS CTGRY_NM
			,NVL(SLS_TOT_AMT, 0) AS SLS_TOT_AMT
			,NVL(SLS_TOT_AMT_TOT, 0) AS SLS_TOT_AMT_TOT
			,NVL(SLS_TOT_AMT_RT, 0) AS SLS_TOT_AMT_RT
			,NVL((SELECT ROUND(NVL(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)),0) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = CCA.YR
									AND BRNO = CCA.BRNO
									AND CTGRY_CD = CCA.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
			,TOT.TOT_PERC_CONT
			,RT.RT_PERC_CONT
							FROM
								(SELECT YR, BRNO , '1' AS CTGRY_CD
										,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																		/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
										) AS SLS_TOT_AMT_RT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
										FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
										WHERE 1=1
										  AND APO_SE = '1'
										  AND TYPE_SE_NO IN ('2','3','6','7')
										  AND STBLT_YN = 'Y'
										  AND APRV = '2'
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
										  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																			THEN ERR.MNGR_ICPT_RSN_CD
																			ELSE ERR.ICPT_RSN_CD
																			END)
																	FROM TB_EV_REG_RSLT ERR WHERE  APO_SE = '1' AND  YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
										  AND YR = #{yr}
										  GROUP BY  YR, BRNO
								) CCA
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND STBLT_YN = 'Y'
													  AND APRV = '2'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE   APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_TOT)CCCC
									ORDER BY SLS_TOT_AMT_TOT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) TOT
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																	/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
																,2) ,0
														) AS SLS_TOT_AMT_RT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND STBLT_YN = 'Y'
													  AND APRV = '2'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE  APO_SE = '1' AND  YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_RT)CCCC
									ORDER BY SLS_TOT_AMT_RT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) RT
		UNION ALL
		/* CTGRY_CD ='2'  APRV = '1' */
		SELECT YR, BRNO ,CTGRY_CD  /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectRtDataList */
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = CCA.BRNO) AS CORP_NM
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = CCA.CTGRY_CD) AS CTGRY_NM
			,NVL(SLS_TOT_AMT, 0) AS SLS_TOT_AMT
			,NVL(SLS_TOT_AMT_TOT, 0) AS SLS_TOT_AMT_TOT
			,NVL(SLS_TOT_AMT_RT, 0) AS SLS_TOT_AMT_RT
			,NVL((SELECT ROUND(NVL(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)),0) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = CCA.YR
									AND BRNO = CCA.BRNO
									AND CTGRY_CD = CCA.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
			,TOT.TOT_PERC_CONT
			,RT.RT_PERC_CONT
							FROM
								(SELECT YR, BRNO , '1' AS CTGRY_CD
										,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																		/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
										) AS SLS_TOT_AMT_RT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
										FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
										WHERE 1=1
										  AND APO_SE = '1'
										  AND TYPE_SE_NO IN ('2','3','6','7')
										  AND STBLT_YN = 'Y'
										  AND APRV = '1'
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
										  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																			THEN ERR.MNGR_ICPT_RSN_CD
																			ELSE ERR.ICPT_RSN_CD
																			END)
																	FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
										  AND YR = #{yr}
										  GROUP BY  YR, BRNO
								) CCA
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND (STBLT_YN = 'Y' OR BRNO = '5108205885')/*부적합 품목 이지만 예외 처리*/
													  AND APRV = '1'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_TOT)CCCC
									ORDER BY SLS_TOT_AMT_TOT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) TOT
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																	/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
																,2) ,0
														) AS SLS_TOT_AMT_RT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND (STBLT_YN = 'Y' OR BRNO = '5108205885')/*부적합 품목 이지만 예외 처리*/
													  AND APRV = '1'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_RT)CCCC
									ORDER BY SLS_TOT_AMT_RT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) RT

		UNION ALL
		/* CTGRY_CD ='2'  APRV = '2' */
		SELECT YR, BRNO ,CTGRY_CD  /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectRtDataList */
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = CCA.BRNO) AS CORP_NM
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = CCA.CTGRY_CD) AS CTGRY_NM
			,NVL(SLS_TOT_AMT, 0) AS SLS_TOT_AMT
			,NVL(SLS_TOT_AMT_TOT, 0) AS SLS_TOT_AMT_TOT
			,NVL(SLS_TOT_AMT_RT, 0) AS SLS_TOT_AMT_RT
			,NVL((SELECT ROUND(NVL(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)),0) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = CCA.YR
									AND BRNO = CCA.BRNO
									AND CTGRY_CD = CCA.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
			,TOT.TOT_PERC_CONT
			,RT.RT_PERC_CONT
							FROM
								(SELECT YR, BRNO , '1' AS CTGRY_CD
										,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																		/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
										) AS SLS_TOT_AMT_RT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
										FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
										WHERE 1=1
										  AND APO_SE = '1'
										  AND TYPE_SE_NO IN ('2','3','6','7')
										  AND STBLT_YN = 'Y'
										  AND APRV = '2'
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
										  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
										  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																			THEN ERR.MNGR_ICPT_RSN_CD
																			ELSE ERR.ICPT_RSN_CD
																			END)
																	FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
										  AND YR = #{yr}
										  GROUP BY  YR, BRNO
								) CCA
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND STBLT_YN = 'Y'
													  AND APRV = '2'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_TOT)CCCC
									ORDER BY SLS_TOT_AMT_TOT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) TOT
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																	/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
																,2) ,0
														) AS SLS_TOT_AMT_RT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND STBLT_YN = 'Y'
													  AND APRV = '2'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '2' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_RT)CCCC
									ORDER BY SLS_TOT_AMT_RT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) RT
		UNION ALL
		/* CTGRY_CD ='3'  APRV = '1' */
		SELECT YR, BRNO ,CTGRY_CD
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = CCB.BRNO) AS CORP_NM
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = CCB.CTGRY_CD) AS CTGRY_NM
			,NVL(SLS_TOT_AMT, 0) AS SLS_TOT_AMT
			,NVL(SLS_TOT_AMT_TOT, 0) AS SLS_TOT_AMT_TOT
			,NVL(SLS_TOT_AMT_RT, 0) AS SLS_TOT_AMT_RT
			,NVL((SELECT ROUND(NVL(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)),0) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = CCB.YR
									AND BRNO = CCB.BRNO
									AND CTGRY_CD = CCB.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
			,TOT.TOT_PERC_CONT
			,RT.RT_PERC_CONT
							FROM
								(SELECT YR, BRNO , '2' AS CTGRY_CD
										,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTB.SLS_CNSGN_SLS_AMT,0) END) ,0)
																		/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTB.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
										) AS SLS_TOT_AMT_RT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTB.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTB.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
										FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTB
										WHERE 1=1
										  AND APO_SE = '1'
										  AND TYPE_SE_NO IN ('2','3','6','7')
										  AND STBLT_YN = 'Y'
										  AND APRV = '1'
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTB.YR AND BRNO = PSTB.BRNO AND ITEM_CD = PSTB.ITEM_CD)
										  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTB.YR AND BRNO = PSTB.BRNO AND ITEM_CD = PSTB.ITEM_CD)
										  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTB.YR AND BRNO = PSTB.BRNO AND ITEM_CD = PSTB.ITEM_CD)
										  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
										  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																			THEN ERR.MNGR_ICPT_RSN_CD
																			ELSE ERR.ICPT_RSN_CD
																			END)
																	FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTB.YR AND BRNO = PSTB.BRNO),'N')
										  AND YR = #{yr}
										  GROUP BY  YR, BRNO
								) CCB
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND (STBLT_YN = 'Y' OR BRNO = '4128124086')/*부적합 품목 이지만 예외 처리*/
													  AND APRV = '1'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_TOT)CCCC
									ORDER BY SLS_TOT_AMT_TOT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) TOT
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																	/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
																,2) ,0
														) AS SLS_TOT_AMT_RT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND (STBLT_YN = 'Y' OR BRNO = '4128124086')/*부적합 품목 이지만 예외 처리*/
													  AND APRV = '1'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_RT)CCCC
									ORDER BY SLS_TOT_AMT_RT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) RT
		UNION ALL
		/* CTGRY_CD ='3'  APRV = '2' */
		SELECT YR, BRNO ,CTGRY_CD
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = CCC.BRNO) AS CORP_NM
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = CCC.CTGRY_CD) AS CTGRY_NM
			,NVL(SLS_TOT_AMT, 0) AS SLS_TOT_AMT
			,NVL(SLS_TOT_AMT_TOT, 0) AS SLS_TOT_AMT_TOT
			,NVL(SLS_TOT_AMT_RT, 0) AS SLS_TOT_AMT_RT
			,NVL((SELECT ROUND(NVL(SUM(NVL(ONLN_WHLSL_MRKT_AMT,0)),0) * 0.2 , 2 )
								FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
								WHERE YR = CCC.YR
									AND BRNO = CCC.BRNO
									AND CTGRY_CD = CCC.CTGRY_CD
									AND PRCHS_SLS_SE = '2') , 0
					) AS ONLN_WHLSL_MRKT_AMT
			,TOT.TOT_PERC_CONT
			,RT.RT_PERC_CONT
							FROM
								(SELECT YR, BRNO , '3' AS CTGRY_CD
										,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTC.SLS_CNSGN_SLS_AMT,0) END) ,0)
																		/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTC.SLS_CNSGN_SLS_AMT,0) END), 0)
															,2) ,0
										) AS SLS_TOT_AMT_RT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTC.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT
										,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTC.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
										FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTC
										WHERE 1=1
										  AND APO_SE = '1'
										  AND TYPE_SE_NO IN ('2','3','6','7')
										  AND STBLT_YN = 'Y'
										  AND APRV = '2'
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
										  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
										  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTC.YR AND BRNO = PSTC.BRNO AND ITEM_CD = PSTC.ITEM_CD)
										  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTC.YR AND BRNO = PSTC.BRNO AND ITEM_CD = PSTC.ITEM_CD)
										  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTC.YR AND BRNO = PSTC.BRNO AND ITEM_CD = PSTC.ITEM_CD)
										  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
										  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																			THEN ERR.MNGR_ICPT_RSN_CD
																			ELSE ERR.ICPT_RSN_CD
																			END)
																	FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTC.YR AND BRNO = PSTC.BRNO),'N')
										  AND YR = #{yr}
										  GROUP BY  YR, BRNO
								) CCC
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_TOT, 0)),2) AS TOT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) AS SLS_TOT_AMT_TOT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND STBLT_YN = 'Y'
													  AND APRV = '2'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_TOT)CCCC
									ORDER BY SLS_TOT_AMT_TOT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) TOT
								,(SELECT
									ROUND(AVG(NVL(SLS_TOT_AMT_RT, 0)),2) AS RT_PERC_CONT
									FROM
										(SELECT
												CCCC.*
												,ROWNUM AS A
												,COUNT(*) OVER () AS TOTAL_ROWS
											FROM
												(SELECT YR, BRNO , APRV , '1' AS CTGRY_CD
														,NVL( ROUND( NVL(SUM(CASE WHEN TYPE_SE_NO IN ('2','6') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END) ,0)
																	/ NULLIF(SUM(CASE WHEN TYPE_SE_NO IN ('2','3','6','7') THEN NVL(PSTA.SLS_CNSGN_SLS_AMT,0) END), 0)
																,2) ,0
														) AS SLS_TOT_AMT_RT
													FROM (SELECT A.*, (SELECT APRV FROM TB_EV_APO WHERE BRNO = A.BRNO) AS APRV from TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A) PSTA
													WHERE 1=1
													  AND APO_SE = '1'
													  AND TYPE_SE_NO IN ('2','3','6','7')
													  AND STBLT_YN = 'Y'
													  AND APRV = '2'
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61'))
													  AND BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND UO_BRNO NOT IN (SELECT BRNO FROM TB_COM_USER WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'))
													  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '3' =  (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  AND '1' =  (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = PSTA.YR AND BRNO = PSTA.BRNO AND ITEM_CD = PSTA.ITEM_CD)
													  /* MNGR_ICPT_RSN_CD = A 기본요건 미달*/
													  AND 'A' != NVL((SELECT (CASE WHEN NVL(ERR.MNGR_ICPT_RSN_CD,'') IS NOT NULL
																						THEN ERR.MNGR_ICPT_RSN_CD
																						ELSE ERR.ICPT_RSN_CD
																						END)
																				FROM TB_EV_REG_RSLT ERR WHERE APO_SE = '1' AND YR = PSTA.YR AND BRNO = PSTA.BRNO),'N')
													  AND YR = #{yr}
													  GROUP BY  YR, BRNO,APRV
													  ORDER BY SLS_TOT_AMT_RT)CCCC
									ORDER BY SLS_TOT_AMT_RT)
									WHERE A > TOTAL_ROWS - (CASE WHEN TOTAL_ROWS* 0.1 > 1 THEN CEIL(TOTAL_ROWS * 0.1) WHEN 1 > TOTAL_ROWS* 0.9  THEN 1 ELSE 1 END)
								) RT

	</select>

	<select id="selectScrUserGrid01" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
	</select>
	<select id="selectScrUserGrid02" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
	</select>
	<select id="selectScrUserGrid03" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectScrUserGrid03 */
			TOT.YR
			,TOT.BRNO
			,TOT.CORP_NM
			,TOT.CORP_SE_CD
			,TOT.CORP_SE_NM
			,TOT.CORP_DTL_SE_CD
			,TOT.CORP_DTL_SE_NM

			,TOT.ICPT_RSN_CD

			,TOT.ICPT_RSN_DTL_CD

			,TOT.STBLT_YN

			,TOT.ITR_RT

			, DECODE(TOT.ICPT_RSN_CD , 'A' , '기본요건 미충족'
										,'B' ,'세부요건 미충족'
										,'C' , '통합조직 탈락'
										,'EX1' , '-'
										,'EX2' , '-'
										,''
			)AS ICPT_RSN_NM
			, DECODE(TOT.ICPT_RSN_DTL_CD , 'A1' , '농업경영체 미등록'
											,'A2' ,'출자자본금 1억원 미달'
											,'A3' ,'설립 후 운영실적 1년 미만'
											,'A4' ,'농업인 주주 5명 미만'
											,'A5' ,'농업인 주주 지분 50% 미만'
											,'A6' ,'원예농산물 취급액 50% 미만'
											,'A7' ,'조공설립계획 미수립'
											,'A8' ,'현장실사 미참여'
											,'B1' ,'품목 부적합(농협조직)'
											,'B2' ,'품목 부적합(농업법인, 협동조합)'
											,'C1' , '통합조직 탈락(농협조직)'
											,'C2' , '통합조직 탈락(농업법인, 협동조합)'
											,'-' , '-'
											,''
			)AS ICPT_RSN_DTL_NM
			, DECODE(TOT.ICPT_RSN_CD , 'A' , '기존자금 회수'
										,'B' ,'최고금리'
										,'C' , '최고금리'
										,'EX1' , '최고금리'
										,'EX2' , '기존자금 회수'
			)AS PNLTY

			,TOT.FUND_APLY_AMT_TOT
			,(NVL((SELECT PRUO_FUND_APLY_AMT FROM TB_EV_APLY_MNG WHERE BRNO = TOT.BRNO AND YR = TOT.YR AND APO_SE = '1'),0)
				+ NVL((SELECT SUM(ISO_FUND_APLY_AMT)
						FROM TB_EV_APLY_MNG TEAM
						WHERE 1=1
						  AND YR = TOT.YR
						  AND UO_BRNO = TOT.BRNO
						  AND APO_SE = '2'
						  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = TOT.BRNO)
						  AND BRNO = (SELECT BRNO
						  				FROM TB_EV_REG_RSLT TERR
						  				WHERE 1=1
						  				  AND APO_SE = '2'
						  				  AND YR = TEAM.YR
						  				  AND BRNO = TEAM.BRNO
						  				  AND UO_BRNO = TOT.BRNO
						  				  AND 'Y' = (CASE WHEN TERR.MNGR_STBLT_YN = 'Y' THEN 'Y'
						  									WHEN TERR.MNGR_STBLT_YN = 'N' THEN 'N'
						  									ELSE TERR.STBLT_YN
						  									END)
						  				)
						  ),0)
			) AS FUND_APLY_AMT_STBLT_TOT
			,TOT.STBLT_ITEM_LIST
			,TOT.RMRK
		FROM
		(SELECT
			ERR.YR
			,ERR.BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_NM

			,(SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_SE_CD

			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL
				WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = (SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO)
			) AS CORP_SE_NM

			,(SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_DTL_SE_CD

			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL
				WHERE CD_ID = 'CORP_SHAP' AND CD_VL = (SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO)
			) AS CORP_DTL_SE_NM

			,(CASE
					WHEN ERR.MNGR_STBLT_YN = 'Y' THEN ERR.MNGR_ICPT_RSN_CD
					WHEN ERR.MNGR_ICPT_RSN_CD IS NOT NULL THEN ERR.MNGR_ICPT_RSN_CD
					ELSE ERR.ICPT_RSN_CD
					END
			) AS ICPT_RSN_CD

			,(CASE
					WHEN ERR.MNGR_STBLT_YN = 'Y' THEN ERR.MNGR_ICPT_RSN_DTL_CD
					WHEN ERR.MNGR_ICPT_RSN_DTL_CD IS NOT NULL THEN ERR.MNGR_ICPT_RSN_DTL_CD
					ELSE ERR.ICPT_RSN_DTL_CD
					END
			) AS ICPT_RSN_DTL_CD

			,(CASE WHEN ERR.MNGR_STBLT_YN IS NOT NULL THEN ERR.MNGR_STBLT_YN
					ELSE ERR.STBLT_YN
					END
			) AS STBLT_YN

			,(CASE WHEN ERR.MNGR_ITR_RT IS NOT NULL THEN ERR.MNGR_ITR_RT
					ELSE ERR.ITR_RT
					END
			) AS ITR_RT

			,FUND_APLY_AMT_TOT
			,FUND_APLY_AMT_STBLT_TOT
			,ERR.STBLT_ITEM_LIST
			,ERR.RMRK

		FROM TB_EV_REG_RSLT ERR
		WHERE 1=1
		  AND APO_SE = '1'
		  AND YR = #{yr}
		  AND BRNO = #{brno}
		)TOT

	</select>
	<select id="selectScrUserGrid04" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT   /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectScrUserGrid04 */
			TOT.YR
			,TOT.BRNO
			,TOT.CORP_NM
			,TOT.CORP_SE_CD
			,TOT.CORP_SE_NM
			,TOT.CORP_DTL_SE_CD
			,TOT.CORP_DTL_SE_NM
			,TOT.UO_BRNO
			,TOT.UO_CORP_NM
			,TOT.UO_CORP_SE_CD
			,TOT.UO_CORP_SE_NM
			,TOT.UO_CORP_DTL_SE_CD
			,TOT.UO_CORP_DTL_SE_NM

			,TOT.ICPT_RSN_CD

			,TOT.ICPT_RSN_DTL_CD

			,TOT.STBLT_YN

			,TOT.ITR_RT

			, DECODE(TOT.ICPT_RSN_CD , 'A' , '기본요건 미충족'
										,'B' ,'세부요건 미충족'
										,'C' , '통합조직 탈락'
										,'EX1' , '-'
										,'EX2' , '-'
										,''
			)AS ICPT_RSN_NM
			, DECODE(TOT.ICPT_RSN_DTL_CD , 'A1' , '농업경영체 미등록'
											,'A2' ,'출자자본금 1억원 미달'
											,'A3' ,'설립 후 운영실적 1년 미만'
											,'A4' ,'농업인 주주 5명 미만'
											,'A5' ,'농업인 주주 지분 50% 미만'
											,'A6' ,'원예농산물 취급액 50% 미만'
											,'A7' ,'조공설립계획 미수립'
											,'A8' ,'현장실사 미참여'
											,'B1' ,'품목 부적합(농협조직)'
											,'B2' ,'품목 부적합(농업법인, 협동조합)'
											,'C1' , '통합조직 탈락(농협조직)'
											,'C2' , '통합조직 탈락(농업법인, 협동조합)'
											,'-' , '-'
											,''
			)AS ICPT_RSN_DTL_NM
			, DECODE(TOT.ICPT_RSN_CD , 'A' , '기존자금 회수'
										,'B' ,'최고금리'
										,'C' , '최고금리'
										,'EX1' , '최고금리'
										,'EX2' , '기존자금 회수'
										,''
			)AS PNLTY

			,TOT.FUND_APLY_AMT_TOT
			,TOT.STBLT_ITEM_LIST
			,TOT.RMRK
		FROM
		(SELECT
			ERR.YR
			,ERR.BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_NM

			,(SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_SE_CD

			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL
				WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = (SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO)
			)CORP_SE_NM

			,(SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_DTL_SE_CD

			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL
				WHERE CD_ID = 'CORP_SHAP' AND CD_VL = (SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO)
			) AS CORP_DTL_SE_NM


			,ERR.UO_BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ERR.UO_BRNO) AS UO_CORP_NM

			,(SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.UO_BRNO) AS UO_CORP_SE_CD

			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL
				WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = (SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.UO_BRNO)
			) AS UO_CORP_SE_NM

			,(SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.UO_BRNO) AS UO_CORP_DTL_SE_CD

			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL
				WHERE CD_ID = 'CORP_SHAP' AND CD_VL = (SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.UO_BRNO)
			) AS UO_CORP_DTL_SE_NM


			,(CASE
					WHEN ERR.MNGR_STBLT_YN = 'Y' THEN ERR.MNGR_ICPT_RSN_CD
					WHEN ERR.MNGR_ICPT_RSN_CD IS NOT NULL THEN ERR.MNGR_ICPT_RSN_CD
					ELSE ERR.ICPT_RSN_CD
					END
			) AS ICPT_RSN_CD

			,(CASE
					WHEN ERR.MNGR_STBLT_YN = 'Y' THEN ERR.MNGR_ICPT_RSN_DTL_CD
					WHEN ERR.MNGR_ICPT_RSN_DTL_CD IS NOT NULL THEN ERR.MNGR_ICPT_RSN_DTL_CD
					ELSE ERR.ICPT_RSN_DTL_CD
					END
			) AS ICPT_RSN_DTL_CD

			,(CASE WHEN ERR.MNGR_STBLT_YN IS NOT NULL THEN ERR.MNGR_STBLT_YN
					ELSE ERR.STBLT_YN
					END
			) AS STBLT_YN

			,(CASE WHEN ERR.MNGR_ITR_RT IS NOT NULL THEN ERR.MNGR_ITR_RT
					ELSE ERR.ITR_RT
					END
			) AS ITR_RT

			,(SELECT ISO_FUND_APLY_AMT
					FROM TB_EV_APLY_MNG
					WHERE 1=1
					  AND APO_SE = '2'
					  AND YR = ERR.YR
					  AND BRNO = ERR.BRNO
					  AND UO_BRNO = ERR.UO_BRNO
			) AS FUND_APLY_AMT_TOT
			,ERR.STBLT_ITEM_LIST
			,ERR.RMRK
		FROM TB_EV_REG_RSLT ERR
		WHERE 1=1
		  AND APO_SE = '2'
		  AND YR = #{yr}
		  AND UO_BRNO = #{brno})TOT
	</select>
	<select id="selectScrUserGrid05" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		SELECT  /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectScrUserGrid05 */
			ESR.YR
			,ESR.BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ESR.BRNO) AS CORP_NM
			,ESR.APO_SE
			,ESR.APRV
			,DECODE(ESR.APRV , '1' , '승인형' , '2' , '육성형' , '' ) AS APRV_NM
			,ESR.SLS_TOT_AMT_SCR
			,ESR.SLS_TOT_RT_SCR
			,ESR.TOT_SCR
			,ESR.ONLN_WHLSL_MRKT_SCR
			,ESR.RTL_EDNST_SCR
			,ESR.DDC_SCR
			,ESR.LAST_SCR
		FROM TB_EV_SCR_RSLT ESR
		WHERE 1=1
		  AND APO_SE = '1'
		  AND BRNO = #{brno}
		  AND YR = #{yr}
	</select>

	<!-- 최종점수 조회 -->
	<select id="selectScrRsltList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.selectScrRsltList */
			ESR.YR
			,ESR.BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ESR.BRNO) AS CORP_NM
			,ESR.APO_SE
			,ESR.APRV
			,DECODE(ESR.APRV , '1' , '승인형' , '2' , '육성형' , '' ) AS APRV_NM
			,ESR.SLS_TOT_AMT_SCR
			,ESR.SLS_TOT_RT_SCR
			,ESR.TOT_SCR
			,ESR.ONLN_WHLSL_MRKT_SCR
			,ESR.RTL_EDNST_SCR
			,ESR.DDC_SCR
			,ESR.LAST_SCR
		FROM TB_EV_SCR_RSLT ESR
		WHERE 1=1
		  AND APO_SE = '1'
		  AND BRNO = #{brno}
		  AND YR = #{yr}
	</select>

	<!-- 최종점수 저장 -->
	<insert id="insertScrRslt" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		MERGE INTO TB_EV_SCR_RSLT CLT  /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluFndsMngMapper.insertScrRslt */
		USING DUAL
			ON (
					CLT.YR		= #{yr}
				AND CLT.BRNO	= #{brno}
				)
		WHEN MATCHED THEN
				 UPDATE
					   SET
						  SLS_TOT_AMT_SCR			= #{slsTotAmtScr}
						, SLS_TOT_RT_SCR			= #{slsTotRtScr}
						, TOT_SCR					= #{totScr}
						, ONLN_WHLSL_MRKT_SCR		= #{onlnWhlslMrktScr}
						, RTL_EDNST_SCR				= #{rtlEdnstScr}
						, DDC_SCR					= #{ddcScr}
						, LAST_SCR					= #{lastScr}

						, SYS_LAST_CHG_DT			= SYSDATE
						, SYS_LAST_CHG_USER_ID		= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID		= #{sysLastChgPrgrmId}

					WHERE 1=1
					  AND CLT.YR		= #{yr}
					  AND CLT.BRNO		= #{brno}

		WHEN NOT MATCHED THEN
			 INSERT
					(
						YR
					  , BRNO
					  , APO_SE
					  , APRV

					  , SLS_TOT_AMT_SCR
					  , SLS_TOT_RT_SCR
					  , TOT_SCR
					  , ONLN_WHLSL_MRKT_SCR
					  , RTL_EDNST_SCR
					  , DDC_SCR
					  , LAST_SCR

					  , SYS_FRST_INPT_DT
					  , SYS_FRST_INPT_USER_ID
					  , SYS_FRST_INPT_PRGRM_ID
					  , SYS_LAST_CHG_DT
					  , SYS_LAST_CHG_USER_ID
					  , SYS_LAST_CHG_PRGRM_ID

					)
				VALUES
					(
						#{yr}
					  , #{brno}
					  , '1'
					  , (SELECT APRV FROM TB_EV_APO WHERE BRNO = #{brno})

					  , #{slsTotAmtScr}
					  , #{slsTotRtScr}
					  , #{totScr}
					  , #{onlnWhlslMrktScr}
					  , #{rtlEdnstScr}
					  , #{ddcScr}
					  , #{lastScr}



					  , SYSDATE
					  , #{sysFrstInptUserId}
					  , #{sysFrstInptPrgrmId}
					  , SYSDATE
					  , #{sysLastChgUserId}
					  , #{sysLastChgPrgrmId}
					)
	</insert>
	<!-- 활성화자금 출자출하조직 로우데이터 -->
	<select id="selectFndsRawDataIsoList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		SELECT
			ERR.YR
			,UOEA.CORP_SE_CD AS UO_CORP_SE_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = UOEA.CORP_SE_CD) AS UO_CORP_SE_NM
			,UOEA.CORP_NM AS UO_CORP_NM
			,ERR.UO_BRNO
			,UOEA.APRV
			,DECODE(UOEA.APRV , '1' , '승인형' , '2' , '육성형' , '' ) AS APRV_NM

			,URR.STBLT_YN AS UO_STBLT_YN
			,URR.ICPT_RSN_CD AS UO_ICPT_RSN_CD
			, DECODE(URR.ICPT_RSN_CD , 'A' , '기본요건 미충족'
															,'B' ,'세부요건 미충족'
															,'C' , '통합조직 탈락'
															,'EX1' , '-'
															,'EX2' , '-'
															,''
			)AS UO_ICPT_RSN_NM
			,URR.ITR_RT AS UO_ITR_RT
		/*
			,URR.MNGR_STBLT_YN AS UO_MNGR_STBLT_YN
			,URR.MNGR_ICPT_RSN_CD AS UO_MNGR_ICPT_RSN_CD
			, DECODE(URR.MNGR_ICPT_RSN_CD , 'A' , '기본요건 미충족'
																	,'B' ,'세부요건 미충족'
																	,'C' , '통합조직 탈락'
																	,'EX1' , '-'
																	,'EX2' , '-'
																	,''
			)AS UO_MNGR_ICPT_RSN_NM
			,URR.MNGR_ITR_RT AS UO_MNGR_ITR_RT
		*/

			,ISOEA.CORP_SE_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = ISOEA.CORP_SE_CD) AS CORP_SE_NM
			,ISOEA.CORP_NM
			,ISOEA.BRNO
			,DECODE(ERR.APO_SE , '2' , DECODE(  (SELECT COUNT(*) FROM TB_EV_APO_UO_CD WHERE ISO_BRNO = ERR.BRNO) , 1, 'N' , 'Y')
										,'-'
			)AS UO_BRNO_CNT

			,ERR.STBLT_ITEM_LIST
			,ERR.STBLT_YN

			,ERR.ICPT_RSN_CD
			,DECODE(ERR.ICPT_RSN_CD , 'A' , '기본요건 미충족'
														,'B' ,'세부요건 미충족'
														,'C' , '통합조직 탈락'
														,'EX1' , '-'
														,'EX2' , '-'
														,''
			)AS ICPT_RSN_NM
			,ERR.ICPT_RSN_DTL_CD
			,DECODE(ERR.ICPT_RSN_DTL_CD , 'A1' , '농업경영체 미등록'
																,'A2' ,'출자자본금 1억원 미달'
																,'A3' ,'설립 후 운영실적 1년 미만'
																,'A4' ,'농업인 주주 5명 미만'
																,'A5' ,'농업인 주주 지분 50% 미만'
																,'A6' ,'원예농산물 취급액 50% 미만'
																,'A7' ,'조공설립계획 미수립'
																,'A8' ,'현장실사 미참여'
																,'B1' ,'품목 부적합(농협조직)'
																,'B2' ,'품목 부적합(농업법인, 협동조합)'
																,'C1' , '통합조직 탈락(농협조직)'
																,'C2' , '통합조직 탈락(농업법인, 협동조합)'
																,'-' , '-'
																,''
			)AS ICPT_RSN_DTL_NM

		/*
			,ERR.MNGR_STBLT_YN
			,ERR.MNGR_ICPT_RSN_CD
			,DECODE(ERR.MNGR_ICPT_RSN_CD , 'A' , '기본요건 미충족'
																	,'B' ,'세부요건 미충족'
																	,'C' , '통합조직 탈락'
																	,'EX1' , '-'
																	,'EX2' , '-'
																	,''
			)AS MNGR_ICPT_RSN_NM
			,ERR.MNGR_ICPT_RSN_DTL_CD
			,DECODE(ERR.MNGR_ICPT_RSN_DTL_CD , 'A1' , '농업경영체 미등록'
																			,'A2' ,'출자자본금 1억원 미달'
																			,'A3' ,'설립 후 운영실적 1년 미만'
																			,'A4' ,'농업인 주주 5명 미만'
																			,'A5' ,'농업인 주주 지분 50% 미만'
																			,'A6' ,'원예농산물 취급액 50% 미만'
																			,'A7' ,'조공설립계획 미수립'
																			,'A8' ,'현장실사 미참여'
																			,'B1' ,'품목 부적합(농협조직)'
																			,'B2' ,'품목 부적합(농업법인, 협동조합)'
																			,'C1' , '통합조직 탈락(농협조직)'
																			,'C2' , '통합조직 탈락(농업법인, 협동조합)'
																			,'-' , '-'
																			,''
			)AS MNGR_ICPT_RSN_DTL_NM
			,DECODE(ERR.MNGR_ICPT_RSN_CD , 'A' , '기존자금 회수'
																	,'B' ,'최고금리'
																	,'C' , '최고금리'
																	,'EX1' , '최고금리'
																	,'EX2' , '기존자금 회수'
																	,''
			)AS MNGR_PNLTY
			,ERR.MNGR_ITR_RT
			,ERR.ITR_RT
		*/

			,DECODE(ERR.ICPT_RSN_CD , 'A' , '기존자금 회수'
														,'B' ,'최고금리'
														,'C' , '최고금리'
														,'EX1' , '최고금리'
														,'EX2' , '기존자금 회수'
														,''
			)AS PNLTY
			,DECODE(ERR.STBLT_YN , 'Y' , URR.ITR_RT , ERR.ITR_RT
			)AS ITR_RT

			,NVL((SELECT ISO_FUND_APLY_AMT
							FROM TB_EV_APLY_MNG
							WHERE 1=1
							  AND YR = ERR.YR
							  AND BRNO = ERR.BRNO
							  AND UO_BRNO = ERR.UO_BRNO
							),0
			) AS ISO_FUND_APLY_AMT

			,( NVL(ISOPST.SPMT_AMT_TOT,0) + NVL(ISOAPS.TOT_DDC_AMT , 0)
			) AS TOT_TRMT_PRFMNC_AMT
			,NVL(ISOAPS.TOT_DDC_AMT , 0) AS TOT_DDC_AMT

			,NVL(ISOPST.SPMT_AMT_TOT,0) AS TOT_AJMT_AMT

			,NVL(ISOPST.UO_SPMT_AMT_TOT,0) AS ETC_TOT_SPMT_PRFMNC_AMT

			,NVL(ISOPST.UO_SPMT_AMT_TOT,0) AS UO_SPMT_AMT_TOT

			,ROUND(
				(NVL(ISOPST.UO_SPMT_AMT_TOT,0) + NVL(ISOAPS.ETC_TOT_SPMT_PRFMNC_AMT,0))
				/ NULLIF(  NVL(ISOPST.SPMT_AMT_TOT,0) + NVL(ISOAPS.ETC_TOT_TRMT_PRFMNC_AMT,0) ,0)
				* 100
				, 2
			) AS SPMT_AMT_RT
		FROM
			(SELECT
					YR
					,BRNO
					,UO_BRNO
					,APO_SE
					,STBLT_ITEM_LIST
					,(CASE
							WHEN MNGR_STBLT_YN = 'Y' THEN MNGR_ICPT_RSN_CD
							WHEN MNGR_ICPT_RSN_CD IS NOT NULL THEN MNGR_ICPT_RSN_CD
							ELSE ICPT_RSN_CD
							END
					) AS ICPT_RSN_CD

					,(CASE
							WHEN MNGR_STBLT_YN = 'Y' THEN MNGR_ICPT_RSN_DTL_CD
							WHEN MNGR_ICPT_RSN_DTL_CD IS NOT NULL THEN MNGR_ICPT_RSN_DTL_CD
							ELSE ICPT_RSN_DTL_CD
							END
					) AS ICPT_RSN_DTL_CD

					,(CASE WHEN MNGR_STBLT_YN IS NOT NULL THEN MNGR_STBLT_YN
							ELSE STBLT_YN
							END
					) AS STBLT_YN

					,(CASE WHEN MNGR_ITR_RT IS NOT NULL THEN MNGR_ITR_RT
							ELSE ITR_RT
							END
					) AS ITR_RT
				FROM USRAM.TB_EV_REG_RSLT
				WHERE 1=1
				  AND APO_SE = '2'
				  AND YR = #{yr}
				  AND BRNO NOT IN (SELECT BRNO
				  					FROM TB_COM_USER
				  					WHERE 1=1
				  					  AND USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'
				  					  					, 'at21','at22','at23','at24','at25','at26','at27','at61'))
			) ERR
			,(SELECT * FROM USRAM.TB_EV_APLY_MNG WHERE APO_SE = '2' AND YR = #{yr}) EAM
			,(SELECT * FROM USRAM.TB_EV_APO WHERE APO_SE = '2' ) ISOEA
			,(SELECT * FROM USRAM.TB_EV_APO WHERE APO_SE = '1' ) UOEA
			,(SELECT
					YR
					,BRNO
					,STBLT_ITEM_LIST
					,(CASE
							WHEN MNGR_STBLT_YN = 'Y' THEN MNGR_ICPT_RSN_CD
							WHEN MNGR_ICPT_RSN_CD IS NOT NULL THEN MNGR_ICPT_RSN_CD
							ELSE ICPT_RSN_CD
							END
					) AS ICPT_RSN_CD

					,(CASE
							WHEN MNGR_STBLT_YN = 'Y' THEN MNGR_ICPT_RSN_DTL_CD
							WHEN MNGR_ICPT_RSN_DTL_CD IS NOT NULL THEN MNGR_ICPT_RSN_DTL_CD
							ELSE ICPT_RSN_DTL_CD
							END
					) AS ICPT_RSN_DTL_CD

					,(CASE WHEN MNGR_STBLT_YN IS NOT NULL THEN MNGR_STBLT_YN
							ELSE STBLT_YN
							END
					) AS STBLT_YN

					,(CASE WHEN MNGR_ITR_RT IS NOT NULL THEN MNGR_ITR_RT
							ELSE ITR_RT
							END
					) AS ITR_RT
				FROM USRAM.TB_EV_REG_RSLT
				WHERE 1=1
				  AND APO_SE = '1'
				  AND YR = #{yr}
			) URR
			,(SELECT
					YR
					,BRNO
					,SUM(NVL(UO_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT
					,SUM( NVL(UO_SPMT_AMT,0) + NVL(UO_OTHER_SPMT_AMT,0) ) AS SPMT_AMT_TOT
				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
				WHERE APO_SE = '2'
				  AND TYPE_SE_NO IN ('5','7')
				  AND YR = #{yr}
				  AND STBLT_YN = 'Y'
				  AND 'Y' = (SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN) FROM TB_EV_REG_RSLT ERR WHERE YR = PST.YR AND BRNO = PST.BRNO AND UO_BRNO = PST.UO_BRNO)
				GROUP BY YR, BRNO
			) ISOPST
			,(SELECT
					YR
					,BRNO
					,SUM(DECODE(STTG_UPBR_ITEM_SE, '3' , NVL(TOT_SPMT_PRFMNC_AMT , 0) , 0)) AS ETC_TOT_SPMT_PRFMNC_AMT
					,SUM(DECODE(STTG_UPBR_ITEM_SE, '3' , NVL(TOT_TRMT_PRFMNC_AMT , 0) , 0)) AS ETC_TOT_TRMT_PRFMNC_AMT
					,SUM(DECODE(APS.PRCHS_SLS_SE
											, '2' , NVL(DECODE(APS.STTG_UPBR_ITEM_SE
																			, '1' , NVL(APS.DDC_EXPRT_AMT,0)
																					 + NVL(APS.DDC_AMT,0)
																					 + NVL(APS.DDC_ARMY_DLVGDS_AMT,0)
																					 + NVL(APS.DDC_MLSR_AMT,0)
																			, '2' , NVL(APS.DDC_EXPRT_AMT,0)
																					 + NVL(APS.DDC_AMT,0)
																					 + NVL(APS.DDC_ARMY_DLVGDS_AMT,0)
																					 + NVL(APS.DDC_MLSR_AMT,0)
																			, 0)
															,0)
											, 0)
					) AS TOT_DDC_AMT
				FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
				WHERE 1=1
				  AND APO_SE = '2'
				  AND YR = #{yr}
				  AND 'Y' = (SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN) FROM TB_EV_REG_RSLT ERR WHERE YR = APS.YR AND BRNO = APS.BRNO AND UO_BRNO = APS.UO_BRNO)
				GROUP BY YR, BRNO
				) ISOAPS
		WHERE 1=1
		  AND ERR.BRNO = EAM.BRNO(+)
		  AND ERR.BRNO = ISOEA.BRNO(+)
		  AND ERR.UO_BRNO = URR.BRNO(+)
		  AND ERR.UO_BRNO = UOEA.BRNO(+)
		  AND ERR.BRNO = ISOPST.BRNO(+)
		  AND ERR.BRNO = ISOAPS.BRNO(+)
	</select>
	<!-- 활성화자금 통합조직 로우데이터 -->
	<select id="selectFndsRawDataUoList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluFndsMngVO">
		SELECT
			EAM.YR
			,EA.CORP_SE_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = EA.CORP_SE_CD) AS CORP_SE_NM
			,EA.CORP_DTL_SE_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SHAP' AND CD_VL = EA.CORP_DTL_SE_CD) AS CORP_DTL_SE_NM
			,EA.CORP_NM
			,EA.BRNO
			,EA.APRV
			,DECODE(EA.APRV , '1' , '승인형' , '2' , '육성형' , '' ) AS APRV_NM

			,ERR.STBLT_ITEM_LIST
			,ERR.STBLT_YN
		/*
			,ERR.MNGR_STBLT_YN
		*/
			,ERR.ICPT_RSN_CD
			,DECODE(ERR.ICPT_RSN_CD , 'A' , '기본요건 미충족'
														,'B' ,'세부요건 미충족'
														,'C' , '통합조직 탈락'
														,'EX1' , '-'
														,'EX2' , '-'
														,''
			)AS ICPT_RSN_NM
		/*
			,ERR.MNGR_ICPT_RSN_CD
			,DECODE(ERR.MNGR_ICPT_RSN_CD , 'A' , '기본요건 미충족'
																	,'B' ,'세부요건 미충족'
																	,'C' , '통합조직 탈락'
																	,'EX1' , '-'
																	,'EX2' , '-'
																	,''
			)AS MNGR_ICPT_RSN_NM
		*/
			,ERR.ICPT_RSN_DTL_CD
			,DECODE(ERR.ICPT_RSN_DTL_CD , 'A1' , '농업경영체 미등록'
																,'A2' ,'출자자본금 1억원 미달'
																,'A3' ,'설립 후 운영실적 1년 미만'
																,'A4' ,'농업인 주주 5명 미만'
																,'A5' ,'농업인 주주 지분 50% 미만'
																,'A6' ,'원예농산물 취급액 50% 미만'
																,'A7' ,'조공설립계획 미수립'
																,'A8' ,'현장실사 미참여'
																,'B1' ,'품목 부적합(농협조직)'
																,'B2' ,'품목 부적합(농업법인, 협동조합)'
																,'C1' , '통합조직 탈락(농협조직)'
																,'C2' , '통합조직 탈락(농업법인, 협동조합)'
																,'-' , '-'
																,''
			)AS ICPT_RSN_DTL_NM
		/*
			,ERR.MNGR_ICPT_RSN_DTL_CD
			,DECODE(ERR.MNGR_ICPT_RSN_DTL_CD , 'A1' , '농업경영체 미등록'
																			,'A2' ,'출자자본금 1억원 미달'
																			,'A3' ,'설립 후 운영실적 1년 미만'
																			,'A4' ,'농업인 주주 5명 미만'
																			,'A5' ,'농업인 주주 지분 50% 미만'
																			,'A6' ,'원예농산물 취급액 50% 미만'
																			,'A7' ,'조공설립계획 미수립'
																			,'A8' ,'현장실사 미참여'
																			,'B1' ,'품목 부적합(농협조직)'
																			,'B2' ,'품목 부적합(농업법인, 협동조합)'
																			,'C1' , '통합조직 탈락(농협조직)'
																			,'C2' , '통합조직 탈락(농업법인, 협동조합)'
																			,'-' , '-'
																			,''
			)AS MNGR_ICPT_RSN_DTL_NM
		*/
			,DECODE(ERR.ICPT_RSN_CD , 'A' , '기존자금 회수'
														,'B' ,'최고금리'
														,'C' , '최고금리'
														,'EX1' , '최고금리'
														,'EX2' , '기존자금 회수'
														,''
			)AS PNLTY
		/*
			,DECODE(ERR.MNGR_ICPT_RSN_CD , 'A' , '기존자금 회수'
																	,'B' ,'최고금리'
																	,'C' , '최고금리'
																	,'EX1' , '최고금리'
																	,'EX2' , '기존자금 회수'
																	,''
			)AS MNGR_PNLTY
			,ERR.MNGR_ITR_RT
		*/
			,ERR.ITR_RT

			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CMPTNC_INST' AND CD_VL = EA.CMPTN_INST) AS CMPTN_INST
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CMPTN_INST_CTPV' AND CD_VL = EA.CTPV) AS CTPV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CMPTN_INST_SIGUN' AND CD_VL = EA.SGG) AS SGG
			,EA.ZIP
			,DECODE(EA.ROAD_NM_DTL_ADDR , '' , '[지번]' || EA.LOTNO_ADDR || ' ' || EA.LOTNO_DTL_ADDR , '[도로명]'|| EA.ROAD_NM_ADDR || ' ' || EA.ROAD_NM_DTL_ADDR ) AS ADDR
			,EA.INVST_NOPE
			,EA.INVST_EXPND_FRMER_NOPE
			,EA.INVST_AMT
			,EA.FRMER_INVST_AMT
			,EA.CORP_FNDN_DAY

			,EA.RPRSV_FLNM
			,EA.RPRSV_TELNO
			,EA.RPRSV_MOBLNO
			,EA.RPRSV_EML

			,EA.PIC_POSITION
			,EA.PIC_FLNM
			,EA.PIC_TELNO
			,EA.PIC_MOBLNO
			,EA.PIC_EML

			,EAM.PRUO_FUND_APLY_AMT
			,(SELECT SUM(NVL(ISO_FUND_APLY_AMT,0))
				FROM TB_EV_APLY_MNG
				WHERE 1=1
				  AND APO_SE = '2'
				  AND YR = EAM.YR
				  AND UO_BRNO = EAM.BRNO
				  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = EAM.BRNO)
			) AS ISO_FUND_APLY_AMT
			,(NVL(EAM.PRUO_FUND_APLY_AMT , 0 )
			+ NVL((SELECT SUM(NVL(ISO_FUND_APLY_AMT,0))
				FROM TB_EV_APLY_MNG
				WHERE 1=1
				  AND APO_SE = '2'
				  AND YR = EAM.YR
				  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = EAM.BRNO)
				  AND UO_BRNO = EAM.BRNO ) ,0)
			) AS FUND_APLY_AMT_TOT
			,NVL((SELECT SUM(ISO_FUND_APLY_AMT)
								FROM TB_EV_APLY_MNG TEAM
								WHERE 1=1
								  AND YR = EAM.YR
								  AND UO_BRNO = EAM.BRNO
								  AND APO_SE = '2'
								  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = EAM.BRNO)
								  AND BRNO = (SELECT BRNO
												FROM TB_EV_REG_RSLT TERR
												WHERE 1=1
												  AND APO_SE = '2'
												  AND YR = TEAM.YR
												  AND BRNO = TEAM.BRNO
												  AND UO_BRNO = EAM.BRNO
												  AND 'Y' = (CASE WHEN TERR.MNGR_STBLT_YN = 'Y' THEN 'Y'
																	WHEN TERR.MNGR_STBLT_YN = 'N' THEN 'N'
																	ELSE TERR.STBLT_YN
																	END)
												)
								),0
			) AS ISO_FUND_APLY_AMT_STBLT_TOT
			,(NVL(EAM.PRUO_FUND_APLY_AMT,0)
						+ NVL((SELECT SUM(ISO_FUND_APLY_AMT)
								FROM TB_EV_APLY_MNG TEAM
								WHERE 1=1
								  AND YR = EAM.YR
								  AND UO_BRNO = EAM.BRNO
								  AND APO_SE = '2'
								  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = EAM.BRNO)
								  AND BRNO = (SELECT BRNO
												FROM TB_EV_REG_RSLT TERR
												WHERE 1=1
												  AND APO_SE = '2'
												  AND YR = TEAM.YR
												  AND BRNO = TEAM.BRNO
												  AND UO_BRNO = EAM.BRNO
												  AND 'Y' = (CASE WHEN TERR.MNGR_STBLT_YN = 'Y' THEN 'Y'
																	WHEN TERR.MNGR_STBLT_YN = 'N' THEN 'N'
																	ELSE TERR.STBLT_YN
																	END)
												)
								),0)
			) AS FUND_APLY_AMT_STBLT_TOT

			,(NVL(UOAPS.PRCHS_TRST_AMT_TOT, 0) + NVL(UOAPS.ETC_PRCHS_TRST_AMT_TOT, 0)
			) AS PRCHS_TRST_AMT_TOT
			,(NVL(UOAPS.PRCHS_EMSPAP_AMT_TOT, 0) + NVL(UOAPS.ETC_PRCHS_EMSPAP_AMT_TOT, 0)
			) AS PRCHS_EMSPAP_AMT_TOT

			,(NVL(UOAPS.ETC_PRCHS_TRST_AMT_TOT, 0) + NVL(UOAPS.ETC_PRCHS_EMSPAP_AMT_TOT, 0)
				+ NVL(UOPST.SLS_CNSGN_SLS_AMT,0)
			) AS PRCHS_AMT_TOT

			,(NVL(UOAPS.SLS_TRST_AMT_TOT, 0) + NVL(UOAPS.ETC_SLS_TRST_AMT_TOT, 0)
			) AS SLS_TRST_AMT_TOT
			,(NVL(UOAPS.SLS_EMSPAP_AMT_TOT, 0) + NVL(UOAPS.ETC_SLS_EMSPAP_AMT_TOT, 0)
			) AS SLS_EMSPAP_AMT_TOT

			,(NVL(UOAPS.ETC_SLS_TRST_AMT_TOT, 0) + NVL(UOAPS.ETC_SLS_EMSPAP_AMT_TOT, 0)
				+ NVL(UOPST.SLS_CNSGN_SLS_AMT_TOT,0)
			) AS SLS_AMT_TOT

			,NVL(UOYPST.SLS_CNSGN_SLS_AMT, 0
			) AS SLS_CNSGN_SLS_AMT

			,NVL(UOYPST.SLS_CNSGN_SLS_AMT_TOT, 0
			) AS SLS_CNSGN_SLS_AMT_TOT
			,SR.SLS_TOT_AMT_SCR

			,ROUND( NVL(UOYPST.SLS_CNSGN_SLS_AMT, 0) / NULLIF( NVL(UOYPST.SLS_CNSGN_SLS_AMT_TOT,0) ,0) * 100 , 2
			) AS SLS_CNSGN_SLS_AMT_RT
			,SR.SLS_TOT_RT_SCR

			,SR.TOT_SCR
			,(NVL(SR.ONLN_WHLSL_MRKT_SCR,0) + NVL(SR.RTL_EDNST_SCR,0)
			) AS ADD_SCR
			,SR.DDC_SCR
			,SR.LAST_SCR
		FROM
			(SELECT
					YR
					,BRNO
					,STBLT_ITEM_LIST
					,(CASE
							WHEN MNGR_STBLT_YN = 'Y' THEN MNGR_ICPT_RSN_CD
							WHEN MNGR_ICPT_RSN_CD IS NOT NULL THEN MNGR_ICPT_RSN_CD
							ELSE ICPT_RSN_CD
							END
					) AS ICPT_RSN_CD

					,(CASE
							WHEN MNGR_STBLT_YN = 'Y' THEN MNGR_ICPT_RSN_DTL_CD
							WHEN MNGR_ICPT_RSN_DTL_CD IS NOT NULL THEN MNGR_ICPT_RSN_DTL_CD
							ELSE ICPT_RSN_DTL_CD
							END
					) AS ICPT_RSN_DTL_CD

					,(CASE WHEN MNGR_STBLT_YN IS NOT NULL THEN MNGR_STBLT_YN
							ELSE STBLT_YN
							END
					) AS STBLT_YN

					,(CASE WHEN MNGR_ITR_RT IS NOT NULL THEN MNGR_ITR_RT
							ELSE ITR_RT
							END
					) AS ITR_RT
				FROM USRAM.TB_EV_REG_RSLT
				WHERE 1=1
				  AND APO_SE = '1'
				  AND YR = #{yr}
				  AND BRNO != '4168220755'/*구례농협 통합조직이였다가 출자출하조직으로 변경되 일시적 예외처리*/
				  AND BRNO NOT IN (SELECT BRNO
				  					FROM TB_COM_USER
				  					WHERE 1=1
				  					  AND USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51'
				  					  					, 'at21','at22','at23','at24','at25','at26','at27','at61'))
			) ERR
			,(SELECT * FROM USRAM.TB_EV_APLY_MNG WHERE APO_SE = '1' AND YR = #{yr}) EAM
			,(SELECT * FROM USRAM.TB_EV_APO WHERE APO_SE = '1' ) EA
			,(SELECT * FROM USRAM.TB_EV_SCR_RSLT WHERE APO_SE = '1' AND YR = #{yr}) SR
			,(SELECT
					BRNO

					,NVL(SUM(
						DECODE(STTG_UPBR_ITEM_SE
							,'1' , DECODE(APS.PRCHS_SLS_SE
										,'1', NVL(APS.PRCHS_TRST_AMT,0)
										,0)
							,'2' , DECODE(APS.PRCHS_SLS_SE
										,'1', NVL(APS.PRCHS_TRST_AMT,0)
										,0)
							,0)
					),0) AS PRCHS_TRST_AMT_TOT
					,NVL(SUM(
						DECODE(STTG_UPBR_ITEM_SE
							,'1' , DECODE(APS.PRCHS_SLS_SE
										,'1', NVL(APS.PRCHS_EMSPAP_AMT,0)
										,0)
							,'2' , DECODE(APS.PRCHS_SLS_SE
										,'1', NVL(APS.PRCHS_EMSPAP_AMT,0)
										,0)
							,0)
					),0) AS PRCHS_EMSPAP_AMT_TOT

					,NVL(SUM(
						DECODE(STTG_UPBR_ITEM_SE
							,'1' , DECODE(APS.PRCHS_SLS_SE
										,'2', NVL(APS.SLS_TRST_AMT,0)
										,0)
							,'2' , DECODE(APS.PRCHS_SLS_SE
										,'2', NVL(APS.SLS_TRST_AMT,0)
										,0)
							,0)
					),0) AS SLS_TRST_AMT_TOT
					,NVL(SUM(
						DECODE(STTG_UPBR_ITEM_SE
							,'1' , DECODE(APS.PRCHS_SLS_SE
										,'2', NVL(APS.SLS_EMSPAP_AMT,0)
										,0)
							,'2' , DECODE(APS.PRCHS_SLS_SE
										,'2', NVL(APS.SLS_EMSPAP_AMT,0)
										,0)
							,0)
					),0) AS SLS_EMSPAP_AMT_TOT

					,NVL(SUM(
						DECODE(STTG_UPBR_ITEM_SE
							,'3' , DECODE(APS.PRCHS_SLS_SE
										,'1', NVL(APS.PRCHS_TRST_AMT,0)
										,0)
							,0)
					),0) AS ETC_PRCHS_TRST_AMT_TOT
					,NVL(SUM(
						DECODE(STTG_UPBR_ITEM_SE
							,'3' , DECODE(APS.PRCHS_SLS_SE
										,'1', NVL(APS.PRCHS_EMSPAP_AMT,0)
										,0)
							,0)
					),0) AS ETC_PRCHS_EMSPAP_AMT_TOT

					,NVL(SUM(
						DECODE(STTG_UPBR_ITEM_SE
							,'3' , DECODE(APS.PRCHS_SLS_SE
										,'2', NVL(APS.SLS_TRST_AMT,0)
										,0)
							,0)
					),0) AS ETC_SLS_TRST_AMT_TOT
					,NVL(SUM(
						DECODE(STTG_UPBR_ITEM_SE
							,'3' , DECODE(APS.PRCHS_SLS_SE
										,'2', NVL(APS.SLS_EMSPAP_AMT,0)
										,0)
							,0)
					),0) AS ETC_SLS_EMSPAP_AMT_TOT
				FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
				WHERE 1=1
				  AND APO_SE = '1'
				  AND YR = #{yr}
				  AND APS.ITEM_CD = DECODE(STTG_UPBR_ITEM_SE, '3' , APS.ITEM_CD
				  										,(SELECT ITEM_CD
				  											FROM TB_EV_APO_YR_GPC_CD
				  											WHERE 1=1
				  											  AND BRNO = APS.BRNO
				  											  AND YR = APS.YR AND
				  											  ITEM_CD = APS.ITEM_CD
				  											)
				  							)
				  AND 'Y' = (SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN) FROM TB_EV_REG_RSLT ERR WHERE YR = APS.YR AND BRNO = APS.BRNO)
				GROUP BY BRNO
			) UOAPS
			,(SELECT
					BRNO
					,NVL(SUM(
								DECODE(PST.TYPE_SE_NO
								, '2' , NVL(PST.SLS_CNSGN_SLS_AMT , 0)
								, '6' , NVL(PST.SLS_CNSGN_SLS_AMT , 0)
								,0)
					),0) AS SLS_CNSGN_SLS_AMT
					,NVL(SUM(
						NVL(PST.SLS_CNSGN_SLS_AMT , 0)
					),0) AS SLS_CNSGN_SLS_AMT_TOT
				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
				WHERE 1=1
				  AND YR = #{yr}
				  AND APO_SE = '1'
				  AND STBLT_YN = 'Y'
				  AND PST.ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = PST.BRNO AND YR = PST.YR AND ITEM_CD = PST.ITEM_CD)
				  AND TYPE_SE_NO IN ('2','3','6','7')
				  AND 'Y' = (SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN) FROM TB_EV_REG_RSLT ERR WHERE YR = PST.YR AND BRNO = PST.BRNO)
				GROUP BY BRNO
			) UOPST
			,(SELECT
					BRNO
					,NVL(SUM(
								DECODE(PST.TYPE_SE_NO
								, '2' , NVL(PST.SLS_CNSGN_SLS_AMT , 0)
								, '6' , NVL(PST.SLS_CNSGN_SLS_AMT , 0)
								,0)
					),0) AS SLS_CNSGN_SLS_AMT
					,NVL(SUM(
						NVL(PST.SLS_CNSGN_SLS_AMT , 0)
					),0) AS SLS_CNSGN_SLS_AMT_TOT
				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
				WHERE 1=1
				  AND YR = #{yr}
				  AND APO_SE = '1'
				  AND STBLT_YN = 'Y'
				  AND PST.ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = PST.BRNO AND YR = PST.YR AND ITEM_CD = PST.ITEM_CD)
				  AND '1' = (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = PST.BRNO AND YR = PST.YR AND ITEM_CD = PST.ITEM_CD)
				  AND 'Y' = (SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN) FROM TB_EV_REG_RSLT ERR WHERE YR = PST.YR AND BRNO = PST.BRNO)
				  AND TYPE_SE_NO IN ('2','3','6','7')
				GROUP BY BRNO
			) UOYPST
		WHERE 1=1
		  AND ERR.BRNO = EAM.BRNO(+)
		  AND ERR.BRNO = EA.BRNO(+)
		  AND ERR.BRNO = SR.BRNO(+)
		  AND ERR.BRNO = UOAPS.BRNO(+)
		  AND ERR.BRNO = UOPST.BRNO(+)
		  AND ERR.BRNO = UOYPST.BRNO(+)
	</select>
</mapper>