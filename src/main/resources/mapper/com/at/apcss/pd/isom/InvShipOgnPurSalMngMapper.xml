<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : BbsMapper.xml                                    				-->
<!-- DESC : 게시판 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.bbs.mapper.BbsMngMapper.selectBbs				-->
	<!-- DESC : 게시판 테이블 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMng" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		<![CDATA[
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMng */
				  CM.YR
				, CM.APO_CD
				, CM.APO_SE
				, CM.BRNO
				, CM.CRNO
				, CM.CTGRY_CD
				, CM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = CM.ITEM_CD) AS ITEM_NM

				, CM.PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, CM.PRCHS_SORT_TRST_VLM
				, CM.PRCHS_SORT_TRST_AMT
				, CM.PRCHS_SPMT_TRST_VLM
				, CM.PRCHS_SPMT_TRST_AMT
				, CM.PRCHS_SMPL_TRST_VLM
				, CM.PRCHS_SMPL_TRST_AMT
				, CM.PRCHS_SORT_EMSPAP_VLM
				, CM.PRCHS_SORT_EMSPAP_AMT
				, CM.PRCHS_SMPL_EMSPAP_VLM
				, CM.PRCHS_SMPL_EMSPAP_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT


				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				, CM.RMRK

				, CM.DEL_YN		AS DEL_YN
				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			  FROM TB_EV_UO_ISO_ALL_PRCHS_SLS CM
			 WHERE 1=1

		]]>
			<if test='apoCd != null and apoCd != ""'>
				AND CM.APO_CD = #{apoCd}
			</if>
			<if test='apoSe != null and apoSe != ""'>
				AND CM.APO_SE = #{apoSe}
			</if>
		ORDER BY CM.ITEM_CD DESC
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.bbs.mapper.BbsMngMapper.selectBbsList			-->
	<!-- DESC : 게시판 테이블 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMngList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngList */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '1' AS PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, NVL(TOTA.PRCHS_TOT_AMT,0) AS PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, NVL(TOTB.PRCHS_TOT_AMT,0) AS PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, NVL( NVL(TOTA.PRCHS_TOT_AMT,0) + NVL(TOTB.PRCHS_TOT_AMT,0) + NVL(TOTC.PRCHS_TOT_AMT,0) , 0) AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, NVL(TOTC.PRCHS_TOT_AMT,0) AS ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, '' AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, CM.TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			FROM
				(SELECT
						YR
						,BRNO
						,UO_BRNO
						,ITEM_CD
						/*중복아이템은 없는것으로 가정*/
						,(SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS CTGRY_CD
						,(SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS STTG_UPBR_ITEM_SE
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
					WHERE 1=1
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  AND ITEM_CD IN (SELECT ITEM_CD
					  					FROM TB_EV_APO_YR_GPC_CD
					  					WHERE 1=1
					  					<if test='yr != null and yr != ""'>
					  					  AND YR = #{yr}
										</if>
					  					  AND BRNO IN  (SELECT UO_BRNO
					  					  					FROM TB_EV_APO_UO_CD
					  					  					WHERE 1=1
					  					  					<if test='brno != null and brno != ""'>
					  										  AND ISO_BRNO = #{brno}
															</if>
					  					  				)
					  					)
					GROUP BY YR , BRNO ,UO_BRNO,ITEM_CD
				)ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '1'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
			  	(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TRMT_TYPE IN ('1','2')
			  		  AND TYPE_SE_NO = '5'
			  		  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
			  		  							FROM TB_EV_FRMHS_APO
			  		  							WHERE 1=1
			  		  							  AND APO_SE = '2'
			  		  							  AND STBLT_YN = 'Y'
			  		  							  AND NVL(EXCL_YN,'N') != 'Y'
			  		  							<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTA ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD ,  SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTB ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TYPE_SE_NO = '7'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTC
			WHERE 1=1
			  AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			  AND ITEM.BRNO = CM.BRNO(+)
			  AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			  AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			  AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			  AND ITEM.BRNO = TOTA.BRNO(+)
			  AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			  AND ITEM.BRNO = TOTB.BRNO(+)
			  AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			  AND ITEM.BRNO = TOTC.BRNO(+)
			  AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			UNION ALL

			SELECT
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '2' AS PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, '' AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, CM.ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, NVL(TOTB.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, NVL(TOTA.UO_SPMT_AMT ,0) AS SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, NVL(TOTC.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, NVL((TOTA.UO_SPMT_AMT + TOTB.UO_SPMT_AMT + TOTC.UO_SPMT_AMT) ,0) AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, NVL(TOTD.UO_SPMT_AMT_TOT ,0) AS AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, NVL(TOTD.UO_SPMT_AMT ,0) AS TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			FROM
				(SELECT
						YR
						,BRNO
						,UO_BRNO
						,ITEM_CD
						/*중복아이템은 없는것으로 가정*/
						,(SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS CTGRY_CD
						,(SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS STTG_UPBR_ITEM_SE
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
					WHERE 1=1
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  AND ITEM_CD IN (SELECT ITEM_CD
					  					FROM TB_EV_APO_YR_GPC_CD
					  					WHERE 1=1
					  					<if test='yr != null and yr != ""'>
					  					  AND YR = #{yr}
										</if>
					  					  AND BRNO IN  (SELECT UO_BRNO
					  					  					FROM TB_EV_APO_UO_CD
					  					  					WHERE 1=1
					  					  					<if test='brno != null and brno != ""'>
					  										  AND ISO_BRNO = #{brno}
															</if>
					  					  				)
					  					)
					GROUP BY YR , BRNO ,UO_BRNO , ITEM_CD
				)ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '1'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTA ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '2'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
			  		  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTB ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTC ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD
						, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
						, SUM( NVL( UO_SPMT_AMT , 0 ) + NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT_TOT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO IN ('1','3','5','7')
					  AND (
					  		(PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
												)
								)
							OR
								(PRDCR_OGNZ_SN = '0')
							)

					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTD
			WHERE 1=1
			  AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			  AND ITEM.BRNO = CM.BRNO(+)
			  AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			  AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			  AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			  AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			  AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			  AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTD.ITEM_CD(+)
			  AND ITEM.UO_BRNO = TOTD.UO_BRNO(+)

			UNION ALL

			SELECT
				CM.YR
				, CM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = CM.ITEM_CD) AS ITEM_NM
				, CM.CTGRY_CD
				, CM.STTG_UPBR_ITEM_SE
				, '기타' AS STTG_UPBR_ITEM_NM


				, CM.APO_CD
				, CM.APO_SE
				, CM.BRNO
				, CM.UO_BRNO
				, '' AS CORP_NM
				, CM.CRNO

				, CM.PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, '' AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, CM.ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, '' AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, CM.TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, CM.DEL_YN		AS DEL_YN
				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			FROM TB_EV_UO_ISO_ALL_PRCHS_SLS CM
			WHERE 1=1
			  AND STTG_UPBR_ITEM_SE = '3'
			  AND APO_SE = '2'
			<if test='brno != null and brno != ""'>
			  AND BRNO = #{brno}
			</if>
			<if test='yr != null and yr != ""'>
			  AND YR = #{yr}
			</if>
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 총매입매출 매입 리스트 -->
	<select id="selectInvShipOgnPurSalMngPrchsList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngPrchsList */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.CLSF_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '1' AS PRCHS_SLS_SE
				/*수탁*/
				, CM.PRCHS_SORT_TRST_VLM
				, CM.PRCHS_SORT_TRST_AMT
				, CM.PRCHS_SPMT_TRST_VLM
				, CM.PRCHS_SPMT_TRST_AMT
				, CM.PRCHS_SMPL_TRST_VLM
				, CM.PRCHS_SMPL_TRST_AMT
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				/*매취*/
				, CM.PRCHS_SORT_EMSPAP_VLM
				, CM.PRCHS_SORT_EMSPAP_AMT
				, CM.PRCHS_SMPL_EMSPAP_VLM
				, CM.PRCHS_SMPL_EMSPAP_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, NVL( NVL(TOTA.PRCHS_TOT_AMT,0) + NVL(TOTB.PRCHS_TOT_AMT,0) + NVL(TOTC.PRCHS_TOT_AMT,0) , 0) AS PRCHS_TOT_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

			FROM
				(SELECT
						YGC.YR
						,YGC.BRNO
						,(SELECT UO_BRNO FROM TB_EV_APLY_MNG WHERE APO_SE = '2' AND BRNO = YGC.BRNO AND YR = YGC.YR) AS UO_BRNO
						,YGC.ITEM_CD
						,YGC.CTGRY_CD
						,YGC.CLSF_CD
						,YGC.STTG_UPBR_ITEM_SE
					FROM TB_EV_APO_YR_GPC_CD YGC
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '1'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE IN ('1','2')
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTA ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD ,  SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTB ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO = '7'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTC
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO 	= CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTA.BRNO(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTB.BRNO(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTC.BRNO(+)
			   AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 총매입매출 매출 리스트 -->
	<select id="selectInvShipOgnPurSalMngSlsList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.CLSF_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE_1' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '2' AS PRCHS_SLS_SE

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, NVL(TOTB.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, NVL(TOTA.UO_SPMT_AMT ,0) AS SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, NVL(TOTC.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, NVL((TOTA.UO_SPMT_AMT + TOTB.UO_SPMT_AMT + TOTC.UO_SPMT_AMT) ,0) AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, NVL(TOTD.UO_SPMT_AMT_TOT ,0) AS AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, NVL(TOTD.UO_SPMT_AMT ,0) AS TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

			FROM
				(SELECT
						YGC.YR
						,YGC.BRNO
						,(SELECT UO_BRNO FROM TB_EV_APLY_MNG WHERE APO_SE = '2' AND BRNO = YGC.BRNO AND YR = YGC.YR) AS UO_BRNO
						,YGC.ITEM_CD
						,YGC.CTGRY_CD
						,YGC.CLSF_CD
						,YGC.STTG_UPBR_ITEM_SE
					FROM TB_EV_APO_YR_GPC_CD YGC
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '1'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTA ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '2'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTB ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTC ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD
						, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
						, SUM( NVL( UO_SPMT_AMT , 0 ) + NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT_TOT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO IN ('1','3','5','7')
					  AND (
							(PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
												)
								)
							OR
								(PRDCR_OGNZ_SN = '0')
							)

					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTD
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO = CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTD.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTD.UO_BRNO(+)
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 매입 등록 -->
	<insert id="insertInvShipOgnPurSalMng01" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		MERGE INTO TB_EV_UO_ISO_ALL_PRCHS_SLS CLT  /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.insertInvShipOgnPurSalMng01 */
		USING DUAL
			ON (
					CLT.BRNO   				= #{brno}
				<if test='uoBrno != null and uoBrno != ""'>
				AND CLT.UO_BRNO	 			= #{uoBrno}
				</if>
				<if test='uoBrno == null or uoBrno == ""'>
				AND CLT.UO_BRNO	 			= '0'
				</if>
				AND CLT.ITEM_CD	 			= #{itemCd}
				AND CLT.STTG_UPBR_ITEM_SE	= #{sttgUpbrItemSe}
				AND CLT.YR	 				= #{yr}
				AND CLT.PRCHS_SLS_SE		= '1'
				)
		WHEN MATCHED THEN
				 UPDATE
					   SET
						PRCHS_TRST_VLM			= #{prchsTrstVlm}
						, PRCHS_TRST_AMT		= #{prchsTrstAmt}
						, PRCHS_EMSPAP_VLM		= #{prchsEmspapVlm}
						, PRCHS_EMSPAP_AMT		= #{prchsEmspapAmt}
						, ETC_VLM				= #{etcVlm}
						, ETC_AMT				= #{etcAmt}

						, PRCHS_SORT_TRST_VLM	= #{prchsSortTrstVlm}
						, PRCHS_SORT_TRST_AMT	= #{prchsSortTrstAmt}
						, PRCHS_SPMT_TRST_VLM	= #{prchsSpmtTrstVlm}
						, PRCHS_SPMT_TRST_AMT	= #{prchsSpmtTrstAmt}
						, PRCHS_SMPL_TRST_VLM	= #{prchsSmplTrstVlm}
						, PRCHS_SMPL_TRST_AMT	= #{prchsSmplTrstAmt}

						, PRCHS_SORT_EMSPAP_VLM	= #{prchsSortEmspapVlm}
						, PRCHS_SORT_EMSPAP_AMT	= #{prchsSortEmspapAmt}
						, PRCHS_SMPL_EMSPAP_VLM	= #{prchsSmplEmspapVlm}
						, PRCHS_SMPL_EMSPAP_AMT	= #{prchsSmplEmspapAmt}

						, CTGRY_CD				= #{ctgryCd}
						, CLSF_CD				= #{clsfCd}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

		WHEN NOT MATCHED THEN
			 INSERT
					(
						APO_CD
						, APO_SE
						, BRNO
						, UO_BRNO
						, CRNO
						, YR

						, CTGRY_CD
						, CLSF_CD
						, ITEM_CD
						, STTG_UPBR_ITEM_SE
						, PRCHS_SLS_SE

						, PRCHS_TRST_VLM
						, PRCHS_TRST_AMT
						, PRCHS_EMSPAP_VLM
						, PRCHS_EMSPAP_AMT
						, ETC_VLM
						, ETC_AMT

						, PRCHS_SORT_TRST_VL
						, PRCHS_SORT_TRST_AM
						, PRCHS_SPMT_TRST_VL
						, PRCHS_SPMT_TRST_AM
						, PRCHS_SMPL_TRST_VL
						, PRCHS_SMPL_TRST_AM

						, PRCHS_SORT_EMSPAP_VLM
						, PRCHS_SORT_EMSPAP_AMT
						, PRCHS_SMPL_EMSPAP_VLM
						, PRCHS_SMPL_EMSPAP_AMT

						, RMRK

						, SYS_FRST_INPT_DT
						, SYS_FRST_INPT_USER_ID
						, SYS_FRST_INPT_PRGRM_ID
						, SYS_LAST_CHG_DT
						, SYS_LAST_CHG_USER_ID
						, SYS_LAST_CHG_PRGRM_ID
					)
				VALUES
					(
						  #{apoCd}
						, '2'
						, #{brno}
						<if test='uoBrno != null and uoBrno != ""'>
						, #{uoBrno}
						</if>
						<if test='uoBrno == null or uoBrno == ""'>
						, '0'
						</if>
						, (case when #{crno} is not null then #{crno}
									ELSE NVL( (SELECT CRNO FROM TB_EV_APO WHERE BRNO = #{brno}) , 'NULL')
									END)
						, #{yr}

						, #{ctgryCd}
						, #{clsfCd}
						, #{itemCd}
						, #{sttgUpbrItemSe}
						, '1'

						, #{prchsTrstVlm}
						, #{prchsTrstAmt}
						, #{prchsEmspapVlm}
						, #{prchsEmspapAmt}
						, #{etcVlm}
						, #{etcAmt}

						, #{prchsSortTrstVlm}
						, #{prchsSortTrstAmt}
						, #{prchsSpmtTrstVlm}
						, #{prchsSpmtTrstAmt}
						, #{prchsSmplTrstVlm}
						, #{prchsSmplTrstAmt}

						, #{prchsSortEmspapVlm}
						, #{prchsSortEmspapAmt}
						, #{prchsSmplEmspapVlm}
						, #{prchsSmplEmspapAmt}

						, #{rmrk}

						, SYSDATE
						, #{sysFrstInptUserId}
						, #{sysFrstInptPrgrmId}
						, SYSDATE
						, #{sysLastChgUserId}
						, #{sysLastChgPrgrmId}
					)
	</insert>

	<!-- 매출 등록 -->
	<insert id="insertInvShipOgnPurSalMng02" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		MERGE INTO TB_EV_UO_ISO_ALL_PRCHS_SLS CLT  /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.insertInvShipOgnPurSalMng02 */
		USING DUAL
			ON (
					CLT.BRNO   				= #{brno}
				<if test='uoBrno != null and uoBrno != ""'>
				AND CLT.UO_BRNO	 			= #{uoBrno}
				</if>
				<if test='uoBrno == null or uoBrno == ""'>
				AND CLT.UO_BRNO	 			= '0'
				</if>
				AND CLT.ITEM_CD	 			= #{itemCd}
				AND CLT.STTG_UPBR_ITEM_SE	= #{sttgUpbrItemSe}
				AND CLT.YR	 				= #{yr}
				AND CLT.PRCHS_SLS_SE		= '2'
				)
		WHEN MATCHED THEN
				 UPDATE
					SET
						DDC_EXPRT_VLM			= #{ddcExprtVlm}
						, DDC_EXPRT_AMT			= #{ddcExprtAmt}
						, DDC_VLM				= #{ddcVlm}
						, DDC_AMT				= #{ddcAmt}
						, DDC_ARMY_DLVGDS_VLM	= #{ddcArmyDlvgdsVlm}
						, DDC_ARMY_DLVGDS_AMT	= #{ddcArmyDlvgdsAmt}
						, DDC_MLSR_VLM			= #{ddcMlsrVlm}
						, DDC_MLSR_AMT			= #{ddcMlsrAmt}

						, AJMT_VLM				= #{ajmtVlm}
						, AJMT_AMT				= #{ajmtAmt}

						, TOT_TRMT_PRFMNC_VLM	= #{totTrmtPrfmncVlm}
						, TOT_TRMT_PRFMNC_AMT	= #{totTrmtPrfmncAmt}

						, CTGRY_CD				= #{ctgryCd}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

		WHEN NOT MATCHED THEN
			INSERT
					(
						APO_CD
						, APO_SE
						, BRNO
						, UO_BRNO
						, CRNO
						, YR

						, CTGRY_CD
						, ITEM_CD
						, STTG_UPBR_ITEM_SE
						, PRCHS_SLS_SE

						, DDC_EXPRT_VLM
						, DDC_EXPRT_AMT
						, DDC_VLM
						, DDC_AMT
						, DDC_ARMY_DLVGDS_VLM
						, DDC_ARMY_DLVGDS_AMT
						, DDC_MLSR_VLM
						, DDC_MLSR_AMT

						, AJMT_VLM
						, AJMT_AMT

						, TOT_TRMT_PRFMNC_VLM
						, TOT_TRMT_PRFMNC_AMT

						, RMRK

						, SYS_FRST_INPT_DT
						, SYS_FRST_INPT_USER_ID
						, SYS_FRST_INPT_PRGRM_ID
						, SYS_LAST_CHG_DT
						, SYS_LAST_CHG_USER_ID
						, SYS_LAST_CHG_PRGRM_ID
					)
				VALUES
					(
						  #{apoCd}
						, '2'
						, #{brno}
						<if test='uoBrno != null and uoBrno != ""'>
						, #{uoBrno}
						</if>
						<if test='uoBrno == null or uoBrno == ""'>
						, '0'
						</if>
						, (case when #{crno} is not null then #{crno}
									ELSE NVL( (SELECT CRNO FROM TB_EV_APO WHERE BRNO = #{brno}) , 'NULL')
									END)
						, #{yr}

						, #{ctgryCd}
						, #{itemCd}
						, #{sttgUpbrItemSe}
						, '2'

						, #{ddcExprtVlm}
						, #{ddcExprtAmt}
						, #{ddcVlm}
						, #{ddcAmt}
						, #{ddcArmyDlvgdsVlm}
						, #{ddcArmyDlvgdsAmt}
						, #{ddcMlsrVlm}
						, #{ddcMlsrAmt}

						, #{ajmtVlm}
						, #{ajmtAmt}

						, #{totTrmtPrfmncVlm}
						, #{totTrmtPrfmncAmt}

						, #{rmrk}

						, SYSDATE
						, #{sysFrstInptUserId}
						, #{sysFrstInptPrgrmId}
						, SYSDATE
						, #{sysLastChgUserId}
						, #{sysLastChgPrgrmId}
					)
	</insert>

	<insert id="insertInvShipOgnPurSalMng03" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		MERGE INTO TB_EV_UO_ISO_ALL_PRCHS_SLS CLT  /* com.at.apcss.pd.pcom.mapper.PrdcrCrclOgnPurSalMngMapper.insertInvShipOgnPurSalMng03 */
		USING DUAL
			ON (
					CLT.BRNO   				= #{brno}
				<if test='uoBrno != null and uoBrno != ""'>
				AND CLT.UO_BRNO	 			= #{uoBrno}
				</if>
				<if test='uoBrno == null or uoBrno == ""'>
				AND CLT.UO_BRNO	 			= '0'
				</if>
				AND CLT.ITEM_CD	 			= #{itemCd}
				AND CLT.STTG_UPBR_ITEM_SE	= #{sttgUpbrItemSe}
				AND CLT.YR	 				= #{yr}
				AND CLT.PRCHS_SLS_SE		= '2'
				)
		WHEN MATCHED THEN
				 UPDATE
					SET
						SLS_CPRTN_SORT_TRST_VLM			= #{slsCprtnSortTrstVlm}
						, SLS_CPRTN_SORT_TRST_AMT		= #{slsCprtnSortTrstAmt}
						, SLS_CPRTN_TRST_VLM			= #{slsCprtnTrstVlm}
						, SLS_CPRTN_TRST_AMT			= #{slsCprtnTrstAmt}
						, SLS_CPRTN_SORT_EMSPAP_VLM		= #{slsCprtnSortEmspapVlm}
						, SLS_CPRTN_SORT_EMSPAP_AMT		= #{slsCprtnSortEmspapAmt}
						, SLS_SMPL_TRST_VLM				= #{slsSmplTrstVlm}
						, SLS_SMPL_TRST_AMT				= #{slsSmplTrstAmt}
						, SLS_SMPL_EMSPAP_VLM			= #{slsSmplEmspapVlm}
						, SLS_SMPL_EMSPAP_AMT			= #{slsSmplEmspapAmt}

						, SLS_EMSPAP_VLM		= #{slsEmspapVlm}
						, SLS_EMSPAP_AMT		= #{slsEmspapAmt}
						, SLS_TRST_VLM			= #{slsTrstVlm}
						, SLS_TRST_AMT			= #{slsTrstAmt}

						, SPMT_PRFMNC_VLM		= #{spmtPrfmncVlm}
						, SPMT_PRFMNC_AMT		= #{spmtPrfmncAmt}
						, SMPL_INPT_VLM			= #{smplInptVlm}
						, SMPL_INPT_AMT			= #{smplInptAmt}

						, TOT_SPMT_PRFMNC_VLM	= #{totSpmtPrfmncVlm}
						, TOT_SPMT_PRFMNC_AMT	= #{totSpmtPrfmncAmt}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

		WHEN NOT MATCHED THEN
			 INSERT
					(
						APO_CD
						, APO_SE
						, BRNO
						, UO_BRNO
						, CRNO
						, YR

						, CTGRY_CD
						, ITEM_CD
						, STTG_UPBR_ITEM_SE
						, PRCHS_SLS_SE

						, SLS_CPRTN_SORT_TRST_VLM
						, SLS_CPRTN_SORT_TRST_AMT
						, SLS_CPRTN_TRST_VLM
						, SLS_CPRTN_TRST_AMT
						, SLS_CPRTN_SORT_EMSPAP_VLM
						, SLS_CPRTN_SORT_EMSPAP_AMT
						, SLS_SMPL_TRST_VLM
						, SLS_SMPL_TRST_AMT
						, SLS_SMPL_EMSPAP_VLM
						, SLS_SMPL_EMSPAP_AMT

						, SLS_EMSPAP_VLM
						, SLS_EMSPAP_AMT
						, SLS_TRST_VLM
						, SLS_TRST_AMT

						, SPMT_PRFMNC_VLM
						, SPMT_PRFMNC_AMT
						, SMPL_INPT_VLM
						, SMPL_INPT_AMT

						, TOT_SPMT_PRFMNC_VLM
						, TOT_SPMT_PRFMNC_AMT

						, RMRK

						, SYS_FRST_INPT_DT
						, SYS_FRST_INPT_USER_ID
						, SYS_FRST_INPT_PRGRM_ID
						, SYS_LAST_CHG_DT
						, SYS_LAST_CHG_USER_ID
						, SYS_LAST_CHG_PRGRM_ID
					)
				VALUES
					(
						#{apoCd}
						, '2'
						, #{brno}
						<if test='uoBrno != null and uoBrno != ""'>
						, #{uoBrno}
						</if>
						<if test='uoBrno == null or uoBrno == ""'>
						, '0'
						</if>
						, (case when #{crno} is not null then #{crno}
									ELSE (SELECT CRNO FROM TB_EV_APO WHERE APO_CD = #{apoCd})
									END)
						, #{yr}

						, #{ctgryCd}
						, #{itemCd}
						, #{sttgUpbrItemSe}
						, '2'

						, #{slsCprtnSortTrstVlm}
						, #{slsCprtnSortTrstAmt}
						, #{slsCprtnTrstVlm}
						, #{slsCprtnTrstAmt}
						, #{slsCprtnSortEmspapVlm}
						, #{slsCprtnSortEmspapAmt}
						, #{slsSmplTrstVlm}
						, #{slsSmplTrstAmt}
						, #{slsSmplEmspapVlm}
						, #{slsSmplEmspapAmt}

						, #{slsEmspapVlm}
						, #{slsEmspapAmt}
						, #{slsTrstVlm}
						, #{slsTrstAmt}

						, #{spmtPrfmncVlm}
						, #{spmtPrfmncAmt}
						, #{smplInptVlm}
						, #{smplInptAmt}

						, #{totSpmtPrfmncVlm}
						, #{totSpmtPrfmncAmt}

						, #{rmrk}

						, SYSDATE
						, #{sysFrstInptUserId}
						, #{sysFrstInptPrgrmId}
						, SYSDATE
						, #{sysLastChgUserId}
						, #{sysLastChgPrgrmId}
					)
	</insert>

	<delete id="deleteInvShipOgnPurSalMng" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		DELETE FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
		 WHERE 1=1
					 AND BRNO				= #{brno}
					 <if test='uoBrno != null and uoBrno != ""'>
					 AND UO_BRNO	 		= #{uoBrno}
					 </if>
					 <if test='uoBrno == null or uoBrno == ""'>
					 AND UO_BRNO 			= '0'
					 </if>
					 AND CTGRY_CD			= #{ctgryCd}
					 AND ITEM_CD			= #{itemCd}
					 AND STTG_UPBR_ITEM_SE	= #{sttgUpbrItemSe}
					 AND PRCHS_SLS_SE		= #{prchsSlsSe}
					 AND APO_SE 			= '2'
					 AND YR	 				= #{yr}
	</delete>
	<!-- 총매입매출 출자출하조직 로우데이터 -->
	<select id="selectRawDataList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectRawDataList */
			YR
			, BRNO
			, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = A.BRNO) AS CORP_NM
			, DECODE( (SELECT APRV
						FROM TB_EV_APO
						WHERE BRNO = (SELECT UO_BRNO
										FROM TB_EV_APLY_MNG
										WHERE  YR = A.YR
										  AND BRNO = A.BRNO
									)
						)
						, '1' , '승인형'
						, '2' , '육성형'
						, ''
			) AS APRV
			, PRCHS_SLS_SE
			, DECODE(A.PRCHS_SLS_SE,'1','매입',2,'매출','') AS PRCHS_SLS_SE_NM
			, STTG_UPBR_ITEM_SE
			, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE_1' AND CD_VL = A.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
			, ITEM_CD
			, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
			, CTGRY_CD
			, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD_1' AND CD_VL = A.CTGRY_CD) AS CTGRY_NM
			, UO_BRNO
			, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = A.UO_BRNO) AS UO_CORP_NM

			/*매입*/
			, PRCHS_TRST_VLM
			, PRCHS_TRST_AMT
			, PRCHS_EMSPAP_VLM
			, PRCHS_EMSPAP_AMT
			, NVL(PRCHS_TRST_VLM , 0) + NVL(PRCHS_EMSPAP_VLM , 0) AS PRCHS_TOT_VLM
			, NVL(PRCHS_EMSPAP_AMT , 0) + NVL(PRCHS_EMSPAP_AMT , 0) AS PRCHS_TOT_AMT

			,ETC_VLM
			,ETC_AMT

			/*매출*/
			, SLS_CPRTN_SORT_TRST_VLM
			, SLS_CPRTN_SORT_TRST_AMT
			, SLS_CPRTN_TRST_VLM
			, SLS_CPRTN_TRST_AMT
			, SLS_CPRTN_SORT_EMSPAP_VLM
			, SLS_CPRTN_SORT_EMSPAP_AMT

			, NVL(SLS_CPRTN_SORT_TRST_VLM , 0)
				+ NVL(SLS_CPRTN_TRST_VLM , 0)
				+ NVL(SLS_CPRTN_SORT_EMSPAP_VLM , 0)
			AS SLS_CPRTN_VLM_TOT
			, NVL(SLS_CPRTN_SORT_TRST_AMT , 0)
				+ NVL(SLS_CPRTN_TRST_AMT , 0)
				+ NVL(SLS_CPRTN_SORT_EMSPAP_AMT , 0)
			AS SLS_CPRTN_AMT_TOT

			/*공제*/
			, DDC_EXPRT_VLM
			, DDC_EXPRT_AMT
			, DDC_VLM
			, DDC_AMT
			, DDC_ARMY_DLVGDS_VLM
			, DDC_ARMY_DLVGDS_AMT
			, DDC_MLSR_VLM
			, DDC_MLSR_AMT

			, NVL(DDC_EXPRT_VLM , 0)
				+ NVL(DDC_VLM , 0)
				+ NVL(DDC_ARMY_DLVGDS_VLM , 0)
				+ NVL(DDC_MLSR_VLM , 0)
			AS DDC_VLM_TOT
			, NVL(DDC_EXPRT_AMT , 0)
				+ NVL(DDC_AMT , 0)
				+ NVL(DDC_ARMY_DLVGDS_AMT , 0)
				+ NVL(DDC_MLSR_AMT , 0)
			AS DDC_AMT_TOT

			, SPMT_PRFMNC_VLM
			, SPMT_PRFMNC_AMT
			, SMPL_INPT_VLM
			, SMPL_INPT_AMT

			, AJMT_VLM
			, AJMT_AMT

			/* 총 실적 */
			, TOT_TRMT_PRFMNC_VLM
			, TOT_TRMT_PRFMNC_AMT
			, TOT_SPMT_PRFMNC_VLM
			, TOT_SPMT_PRFMNC_AMT

		FROM TB_EV_UO_ISO_ALL_PRCHS_SLS A
		WHERE APO_SE ='2'
			AND YR = #{yr}
			AND BRNO NOT IN (SELECT BRNO
								FROM TB_COM_USER
								WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61')
							)
			AND UO_BRNO NOT IN (SELECT BRNO
								FROM TB_COM_USER
								WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51')
								)
			AND ITEM_CD = DECODE(STTG_UPBR_ITEM_SE
									, '3' , A.ITEM_CD
									, (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = A.UO_BRNO AND YR = A.YR AND ITEM_CD = A.ITEM_CD)
								)
		ORDER BY BRNO , PRCHS_SLS_SE  , A.STTG_UPBR_ITEM_SE , UO_BRNO , ITEM_CD
	</select>

	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngNew	-->
	<!-- DESC : 출자출하조직 전문품목 매입매출                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.09  	ljw        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMngNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		<![CDATA[
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngNew */
				  CM.YR
				, CM.APO_CD
				, CM.APO_SE
				, CM.BRNO
				, CM.CRNO
				, CM.CTGRY_CD
				, CM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = CM.ITEM_CD) AS ITEM_NM

				, CM.PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, CM.PRCHS_SORT_TRST_VLM
				, CM.PRCHS_SORT_TRST_AMT
				, CM.PRCHS_SPMT_TRST_VLM
				, CM.PRCHS_SPMT_TRST_AMT
				, CM.PRCHS_SMPL_TRST_VLM
				, CM.PRCHS_SMPL_TRST_AMT
				, CM.PRCHS_SORT_EMSPAP_VLM
				, CM.PRCHS_SORT_EMSPAP_AMT
				, CM.PRCHS_SMPL_EMSPAP_VLM
				, CM.PRCHS_SMPL_EMSPAP_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT


				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				, CM.RMRK

				, CM.DEL_YN		AS DEL_YN
				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			  FROM TB_EV_UO_ISO_ALL_PRCHS_SLS CM
			 WHERE 1=1

		]]>
			<if test='apoCd != null and apoCd != ""'>
				AND CM.APO_CD = #{apoCd}
			</if>
			<if test='apoSe != null and apoSe != ""'>
				AND CM.APO_SE = #{apoSe}
			</if>
		ORDER BY CM.ITEM_CD DESC
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.bbs.mapper.BbsMngMapper.selectBbsList			-->
	<!-- DESC : 게시판 테이블 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMngListNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngListNew */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '1' AS PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, NVL(TOTA.PRCHS_TOT_AMT,0) AS PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, NVL(TOTB.PRCHS_TOT_AMT,0) AS PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, NVL( NVL(TOTA.PRCHS_TOT_AMT,0) + NVL(TOTB.PRCHS_TOT_AMT,0) + NVL(TOTC.PRCHS_TOT_AMT,0) , 0) AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, NVL(TOTC.PRCHS_TOT_AMT,0) AS ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, '' AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, CM.TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			FROM
				(SELECT
						YR
						,BRNO
						,UO_BRNO
						,ITEM_CD
						/*중복아이템은 없는것으로 가정*/
						,(SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS CTGRY_CD
						,(SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS STTG_UPBR_ITEM_SE
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  AND ITEM_CD IN (SELECT ITEM_CD
										FROM TB_EV_APO_YR_GPC_CD
										WHERE 1=1
										  AND APO_SE = '2'
										  AND STTG_UPBR_ITEM_SE != '3'
										  AND YR = A.YR
										  AND BRNO = A.BRNO
										)
					GROUP BY YR , BRNO ,UO_BRNO,ITEM_CD
				)ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '1'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE IN ('1','2')
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTA ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD ,  SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTB ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO = '7'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTC
			WHERE 1=1
			  AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			  AND ITEM.BRNO = CM.BRNO(+)
			  AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			  AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			  AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			  AND ITEM.BRNO = TOTA.BRNO(+)
			  AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			  AND ITEM.BRNO = TOTB.BRNO(+)
			  AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			  AND ITEM.BRNO = TOTC.BRNO(+)
			  AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			UNION ALL

			SELECT
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '2' AS PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, '' AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, CM.ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, NVL(TOTB.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, NVL(TOTA.UO_SPMT_AMT ,0) AS SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, NVL(TOTC.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, NVL((TOTA.UO_SPMT_AMT + TOTB.UO_SPMT_AMT + TOTC.UO_SPMT_AMT) ,0) AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, NVL(TOTD.UO_SPMT_AMT_TOT ,0) AS AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, NVL(TOTD.UO_SPMT_AMT ,0) AS TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			  FROM
			  	(SELECT
						YR
						,BRNO
						,UO_BRNO
						,ITEM_CD
						/*중복아이템은 없는것으로 가정*/
						,(SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS CTGRY_CD
						,(SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS STTG_UPBR_ITEM_SE
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
					WHERE 1=1
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  AND ITEM_CD IN (SELECT ITEM_CD
					  					FROM TB_EV_APO_YR_GPC_CD
					  					WHERE 1=1
					  					<if test='yr != null and yr != ""'>
					  					  AND YR = #{yr}
										</if>
					  					  AND BRNO IN  (SELECT UO_BRNO
					  					  					FROM TB_EV_APO_UO_CD
					  					  					WHERE 1=1
					  					  					<if test='brno != null and brno != ""'>
					  										  AND ISO_BRNO = #{brno}
															</if>
					  					  				)
					  					)
					GROUP BY YR , BRNO ,UO_BRNO , ITEM_CD
				)ITEM ,
			  	(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '1'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTA ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '2'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
			  		  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTB ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTC ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD
						, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
						, SUM( NVL( UO_SPMT_AMT , 0 ) + NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT_TOT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO IN ('1','3','5','7')
					  AND (
							(PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
												)
								)
							OR
								(PRDCR_OGNZ_SN = '0')
							)

					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTD
			WHERE 1=1
			  AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			  AND ITEM.BRNO = CM.BRNO(+)
			  AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			  AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			  AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			  AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			  AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			  AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			  AND ITEM.ITEM_CD = TOTD.ITEM_CD(+)
			  AND ITEM.UO_BRNO = TOTD.UO_BRNO(+)

			UNION ALL

			SELECT
				CM.YR
				, CM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = CM.ITEM_CD) AS ITEM_NM
				, CM.CTGRY_CD
				, CM.STTG_UPBR_ITEM_SE
				, '기타' AS STTG_UPBR_ITEM_NM


				, CM.APO_CD
				, CM.APO_SE
				, CM.BRNO
				, CM.UO_BRNO
				, '' AS CORP_NM
				, CM.CRNO

				, CM.PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, '' AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, CM.ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, '' AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, CM.TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, CM.DEL_YN		AS DEL_YN
				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			FROM TB_EV_UO_ISO_ALL_PRCHS_SLS CM
			WHERE 1=1
			  AND APO_SE = '2'
			  AND ITEM_CD IN (SELECT ITEM_CD
								FROM TB_EV_APO_YR_GPC_CD
								WHERE BRNO = CM.BRNO
								  AND YR = CM.YR
								  AND APO_SE = '2'
								  AND STTG_UPBR_ITEM_SE = '3'
								)
			<if test='brno != null and brno != ""'>
			  AND BRNO = #{brno}
			</if>
			<if test='yr != null and yr != ""'>
			  AND YR = #{yr}
			</if>
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 총매입매출 매입 리스트 -->
	<select id="selectInvShipOgnPurSalMngPrchsListNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngPrchsListNew */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.CLSF_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '1' AS PRCHS_SLS_SE
				/*수탁*/
				, CM.PRCHS_SORT_TRST_VLM
				, CM.PRCHS_SORT_TRST_AMT
				, CM.PRCHS_SPMT_TRST_VLM
				, CM.PRCHS_SPMT_TRST_AMT
				, CM.PRCHS_SMPL_TRST_VLM
				, CM.PRCHS_SMPL_TRST_AMT
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				/*매취*/
				, CM.PRCHS_SORT_EMSPAP_VLM
				, CM.PRCHS_SORT_EMSPAP_AMT
				, CM.PRCHS_SMPL_EMSPAP_VLM
				, CM.PRCHS_SMPL_EMSPAP_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, NVL( NVL(TOTA.PRCHS_TOT_AMT,0) + NVL(TOTB.PRCHS_TOT_AMT,0) + NVL(TOTC.PRCHS_TOT_AMT,0) , 0) AS PRCHS_TOT_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

			FROM
				(SELECT
						YGC.YR
						,YGC.BRNO
						,(SELECT UO_BRNO FROM TB_EV_APLY_MNG WHERE APO_SE = '2' AND BRNO = YGC.BRNO AND YR = YGC.YR) AS UO_BRNO
						,YGC.ITEM_CD
						,YGC.CTGRY_CD
						,YGC.CLSF_CD
						,YGC.STTG_UPBR_ITEM_SE
					FROM TB_EV_APO_YR_GPC_CD YGC
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '1'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE IN ('1','2')
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTA ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD ,  SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTB ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO = '7'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTC
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO 	= CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTA.BRNO(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTB.BRNO(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTC.BRNO(+)
			   AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 총매입매출 매출 리스트 -->
	<select id="selectInvShipOgnPurSalMngSlsListNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngSlsListNew */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.CLSF_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE_1' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '2' AS PRCHS_SLS_SE

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, NVL(TOTB.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, NVL(TOTA.UO_SPMT_AMT ,0) AS SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, NVL(TOTC.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, NVL((TOTA.UO_SPMT_AMT + TOTB.UO_SPMT_AMT + TOTC.UO_SPMT_AMT) ,0) AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, NVL(TOTD.UO_SPMT_AMT_TOT ,0) AS AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, NVL(TOTD.UO_SPMT_AMT ,0) AS TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

			FROM
				(SELECT
						YGC.YR
						,YGC.BRNO
						,(SELECT UO_BRNO FROM TB_EV_APLY_MNG WHERE APO_SE = '2' AND BRNO = YGC.BRNO AND YR = YGC.YR) AS UO_BRNO
						,YGC.ITEM_CD
						,YGC.CTGRY_CD
						,YGC.CLSF_CD
						,YGC.STTG_UPBR_ITEM_SE
					FROM TB_EV_APO_YR_GPC_CD YGC
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '1'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTA ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '2'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTB ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTC ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD
						, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
						, SUM( NVL( UO_SPMT_AMT , 0 ) + NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT_TOT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO IN ('1','3','5','7')
					  AND (
							(PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
												)
								)
							OR
								(PRDCR_OGNZ_SN = '0')
							)

					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTD
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO = CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTD.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTD.UO_BRNO(+)
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>
</mapper>