<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : BbsMapper.xml                                    				-->
<!-- DESC : 게시판 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
<!-- ==========================================================================	-->
<mapper namespace="com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.bbs.mapper.BbsMngMapper.selectBbs				-->
	<!-- DESC : 게시판 테이블 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMng" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		<![CDATA[
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMng */
				  CM.YR
				, CM.APO_CD
				, CM.APO_SE
				, CM.BRNO
				, CM.CRNO
				, CM.CTGRY_CD
				, CM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = CM.ITEM_CD) AS ITEM_NM

				, CM.PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT


				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				, CM.RMRK

				, CM.DEL_YN		AS DEL_YN
				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			  FROM TB_EV_UO_ISO_ALL_PRCHS_SLS CM
			 WHERE 1=1

    	]]>
    		<if test='apoCd != null and apoCd != ""'>
				AND CM.APO_CD = #{apoCd}
			</if>
			<if test='apoSe != null and apoSe != ""'>
				AND CM.APO_SE = #{apoSe}
			</if>
		ORDER BY CM.ITEM_CD DESC
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.bbs.mapper.BbsMngMapper.selectBbsList			-->
	<!-- DESC : 게시판 테이블 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMngList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngList */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '1' AS PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, NVL(TOTA.PRCHS_TOT_AMT,0) AS PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, NVL(TOTB.PRCHS_TOT_AMT,0) AS PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_AMT
				, NVL( NVL(TOTA.PRCHS_TOT_AMT,0) + NVL(TOTB.PRCHS_TOT_AMT,0) + NVL(TOTC.PRCHS_TOT_AMT,0) , 0) AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, NVL(TOTC.PRCHS_TOT_AMT,0) AS ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, '' AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, CM.TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			  FROM
			  	(SELECT
						YR
						,BRNO
						,UO_BRNO
						,ITEM_CD
						/*중복아이템은 없는것으로 가정*/
						,(SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS CTGRY_CD
						,(SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS STTG_UPBR_ITEM_SE
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
					WHERE 1=1
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  AND ITEM_CD IN (SELECT ITEM_CD
					  					FROM TB_EV_APO_YR_GPC_CD
					  					WHERE 1=1
					  					<if test='yr != null and yr != ""'>
					  					  AND YR = #{yr}
										</if>
					  					  AND BRNO IN  (SELECT UO_BRNO
					  					  					FROM TB_EV_APO_UO_CD
					  					  					WHERE 1=1
					  					  					<if test='brno != null and brno != ""'>
					  										  AND ISO_BRNO = #{brno}
															</if>
					  					  				)
					  					)
					GROUP BY YR , BRNO ,UO_BRNO,ITEM_CD
				)ITEM ,
			  	(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '1'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
			  	(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TRMT_TYPE IN ('1','2')
			  		  AND TYPE_SE_NO = '5'
			  		  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
			  		  							FROM TB_EV_FRMHS_APO
			  		  							WHERE 1=1
			  		  							  AND APO_SE = '2'
			  		  							  AND STBLT_YN = 'Y'
			  		  							  AND NVL(EXCL_YN,'N') != 'Y'
			  		  							<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTA ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD ,  SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TRMT_TYPE = '3'
			  		  AND TYPE_SE_NO = '5'
			  		  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
			  		  							FROM TB_EV_FRMHS_APO
			  		  							WHERE 1=1
			  		  							  AND APO_SE = '2'
			  		  							  AND STBLT_YN = 'Y'
			  		  							  AND NVL(EXCL_YN,'N') != 'Y'
			  		  							<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTB ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TYPE_SE_NO = '7'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTC
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO 	= CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTA.BRNO(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTB.BRNO(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTC.BRNO(+)
			   AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			UNION ALL

			SELECT
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '2' AS PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, '' AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, CM.ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, NVL(TOTB.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, NVL(TOTA.UO_SPMT_AMT ,0) AS SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, NVL(TOTC.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, NVL((TOTA.UO_SPMT_AMT + TOTB.UO_SPMT_AMT + TOTC.UO_SPMT_AMT) ,0) AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, NVL(TOTD.UO_SPMT_AMT_TOT ,0) AS AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, NVL(TOTD.UO_SPMT_AMT ,0) AS TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			  FROM
			  	(SELECT
						YR
						,BRNO
						,UO_BRNO
						,ITEM_CD
						/*중복아이템은 없는것으로 가정*/
						,(SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS CTGRY_CD
						,(SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD ) AS STTG_UPBR_ITEM_SE
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
					WHERE 1=1
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  AND ITEM_CD IN (SELECT ITEM_CD
					  					FROM TB_EV_APO_YR_GPC_CD
					  					WHERE 1=1
					  					<if test='yr != null and yr != ""'>
					  					  AND YR = #{yr}
										</if>
					  					  AND BRNO IN  (SELECT UO_BRNO
					  					  					FROM TB_EV_APO_UO_CD
					  					  					WHERE 1=1
					  					  					<if test='brno != null and brno != ""'>
					  										  AND ISO_BRNO = #{brno}
															</if>
					  					  				)
					  					)
					GROUP BY YR , BRNO ,UO_BRNO , ITEM_CD
				)ITEM ,
			  	(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
			  	(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TRMT_TYPE = '1'
			  		  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
			  		  							FROM TB_EV_FRMHS_APO
			  		  							WHERE 1=1
			  		  							  AND APO_SE = '2'
			  		  							  AND STBLT_YN = 'Y'
			  		  							  AND NVL(EXCL_YN,'N') != 'Y'
			  		  							<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
			  		  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
			  		) TOTA ,
			  		(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TRMT_TYPE = '2'
			  		  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
			  		  							FROM TB_EV_FRMHS_APO
			  		  							WHERE 1=1
			  		  							  AND APO_SE = '2'
			  		  							  AND STBLT_YN = 'Y'
			  		  							  AND NVL(EXCL_YN,'N') != 'Y'
			  		  							<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
			  		  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
			  		) TOTB ,
			  		(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TRMT_TYPE = '3'
			  		  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
			  		  							FROM TB_EV_FRMHS_APO
			  		  							WHERE 1=1
			  		  							  AND APO_SE = '2'
			  		  							  AND STBLT_YN = 'Y'
			  		  							  AND NVL(EXCL_YN,'N') != 'Y'
			  		  							<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
			  		  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
			  		) TOTC ,
			  		(SELECT YR , BRNO , UO_BRNO , ITEM_CD
			  			, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
			  			, SUM( NVL( UO_SPMT_AMT , 0 ) + NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT_TOT
			  		FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
			  		WHERE 1=1
			  		  AND APO_SE = '2'
			  		  AND TYPE_SE_NO IN ('1','3','5','7')
					  AND (
					  		(PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
			  		  							FROM TB_EV_FRMHS_APO
			  		  							WHERE 1=1
			  		  							  AND APO_SE = '2'
			  		  							  AND STBLT_YN = 'Y'
			  		  							  AND NVL(EXCL_YN,'N') != 'Y'
			  		  							<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  							)
					  			)
					  		OR
					  			(PRDCR_OGNZ_SN = '0')
					  		)

			  		  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
			  		) TOTD
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO = CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTD.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTD.UO_BRNO(+)

			UNION ALL

			SELECT
				CM.YR
				, CM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = CM.ITEM_CD) AS ITEM_NM
				, CM.CTGRY_CD
				, CM.STTG_UPBR_ITEM_SE
				, '기타' AS STTG_UPBR_ITEM_NM


				, CM.APO_CD
				, CM.APO_SE
				, CM.BRNO
				, CM.UO_BRNO
				, '' AS CORP_NM
				, CM.CRNO

				, CM.PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, '' AS PRCHS_TOT_AMT

				, CM.ETC_VLM
				, CM.ETC_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, '' AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, CM.TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, CM.DEL_YN		AS DEL_YN
				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			FROM TB_EV_UO_ISO_ALL_PRCHS_SLS CM
			WHERE 1=1
			  AND STTG_UPBR_ITEM_SE = '3'
			  AND APO_SE = '2'
			<if test='brno != null and brno != ""'>
			  AND BRNO = #{brno}
			</if>
			<if test='yr != null and yr != ""'>
			  AND YR = #{yr}
			</if>
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 총매입매출 매입 리스트 -->
	<select id="selectInvShipOgnPurSalMngPrchsList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngPrchsList */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.CLSF_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '1' AS PRCHS_SLS_SE
				/*수탁*/
				, CM.PRCHS_SORT_TRST_VLM
				, CM.PRCHS_SORT_TRST_AMT
				, CM.PRCHS_SPMT_TRST_VLM
				, CM.PRCHS_SPMT_TRST_AMT
				, CM.PRCHS_SMPL_TRST_VLM
				, CM.PRCHS_SMPL_TRST_AMT
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				/*매취*/
				, CM.PRCHS_SORT_EMSPAP_VLM
				, CM.PRCHS_SORT_EMSPAP_AMT
				, CM.PRCHS_SMPL_EMSPAP_VLM
				, CM.PRCHS_SMPL_EMSPAP_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, '' AS PRCHS_TOT_VLM
				, NVL( NVL(TOTA.PRCHS_TOT_AMT,0) + NVL(TOTB.PRCHS_TOT_AMT,0) + NVL(TOTC.PRCHS_TOT_AMT,0) , 0) AS PRCHS_TOT_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

			FROM
				(SELECT
						YGC.YR
						,YGC.BRNO
						,(SELECT UO_BRNO FROM TB_EV_APLY_MNG WHERE APO_SE = '2' AND BRNO = YGC.BRNO AND YR = YGC.YR) AS UO_BRNO
						,YGC.ITEM_CD
						,YGC.CTGRY_CD
						,YGC.CLSF_CD
						,YGC.STTG_UPBR_ITEM_SE
					FROM TB_EV_APO_YR_GPC_CD YGC
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '1'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE IN ('1','2')
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTA ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD ,  SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTB ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO = '7'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTC
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO 	= CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTA.BRNO(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTB.BRNO(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			   AND ITEM.BRNO 	= TOTC.BRNO(+)
			   AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 총매입매출 매출 리스트 -->
	<select id="selectInvShipOgnPurSalMngSlsList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, ITEM.CLSF_CD
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '2' AS PRCHS_SLS_SE

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, NVL(TOTB.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, NVL(TOTA.UO_SPMT_AMT ,0) AS SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, NVL(TOTC.UO_SPMT_AMT ,0) AS SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, '' AS SLS_TOT_VLM
				, NVL((TOTA.UO_SPMT_AMT + TOTB.UO_SPMT_AMT + TOTC.UO_SPMT_AMT) ,0) AS SLS_TOT_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, NVL(TOTD.UO_SPMT_AMT_TOT ,0) AS AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT
				, CM.TOT_SPMT_PRFMNC_VLM
				, NVL(TOTD.UO_SPMT_AMT ,0) AS TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

			FROM
				(SELECT
						YGC.YR
						,YGC.BRNO
						,(SELECT UO_BRNO FROM TB_EV_APLY_MNG WHERE APO_SE = '2' AND BRNO = YGC.BRNO AND YR = YGC.YR) AS UO_BRNO
						,YGC.ITEM_CD
						,YGC.CTGRY_CD
						,YGC.CLSF_CD
						,YGC.STTG_UPBR_ITEM_SE
					FROM TB_EV_APO_YR_GPC_CD YGC
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '1'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
											)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTA ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '2'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTB ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD , SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TRMT_TYPE = '3'
					  AND TYPE_SE_NO = '5'
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
					  						)
					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTC ,
					(SELECT YR , BRNO , UO_BRNO , ITEM_CD
						, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
						, SUM( NVL( UO_SPMT_AMT , 0 ) + NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT_TOT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
					WHERE 1=1
					  AND APO_SE = '2'
					  AND TYPE_SE_NO IN ('1','3','5','7')
					  AND (
							(PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND STBLT_YN = 'Y'
												  AND NVL(EXCL_YN,'N') != 'Y'
												<if test='brno != null and brno != ""'>
												  AND BRNO = #{brno}
												</if>
												<if test='yr != null and yr != ""'>
												  AND YR = #{yr}
												</if>
												)
								)
							OR
								(PRDCR_OGNZ_SN = '0')
							)

					  <if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					  </if>
					  <if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					  </if>

					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
					) TOTD
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO = CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTC.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTC.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTD.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTD.UO_BRNO(+)
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 매입 등록 -->
	<insert id="insertInvShipOgnPurSalMng01" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		MERGE INTO TB_EV_UO_ISO_ALL_PRCHS_SLS CLT  /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.insertInvShipOgnPurSalMng01 */
		USING DUAL
			ON (
					CLT.BRNO   				= #{brno}
				AND CLT.UO_BRNO	 			= #{uoBrno}
				AND CLT.ITEM_CD	 			= #{itemCd}
				AND CLT.STTG_UPBR_ITEM_SE	= #{sttgUpbrItemSe}
				AND CLT.YR	 				= #{yr}
				AND CLT.PRCHS_SLS_SE		= '1'
				)
		WHEN MATCHED THEN
				 UPDATE
					   SET
						PRCHS_TRST_VLM			= #{prchsTrstVlm}
						, PRCHS_TRST_AMT		= #{prchsTrstAmt}
						, PRCHS_EMSPAP_VLM		= #{prchsEmspapVlm}
						, PRCHS_EMSPAP_AMT		= #{prchsEmspapAmt}
						, ETC_VLM				= #{etcVlm}
						, ETC_AMT				= #{etcAmt}

						, PRCHS_SORT_TRST_VLM	= #{prchsSortTrstVlm}
						, PRCHS_SORT_TRST_AMT	= #{prchsSortTrstAmt}
						, PRCHS_SPMT_TRST_VLM	= #{prchsSpmtTrstVlm}
						, PRCHS_SPMT_TRST_AMT	= #{prchsSpmtTrstAmt}
						, PRCHS_SMPL_TRST_VLM	= #{prchsSmplTrstVlm}
						, PRCHS_SMPL_TRST_AMT	= #{prchsSmplTrstAmt}

						, PRCHS_SORT_EMSPAP_VLM	= #{prchsSortEmspapVlm}
						, PRCHS_SORT_EMSPAP_AMT	= #{prchsSortEmspapAmt}
						, PRCHS_SMPL_EMSPAP_VLM	= #{prchsSmplEmspapVlm}
						, PRCHS_SMPL_EMSPAP_AMT	= #{prchsSmplEmspapAmt}

						, CTGRY_CD				= #{ctgryCd}
						, CLSF_CD				= #{clsfCd}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

		WHEN NOT MATCHED THEN
			 INSERT
					(
						APO_CD
						, APO_SE
						, BRNO
						, UO_BRNO
						, CRNO
						, YR

						, CTGRY_CD
						, CLSF_CD
						, ITEM_CD
						, STTG_UPBR_ITEM_SE
						, PRCHS_SLS_SE

						, PRCHS_TRST_VLM
						, PRCHS_TRST_AMT
						, PRCHS_EMSPAP_VLM
						, PRCHS_EMSPAP_AMT
						, ETC_VLM
						, ETC_AMT

						, PRCHS_SORT_TRST_VLM
						, PRCHS_SORT_TRST_AMT
						, PRCHS_SPMT_TRST_VLM
						, PRCHS_SPMT_TRST_AMT
						, PRCHS_SMPL_TRST_VLM
						, PRCHS_SMPL_TRST_AMT

						, PRCHS_SORT_EMSPAP_VLM
						, PRCHS_SORT_EMSPAP_AMT
						, PRCHS_SMPL_EMSPAP_VLM
						, PRCHS_SMPL_EMSPAP_AMT

						, RMRK

						, SYS_FRST_INPT_DT
						, SYS_FRST_INPT_USER_ID
						, SYS_FRST_INPT_PRGRM_ID
						, SYS_LAST_CHG_DT
						, SYS_LAST_CHG_USER_ID
						, SYS_LAST_CHG_PRGRM_ID
					)
				VALUES
					(
						  (SELECT APO_CD FROM TB_EV_APO WHERE BRNO = #{brno})
						, '2'
						, #{brno}
						<if test='uoBrno != null and uoBrno != ""'>
						, #{uoBrno}
						</if>
						<if test='uoBrno == null or uoBrno == ""'>
						, '0'
						</if>
						, (SELECT CRNO FROM TB_EV_APO WHERE BRNO = #{brno})
						, #{yr}

						, #{ctgryCd}
						, #{clsfCd}
						, #{itemCd}
						, #{sttgUpbrItemSe}
						, '1'

						, #{prchsTrstVlm}
						, #{prchsTrstAmt}
						, #{prchsEmspapVlm}
						, #{prchsEmspapAmt}
						, #{etcVlm}
						, #{etcAmt}

						, #{prchsSortTrstVlm}
						, #{prchsSortTrstAmt}
						, #{prchsSpmtTrstVlm}
						, #{prchsSpmtTrstAmt}
						, #{prchsSmplTrstVlm}
						, #{prchsSmplTrstAmt}

						, #{prchsSortEmspapVlm}
						, #{prchsSortEmspapAmt}
						, #{prchsSmplEmspapVlm}
						, #{prchsSmplEmspapAmt}

						, #{rmrk}

						, SYSDATE
						, #{sysFrstInptUserId}
						, #{sysFrstInptPrgrmId}
						, SYSDATE
						, #{sysLastChgUserId}
						, #{sysLastChgPrgrmId}
					)
	</insert>

	<!-- 매출 등록 -->
	<insert id="insertInvShipOgnPurSalMng02" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		MERGE INTO TB_EV_UO_ISO_ALL_PRCHS_SLS CLT  /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.insertInvShipOgnPurSalMng02 */
		USING DUAL
			ON (
					CLT.BRNO   				= #{brno}
				AND CLT.UO_BRNO	 			= #{uoBrno}
				AND CLT.ITEM_CD	 			= #{itemCd}
				AND CLT.STTG_UPBR_ITEM_SE	= #{sttgUpbrItemSe}
				AND CLT.YR	 				= #{yr}
				AND CLT.PRCHS_SLS_SE		= '2'
				)
		WHEN MATCHED THEN
				 UPDATE
					SET
						DDC_EXPRT_VLM			= #{ddcExprtVlm}
						, DDC_EXPRT_AMT			= #{ddcExprtAmt}
						, DDC_VLM				= #{ddcVlm}
						, DDC_AMT				= #{ddcAmt}
						, DDC_ARMY_DLVGDS_VLM	= #{ddcArmyDlvgdsVlm}
						, DDC_ARMY_DLVGDS_AMT	= #{ddcArmyDlvgdsAmt}
						, DDC_MLSR_VLM			= #{ddcMlsrVlm}
						, DDC_MLSR_AMT			= #{ddcMlsrAmt}

						, AJMT_VLM				= #{ajmtVlm}
						, AJMT_AMT				= #{ajmtAmt}

						, TOT_TRMT_PRFMNC_VLM	= #{totTrmtPrfmncVlm}
						, TOT_TRMT_PRFMNC_AMT	= #{totTrmtPrfmncAmt}

						, CTGRY_CD				= #{ctgryCd}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

		WHEN NOT MATCHED THEN
			INSERT
					(
						APO_CD
						, APO_SE
						, BRNO
						, UO_BRNO
						, CRNO
						, YR

						, CTGRY_CD
						, ITEM_CD
						, STTG_UPBR_ITEM_SE
						, PRCHS_SLS_SE

						, DDC_EXPRT_VLM
						, DDC_EXPRT_AMT
						, DDC_VLM
						, DDC_AMT
						, DDC_ARMY_DLVGDS_VLM
						, DDC_ARMY_DLVGDS_AMT
						, DDC_MLSR_VLM
						, DDC_MLSR_AMT

						, AJMT_VLM
						, AJMT_AMT

						, TOT_TRMT_PRFMNC_VLM
						, TOT_TRMT_PRFMNC_AMT

						, RMRK

						, SYS_FRST_INPT_DT
						, SYS_FRST_INPT_USER_ID
						, SYS_FRST_INPT_PRGRM_ID
						, SYS_LAST_CHG_DT
						, SYS_LAST_CHG_USER_ID
						, SYS_LAST_CHG_PRGRM_ID
					)
				VALUES
					(
						  (SELECT APO_CD FROM TB_EV_APO WHERE BRNO = #{brno})
						, '2'
						, #{brno}
						, #{uoBrno}
						, (SELECT CRNO FROM TB_EV_APO WHERE BRNO = #{brno})
						, #{yr}

						, #{ctgryCd}
						, #{itemCd}
						, #{sttgUpbrItemSe}
						, '2'

						, #{ddcExprtVlm}
						, #{ddcExprtAmt}
						, #{ddcVlm}
						, #{ddcAmt}
						, #{ddcArmyDlvgdsVlm}
						, #{ddcArmyDlvgdsAmt}
						, #{ddcMlsrVlm}
						, #{ddcMlsrAmt}

						, #{ajmtVlm}
						, #{ajmtAmt}

						, #{totTrmtPrfmncVlm}
						, #{totTrmtPrfmncAmt}

						, #{rmrk}

						, SYSDATE
						, #{sysFrstInptUserId}
						, #{sysFrstInptPrgrmId}
						, SYSDATE
						, #{sysLastChgUserId}
						, #{sysLastChgPrgrmId}
					)
	</insert>

	<insert id="insertInvShipOgnPurSalMng03" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		MERGE INTO TB_EV_UO_ISO_ALL_PRCHS_SLS CLT  /* com.at.apcss.pd.pcom.mapper.PrdcrCrclOgnPurSalMngMapper.insertInvShipOgnPurSalMng03 */
		USING DUAL
			ON (
					CLT.BRNO   				= #{brno}
				AND CLT.UO_BRNO	 			= #{uoBrno}
				AND CLT.ITEM_CD	 			= #{itemCd}
				AND CLT.STTG_UPBR_ITEM_SE	= #{sttgUpbrItemSe}
				AND CLT.YR	 				= #{yr}
				AND CLT.PRCHS_SLS_SE		= '2'
				)
		WHEN MATCHED THEN
				 UPDATE
					SET
						SLS_CPRTN_SORT_TRST_VLM			= #{slsCprtnSortTrstVlm}
						, SLS_CPRTN_SORT_TRST_AMT		= #{slsCprtnSortTrstAmt}
						, SLS_CPRTN_TRST_VLM			= #{slsCprtnTrstVlm}
						, SLS_CPRTN_TRST_AMT			= #{slsCprtnTrstAmt}
						, SLS_CPRTN_SORT_EMSPAP_VLM		= #{slsCprtnSortEmspapVlm}
						, SLS_CPRTN_SORT_EMSPAP_AMT		= #{slsCprtnSortEmspapAmt}
						, SLS_SMPL_TRST_VLM				= #{slsSmplTrstVlm}
						, SLS_SMPL_TRST_AMT				= #{slsSmplTrstAmt}
						, SLS_SMPL_EMSPAP_VLM			= #{slsSmplEmspapVlm}
						, SLS_SMPL_EMSPAP_AMT			= #{slsSmplEmspapAmt}

						, SLS_EMSPAP_VLM		= #{slsEmspapVlm}
						, SLS_EMSPAP_AMT		= #{slsEmspapAmt}
						, SLS_TRST_VLM			= #{slsTrstVlm}
						, SLS_TRST_AMT			= #{slsTrstAmt}

						, SPMT_PRFMNC_VLM		= #{spmtPrfmncVlm}
						, SPMT_PRFMNC_AMT		= #{spmtPrfmncAmt}
						, SMPL_INPT_VLM			= #{smplInptVlm}
						, SMPL_INPT_AMT			= #{smplInptAmt}

						, TOT_SPMT_PRFMNC_VLM	= #{totSpmtPrfmncVlm}
						, TOT_SPMT_PRFMNC_AMT	= #{totSpmtPrfmncAmt}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

		WHEN NOT MATCHED THEN
			 INSERT
					(
						APO_CD
						, APO_SE
						, BRNO
						, UO_BRNO
						, CRNO
						, YR

						, CTGRY_CD
						, ITEM_CD
						, STTG_UPBR_ITEM_SE
						, PRCHS_SLS_SE

						, SLS_CPRTN_SORT_TRST_VLM
						, SLS_CPRTN_SORT_TRST_AMT
						, SLS_CPRTN_TRST_VLM
						, SLS_CPRTN_TRST_AMT
						, SLS_CPRTN_SORT_EMSPAP_VLM
						, SLS_CPRTN_SORT_EMSPAP_AMT
						, SLS_SMPL_TRST_VLM
						, SLS_SMPL_TRST_AMT
						, SLS_SMPL_EMSPAP_VLM
						, SLS_SMPL_EMSPAP_AMT

						, SLS_EMSPAP_VLM
						, SLS_EMSPAP_AMT
						, SLS_TRST_VLM
						, SLS_TRST_AMT

						, SPMT_PRFMNC_VLM
						, SPMT_PRFMNC_AMT
						, SMPL_INPT_VLM
						, SMPL_INPT_AMT

						, TOT_SPMT_PRFMNC_VLM
						, TOT_SPMT_PRFMNC_AMT

						, RMRK

						, SYS_FRST_INPT_DT
						, SYS_FRST_INPT_USER_ID
						, SYS_FRST_INPT_PRGRM_ID
						, SYS_LAST_CHG_DT
						, SYS_LAST_CHG_USER_ID
						, SYS_LAST_CHG_PRGRM_ID
					)
				VALUES
					(
						(SELECT APO_CD FROM TB_EV_APO WHERE BRNO = #{brno})
						, '2'
						, #{brno}
						, #{uoBrno}
						, (SELECT CRNO FROM TB_EV_APO WHERE BRNO = #{brno})
						, #{yr}

						, #{ctgryCd}
						, #{itemCd}
						, #{sttgUpbrItemSe}
						, '2'

						, #{slsCprtnSortTrstVlm}
						, #{slsCprtnSortTrstAmt}
						, #{slsCprtnTrstVlm}
						, #{slsCprtnTrstAmt}
						, #{slsCprtnSortEmspapVlm}
						, #{slsCprtnSortEmspapAmt}
						, #{slsSmplTrstVlm}
						, #{slsSmplTrstAmt}
						, #{slsSmplEmspapVlm}
						, #{slsSmplEmspapAmt}

						, #{slsEmspapVlm}
						, #{slsEmspapAmt}
						, #{slsTrstVlm}
						, #{slsTrstAmt}

						, #{spmtPrfmncVlm}
						, #{spmtPrfmncAmt}
						, #{smplInptVlm}
						, #{smplInptAmt}

						, #{totSpmtPrfmncVlm}
						, #{totSpmtPrfmncAmt}

						, #{rmrk}

						, SYSDATE
						, #{sysFrstInptUserId}
						, #{sysFrstInptPrgrmId}
						, SYSDATE
						, #{sysLastChgUserId}
						, #{sysLastChgPrgrmId}
					)
	</insert>

	<delete id="deleteInvShipOgnPurSalMng" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		DELETE FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
		 WHERE 1=1
			 AND BRNO				= #{brno}
			 AND UO_BRNO	 		= #{uoBrno}
			 AND CTGRY_CD			= #{ctgryCd}
			 AND ITEM_CD			= #{itemCd}
			 AND STTG_UPBR_ITEM_SE	= #{sttgUpbrItemSe}
			 AND PRCHS_SLS_SE		= #{prchsSlsSe}
			 AND APO_SE 			= '2'
			 AND YR	 				= #{yr}
	</delete>
	<!-- 총매입매출 출자출하조직 로우데이터 -->
	<select id="selectRawDataList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectRawDataList */
			YR
			, BRNO
			, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = A.BRNO) AS CORP_NM
			, DECODE( (SELECT APRV
						FROM TB_EV_APO
						WHERE BRNO = (SELECT UO_BRNO
										FROM TB_EV_APLY_MNG
										WHERE  YR = A.YR
										  AND BRNO = A.BRNO
									)
						)
						, '1' , '승인형'
						, '2' , '육성형'
						, ''
			) AS APRV
			, PRCHS_SLS_SE
			, DECODE(A.PRCHS_SLS_SE,'1','매입',2,'매출','') AS PRCHS_SLS_SE_NM
			, STTG_UPBR_ITEM_SE
			, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = A.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
			, ITEM_CD
			, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
			, CTGRY_CD
			, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD_1' AND CD_VL = A.CTGRY_CD) AS CTGRY_NM
			, UO_BRNO
			, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = A.UO_BRNO) AS UO_CORP_NM

			/*매입*/
			, PRCHS_TRST_VLM
			, PRCHS_TRST_AMT
			, PRCHS_EMSPAP_VLM
			, PRCHS_EMSPAP_AMT
			, NVL(PRCHS_TRST_VLM , 0) + NVL(PRCHS_EMSPAP_VLM , 0) AS PRCHS_TOT_VLM
			, NVL(PRCHS_EMSPAP_AMT , 0) + NVL(PRCHS_EMSPAP_AMT , 0) AS PRCHS_TOT_AMT

			,ETC_VLM
			,ETC_AMT

			/*매출*/
			, SLS_CPRTN_SORT_TRST_VLM
			, SLS_CPRTN_SORT_TRST_AMT
			, SLS_CPRTN_TRST_VLM
			, SLS_CPRTN_TRST_AMT
			, SLS_CPRTN_SORT_EMSPAP_VLM
			, SLS_CPRTN_SORT_EMSPAP_AMT

			, NVL(SLS_CPRTN_SORT_TRST_VLM , 0)
				+ NVL(SLS_CPRTN_TRST_VLM , 0)
				+ NVL(SLS_CPRTN_SORT_EMSPAP_VLM , 0)
			AS SLS_CPRTN_VLM_TOT
			, NVL(SLS_CPRTN_SORT_TRST_AMT , 0)
				+ NVL(SLS_CPRTN_TRST_AMT , 0)
				+ NVL(SLS_CPRTN_SORT_EMSPAP_AMT , 0)
			AS SLS_CPRTN_AMT_TOT

			/*공제*/
			, DDC_EXPRT_VLM
			, DDC_EXPRT_AMT
			, DDC_VLM
			, DDC_AMT
			, DDC_ARMY_DLVGDS_VLM
			, DDC_ARMY_DLVGDS_AMT
			, DDC_MLSR_VLM
			, DDC_MLSR_AMT

			, NVL(DDC_EXPRT_VLM , 0)
				+ NVL(DDC_VLM , 0)
				+ NVL(DDC_ARMY_DLVGDS_VLM , 0)
				+ NVL(DDC_MLSR_VLM , 0)
			AS DDC_VLM_TOT
			, NVL(DDC_EXPRT_AMT , 0)
				+ NVL(DDC_AMT , 0)
				+ NVL(DDC_ARMY_DLVGDS_AMT , 0)
				+ NVL(DDC_MLSR_AMT , 0)
			AS DDC_AMT_TOT

			, SPMT_PRFMNC_VLM
			, SPMT_PRFMNC_AMT
			, SMPL_INPT_VLM
			, SMPL_INPT_AMT

			, AJMT_VLM
			, AJMT_AMT

			/* 총 실적 */
			, TOT_TRMT_PRFMNC_VLM
			, TOT_TRMT_PRFMNC_AMT
			, TOT_SPMT_PRFMNC_VLM
			, TOT_SPMT_PRFMNC_AMT

		FROM TB_EV_UO_ISO_ALL_PRCHS_SLS A
		WHERE APO_SE ='2'
			AND YR = #{yr}
			AND BRNO NOT IN (SELECT BRNO
								FROM TB_COM_USER
								WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61')
							)
			AND UO_BRNO NOT IN (SELECT BRNO
								FROM TB_COM_USER
								WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51')
								)
			AND ITEM_CD = DECODE(STTG_UPBR_ITEM_SE
									, '3' , A.ITEM_CD
									, (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = A.UO_BRNO AND YR = A.YR AND ITEM_CD = A.ITEM_CD)
								)
		ORDER BY BRNO , PRCHS_SLS_SE  , A.STTG_UPBR_ITEM_SE , UO_BRNO , ITEM_CD
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectRawDataList2025	-->
	<!-- DESC : 출자출하조직 총 매입매출 로우데이터 조회 2025년                                   	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.02.18  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectRawDataList2025" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectRawDataList2025 */
			YR
			, BRNO
			, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = CM.BRNO) AS CORP_NM
			, UO_BRNO
			, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = CM.UO_BRNO) AS UO_CORP_NM
			, DECODE( (SELECT
							(SELECT APRV FROM TB_EV_APO WHERE BRNO = EAM.UO_BRNO)
						FROM TB_EV_APLY_MNG EAM
						WHERE YR = CM.YR
						  AND BRNO = CM.BRNO
						  AND APO_SE = '2'
						)
						, '1' , '승인형'
						, '2' , '육성형'
						, ''
			) AS APRV
			, PRCHS_SLS_SE
			, DECODE(CM.PRCHS_SLS_SE,'1','매입',2,'매출','') AS PRCHS_SLS_SE_NM
			, STTG_UPBR_ITEM_SE
			, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = CM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
			, ITEM_CD
			, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = CM.ITEM_CD) AS ITEM_NM
			, CTGRY_CD
			, (SELECT CD_VL_NM
				FROM TB_COM_CD_DTL
				WHERE CD_ID = 'CTGRY_CD'
				  AND CD_VL = (SELECT CTGRY_CD
				  				FROM TB_EV_APO_YR_GPC_CD
				  				WHERE APO_SE = '2'
				  				  AND BRNO = CM.BRNO
				  				  AND YR = CM.YR
				  				  AND ITEM_CD = CM.ITEM_CD)
			) AS CTGRY_NM

			/*매입*/
			/*수탁*/
			, CM.PRCHS_SORT_TRST_VLM
			, CM.PRCHS_SORT_TRST_AMT
			, CM.PRCHS_SPMT_TRST_VLM
			, CM.PRCHS_SPMT_TRST_AMT
			, CM.PRCHS_SMPL_TRST_VLM
			, CM.PRCHS_SMPL_TRST_AMT
			, NVL(CM.PRCHS_SORT_TRST_VLM, 0) + NVL(CM.PRCHS_SPMT_TRST_VLM,0) + NVL(CM.PRCHS_SMPL_TRST_VLM,0) AS PRCHS_TRST_VLM
			, NVL(CM.PRCHS_SORT_TRST_AMT, 0) + NVL(CM.PRCHS_SPMT_TRST_AMT,0) + NVL(CM.PRCHS_SMPL_TRST_AMT,0) AS PRCHS_TRST_AMT
			/*매취*/
			, CM.PRCHS_SORT_EMSPAP_VLM
			, CM.PRCHS_SORT_EMSPAP_AMT
			, CM.PRCHS_SMPL_EMSPAP_VLM
			, CM.PRCHS_SMPL_EMSPAP_AMT
			, NVL(CM.PRCHS_SORT_EMSPAP_VLM, 0) + NVL(CM.PRCHS_SMPL_EMSPAP_VLM,0) AS PRCHS_EMSPAP_VLM
			, NVL(CM.PRCHS_SORT_EMSPAP_AMT, 0) + NVL(CM.PRCHS_SMPL_EMSPAP_AMT,0) AS PRCHS_EMSPAP_AMT

			, NVL(CM.PRCHS_SORT_TRST_VLM, 0) + NVL(CM.PRCHS_SPMT_TRST_VLM,0) + NVL(CM.PRCHS_SMPL_TRST_VLM,0)
				 + NVL(CM.PRCHS_SORT_EMSPAP_VLM,0) + NVL(CM.PRCHS_SMPL_EMSPAP_VLM,0) AS PRCHS_TOT_VLM
			, NVL(CM.PRCHS_SORT_TRST_AMT, 0) + NVL(CM.PRCHS_SPMT_TRST_AMT,0) + NVL(CM.PRCHS_SMPL_TRST_AMT,0)
				 + NVL(CM.PRCHS_SORT_EMSPAP_AMT,0) + NVL(CM.PRCHS_SMPL_EMSPAP_AMT,0) AS PRCHS_TOT_AMT

			/*매출*/
			/* 매출 수탁 */
			, SLS_CPRTN_TRST_VLM
			, SLS_CPRTN_TRST_AMT
			, SLS_CPRTN_SORT_TRST_VLM
			, SLS_CPRTN_SORT_TRST_AMT
			, SLS_SMPL_TRST_VLM
			, SLS_SMPL_TRST_AMT

			, NVL(CM.SLS_CPRTN_TRST_VLM, 0) + NVL(CM.SLS_CPRTN_SORT_TRST_VLM,0) + NVL(CM.SLS_SMPL_TRST_VLM,0) AS SLS_TRST_VLM
			, NVL(CM.SLS_CPRTN_TRST_AMT, 0) + NVL(CM.SLS_CPRTN_SORT_TRST_AMT,0) + NVL(CM.SLS_SMPL_TRST_AMT,0) AS SLS_TRST_AMT

			/* 매출 매취 */
			, CM.SLS_CPRTN_SORT_EMSPAP_VLM
			, CM.SLS_CPRTN_SORT_EMSPAP_AMT
			, CM.SLS_SMPL_EMSPAP_VLM
			, CM.SLS_SMPL_EMSPAP_AMT

			, NVL(CM.SLS_CPRTN_SORT_EMSPAP_VLM, 0) + NVL(CM.SLS_SMPL_EMSPAP_VLM,0) AS SLS_EMSPAP_VLM
			, NVL(CM.SLS_CPRTN_SORT_EMSPAP_AMT, 0) + NVL(CM.SLS_SMPL_EMSPAP_AMT,0) AS SLS_EMSPAP_AMT

			, CM.DDC_VLM
			, CM.DDC_AMT

			/* 매출 합계 */
			, NVL(CM.SLS_CPRTN_TRST_VLM, 0) + NVL(CM.SLS_CPRTN_SORT_TRST_VLM,0) + NVL(CM.SLS_SMPL_TRST_VLM,0)
				 + NVL(CM.SLS_CPRTN_SORT_EMSPAP_VLM,0) + NVL(CM.SLS_SMPL_EMSPAP_VLM,0) AS SLS_TOT_VLM
			, NVL(CM.SLS_CPRTN_TRST_AMT, 0) + NVL(CM.SLS_CPRTN_SORT_TRST_AMT,0) + NVL(CM.SLS_SMPL_TRST_AMT,0)
				 + NVL(CM.SLS_CPRTN_SORT_EMSPAP_AMT,0) + NVL(CM.SLS_SMPL_EMSPAP_AMT,0) AS SLS_TOT_AMT

			/*공제*/
			, DDC_EXPRT_VLM
			, DDC_EXPRT_AMT
			, DDC_VLM
			, DDC_AMT
			, DDC_ARMY_DLVGDS_VLM
			, DDC_ARMY_DLVGDS_AMT
			, DDC_MLSR_VLM
			, DDC_MLSR_AMT

			, NVL(DDC_EXPRT_VLM , 0)
				+ NVL(DDC_VLM , 0)
				+ NVL(DDC_ARMY_DLVGDS_VLM , 0)
				+ NVL(DDC_MLSR_VLM , 0)
			AS DDC_VLM_TOT
			, NVL(DDC_EXPRT_AMT , 0)
				+ NVL(DDC_AMT , 0)
				+ NVL(DDC_ARMY_DLVGDS_AMT , 0)
				+ NVL(DDC_MLSR_AMT , 0)
			AS DDC_AMT_TOT

			, SPMT_PRFMNC_VLM
			, SPMT_PRFMNC_AMT
			, SMPL_INPT_VLM
			, SMPL_INPT_AMT

			, AJMT_VLM
			, AJMT_AMT

			/* 총 실적 */
			, TOT_TRMT_PRFMNC_VLM
			, TOT_TRMT_PRFMNC_AMT
			, TOT_SPMT_PRFMNC_VLM
			, TOT_SPMT_PRFMNC_AMT

		FROM TB_EV_UO_ISO_ALL_PRCHS_SLS CM
		WHERE APO_SE ='2'
		  AND YR = #{yr}
		  AND BRNO NOT IN (SELECT BRNO
								FROM TB_COM_USER
								WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61','beop01','beop02')
								)
		  AND ITEM_CD = (SELECT ITEM_CD
							FROM TB_EV_APO_YR_GPC_CD
							WHERE APO_SE = '2'
							  AND BRNO = CM.BRNO
							  AND YR = CM.YR
							  AND ITEM_CD = CM.ITEM_CD
							  AND STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE
							  )
		ORDER BY BRNO , PRCHS_SLS_SE , STTG_UPBR_ITEM_SE , ITEM_CD
	</select>

	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngNew	-->
	<!-- DESC : 출자출하조직 총 매입매출                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.09  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMngNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		<![CDATA[
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngNew */
				  CM.YR
				, CM.APO_CD
				, CM.APO_SE
				, CM.BRNO
				, CM.CRNO
				, CM.CTGRY_CD
				, CM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = CM.ITEM_CD) AS ITEM_NM

				, CM.PRCHS_SLS_SE

				/*매입*/
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, CM.PRCHS_SORT_TRST_VLM
				, CM.PRCHS_SORT_TRST_AMT
				, CM.PRCHS_SPMT_TRST_VLM
				, CM.PRCHS_SPMT_TRST_AMT
				, CM.PRCHS_SMPL_TRST_VLM
				, CM.PRCHS_SMPL_TRST_AMT
				, CM.PRCHS_SORT_EMSPAP_VLM
				, CM.PRCHS_SORT_EMSPAP_AMT
				, CM.PRCHS_SMPL_EMSPAP_VLM
				, CM.PRCHS_SMPL_EMSPAP_AMT

				/*매출*/
				, CM.SLS_CPRTN_SORT_TRST_VLM
				, CM.SLS_CPRTN_SORT_TRST_AMT
				, CM.SLS_CPRTN_TRST_VLM
				, CM.SLS_CPRTN_TRST_AMT
				, CM.SLS_CPRTN_SORT_EMSPAP_VLM
				, CM.SLS_CPRTN_SORT_EMSPAP_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT


				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, CM.AJMT_VLM
				, CM.AJMT_AMT

				, CM.RMRK

				, CM.DEL_YN		AS DEL_YN
				, CM.SYS_FRST_INPT_DT		AS SYS_FRST_INPT_DT
				, TO_CHAR(CM.SYS_FRST_INPT_DT,'YYYY-MM-DD')		AS SYS_FRST_INPT_DT_YMD
				, CM.SYS_FRST_INPT_USER_ID	AS SYS_FRST_INPT_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_FRST_INPT_USER_ID) AS SYS_FRST_INPT_USER_ID_NM
				, CM.SYS_FRST_INPT_PRGRM_ID	AS SYS_FRST_INPT_PRGRM_ID
				, CM.SYS_LAST_CHG_DT		AS SYS_LAST_CHG_DT
				, TO_CHAR(CM.SYS_LAST_CHG_DT,'YYYY-MM-DD')		AS SYS_LAST_CHG_DT_YMD
				, CM.SYS_LAST_CHG_USER_ID	AS SYS_LAST_CHG_USER_ID
				, (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = CM.SYS_LAST_CHG_USER_ID) AS SYS_LAST_CHG_USER_ID_NM
				, CM.SYS_LAST_CHG_PRGRM_ID	AS SYS_LAST_CHG_PRGRM_ID
			  FROM TB_EV_UO_ISO_ALL_PRCHS_SLS CM
			 WHERE 1=1

		]]>
			<if test='apoCd != null and apoCd != ""'>
				AND CM.APO_CD = #{apoCd}
			</if>
			<if test='apoSe != null and apoSe != ""'>
				AND CM.APO_SE = #{apoSe}
			</if>
		ORDER BY CM.ITEM_CD DESC
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngPrchsListNew	-->
	<!-- DESC : 총매입매출 매입 리스트.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.16  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMngPrchsListNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngPrchsListNew */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = ITEM.CTGRY_CD) AS CTGRY_NM
				, ITEM.CLSF_CD
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CLSF_CD' AND CD_VL = ITEM.CLSF_CD) AS CLSF_NM
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, (SELECT APO_CD FROM TB_EV_APO WHERE BRNO = ITEM.BRNO)AS APO_CD
				, ITEM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, (SELECT CRNO FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CRNO

				, '1' AS PRCHS_SLS_SE
				/*수탁*/
				, DECODE(ITEM.STTG_UPBR_ITEM_SE, '3', CM.PRCHS_SORT_TRST_VLM, TOTA.PRCHS_SORT_TRST_VLM) AS PRCHS_SORT_TRST_VLM
				, DECODE(ITEM.STTG_UPBR_ITEM_SE, '3', CM.PRCHS_SORT_TRST_AMT, TOTA.PRCHS_SORT_TRST_AMT) AS PRCHS_SORT_TRST_AMT
				, DECODE(ITEM.STTG_UPBR_ITEM_SE, '3', CM.PRCHS_SPMT_TRST_VLM, TOTA.PRCHS_SPMT_TRST_VLM) AS PRCHS_SPMT_TRST_VLM
				, DECODE(ITEM.STTG_UPBR_ITEM_SE, '3', CM.PRCHS_SPMT_TRST_AMT, TOTA.PRCHS_SPMT_TRST_AMT) AS PRCHS_SPMT_TRST_AMT
				, CM.PRCHS_SMPL_TRST_VLM
				, CM.PRCHS_SMPL_TRST_AMT
				, CM.PRCHS_TRST_VLM
				, CM.PRCHS_TRST_AMT
				/*매취*/
				, DECODE(ITEM.STTG_UPBR_ITEM_SE, '3', CM.PRCHS_SORT_EMSPAP_VLM, TOTA.PRCHS_SORT_EMSPAP_VLM) AS PRCHS_SORT_EMSPAP_VLM
				, DECODE(ITEM.STTG_UPBR_ITEM_SE, '3', CM.PRCHS_SORT_EMSPAP_AMT, TOTA.PRCHS_SORT_EMSPAP_AMT) AS PRCHS_SORT_EMSPAP_AMT
				, CM.PRCHS_SMPL_EMSPAP_VLM
				, CM.PRCHS_SMPL_EMSPAP_AMT
				, CM.PRCHS_EMSPAP_VLM
				, CM.PRCHS_EMSPAP_AMT

				, DECODE(ITEM.STTG_UPBR_ITEM_SE
							, '3', NVL(CM.PRCHS_SORT_TRST_VLM,0)
									+ NVL(CM.PRCHS_SPMT_TRST_VLM,0)
									+ NVL(CM.PRCHS_SMPL_TRST_VLM,0)
									+ NVL(CM.PRCHS_SORT_EMSPAP_VLM,0)
									+ NVL(CM.PRCHS_SMPL_EMSPAP_VLM,0)
							, NVL( NVL(TOTA.PRCHS_TOT_VLM,0) + NVL(TOTB.PRCHS_TOT_VLM,0), 0)
				) AS PRCHS_TOT_VLM
				, DECODE(ITEM.STTG_UPBR_ITEM_SE
							, '3', NVL(CM.PRCHS_SORT_TRST_AMT,0)
									+ NVL(CM.PRCHS_SPMT_TRST_AMT,0)
									+ NVL(CM.PRCHS_SMPL_TRST_AMT,0)
									+ NVL(CM.PRCHS_SORT_EMSPAP_AMT,0)
									+ NVL(CM.PRCHS_SMPL_EMSPAP_AMT,0)
							, NVL( NVL(TOTA.PRCHS_TOT_AMT,0) + NVL(TOTB.PRCHS_TOT_AMT,0), 0)
				) AS PRCHS_TOT_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

			FROM
				(SELECT
						YGC.YR
						,YGC.BRNO
						,YGC.APO_SE
						,NVL(YGC.UO_BRNO,'0') AS UO_BRNO
						,YGC.ITEM_CD
						,DECODE(STTG_UPBR_ITEM_SE
									, '3' , CTGRY_CD
									, (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = YGC.YR AND BRNO = YGC.UO_BRNO AND ITEM_CD = YGC.ITEM_CD)
						) AS CTGRY_CD
						,DECODE(STTG_UPBR_ITEM_SE
									, '3' , CLSF_CD
									, (SELECT CLSF_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = YGC.YR AND BRNO = YGC.UO_BRNO AND ITEM_CD = YGC.ITEM_CD)
						) AS CLSF_CD
						,DECODE(STTG_UPBR_ITEM_SE
									, '3' , STTG_UPBR_ITEM_SE
									, (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = YGC.YR AND BRNO = YGC.UO_BRNO AND ITEM_CD = YGC.ITEM_CD)
						) AS STTG_UPBR_ITEM_SE
					FROM TB_EV_APO_YR_GPC_CD YGC
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
					WHERE 1=1
					  AND DEL_YN = 'N'
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '1'
					  AND ITEM_CD IN (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = APS.YR AND BRNO = APS.BRNO)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , TYPE_SE_NO , ITEM_CD
						, SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
						, SUM( NVL( SLS_CNSGN_PRCHS_VLM , 0 ) ) AS PRCHS_TOT_VLM

						, SUM( DECODE(PST.TRMT_TYPE , '2' ,  SLS_CNSGN_PRCHS_VLM , 0 ) ) AS PRCHS_SORT_TRST_VLM
						, SUM( DECODE(PST.TRMT_TYPE , '2' ,  SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_SORT_TRST_AMT
						, SUM( DECODE(PST.TRMT_TYPE , '1' ,  SLS_CNSGN_PRCHS_VLM , 0 ) ) AS PRCHS_SPMT_TRST_VLM
						, SUM( DECODE(PST.TRMT_TYPE , '1' ,  SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_SPMT_TRST_AMT
						, SUM( DECODE(PST.TRMT_TYPE , '3' ,  SLS_CNSGN_PRCHS_VLM , 0 ) ) AS PRCHS_SORT_EMSPAP_VLM
						, SUM( DECODE(PST.TRMT_TYPE , '3' ,  SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_SORT_EMSPAP_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
					WHERE 1=1
					  AND DEL_YN = 'N'
					  AND APO_SE = '2'
					  AND TYPE_SE_NO = '5'
					  AND NVL(TMPR_STRG_YN,'N') = 'N'
					  AND CTGRY_CD IS NULL
					  AND CLTVTN_LAND_SN IS NULL
					  AND ITEM_CD IN (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PST.YR AND BRNO = PST.BRNO AND STTG_UPBR_ITEM_SE != '3' AND UO_BRNO = PST.UO_BRNO)
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND NVL(EXCL_YN,'N') != 'Y'
												  AND ITEM_CD = PST.ITEM_CD
												  AND BRNO = PST.BRNO
												  AND UO_BRNO = PST.UO_BRNO
												  AND YR = PST.YR
												  AND STBLT_YN = PST.OGNZ_STBLT_YN
												  AND TRMT_TYPE = PST.TRMT_TYPE
					  						)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD , TYPE_SE_NO
				) TOTA ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD
						, SUM( NVL( SLS_CNSGN_PRCHS_VLM , 0 ) ) AS PRCHS_TOT_VLM
						, SUM( NVL( SLS_CNSGN_PRCHS_AMT , 0 ) ) AS PRCHS_TOT_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
					WHERE 1=1
					  AND DEL_YN = 'N'
					  AND APO_SE = '2'
					  AND TYPE_SE_NO = '7'
					  AND NVL(TMPR_STRG_YN,'N') = 'N'
					  AND CTGRY_CD IS NULL
					  AND CLTVTN_LAND_SN IS NULL
					  AND ITEM_CD IN (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PST.YR AND BRNO = PST.BRNO AND STTG_UPBR_ITEM_SE != '3')
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTB
			 WHERE 1=1
			   AND ITEM.BRNO 	= CM.BRNO(+)
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.BRNO 	= TOTA.BRNO(+)
			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.BRNO 	= TOTB.BRNO(+)
			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngSlsListNew	-->
	<!-- DESC : 총매입매출 매출 리스트.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.16  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvShipOgnPurSalMngSlsListNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT * FROM
		(
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectInvShipOgnPurSalMngSlsListNew */
				ITEM.YR
				, ITEM.ITEM_CD
				, (SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				, ITEM.CTGRY_CD
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = ITEM.CTGRY_CD) AS CTGRY_NM
				, ITEM.CLSF_CD
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CLSF_CD' AND CD_VL = ITEM.CLSF_CD) AS CLSF_NM
				, ITEM.STTG_UPBR_ITEM_SE
				, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM

				, CM.APO_CD
				, CM.APO_SE
				, ITEM.BRNO
				, ITEM.UO_BRNO
				, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS CORP_NM
				, CM.CRNO

				, '2' AS PRCHS_SLS_SE

				/*매출*/
				, NVL(TOTA.SLS_CPRTN_SORT_TRST_VLM ,0) AS SLS_CPRTN_SORT_TRST_VLM
				, NVL(TOTA.SLS_CPRTN_SORT_TRST_AMT ,0) AS SLS_CPRTN_SORT_TRST_AMT
				, NVL(TOTA.SLS_CPRTN_TRST_VLM ,0) AS SLS_CPRTN_TRST_VLM
				, NVL(TOTA.SLS_CPRTN_TRST_AMT ,0) AS SLS_CPRTN_TRST_AMT
				, NVL(TOTA.SLS_CPRTN_SORT_EMSPAP_VLM ,0) AS SLS_CPRTN_SORT_EMSPAP_VLM
				, NVL(TOTA.SLS_CPRTN_SORT_EMSPAP_AMT ,0) AS SLS_CPRTN_SORT_EMSPAP_AMT

				, NVL(TOTA.SLS_CPRTN_TOT_VLM ,0) AS SLS_CPRTN_TOT_VLM
				, NVL(TOTA.SLS_CPRTN_TOT_AMT ,0) AS SLS_CPRTN_TOT_AMT

				, CM.SLS_SMPL_TRST_VLM
				, CM.SLS_SMPL_TRST_AMT
				, CM.SLS_SMPL_EMSPAP_VLM
				, CM.SLS_SMPL_EMSPAP_AMT

				, CM.SLS_EMSPAP_VLM
				, CM.SLS_EMSPAP_AMT
				, CM.SLS_TRST_VLM
				, CM.SLS_TRST_AMT

				/*공제*/
				, CM.DDC_EXPRT_VLM
				, CM.DDC_EXPRT_AMT
				, CM.DDC_VLM
				, CM.DDC_AMT
				, CM.DDC_ARMY_DLVGDS_VLM
				, CM.DDC_ARMY_DLVGDS_AMT
				, CM.DDC_MLSR_VLM
				, CM.DDC_MLSR_AMT

				, CM.SPMT_PRFMNC_VLM
				, CM.SPMT_PRFMNC_AMT
				, CM.SMPL_INPT_VLM
				, CM.SMPL_INPT_AMT

				, NVL(TOTA.SLS_TOT_VLM,0) + NVL(TOTB.SLS_TOT_VLM,0) AS AJMT_VLM
				, NVL(TOTA.SLS_TOT_AMT,0) + NVL(TOTB.SLS_TOT_AMT,0) AS AJMT_AMT

				/* 총 실적 */
				, CM.TOT_TRMT_PRFMNC_VLM
				, CM.TOT_TRMT_PRFMNC_AMT

				, DECODE(ITEM.STTG_UPBR_ITEM_SE
							, '3' , CM.TOT_SPMT_PRFMNC_VLM
							,NVL(TOTA.SLS_CPRTN_TOT_VLM,0) + NVL(TOTB.SLS_CPRTN_TOT_VLM,0)
				) AS TOT_SPMT_PRFMNC_VLM
				, DECODE(ITEM.STTG_UPBR_ITEM_SE
							, '3' , CM.TOT_SPMT_PRFMNC_AMT
							,NVL(TOTA.SLS_CPRTN_TOT_AMT,0) + NVL(TOTB.SLS_CPRTN_TOT_AMT,0)
				) AS TOT_SPMT_PRFMNC_AMT

				, CM.RMRK

				, 'N' AS DEL_YN

			FROM
				(SELECT
						YGC.YR
						,YGC.BRNO
						,YGC.APO_SE
						,NVL(YGC.UO_BRNO,'0') AS UO_BRNO
						,YGC.ITEM_CD
						,DECODE(STTG_UPBR_ITEM_SE
									, '3' , CTGRY_CD
									, (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = YGC.YR AND BRNO = YGC.UO_BRNO AND ITEM_CD = YGC.ITEM_CD)
						) AS CTGRY_CD
						,DECODE(STTG_UPBR_ITEM_SE
									, '3' , CLSF_CD
									, (SELECT CLSF_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = YGC.YR AND BRNO = YGC.UO_BRNO AND ITEM_CD = YGC.ITEM_CD)
						) AS CLSF_CD
						,DECODE(STTG_UPBR_ITEM_SE
									, '3' , STTG_UPBR_ITEM_SE
									, (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = YGC.YR AND BRNO = YGC.UO_BRNO AND ITEM_CD = YGC.ITEM_CD)
						) AS STTG_UPBR_ITEM_SE
					FROM TB_EV_APO_YR_GPC_CD YGC
					WHERE 1=1
					  AND APO_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) ITEM ,
				(SELECT *
					FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
					WHERE 1=1
					  AND APO_SE = '2'
					  AND PRCHS_SLS_SE = '2'
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
				) CM ,
				(SELECT YR , BRNO , UO_BRNO , TYPE_SE_NO , ITEM_CD
						, SUM( NVL( UO_SPMT_VLM , 0 ) + NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS SLS_TOT_VLM
						, SUM( NVL( UO_SPMT_AMT , 0 ) + NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS SLS_TOT_AMT

						, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS SLS_CPRTN_TOT_VLM
						, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS SLS_CPRTN_TOT_AMT

						, SUM( DECODE(PST.TRMT_TYPE , '2' ,  UO_SPMT_VLM , 0 ) ) AS SLS_CPRTN_SORT_TRST_VLM
						, SUM( DECODE(PST.TRMT_TYPE , '2' ,  UO_SPMT_AMT , 0 ) ) AS SLS_CPRTN_SORT_TRST_AMT
						, SUM( DECODE(PST.TRMT_TYPE , '1' ,  UO_SPMT_VLM , 0 ) ) AS SLS_CPRTN_TRST_VLM
						, SUM( DECODE(PST.TRMT_TYPE , '1' ,  UO_SPMT_AMT , 0 ) ) AS SLS_CPRTN_TRST_AMT
						, SUM( DECODE(PST.TRMT_TYPE , '3' ,  UO_SPMT_VLM , 0 ) ) AS SLS_CPRTN_SORT_EMSPAP_VLM
						, SUM( DECODE(PST.TRMT_TYPE , '3' ,  UO_SPMT_AMT , 0 ) ) AS SLS_CPRTN_SORT_EMSPAP_AMT
					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
					WHERE 1=1
					  AND DEL_YN = 'N'
					  AND APO_SE = '2'
					  AND TYPE_SE_NO = '5'
					  AND NVL(TMPR_STRG_YN,'N') = 'N'
					  AND CTGRY_CD IS NULL
					  AND CLTVTN_LAND_SN IS NULL
					  AND ITEM_CD IN (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PST.YR AND BRNO = PST.BRNO AND STTG_UPBR_ITEM_SE != '3')
					  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
												FROM TB_EV_FRMHS_APO
												WHERE 1=1
												  AND APO_SE = '2'
												  AND NVL(EXCL_YN,'N') != 'Y'
												  AND ITEM_CD = PST.ITEM_CD
												  AND BRNO = PST.BRNO
												  AND UO_BRNO = PST.UO_BRNO
												  AND YR = PST.YR
												  AND TRMT_TYPE = PST.TRMT_TYPE
					  						)
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD , TYPE_SE_NO
				) TOTA ,
				(SELECT YR , BRNO , UO_BRNO , ITEM_CD
						, SUM( NVL( UO_SPMT_VLM , 0 ) + NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS SLS_TOT_VLM
						, SUM( NVL( UO_SPMT_AMT , 0 ) + NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS SLS_TOT_AMT

						, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS SLS_CPRTN_TOT_VLM
						, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS SLS_CPRTN_TOT_AMT

					FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
					WHERE 1=1
					  AND DEL_YN = 'N'
					  AND APO_SE = '2'
					  AND TYPE_SE_NO = '7'
					  AND NVL(TMPR_STRG_YN,'N') = 'N'
					  AND CTGRY_CD IS NULL
					  AND CLTVTN_LAND_SN IS NULL
					  AND ITEM_CD IN (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PST.YR AND BRNO = PST.BRNO AND STTG_UPBR_ITEM_SE != '3')
					<if test='brno != null and brno != ""'>
					  AND BRNO = #{brno}
					</if>
					<if test='yr != null and yr != ""'>
					  AND YR = #{yr}
					</if>
					  GROUP BY  YR , BRNO , UO_BRNO , ITEM_CD
				) TOTB
			 WHERE 1=1
			   AND ITEM.ITEM_CD = CM.ITEM_CD(+)
			   AND ITEM.BRNO = CM.BRNO(+)
			   AND ITEM.UO_BRNO = CM.UO_BRNO(+)
			   AND ITEM.STTG_UPBR_ITEM_SE = CM.STTG_UPBR_ITEM_SE(+)

			   AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)

			   AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
			   AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)
		)
		ORDER BY STTG_UPBR_ITEM_SE , ITEM_CD , UO_BRNO DESC
	</select>

	<!-- 출자출하조직 총매입매출 임시저장 처리 -->
	<update id="updateTempSaveIsoAps" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		UPDATE /* com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngMapper.updateTempSaveIsoAps */
			TB_EV_UO_ISO_ALL_PRCHS_SLS APS
		   SET
			<if test='tmprStrgYn == "Y"'>
				TMPR_STRG_YN	= 'Y'
				, TMPR_STRG_RSN	= ''
				, TMPR_STRG_DT	= SYSDATE
			</if>
			<if test='tmprStrgYn != "Y"'>
				TMPR_STRG_YN	= 'N'
				, TMPR_STRG_RSN	= ''
			</if>
		WHERE 1=1
		  AND APO_SE = '2'
		  AND YR = #{yr}
		  AND BRNO = #{brno}
	</update>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngMapper.selectTempSaveIsoAps	-->
	<!-- DESC : 임시저장 조회                                            					-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.01.20  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTempSaveIsoAps" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		SELECT	/* com.at.apcss.pd.isom.vo.InvShipOgnSpeczItmPurSalMngMapper.selectTempSaveIsoAps */
			TMPR_STRG_YN
			,TMPR_STRG_RSN
			,TMPR_STRG_DT
		FROM TB_EV_UO_ISO_ALL_PRCHS_SLS
		WHERE 1=1
		  AND DEL_YN = 'N'
		  AND APO_SE = '2'
		  AND ROWNUM = 1
		  AND YR = #{yr}
		  AND BRNO = #{brno}
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectIsoTotalPurchaseSaleRawDataList	-->
	<!-- DESC : 출자출하조직 총 매입매출 rawdata 목록 조회                               -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.02.18  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectIsoTotalPurchaseSaleRawDataList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
    	<![CDATA[
			SELECT  /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectIsoTotalPurchaseSaleRawDataList */
				  APO.YR		AS YR
				, APO.BRNO		AS BRNO
				, APO.CORP_NM	AS CORP_NM
				, PS.UO_BRNO	AS UO_BRNO
				, CASE
				    WHEN PS.UO_BRNO = '0' THEN NULL
				    ELSE UO.CORP_NM
				  END			AS UO_CORP_NM
				, UO.APRV		AS APRV
				, (SELECT FN_GET_COM_CD_VL_NM('APRV_UPBR_SE_CD', UO.APRV) FROM DUAL) AS APRV_NM
				, PS.PRCHS_SLS_SE	AS PRCHS_SLS_SE
				, (SELECT FN_GET_COM_CD_VL_NM('PRCHS_SLS_SE', PS.PRCHS_SLS_SE) FROM DUAL) AS PRCHS_SLS_SE_NM
				, PS.ITEM_CD		AS ITEM_CD
				, ITM.ITEM_NM		AS ITEM_NM
				, ITM.CTGRY_CD		AS CTGRY_CD
				, (SELECT FN_GET_COM_CD_VL_NM('CTGRY_CD', ITM.CTGRY_CD) FROM DUAL) AS CTGRY_NM
				, PS.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
				, (SELECT FN_GET_COM_CD_VL_NM('STTG_UPBR_ITEM_SE', PS.STTG_UPBR_ITEM_SE) FROM DUAL) AS STTG_UPBR_ITEM_NM

				/* 매입 */
				/* 매입-수탁 */
				, PS.PRCHS_SORT_TRST_VLM	AS PRCHS_SORT_TRST_VLM
				, PS.PRCHS_SORT_TRST_AMT	AS PRCHS_SORT_TRST_AMT
				, PS.PRCHS_SPMT_TRST_VLM	AS PRCHS_SPMT_TRST_VLM
				, PS.PRCHS_SPMT_TRST_AMT	AS PRCHS_SPMT_TRST_AMT
				, PS.PRCHS_SMPL_TRST_VLM	AS PRCHS_SMPL_TRST_VLM
				, PS.PRCHS_SMPL_TRST_AMT	AS PRCHS_SMPL_TRST_AMT
			 	, NVL(PS.PRCHS_SORT_TRST_VLM, 0)
					+ NVL(PS.PRCHS_SPMT_TRST_VLM, 0)
					+ NVL(PS.PRCHS_SMPL_TRST_VLM, 0)	AS PRCHS_TRST_VLM
			 	, NVL(PS.PRCHS_SORT_TRST_AMT, 0)
					+ NVL(PS.PRCHS_SPMT_TRST_AMT, 0)
					+ NVL(PS.PRCHS_SMPL_TRST_AMT, 0)	AS PRCHS_TRST_AMT
			 	, CASE
					WHEN APO.YR < '2025' THEN NVL(PS.PRCHS_TRST_VLM, 0)
					ELSE
						   NVL(PS.PRCHS_SORT_TRST_VLM, 0)
						   + NVL(PS.PRCHS_SPMT_TRST_VLM, 0)
						   + NVL(PS.PRCHS_SMPL_TRST_VLM, 0)
			  	END			AS PRCHS_TRST_VLM
			 	, CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.PRCHS_TRST_AMT, 0)
					   ELSE
							NVL(PS.PRCHS_SORT_TRST_AMT, 0)
							+ NVL(PS.PRCHS_SPMT_TRST_AMT, 0)
							+ NVL(PS.PRCHS_SMPL_TRST_AMT, 0)
				END			AS PRCHS_TRST_AMT

				/* 매입-매취 */
				 , PS.PRCHS_SORT_EMSPAP_VLM	AS PRCHS_SORT_EMSPAP_VLM
				 , PS.PRCHS_SORT_EMSPAP_AMT	AS PRCHS_SORT_EMSPAP_AMT
				 , PS.PRCHS_SMPL_EMSPAP_VLM	AS PRCHS_SMPL_EMSPAP_VLM
				 , PS.PRCHS_SMPL_EMSPAP_AMT	AS PRCHS_SMPL_EMSPAP_AMT
				 , NVL(PS.PRCHS_SORT_EMSPAP_VLM, 0) + NVL(PS.PRCHS_SMPL_EMSPAP_VLM, 0)	AS PRCHS_EMSPAP_VLM
				 , NVL(PS.PRCHS_SORT_EMSPAP_AMT, 0) + NVL(PS.PRCHS_SMPL_EMSPAP_AMT, 0)	AS PRCHS_EMSPAP_AMT
				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.PRCHS_EMSPAP_VLM, 0)
					   ELSE
							   NVL(PS.PRCHS_SORT_EMSPAP_VLM, 0)
							   + NVL(PS.PRCHS_SMPL_EMSPAP_VLM, 0)
				END			AS PRCHS_EMSPAP_VLM
				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.PRCHS_EMSPAP_AMT, 0)
					   ELSE
							   NVL(PS.PRCHS_SORT_EMSPAP_AMT, 0)
							   + NVL(PS.PRCHS_SMPL_EMSPAP_AMT, 0)
				END			AS PRCHS_EMSPAP_AMT

				/* 매입-합계 */
				 , NVL(PS.PRCHS_SORT_TRST_VLM, 0)
				+ NVL(PS.PRCHS_SPMT_TRST_VLM, 0)
				+ NVL(PS.PRCHS_SMPL_TRST_VLM, 0)
				+ NVL(PS.PRCHS_SORT_EMSPAP_VLM, 0)
				+ NVL(PS.PRCHS_SMPL_EMSPAP_VLM, 0)	AS PRCHS_TOT_VLM
				 , NVL(PS.PRCHS_SORT_TRST_AMT, 0)
				+ NVL(PS.PRCHS_SPMT_TRST_AMT, 0)
				+ NVL(PS.PRCHS_SMPL_TRST_AMT, 0)
				+ NVL(PS.PRCHS_SORT_EMSPAP_AMT, 0)
				+ NVL(PS.PRCHS_SMPL_EMSPAP_AMT, 0)	AS PRCHS_TOT_AMT
				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.PRCHS_TRST_VLM, 0) + NVL(PS.PRCHS_EMSPAP_VLM, 0)
					   ELSE
							   NVL(PS.PRCHS_SORT_TRST_VLM, 0)
							   + NVL(PS.PRCHS_SPMT_TRST_VLM, 0)
							   + NVL(PS.PRCHS_SMPL_TRST_VLM, 0)
							   + NVL(PS.PRCHS_SORT_EMSPAP_VLM, 0)
							   + NVL(PS.PRCHS_SMPL_EMSPAP_VLM, 0)
				END			AS PRCHS_TOT_VLM
				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.PRCHS_TRST_AMT, 0) + NVL(PS.PRCHS_EMSPAP_AMT, 0)
					   ELSE
							   NVL(PS.PRCHS_SORT_TRST_AMT, 0)
							   + NVL(PS.PRCHS_SPMT_TRST_AMT, 0)
							   + NVL(PS.PRCHS_SMPL_TRST_AMT, 0)
							   + NVL(PS.PRCHS_SORT_EMSPAP_AMT, 0)
							   + NVL(PS.PRCHS_SMPL_EMSPAP_AMT, 0)
				END			AS PRCHS_TOT_AMT


				/* 매출 */
				/* 매출-수탁 */
				 , PS.SLS_CPRTN_TRST_VLM			AS SLS_CPRTN_TRST_VLM
				 , PS.SLS_CPRTN_TRST_AMT			AS SLS_CPRTN_TRST_AMT
				 , PS.SLS_CPRTN_SORT_TRST_VLM	AS SLS_CPRTN_SORT_TRST_VLM
				 , PS.SLS_CPRTN_SORT_TRST_AMT	AS SLS_CPRTN_SORT_TRST_AMT
				 , PS.SLS_SMPL_TRST_VLM			AS SLS_SMPL_TRST_VLM
				 , PS.SLS_SMPL_TRST_AMT			AS SLS_SMPL_TRST_AMT

				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.SLS_TRST_VLM, 0)
					   ELSE
							   NVL(PS.SLS_CPRTN_TRST_VLM, 0)
							   + NVL(PS.SLS_CPRTN_SORT_TRST_VLM, 0)
							   + NVL(PS.SLS_SMPL_TRST_VLM, 0)
				END			AS SLS_TRST_VLM
				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.SLS_TRST_AMT, 0)
					   ELSE
							   NVL(PS.SLS_CPRTN_TRST_AMT, 0)
							   + NVL(PS.SLS_CPRTN_SORT_TRST_AMT, 0)
							   + NVL(PS.SLS_SMPL_TRST_AMT, 0)
				END			AS SLS_TRST_AMT

				/* 매출-매취 */
				 , PS.SLS_CPRTN_SORT_EMSPAP_VLM	AS SLS_CPRTN_SORT_EMSPAP_VLM
				 , PS.SLS_CPRTN_SORT_EMSPAP_AMT	AS SLS_CPRTN_SORT_EMSPAP_AMT
				 , PS.SLS_SMPL_EMSPAP_VLM		AS SLS_SMPL_EMSPAP_VLM
				 , PS.SLS_SMPL_EMSPAP_AMT		AS SLS_SMPL_EMSPAP_AMT

				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.SLS_EMSPAP_VLM, 0)
					   ELSE
							   NVL(PS.SLS_CPRTN_SORT_EMSPAP_VLM, 0)
							   + NVL(PS.SLS_SMPL_EMSPAP_VLM, 0)
				END			AS SLS_EMSPAP_VLM
				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.SLS_EMSPAP_AMT, 0)
					   ELSE
							   NVL(PS.SLS_CPRTN_SORT_EMSPAP_AMT, 0)
							   + NVL(PS.SLS_SMPL_EMSPAP_AMT, 0)
				END			AS SLS_EMSPAP_AMT


				 , PS.DDC_VLM	AS DDC_VLM
				 , PS.DDC_AMT	AS DDC_AMT

				/* 매출-합계 */
				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.SLS_EMSPAP_VLM, 0) + NVL(PS.SLS_TRST_VLM, 0)
					   ELSE
							   NVL(PS.SLS_CPRTN_TRST_VLM, 0)
							   + NVL(PS.SLS_CPRTN_SORT_TRST_VLM, 0)
							   + NVL(PS.SLS_SMPL_TRST_VLM, 0)
							   + NVL(PS.SLS_CPRTN_SORT_EMSPAP_VLM, 0)
							   + NVL(PS.SLS_SMPL_EMSPAP_VLM, 0)
				END			AS SLS_TOT_VLM
				 , CASE
					   WHEN APO.YR < '2025' THEN NVL(PS.SLS_EMSPAP_AMT, 0) + NVL(PS.SLS_TRST_AMT, 0)
					   ELSE
							   NVL(PS.SLS_CPRTN_TRST_AMT, 0)
							   + NVL(PS.SLS_CPRTN_SORT_TRST_AMT, 0)
							   + NVL(PS.SLS_SMPL_TRST_AMT, 0)
							   + NVL(PS.SLS_CPRTN_SORT_EMSPAP_AMT, 0)
							   + NVL(PS.SLS_SMPL_EMSPAP_AMT, 0)
				END			AS SLS_TOT_AMT


				/* 공제 */
				 , PS.DDC_EXPRT_VLM			AS DDC_EXPRT_VLM
				 , PS.DDC_EXPRT_AMT			AS DDC_EXPRT_AMT
				 , PS.DDC_VLM				AS DDC_VLM
				 , PS.DDC_AMT				AS DDC_AMT
				 , PS.DDC_ARMY_DLVGDS_VLM	AS DDC_ARMY_DLVGDS_VLM
				 , PS.DDC_ARMY_DLVGDS_AMT	AS DDC_ARMY_DLVGDS_AMT
				 , PS.DDC_MLSR_VLM			AS DDC_MLSR_VLM
				 , PS.DDC_MLSR_AMT			AS DDC_MLSR_AMT

				 , NVL(PS.DDC_EXPRT_VLM, 0)
					+ NVL(PS.DDC_VLM, 0)
					+ NVL(PS.DDC_ARMY_DLVGDS_VLM, 0)
					+ NVL(PS.DDC_MLSR_VLM, 0)	AS DDC_VLM_TOT
				 , NVL(PS.DDC_EXPRT_AMT, 0)
					+ NVL(PS.DDC_AMT, 0)
					+ NVL(PS.DDC_ARMY_DLVGDS_AMT, 0)
					+ NVL(PS.DDC_MLSR_AMT, 0)	AS DDC_AMT_TOT

				 , PS.SPMT_PRFMNC_VLM		AS SPMT_PRFMNC_VLM
				 , PS.SPMT_PRFMNC_AMT		AS SPMT_PRFMNC_AMT
				 , PS.SMPL_INPT_VLM			AS SMPL_INPT_VLM
				 , PS.SMPL_INPT_AMT			AS SMPL_INPT_AMT

				 , PS.AJMT_VLM				AS AJMT_VLM
				 , PS.AJMT_AMT				AS AJMT_AMT

				/* 총 실적 */
				, CASE
				    WHEN PS.TOT_TRMT_PRFMNC_VLM = 0 THEN
				    	NVL(PS.DDC_EXPRT_VLM, 0)
						+ NVL(PS.DDC_VLM, 0)
						+ NVL(PS.DDC_ARMY_DLVGDS_VLM, 0)
						+ NVL(PS.DDC_MLSR_VLM, 0)
				    	+ NVL(PS.AJMT_VLM, 0)
				    ELSE PS.TOT_TRMT_PRFMNC_VLM
				  END	AS TOT_TRMT_PRFMNC_VLM
				, CASE
				    WHEN PS.TOT_TRMT_PRFMNC_AMT = 0 THEN
				    	NVL(PS.DDC_EXPRT_AMT, 0)
						+ NVL(PS.DDC_AMT, 0)
						+ NVL(PS.DDC_ARMY_DLVGDS_AMT, 0)
						+ NVL(PS.DDC_MLSR_AMT, 0)
				    	+ NVL(PS.AJMT_AMT, 0)
				    ELSE PS.TOT_TRMT_PRFMNC_AMT
				  END	AS TOT_TRMT_PRFMNC_AMT
				 /*
			     , PS.TOT_TRMT_PRFMNC_VLM		AS TOT_TRMT_PRFMNC_VLM
				 , PS.TOT_TRMT_PRFMNC_AMT		AS TOT_TRMT_PRFMNC_AMT
				  */
				 , PS.TOT_SPMT_PRFMNC_VLM		AS TOT_SPMT_PRFMNC_VLM
				 , PS.TOT_SPMT_PRFMNC_AMT		AS TOT_SPMT_PRFMNC_AMT

			FROM (
					 SELECT
						 EAM.APO_SE		AS APO_SE
						  , APO.APO_CD		AS APO_CD
						  , APO.CORP_NM	AS CORP_NM
						  , APO.CRNO		AS CRNO
						  , APO.BRNO			AS BRNO
						  , EAM.YR			AS YR
						  , EAM.UO_BRNO		AS UO_BRNO
					 FROM TB_EV_APLY_MNG EAM

					  JOIN TB_EV_APO APO
					   ON APO.BRNO = EAM.BRNO
					   AND APO.DEL_YN = 'N'
					/*
					  JOIN VW_EV_APO_UO_CD UC
					   ON UC.CRTR_YR = EAM.YR
						--		 	AND UC.ISO_APO_CD = EAM.APO_CD
					   AND UC.ISO_BRNO = EAM.BRNO
					*/
					 WHERE EAM.APO_SE = '2'
					   AND EAM.YR = #{yr}
					   AND NOT EXISTS (
						 SELECT 1
						 FROM TB_COM_USER X
						 WHERE X.USER_ID IN (
							 SELECT CD.CD_VL
							 FROM TB_COM_CD_DTL CD
							 WHERE CD.CD_ID = 'SYS_EXCLD_USER_ID'
							   AND CD.USE_YN = 'Y'
							   AND CD.DEL_YN = 'N'
						 )
						   AND X.BRNO IN (EAM.BRNO, EAM.UO_BRNO)
					 )
				 ) APO

				 JOIN TB_EV_UO_ISO_ALL_PRCHS_SLS PS
				  ON PS.YR = APO.YR
				  AND PS.APO_SE = APO.APO_SE
				  AND PS.BRNO = APO.BRNO
				  AND PS.APO_CD = APO.APO_CD
				  AND PS.UO_BRNO IN (APO.UO_BRNO, '0')
				  /* AND PS.UO_BRNO = APO.UO_BRNO */
				  AND PS.DEL_YN = 'N'

			 LEFT JOIN TB_EV_APO UO
			   ON UO.BRNO = APO.UO_BRNO
			   AND UO.DEL_YN = 'N'

			 LEFT JOIN TB_ITEM_CRTR ITM
			   ON ITM.ITEM_CD = PS.ITEM_CD
			   AND ITM.DEL_YN = 'N'
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
			WHERE (
			   		PS.STTG_UPBR_ITEM_SE = '3'
					OR
					(
					    PS.STTG_UPBR_ITEM_SE IN ('1','2')
					    AND EXISTS (
					        	SELECT 1
					        	FROM TB_EV_APO_YR_GPC_CD GC
								WHERE GC.YR = APO.YR
								AND GC.BRNO = APO.UO_BRNO
								AND GC.DEL_YN = 'N'
								AND GC.ITEM_CD = PS.ITEM_CD
							)
					)
			    )
			</when>
			<otherwise>
				JOIN TB_EV_APO_YR_GPC_CD GC
				ON GC.YR = APO.YR
				AND GC.BRNO = APO.BRNO
				AND GC.ITEM_CD = PS.ITEM_CD
				AND PS.CTGRY_CD = GC.CTGRY_CD
				AND PS.STTG_UPBR_ITEM_SE = GC.STTG_UPBR_ITEM_SE
				AND PS.ITEM_CD = GC.ITEM_CD
				AND GC.DEL_YN = 'N'

			WHERE (
					PS.STTG_UPBR_ITEM_SE = '3'
					OR
					(
						PS.STTG_UPBR_ITEM_SE IN ('1','2')
						AND
						GC.UO_BRNO = APO.UO_BRNO
					)
				)
			</otherwise>
		</choose>
		<![CDATA[
			ORDER BY
				BRNO , PRCHS_SLS_SE , STTG_UPBR_ITEM_SE , PS.ITEM_CD
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectIsoTotalPurchaseSaleList	-->
	<!-- DESC : 출자출하조직 총 매입매출 목록 조회                               -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.02.18  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectIsoTotalPurchaseSaleList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		<![CDATA[
			SELECT  /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectIsoTotalPurchaseSaleList */
				  ITEM.YR						AS YR
				, PS.UO_BRNO					AS UO_BRNO
				, ITEM.BRNO						AS BRNO
				, ITEM.CRNO						AS CRNO
				, ITEM.CORP_NM					AS CORP_NM
				, ITEM.APO_CD					AS APO_CD
				, ITEM.APO_SE					AS APO_SE
				, PS.ITEM_CD					AS ITEM_CD
				, (SELECT X.ITEM_NM FROM TB_ITEM_CRTR X WHERE X.ITEM_CD = PS.ITEM_CD) AS ITEM_NM
				, NVL(PS.CTGRY_CD, ITEM.CTGRY_CD)					AS CTGRY_CD
				, (SELECT FN_GET_COM_CD_VL_NM('CTGRY_CD', NVL(PS.CTGRY_CD, ITEM.CTGRY_CD)) FROM DUAL) AS CTGRY_NM
				, NVL(PS.CLSF_CD, ITEM.CLSF_CD)					AS CLSF_CD
				, (SELECT FN_GET_COM_CD_VL_NM('CLSF_CD', NVL(PS.CLSF_CD, ITEM.CLSF_CD)) FROM DUAL) AS CLSF_NM
				, NVL(PS.STTG_UPBR_ITEM_SE, ITEM.STTG_UPBR_ITEM_SE)		AS STTG_UPBR_ITEM_SE
				, (SELECT FN_GET_COM_CD_VL_NM('STTG_UPBR_ITEM_SE', NVL(PS.STTG_UPBR_ITEM_SE, ITEM.STTG_UPBR_ITEM_SE)) FROM DUAL) AS STTG_UPBR_ITEM_NM
				, PS.PRCHS_SLS_SE				AS PRCHS_SLS_SE
				/* 매입 */
				/* 매입-수탁 */
				, PS.PRCHS_SORT_TRST_VLM	AS PRCHS_SORT_TRST_VLM
				, PS.PRCHS_SORT_TRST_AMT	AS PRCHS_SORT_TRST_AMT
				, PS.PRCHS_SPMT_TRST_VLM	AS PRCHS_SPMT_TRST_VLM
				, PS.PRCHS_SPMT_TRST_AMT	AS PRCHS_SPMT_TRST_AMT
				, PS.PRCHS_SMPL_TRST_VLM	AS PRCHS_SMPL_TRST_VLM
				, PS.PRCHS_SMPL_TRST_AMT	AS PRCHS_SMPL_TRST_AMT
			 	, CASE
			   		WHEN ITEM.YR < '2025' THEN NVL(PS.PRCHS_TRST_VLM, 0)
				   	ELSE
				   		NVL(PS.PRCHS_SORT_TRST_VLM, 0)
					   		+ NVL(PS.PRCHS_SPMT_TRST_VLM, 0)
					   		+ NVL(PS.PRCHS_SMPL_TRST_VLM, 0)
				END			AS PRCHS_TRST_VLM
			 	, CASE
			   		WHEN ITEM.YR < '2025' THEN NVL(PS.PRCHS_TRST_AMT, 0)
				   	ELSE
				   		NVL(PS.PRCHS_SORT_TRST_AMT, 0)
					   		+ NVL(PS.PRCHS_SPMT_TRST_AMT, 0)
					   		+ NVL(PS.PRCHS_SMPL_TRST_AMT, 0)
				END			AS PRCHS_TRST_AMT
				/* 매입-매취 */
				, PS.PRCHS_SORT_EMSPAP_VLM	AS PRCHS_SORT_EMSPAP_VLM
				, PS.PRCHS_SORT_EMSPAP_AMT	AS PRCHS_SORT_EMSPAP_AMT
				, PS.PRCHS_SMPL_EMSPAP_VLM	AS PRCHS_SMPL_EMSPAP_VLM
				, PS.PRCHS_SMPL_EMSPAP_AMT	AS PRCHS_SMPL_EMSPAP_AMT
			 	, CASE
					WHEN ITEM.YR < '2025' THEN NVL(PS.PRCHS_EMSPAP_VLM, 0)
					ELSE
				   		NVL(PS.PRCHS_SORT_EMSPAP_VLM, 0)
				   			+ NVL(PS.PRCHS_SMPL_EMSPAP_VLM, 0)
				END			AS PRCHS_EMSPAP_VLM
			 	, CASE
				   	WHEN ITEM.YR < '2025' THEN NVL(PS.PRCHS_EMSPAP_AMT, 0)
				   	ELSE
				   		NVL(PS.PRCHS_SORT_EMSPAP_AMT, 0)
					   		+ NVL(PS.PRCHS_SMPL_EMSPAP_AMT, 0)
				END			AS PRCHS_EMSPAP_AMT
				/* 매입 - 기타 */
				, PS.ETC_VLM	AS ETC_VLM
				, PS.ETC_AMT	AS ETC_AMT

				/* 매입-합계 */
			 	, CASE
				   	WHEN ITEM.YR < '2025' THEN NVL(PS.PRCHS_TRST_VLM, 0) + NVL(PS.PRCHS_EMSPAP_VLM, 0) + NVL(PS.ETC_VLM, 0)
				   	ELSE
				   		NVL(PS.PRCHS_SORT_TRST_VLM, 0)
					   		+ NVL(PS.PRCHS_SPMT_TRST_VLM, 0)
						   	+ NVL(PS.PRCHS_SMPL_TRST_VLM, 0)
						   	+ NVL(PS.PRCHS_SORT_EMSPAP_VLM, 0)
						   	+ NVL(PS.PRCHS_SMPL_EMSPAP_VLM, 0)
				END			AS PRCHS_TOT_VLM
			 	, CASE
				   	WHEN ITEM.YR < '2025' THEN NVL(PS.PRCHS_TRST_AMT, 0) + NVL(PS.PRCHS_EMSPAP_AMT, 0) + NVL(PS.ETC_AMT, 0)
				   	ELSE
				   		NVL(PS.PRCHS_SORT_TRST_AMT, 0)
					   		+ NVL(PS.PRCHS_SPMT_TRST_AMT, 0)
					   		+ NVL(PS.PRCHS_SMPL_TRST_AMT, 0)
						   	+ NVL(PS.PRCHS_SORT_EMSPAP_AMT, 0)
						   	+ NVL(PS.PRCHS_SMPL_EMSPAP_AMT, 0)
				END			AS PRCHS_TOT_AMT

				/* 매출 */
				, NVL(TOTA.SORT_TRST_VLM ,0) 		AS SLS_CPRTN_SORT_TRST_VLM
				, NVL(TOTA.SORT_TRST_AMT ,0) 		AS SLS_CPRTN_SORT_TRST_AMT
				, NVL(TOTA.TRST_VLM ,0) 					AS SLS_CPRTN_TRST_VLM
				, NVL(TOTA.TRST_AMT ,0) 					AS SLS_CPRTN_TRST_AMT
				, NVL(TOTA.SORT_EMSPAP_VLM ,0) 	AS SLS_CPRTN_SORT_EMSPAP_VLM
				, NVL(TOTA.SORT_EMSPAP_AMT ,0) 	AS SLS_CPRTN_SORT_EMSPAP_AMT

				, NVL(TOTA.TOT_VLM, 0)			AS SLS_CPRTN_TOT_VLM
				, NVL(TOTA.TOT_AMT, 0)			AS SLS_CPRTN_TOT_AMT

				, PS.SLS_SMPL_TRST_VLM		AS SLS_SMPL_TRST_VLM
				, PS.SLS_SMPL_TRST_AMT		AS SLS_SMPL_TRST_AMT
				, PS.SLS_SMPL_EMSPAP_VLM	AS SLS_SMPL_EMSPAP_VLM
				, PS.SLS_SMPL_EMSPAP_AMT	AS SLS_SMPL_EMSPAP_AMT
				, PS.SLS_TRST_VLM					AS SLS_TRST_VLM
				, PS.SLS_TRST_AMT					AS SLS_TRST_AMT

			 	, CASE
			   		WHEN ITEM.YR < '2025' THEN NVL(PS.SLS_EMSPAP_VLM, 0)
				   	ELSE
				   		NVL(PS.SLS_CPRTN_SORT_EMSPAP_VLM, 0)
					   		+ NVL(PS.SLS_SMPL_EMSPAP_VLM, 0)
				END			AS SLS_EMSPAP_VLM
			 	, CASE
			   		WHEN ITEM.YR < '2025' THEN NVL(PS.SLS_EMSPAP_AMT, 0)
				   	ELSE
				   		NVL(PS.SLS_CPRTN_SORT_EMSPAP_AMT, 0)
					   		+ NVL(PS.SLS_SMPL_EMSPAP_AMT, 0)
				END			AS SLS_EMSPAP_AMT
				/* 매출-합계 */
			 	, CASE
				   	WHEN ITEM.YR < '2025' THEN NVL(PS.SLS_EMSPAP_VLM, 0) + NVL(PS.SLS_TRST_VLM, 0)
				   	ELSE
					   	NVL(PS.SLS_CPRTN_TRST_VLM, 0)
					   		+ NVL(PS.SLS_CPRTN_SORT_TRST_VLM, 0)
					   		+ NVL(PS.SLS_SMPL_TRST_VLM, 0)
					   		+ NVL(PS.SLS_CPRTN_SORT_EMSPAP_VLM, 0)
					   		+ NVL(PS.SLS_SMPL_EMSPAP_VLM, 0)
				END			AS SLS_TOT_VLM
			 	, CASE
				   	WHEN ITEM.YR < '2025' THEN NVL(PS.SLS_EMSPAP_AMT, 0) + NVL(PS.SLS_TRST_AMT, 0)
				   	ELSE
					   	NVL(PS.SLS_CPRTN_TRST_AMT, 0)
					   		+ NVL(PS.SLS_CPRTN_SORT_TRST_AMT, 0)
					   		+ NVL(PS.SLS_SMPL_TRST_AMT, 0)
					   		+ NVL(PS.SLS_CPRTN_SORT_EMSPAP_AMT, 0)
					   		+ NVL(PS.SLS_SMPL_EMSPAP_AMT, 0)
				END			AS SLS_TOT_AMT

				/*공제*/
				, PS.DDC_EXPRT_VLM				AS DDC_EXPRT_VLM
				, PS.DDC_EXPRT_AMT				AS DDC_EXPRT_AMT
				, PS.DDC_VLM					AS DDC_VLM
				, PS.DDC_AMT					AS DDC_AMT
				, PS.DDC_ARMY_DLVGDS_VLM		AS DDC_ARMY_DLVGDS_VLM
				, PS.DDC_ARMY_DLVGDS_AMT		AS DDC_ARMY_DLVGDS_AMT
				, PS.DDC_MLSR_VLM				AS DDC_MLSR_VLM
				, PS.DDC_MLSR_AMT				AS DDC_MLSR_AMT

				, PS.SPMT_PRFMNC_VLM			AS SPMT_PRFMNC_VLM
				, PS.SPMT_PRFMNC_AMT			AS SPMT_PRFMNC_AMT
				, PS.SMPL_INPT_VLM				AS SMPL_INPT_VLM
				, PS.SMPL_INPT_AMT				AS SMPL_INPT_AMT

				, NVL(TOTA.TOT_VLM, 0) + NVL(TOTB.TOT_VLM, 0) 	AS AJMT_VLM
				, NVL(TOTA.TOT_AMT, 0) + NVL(TOTB.TOT_AMT, 0) 	AS AJMT_AMT

				/* 총 실적 */
				, PS.TOT_TRMT_PRFMNC_VLM	AS TOT_TRMT_PRFMNC_VLM
				, PS.TOT_TRMT_PRFMNC_AMT	AS TOT_TRMT_PRFMNC_AMT

			 	, CASE ITEM.STTG_UPBR_ITEM_SE
				   	WHEN '3' THEN PS.TOT_SPMT_PRFMNC_VLM
				   	ELSE NVL(TOTA.UO_SPMT_VLM, 0) + NVL(TOTB.UO_SPMT_VLM, 0)
				END		AS TOT_SPMT_PRFMNC_VLM

			 	, CASE ITEM.STTG_UPBR_ITEM_SE
				   	WHEN '3' THEN PS.TOT_SPMT_PRFMNC_AMT
				   	ELSE NVL(TOTA.UO_SPMT_AMT, 0) + NVL(TOTB.UO_SPMT_AMT, 0)
				END		AS TOT_SPMT_PRFMNC_AMT

			 	, PS.RMRK		AS RMRK
			 	, 'N' 				AS DEL_YN

			FROM (
					 SELECT
					 	EAM.APO_SE				AS APO_SE
						, APO.APO_CD			AS APO_CD
						, APO.CORP_NM			AS CORP_NM
						, APO.CRNO				AS CRNO
						, EAM.BRNO				AS BRNO
						, EAM.YR				AS YR

					    , EAM.UO_BRNO			AS ORGNL_UO_BRNO
					    , EAM.UO_BRNO			AS UO_BRNO
					    /*
						, NVL(GC.UO_BRNO, UC.UO_BRNO)	AS ORGNL_UO_BRNO
					    , NVL(GC.UO_BRNO, UC.UO_BRNO)	AS UO_BRNO
						 */
						, GC.ITEM_CD			AS ITEM_CD
						, 'Y'					AS ORG
						  --, GC.CTGRY_CD					AS CTGRY_CD
						  --, GC.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
					  	, CASE GC.STTG_UPBR_ITEM_SE
							WHEN '3' THEN GC.CTGRY_CD
							ELSE UGC.CTGRY_CD
					 	END		AS CTGRY_CD
					  	, CASE GC.STTG_UPBR_ITEM_SE
							WHEN '3' THEN GC.CLSF_CD
							ELSE UGC.CLSF_CD
					 	END		AS CLSF_CD
						, CASE GC.STTG_UPBR_ITEM_SE
							WHEN '3' THEN GC.STTG_UPBR_ITEM_SE
							ELSE UGC.STTG_UPBR_ITEM_SE
					 	END		AS STTG_UPBR_ITEM_SE

					 FROM TB_EV_APLY_MNG EAM

					  JOIN TB_EV_APO APO
						   ON APO.BRNO = EAM.BRNO
							   AND APO.DEL_YN = 'N'
					/*
					  JOIN VW_EV_APO_UO_CD UC
				   		ON UC.CRTR_YR = EAM.YR
				   		AND UC.ISO_BRNO = EAM.BRNO
					 */
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>

				JOIN TB_EV_APO_YR_GPC_CD GC
				ON GC.YR = EAM.YR
				AND GC.BRNO = EAM.UO_BRNO
				       /*
				AND GC.BRNO = UC.UO_BRNO
				        */
				AND GC.DEL_YN = 'N'
			</when>
			<otherwise>
				JOIN TB_EV_APO_YR_GPC_CD GC
				ON GC.YR = EAM.YR
				AND GC.BRNO = EAM.BRNO
				AND GC.DEL_YN = 'N'
			</otherwise>
		</choose>
		<![CDATA[
				  LEFT JOIN TB_EV_APO_YR_GPC_CD UGC
						ON UGC.YR = EAM.YR
						AND UGC.BRNO = GC.UO_BRNO
						AND UGC.ITEM_CD = GC.ITEM_CD
						AND UGC.DEL_YN = 'N'

					 WHERE EAM.APO_SE = '2'
					   AND EAM.YR = #{yr}
					   AND EAM.BRNO = #{brno}
					   AND NOT EXISTS (
						 SELECT 1
						 FROM TB_COM_USER X
						 WHERE X.USER_ID IN (
							 SELECT CD.CD_VL
							 FROM TB_COM_CD_DTL CD
							 WHERE CD.CD_ID = 'SYS_EXCLD_USER_ID'
							   AND CD.USE_YN = 'Y'
							   AND CD.DEL_YN = 'N'
						 )
						   AND X.BRNO IN (EAM.BRNO, EAM.UO_BRNO)
						   /* AND X.BRNO IN (EAM.BRNO, UC.UO_BRNO) */
					 	)
				 ) ITEM
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
				JOIN TB_EV_UO_ISO_ALL_PRCHS_SLS PS
				ON PS.APO_SE = ITEM.APO_SE
				AND PS.BRNO = ITEM.BRNO
				AND PS.UO_BRNO IN ('0', ITEM.UO_BRNO)
				AND PS.YR = ITEM.YR
				AND PS.PRCHS_SLS_SE = #{prchsSlsSe}
				AND PS.DEL_YN = 'N'
			</when>
			<otherwise>
				JOIN TB_EV_UO_ISO_ALL_PRCHS_SLS PS
				ON PS.APO_SE = ITEM.APO_SE
				AND PS.BRNO = ITEM.BRNO
				AND PS.UO_BRNO IN ('0', ITEM.UO_BRNO)
				AND PS.YR = ITEM.YR
				AND PS.PRCHS_SLS_SE = #{prchsSlsSe}
				AND PS.STTG_UPBR_ITEM_SE = ITEM.STTG_UPBR_ITEM_SE
				AND PS.ITEM_CD = ITEM.ITEM_CD
				AND PS.DEL_YN = 'N'
			    AND ITEM.ORG = 'Y'
			</otherwise>
		</choose>
		<![CDATA[
			 LEFT JOIN (
				SELECT
					SLS.UO_BRNO		AS UO_BRNO
					 , SLS.BRNO				AS BRNO
					 , SLS.YR					AS YR
					 , SLS.ITEM_CD			AS ITEM_CD

					 , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_SPMT_VLM
					 , NVL(SUM(SLS.UO_SPMT_AMT), 0)				AS UO_SPMT_AMT
					 , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_OTHER_SPMT_VLM
					 , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT

					 , NVL(SUM(SLS.UO_SPMT_VLM), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_VLM), 0)	AS TOT_VLM
					 , NVL(SUM(SLS.UO_SPMT_AMT), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0)	AS TOT_AMT

					 , SUM(CASE SLS.TRMT_TYPE WHEN '2' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS SORT_TRST_VLM
					 , SUM(CASE SLS.TRMT_TYPE WHEN '2' THEN SLS.UO_SPMT_AMT ELSE 0 END) 	AS SORT_TRST_AMT
					 , SUM(CASE SLS.TRMT_TYPE WHEN '1' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS TRST_VLM
					 , SUM(CASE SLS.TRMT_TYPE WHEN '1' THEN SLS.UO_SPMT_AMT ELSE 0 END) 	AS TRST_AMT
					 , SUM(CASE SLS.TRMT_TYPE WHEN '3' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS SORT_EMSPAP_VLM
					 , SUM(CASE SLS.TRMT_TYPE WHEN '3' THEN SLS.UO_SPMT_AMT ELSE 0 END)	AS SORT_EMSPAP_AMT

				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
				WHERE SLS.APO_SE = '2'
				  AND SLS.TYPE_SE_NO IN ('5')
				  AND SLS.DEL_YN = 'N'
				  AND SLS.PRDCR_OGNZ_SN IN (
					SELECT X.PRDCR_OGNZ_SN
					FROM TB_EV_FRMHS_APO X
					WHERE X.APO_SE = SLS.APO_SE
					  AND X.BRNO = SLS.BRNO
					  AND X.YR = SLS.YR
					  AND X.STBLT_YN = 'Y'
					  AND NVL(X.EXCL_YN, 'N') <> 'Y'
				)
				GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
			) TOTA
			   ON TOTA.YR = ITEM.YR
			   AND TOTA.UO_BRNO = ITEM.UO_BRNO
			   AND TOTA.BRNO = ITEM.BRNO
			   AND TOTA.ITEM_CD = PS.ITEM_CD
			   AND ITEM.ORG = 'Y'
			 LEFT JOIN (
				SELECT
					SLS.UO_BRNO	AS UO_BRNO
					 , SLS.BRNO			AS BRNO
					 , SLS.YR				AS YR
					 , SLS.ITEM_CD		AS ITEM_CD
					 , NVL(SUM(SLS.UO_SPMT_AMT), 0)				AS UO_SPMT_AMT
					 , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_SPMT_VLM
					 , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT
					 , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_OTHER_SPMT_VLM
					 , NVL(SUM(SLS.UO_SPMT_VLM), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_VLM), 0)	AS TOT_VLM
					 , NVL(SUM(SLS.UO_SPMT_AMT), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0)	AS TOT_AMT

				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
				WHERE SLS.APO_SE = '2'
				  AND SLS.TYPE_SE_NO IN ('7')
				  AND SLS.DEL_YN = 'N'
				GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
			) TOTB
			   ON TOTB.YR = ITEM.YR
			   AND TOTB.UO_BRNO = ITEM.UO_BRNO
			   AND TOTB.BRNO = ITEM.BRNO
			   AND TOTB.ITEM_CD = PS.ITEM_CD
			   AND ITEM.ORG = 'Y'

			 LEFT JOIN TB_ITEM_CRTR IC
			   ON IC.ITEM_CD = PS.ITEM_CD
			   AND ITEM.ORG = 'Y'
			   AND IC.DEL_YN = 'N'

		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
				WHERE (
					    PS.STTG_UPBR_ITEM_SE = '3'
					OR
					(
						PS.STTG_UPBR_ITEM_SE IN ('1', '2')
						AND
						PS.ITEM_CD = ITEM.ITEM_CD
						AND
						PS.UO_BRNO = ITEM.UO_BRNO
					)
				)
			</when>
			<otherwise>
				WHERE ITEM.ITEM_CD IS NOT NULL
			</otherwise>
		</choose>
		<![CDATA[
			ORDER BY STTG_UPBR_ITEM_SE, ITEM_CD, CASE ITEM.UO_BRNO WHEN '0' THEN 9 ELSE 0 END, UO_BRNO
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectIsoTotalSaleList	-->
	<!-- DESC : 출자출하조직 총 매출 목록 조회                               -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.02.18  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectIsoTotalSaleList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnPurSalMngVO">
		<![CDATA[
			SELECT  /* com.at.apcss.pd.isom.mapper.InvShipOgnPurSalMngMapper.selectIsoTotalSaleList */
				ITEM.YR							AS YR
				 , ITEM.UO_BRNO					AS UO_BRNO
				 , ITEM.BRNO						AS BRNO
				 , ITEM.CRNO						AS CRNO
				 , ITEM.CORP_NM					AS CORP_NM
				 , ITEM.APO_CD						AS APO_CD
				 , ITEM.APO_SE						AS APO_SE
				 , ITEM.ITEM_CD					AS ITEM_CD
				 , (SELECT X.ITEM_NM FROM TB_ITEM_CRTR X WHERE X.ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
				 , ITEM.CTGRY_CD					AS CTGRY_CD
				 , (SELECT FN_GET_COM_CD_VL_NM('CTGRY_CD', ITEM.CTGRY_CD) FROM DUAL) AS CTGRY_NM
				 , ITEM.CLSF_CD					AS CLSF_CD
				 , (SELECT FN_GET_COM_CD_VL_NM('CLSF_CD', ITEM.CLSF_CD) FROM DUAL) AS CLSF_NM
				 , ITEM.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
				 , (SELECT FN_GET_COM_CD_VL_NM('STTG_UPBR_ITEM_SE', ITEM.STTG_UPBR_ITEM_SE) FROM DUAL) AS STTG_UPBR_ITEM_SE_NM

				 , '2' 		AS PRCHS_SLS_SE

				/* 매출 */
				 , NVL(TOTA.SORT_TRST_VLM ,0) 		AS SLS_CPRTN_SORT_TRST_VLM
				 , NVL(TOTA.SORT_TRST_AMT ,0) 		AS SLS_CPRTN_SORT_TRST_AMT
				 , NVL(TOTA.TRST_VLM ,0) 					AS SLS_CPRTN_TRST_VLM
				 , NVL(TOTA.TRST_AMT ,0) 					AS SLS_CPRTN_TRST_AMT
				 , NVL(TOTA.SORT_EMSPAP_VLM ,0) 	AS SLS_CPRTN_SORT_EMSPAP_VLM
				 , NVL(TOTA.SORT_EMSPAP_AMT ,0) 	AS SLS_CPRTN_SORT_EMSPAP_AMT

				 , NVL(TOTA.TOT_VLM, 0)			AS SLS_CPRTN_TOT_VLM
				 , NVL(TOTA.TOT_AMT, 0)			AS SLS_CPRTN_TOT_AMT

				 , CM.SLS_SMPL_TRST_VLM		AS SLS_SMPL_TRST_VLM
				 , CM.SLS_SMPL_TRST_AMT		AS SLS_SMPL_TRST_AMT
				 , CM.SLS_SMPL_EMSPAP_VLM	AS SLS_SMPL_EMSPAP_VLM
				 , CM.SLS_SMPL_EMSPAP_AMT	AS SLS_SMPL_EMSPAP_AMT
				 , CM.SLS_EMSPAP_VLM				AS SLS_EMSPAP_VLM
				 , CM.SLS_EMSPAP_AMT				AS SLS_EMSPAP_AMT
				 , CM.SLS_TRST_VLM					AS SLS_TRST_VLM
				 , CM.SLS_TRST_AMT					AS SLS_TRST_AMT

				/*공제*/
				 , CM.DDC_EXPRT_VLM				AS DDC_EXPRT_VLM
				 , CM.DDC_EXPRT_AMT				AS DDC_EXPRT_AMT
				 , CM.DDC_VLM							AS DDC_VLM
				 , CM.DDC_AMT							AS DDC_AMT
				 , CM.DDC_ARMY_DLVGDS_VLM	AS DDC_ARMY_DLVGDS_VLM
				 , CM.DDC_ARMY_DLVGDS_AMT	AS DDC_ARMY_DLVGDS_AMT
				 , CM.DDC_MLSR_VLM				AS DDC_MLSR_VLM
				 , CM.DDC_MLSR_AMT				AS DDC_MLSR_AMT

				 , CM.SPMT_PRFMNC_VLM			AS SPMT_PRFMNC_VLM
				 , CM.SPMT_PRFMNC_AMT			AS SPMT_PRFMNC_AMT
				 , CM.SMPL_INPT_VLM				AS SMPL_INPT_VLM
				 , CM.SMPL_INPT_AMT				AS SMPL_INPT_AMT

				 , NVL(TOTA.TOT_VLM, 0) + NVL(TOTB.TOT_VLM, 0) 	AS AJMT_VLM
				 , NVL(TOTA.TOT_AMT, 0) + NVL(TOTB.TOT_AMT, 0) 	AS AJMT_AMT

				/* 총 실적 */
				 , CM.TOT_TRMT_PRFMNC_VLM	AS TOT_TRMT_PRFMNC_VLM
				 , CM.TOT_TRMT_PRFMNC_AMT	AS TOT_TRMT_PRFMNC_AMT

				 , CASE ITEM.STTG_UPBR_ITEM_SE
					   WHEN '3' THEN CM.TOT_SPMT_PRFMNC_VLM
					   ELSE NVL(TOTA.UO_SPMT_VLM, 0) + NVL(TOTB.UO_SPMT_VLM, 0)
				END		AS TOT_SPMT_PRFMNC_VLM

				 , CASE ITEM.STTG_UPBR_ITEM_SE
					   WHEN '3' THEN CM.TOT_SPMT_PRFMNC_AMT
					   ELSE NVL(TOTA.UO_SPMT_AMT, 0) + NVL(TOTB.UO_SPMT_AMT, 0)
				END		AS TOT_SPMT_PRFMNC_AMT

				 , CM.RMRK		AS RMRK
				 , 'N' 				AS DEL_YN

			FROM (
					 SELECT
						 EAM.APO_SE						AS APO_SE
						  , APO.APO_CD						AS APO_CD
						  , APO.CORP_NM					AS CORP_NM
						  , APO.CRNO						AS CRNO
						  , EAM.BRNO							AS BRNO
						  , EAM.YR							AS YR
						  , NVL(GC.UO_BRNO, '0')		AS UO_BRNO
						  , GC.ITEM_CD						AS ITEM_CD
						  --, GC.CTGRY_CD					AS CTGRY_CD
						  --, GC.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
						  , CASE GC.STTG_UPBR_ITEM_SE
								WHEN '3' THEN GC.CTGRY_CD
								ELSE UGC.CTGRY_CD
						 END		AS CTGRY_CD
						  , CASE GC.STTG_UPBR_ITEM_SE
								WHEN '3' THEN GC.CLSF_CD
								ELSE UGC.CLSF_CD
						 END		AS CLSF_CD
						  , CASE GC.STTG_UPBR_ITEM_SE
								WHEN '3' THEN GC.STTG_UPBR_ITEM_SE
								ELSE UGC.STTG_UPBR_ITEM_SE
						 END		AS STTG_UPBR_ITEM_SE

					 FROM TB_EV_APLY_MNG EAM

							  JOIN TB_EV_APO APO
								   ON APO.BRNO = EAM.BRNO
									   AND APO.DEL_YN = 'N'

							  JOIN VW_EV_APO_UO_CD UC
								   ON UC.CRTR_YR = EAM.YR
									   --		 	AND UC.ISO_APO_CD = EAM.APO_CD
									   AND UC.ISO_BRNO = EAM.BRNO

							  JOIN TB_EV_APO_YR_GPC_CD GC
								   ON GC.YR = EAM.YR
									   AND GC.BRNO = EAM.BRNO	-- 2024, 2025 다름
									   AND GC.DEL_YN = 'N'

							  LEFT JOIN TB_EV_APO_YR_GPC_CD UGC
										ON UGC.YR = EAM.YR
											AND UGC.BRNO = GC.UO_BRNO
											AND UGC.ITEM_CD = GC.ITEM_CD
											AND UGC.DEL_YN = 'N'

					 WHERE EAM.APO_SE = '2'
					   AND EAM.YR = #{yr}
					   AND EAM.BRNO = #{brno}
					   AND NOT EXISTS (
						 SELECT 1
						 FROM TB_COM_USER X
						 WHERE X.USER_ID IN (
							 SELECT CD.CD_VL
							 FROM TB_COM_CD_DTL CD
							 WHERE CD.CD_ID = 'SYS_EXCLD_USER_ID'
							   AND CD.USE_YN = 'Y'
							   AND CD.DEL_YN = 'N'
						 )
						   AND X.BRNO IN (EAM.BRNO, UC.UO_BRNO)
					 )
				 ) ITEM

					 LEFT JOIN TB_EV_UO_ISO_ALL_PRCHS_SLS CM
							   ON CM.APO_SE = ITEM.APO_SE
								   AND CM.BRNO = ITEM.BRNO
								   AND CM.UO_BRNO = ITEM.UO_BRNO
								   AND CM.YR = ITEM.YR
								   AND CM.PRCHS_SLS_SE = '2'
								   AND CM.STTG_UPBR_ITEM_SE = ITEM.STTG_UPBR_ITEM_SE
								   AND CM.DEL_YN = 'N'

					 LEFT JOIN (
				SELECT
					SLS.UO_BRNO		AS UO_BRNO
					 , SLS.BRNO				AS BRNO
					 , SLS.YR					AS YR
					 , SLS.ITEM_CD			AS ITEM_CD

					 , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_SPMT_VLM
					 , NVL(SUM(SLS.UO_SPMT_AMT), 0)				AS UO_SPMT_AMT
					 , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_OTHER_SPMT_VLM
					 , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT

					 , NVL(SUM(SLS.UO_SPMT_VLM), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_VLM), 0)	AS TOT_VLM
					 , NVL(SUM(SLS.UO_SPMT_AMT), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0)	AS TOT_AMT

					 , SUM(CASE SLS.TRMT_TYPE WHEN '2' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS SORT_TRST_VLM
					 , SUM(CASE SLS.TRMT_TYPE WHEN '2' THEN SLS.UO_SPMT_AMT ELSE 0 END) 	AS SORT_TRST_AMT
					 , SUM(CASE SLS.TRMT_TYPE WHEN '1' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS TRST_VLM
					 , SUM(CASE SLS.TRMT_TYPE WHEN '1' THEN SLS.UO_SPMT_AMT ELSE 0 END) 	AS TRST_AMT
					 , SUM(CASE SLS.TRMT_TYPE WHEN '3' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS SORT_EMSPAP_VLM
					 , SUM(CASE SLS.TRMT_TYPE WHEN '3' THEN SLS.UO_SPMT_AMT ELSE 0 END)	AS SORT_EMSPAP_AMT

				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
				WHERE SLS.APO_SE = '2'
				  AND SLS.TYPE_SE_NO IN ('5')
				  AND SLS.DEL_YN = 'N'
				  AND SLS.PRDCR_OGNZ_SN IN (
					SELECT X.PRDCR_OGNZ_SN
					FROM TB_EV_FRMHS_APO X
					WHERE X.APO_SE = SLS.APO_SE
					  AND X.BRNO = SLS.BRNO
					  AND X.YR = SLS.YR
					  AND X.STBLT_YN = 'Y'
					  AND NVL(X.EXCL_YN, 'N') <> 'Y'
				)
				GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
			) TOTA
							   ON TOTA.YR = ITEM.YR
								   AND TOTA.UO_BRNO = ITEM.UO_BRNO
								   AND TOTA.BRNO = ITEM.BRNO
								   AND TOTA.ITEM_CD = ITEM.ITEM_CD

					 LEFT JOIN (
				SELECT
					SLS.UO_BRNO	AS UO_BRNO
					 , SLS.BRNO			AS BRNO
					 , SLS.YR				AS YR
					 , SLS.ITEM_CD		AS ITEM_CD
					 , NVL(SUM(SLS.UO_SPMT_AMT), 0)				AS UO_SPMT_AMT
					 , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_SPMT_VLM
					 , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT
					 , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_OTHER_SPMT_VLM
					 , NVL(SUM(SLS.UO_SPMT_VLM), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_VLM), 0)	AS TOT_VLM
					 , NVL(SUM(SLS.UO_SPMT_AMT), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0)	AS TOT_AMT

				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
				WHERE SLS.APO_SE = '2'
				  AND SLS.TYPE_SE_NO IN ('7')
				  AND SLS.DEL_YN = 'N'
				GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
			) TOTB
							   ON TOTB.YR = ITEM.YR
								   AND TOTB.UO_BRNO = ITEM.UO_BRNO
								   AND TOTB.BRNO = ITEM.BRNO
								   AND TOTB.ITEM_CD = ITEM.ITEM_CD

					 LEFT JOIN TB_ITEM_CRTR IC
							   ON IC.ITEM_CD = ITEM.ITEM_CD
								   AND IC.DEL_YN = 'N'
			WHERE ITEM.ITEM_CD IS NOT NULL
			ORDER BY STTG_UPBR_ITEM_SE, ITEM_CD, CASE ITEM.UO_BRNO WHEN '0' THEN 9 ELSE 0 END, UO_BRNO
		]]>
	</select>
</mapper>