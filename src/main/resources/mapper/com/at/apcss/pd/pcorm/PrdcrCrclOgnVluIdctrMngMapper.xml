<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : BbsMapper.xml													-->
<!-- DESC : 게시판 정보 mapper											 			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR			DESCRIPTION					  			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.06.29  	jcshin			Initial Creation							-->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper">

	<!-- 통합조직 등록결과 리스트 -->
	<select id="selectUoList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT	/* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.selectItemStbltYn */
			TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.BRNO
			,TOTAL.YR
			,TOTAL.APRV
			,TOTAL.APRV_NM
			,TOTAL.CORP_NM
			,TOTAL.SLS_CNSGN_SLS_AMT
			,TOTAL.SLS_CNSGN_SLS_AMT_TOT
			,TOTAL.SLS_CNSGN_SLS_AMT_RT

			/*예외*/
			,TOTAL.CHK_ITEM_A /*CTGRY_CD 2*/
			,TOTAL.CHK_ITEM_B /*CTGRY_CD 3*/

			/* 총취급액 최저 금액 */
			,TOTAL.CHK_AMT_TOT_A_A
			,TOTAL.CHK_AMT_TOT_A_B
			,TOTAL.CHK_AMT_TOT_A_C

			,TOTAL.CHK_AMT_TOT_B_A
			,TOTAL.CHK_AMT_TOT_B_B
			,TOTAL.CHK_AMT_TOT_B_C

			,TOTAL.CHK_AMT_TOT_C_A
			,TOTAL.CHK_AMT_TOT_C_B
			,TOTAL.CHK_AMT_TOT_C_C

			/* 총취급액 전속 취급률 기준 금액 */
			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C

			/*전속취급률 */
			,TOTAL.CHK_RT_A_A
			,TOTAL.CHK_RT_A_B
			,TOTAL.CHK_RT_A_C

			,TOTAL.CHK_RT_B_A
			,TOTAL.CHK_RT_B_B
			,TOTAL.CHK_RT_B_C

			,TOTAL.CHK_RT_C

			/*APRV 1승인형 2육성형 */
			/*STTG_UPBR_ITEM_SE 1전문품목 2육성품목 */
			/*CTGRY_CD 1과실 2시설 3노지*/
			, (CASE WHEN TOTAL.APRV = '1' AND TOTAL.STTG_UPBR_ITEM_SE = '1' AND (TOTAL.CTGRY_CD ='1' and TOTAL.CHK_ITEM_A != 'Y')
						THEN (CASE WHEN TOTAL.CHK_A_A = 'A' AND TOTAL.CHK_AMT_TOT_A_A = 'Y' AND TOTAL.CHK_RT_A_A = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_A_A = 'B' AND TOTAL.CHK_AMT_TOT_A_A = 'Y' AND TOTAL.CHK_RT_A_B = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_A_A = 'C' AND TOTAL.CHK_AMT_TOT_A_A = 'Y' AND TOTAL.CHK_RT_A_C = 'Y' THEN 'Y'
									ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND TOTAL.STTG_UPBR_ITEM_SE = '1' AND ( (TOTAL.CTGRY_CD ='2' and TOTAL.CHK_ITEM_B != 'Y') OR TOTAL.CHK_ITEM_A = 'Y')
						THEN (CASE WHEN TOTAL.CHK_A_B = 'A' AND TOTAL.CHK_AMT_TOT_A_B = 'Y' AND TOTAL.CHK_RT_A_A = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_A_B = 'B' AND TOTAL.CHK_AMT_TOT_A_B = 'Y' AND TOTAL.CHK_RT_A_B = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_A_B = 'C' AND TOTAL.CHK_AMT_TOT_A_B = 'Y' AND TOTAL.CHK_RT_A_C = 'Y' THEN 'Y'
									ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND TOTAL.STTG_UPBR_ITEM_SE = '1' AND ( TOTAL.CTGRY_CD ='3' OR TOTAL.CHK_ITEM_B = 'Y')
						THEN (CASE WHEN TOTAL.CHK_A_C = 'A' AND TOTAL.CHK_AMT_TOT_A_C = 'Y' AND TOTAL.CHK_RT_A_A = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_A_C = 'B' AND TOTAL.CHK_AMT_TOT_A_C = 'Y' AND TOTAL.CHK_RT_A_B = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_A_C = 'C' AND TOTAL.CHK_AMT_TOT_A_C = 'Y' AND TOTAL.CHK_RT_A_C = 'Y' THEN 'Y'
									ELSE 'N' END)

					WHEN TOTAL.APRV = '1' AND TOTAL.STTG_UPBR_ITEM_SE = '2' AND (TOTAL.CTGRY_CD ='1' and TOTAL.CHK_ITEM_A != 'Y')
						THEN (CASE WHEN TOTAL.CHK_B_A = 'A' AND TOTAL.CHK_AMT_TOT_B_A = 'Y' AND TOTAL.CHK_RT_B_A = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_B_A = 'B' AND TOTAL.CHK_AMT_TOT_B_A = 'Y' AND TOTAL.CHK_RT_B_B = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_B_A = 'C' AND TOTAL.CHK_AMT_TOT_B_A = 'Y' AND TOTAL.CHK_RT_B_C = 'Y' THEN 'Y'
									ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND TOTAL.STTG_UPBR_ITEM_SE = '2' AND ( (TOTAL.CTGRY_CD ='2' and TOTAL.CHK_ITEM_B != 'Y') OR TOTAL.CHK_ITEM_A = 'Y')
						THEN (CASE WHEN TOTAL.CHK_B_B = 'A' AND TOTAL.CHK_AMT_TOT_B_B = 'Y' AND TOTAL.CHK_RT_B_A = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_B_B = 'B' AND TOTAL.CHK_AMT_TOT_B_B = 'Y' AND TOTAL.CHK_RT_B_B = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_B_B = 'C' AND TOTAL.CHK_AMT_TOT_B_B = 'Y' AND TOTAL.CHK_RT_B_C = 'Y' THEN 'Y'
									ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND TOTAL.STTG_UPBR_ITEM_SE = '2' AND ( TOTAL.CTGRY_CD ='3' OR TOTAL.CHK_ITEM_B = 'Y')
						THEN (CASE WHEN TOTAL.CHK_B_C = 'A' AND TOTAL.CHK_AMT_TOT_B_C = 'Y' AND TOTAL.CHK_RT_B_A = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_B_C = 'B' AND TOTAL.CHK_AMT_TOT_B_C = 'Y' AND TOTAL.CHK_RT_B_B = 'Y' THEN 'Y'
									WHEN TOTAL.CHK_B_C = 'C' AND TOTAL.CHK_AMT_TOT_B_C = 'Y' AND TOTAL.CHK_RT_B_C = 'Y' THEN 'Y'
									ELSE 'N' END)

					WHEN  TOTAL.APRV = '2' AND (TOTAL.CTGRY_CD ='1' and TOTAL.CHK_ITEM_A != 'Y')
						THEN (CASE WHEN  TOTAL.CHK_AMT_TOT_C_A = 'Y' AND TOTAL.CHK_RT_C = 'Y'
									THEN 'Y'
									ELSE 'N' END)
					WHEN  TOTAL.APRV = '2' AND ( (TOTAL.CTGRY_CD ='2' and TOTAL.CHK_ITEM_B != 'Y') OR TOTAL.CHK_ITEM_A = 'Y')
						THEN (CASE WHEN  TOTAL.CHK_AMT_TOT_C_B = 'Y' AND TOTAL.CHK_RT_C = 'Y'
									THEN 'Y'
									ELSE 'N' END)
					WHEN  TOTAL.APRV = '2' AND ( TOTAL.CTGRY_CD ='3' OR TOTAL.CHK_ITEM_B = 'Y')
						THEN (CASE WHEN  TOTAL.CHK_AMT_TOT_C_C = 'Y' AND TOTAL.CHK_RT_C = 'Y'
									THEN 'Y'
									ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM

					,TOT.SLS_CNSGN_SLS_AMT
					,TOT.SLS_CNSGN_SLS_AMT_TOT
					,TOT.SLS_CNSGN_SLS_AMT_RT

					/*60억 참다래 0611 자두 0608 블루베리 0659 블랙베리 0664 구즈베리 0676 구스베리 0678*/
					/* 40억 오이 0901 호박 0902 가지 0903*/
					,(CASE WHEN ITEM_CD = '0611' THEN 'Y'
								WHEN ITEM_CD = '0608' THEN 'Y'
								WHEN ITEM_CD = '0659' THEN 'Y'
								WHEN ITEM_CD = '0664' THEN 'Y'
								WHEN ITEM_CD = '0676' THEN 'Y'
								WHEN ITEM_CD = '0678' THEN 'Y'
								ELSE 'N' END) AS CHK_ITEM_A

					,(CASE WHEN ITEM_CD = '0901' THEN 'Y'
								WHEN ITEM_CD = '0902' THEN 'Y'
								WHEN ITEM_CD = '0903' THEN 'Y'
								ELSE 'N' END) AS CHK_ITEM_B

					/* 총취급액 최저 금액 */
					/*승인형 전문품목*/
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 10000000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_A_A
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 7000000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_A_B
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 5000000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_A_C
					/*승인형 육성품목*/
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 5000000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_B_A
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 3500000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_B_B
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 2500000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_B_C
					/* 육성형 */
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT >= 4000000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_C_A
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT >= 3000000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_C_B
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT >= 2000000 THEN 'Y' ELSE 'N' END) AS CHK_AMT_TOT_C_C

					/* 총취급액 전속 취급률 기준 금액 */
					<![CDATA[
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 30000000 THEN 'A'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 15000000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 30000000 THEN 'B'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 10000000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 15000000 THEN 'C'
								ELSE 'N' END
					) AS CHK_A_A
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 15000000 THEN 'A'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 10000000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 15000000 THEN 'B'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 7000000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 10000000 THEN 'C'
								ELSE 'N' END
					) AS CHK_A_B
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 10000000 THEN 'A'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 7000000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 10000000 THEN 'B'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 5000000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 7000000 THEN 'C'
								ELSE 'N' END
					) AS CHK_A_C

					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 15000000 THEN 'A'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 7500000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 15000000 THEN 'B'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 5000000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 7500000 THEN 'C'
								ELSE 'N' END
					) AS CHK_B_A
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 7500000 THEN 'A'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 5000000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 7500000 THEN 'B'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 3500000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 5000000 THEN 'C'
								ELSE 'N' END
					) AS CHK_B_B
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 5000000 THEN 'A'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 3500000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 5000000 THEN 'B'
								WHEN TOT.SLS_CNSGN_SLS_AMT_TOT >= 2500000 AND TOT.SLS_CNSGN_SLS_AMT_TOT < 3500000 THEN 'C'
								ELSE 'N' END
					) AS CHK_B_C
					]]>
					/*전속취급률 */
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_RT >= 50 THEN 'Y' ELSE 'N' END) AS CHK_RT_A_A
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_RT_A_B
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_RT >= 70 THEN 'Y' ELSE 'N' END) AS CHK_RT_A_C

					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_RT >= 25 THEN 'Y' ELSE 'N' END) AS CHK_RT_B_A
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_RT >= 30 THEN 'Y' ELSE 'N' END) AS CHK_RT_B_B
					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_RT >= 35 THEN 'Y' ELSE 'N' END) AS CHK_RT_B_C

					,(CASE WHEN TOT.SLS_CNSGN_SLS_AMT_RT >= 30 THEN 'Y' ELSE 'N' END) AS CHK_RT_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							, ITEM.STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							, ITEM.CTGRY_NM
							, ITEM.BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM

							, TOTA.SLS_CNSGN_SLS_AMT 			AS SLS_CNSGN_SLS_AMT

							, TOTB.SLS_CNSGN_SLS_AMT 			AS SLS_CNSGN_SLS_AMT_TOT

							, ROUND(NVL( TOTA.SLS_CNSGN_SLS_AMT  / NULLIF( TOTB.SLS_CNSGN_SLS_AMT  , 0 ) , 0 ) * 100 , 2 ) AS SLS_CNSGN_SLS_AMT_RT
							, (SELECT STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND APO_SE = '1'
								  AND TYPE_SE_NO ='8'
								  AND BRNO = ITEM.BRNO
								  AND YR = ITEM.YR
								  AND ITEM_CD = ITEM.ITEM_CD
							) AS STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, STTG_UPBR_ITEM_SE
									, CTGRY_CD
									, TO_CHAR(BRNO) AS BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = AYGC.ITEM_CD) AS ITEM_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = AYGC.CTGRY_CD) AS CTGRY_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = AYGC.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
								FROM TB_EV_APO_YR_GPC_CD AYGC
								WHERE 1=1

								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>

							) ITEM ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( SLS_CNSGN_SLS_AMT , 0 ) ) AS SLS_CNSGN_SLS_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								AND APO_SE = '1'
								AND TYPE_SE_NO IN ('2','6')
								AND (
										(PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND APO_SE = '1'
															<if test='brno != null and brno != ""'>
															  AND BRNO = #{brno}
															</if>
															<if test='yr != null and yr != ""'>
															  AND YR = #{yr}
															</if>
															)
										)OR
										(PRDCR_OGNZ_SN = '0')
									)
								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>

								GROUP BY  BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( SLS_CNSGN_SLS_AMT , 0 ) ) AS SLS_CNSGN_SLS_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								AND APO_SE = '1'
								AND TYPE_SE_NO IN ('2','3','6','7')
								AND (
										(PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND APO_SE = '1'
															<if test='brno != null and brno != ""'>
															  AND BRNO = #{brno}
															</if>
															<if test='yr != null and yr != ""'>
															  AND YR = #{yr}
															</if>
															)
										)OR
										(PRDCR_OGNZ_SN = '0')
									)
								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>

								GROUP BY  BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
				)TOT
		)TOTAL
		ORDER BY ITEM_CD , BRNO
	</select>

	<!-- 통합조직 총괄 리스트 -->
	<select id="selectUoTotList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.selectUoTotList */
			EAM.YR
			,EAM.BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS CORP_NM
			,CHK.CORP_SE_CD
			,CHK.CORP_SE_NM
			,CHK.CORP_DTL_SE_CD
			,CHK.CORP_DTL_SE_NM
			,CHK.ICPT_RSN_CD
			,CHK.ICPT_RSN_DTL_CD
			,(CASE WHEN CHK.ICPT_RSN_CD IN ('A','B') THEN 'N'
					ELSE 'Y'
					END
			) AS STBLT_YN
			,RR.MNGR_STBLT_YN
			,RR.MNGR_ICPT_RSN_CD
			,RR.MNGR_ICPT_RSN_DTL_CD
			,RR.MNGR_ITR_RT
			,(NVL(EAM.PRUO_FUND_APLY_AMT,0)
				+ NVL((SELECT SUM(ISO_FUND_APLY_AMT)
						FROM TB_EV_APLY_MNG
						WHERE 1=1
						  AND YR = EAM.YR
						  AND UO_BRNO = EAM.BRNO
						  AND APO_SE = '2'
						  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = EAM.BRNO) ),0)
			) AS FUND_APLY_AMT_TOT
			,(NVL(EAM.PRUO_FUND_APLY_AMT,0)
				+ NVL((SELECT SUM(ISO_FUND_APLY_AMT)
						FROM TB_EV_APLY_MNG TEAM
						WHERE 1=1
						  AND YR = EAM.YR
						  AND UO_BRNO = EAM.BRNO
						  AND APO_SE = '2'
						  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = EAM.BRNO)
						  AND BRNO = (SELECT BRNO
						  				FROM TB_EV_REG_RSLT TERR
						  				WHERE 1=1
						  				  AND APO_SE = '2'
						  				  AND YR = TEAM.YR
						  				  AND BRNO = TEAM.BRNO
						  				  AND UO_BRNO = EAM.BRNO
						  				  AND 'Y' = (CASE WHEN TERR.MNGR_STBLT_YN = 'Y' THEN 'Y'
						  											WHEN  TERR.MNGR_STBLT_YN = 'N' THEN 'N'
						  											ELSE TERR.STBLT_YN
						  											END)
						  				)
						  ),0)
			) AS FUND_APLY_AMT_STBLT_TOT
			,(SELECT LISTAGG(ITEM_NM, ' , ') WITHIN GROUP (ORDER BY ITEM_NM) AS STBLT_YN_NM
								FROM (SELECT
											(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
										FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
										WHERE 1=1
										  AND STBLT_YN = 'Y'
										  AND APO_SE = EAM.APO_SE
										  AND TYPE_SE_NO = '8'
										  AND YR = EAM.YR
										  AND BRNO = EAM.BRNO
										)
				) AS STBLT_ITEM_LIST
			,RR.ITR_RT
			,RR.RMRK
		FROM
			(SELECT *
				FROM TB_EV_APLY_MNG
				WHERE 1=1
				  AND APO_SE = '1'
				  AND BRNO = #{brno}
				  AND YR = #{yr}
			) EAM
			, (SELECT *
					FROM TB_EV_REG_RSLT
					WHERE 1=1
					  AND BRNO = #{brno}
					  AND YR = #{yr}
			) RR
			,(SELECT
					BRNO
					,CORP_SE_CD
					,CORP_SE_NM
					,CORP_DTL_SE_CD
					,CORP_DTL_SE_NM
					,(CASE
							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND (CHK_A_A != 'Y' OR CHK_A_B != 'Y' OR CHK_A_C != 'Y' OR CHK_A_D != 'Y' OR CHK_A_E != 'Y' )  THEN  'A'
							WHEN CORP_SE_CD = 'C34030' AND (CHK_A_A != 'Y' OR CHK_A_B != 'Y' OR CHK_A_C != 'Y' OR CHK_A_D != 'Y' OR CHK_A_E != 'Y' )  THEN  'A'

							WHEN CORP_SE_CD IN ('C34010','C34020','C34030') AND CHK_B != 'Y'  THEN  'B'
							ELSE ''
							END
					) AS ICPT_RSN_CD
					,(CASE WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_A = 'N'  THEN 'A1'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_A = 'N'  THEN 'A1'

							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_B = 'N'  THEN 'A2'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_B = 'N'  THEN 'A2'

							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_C = 'N'  THEN 'A3'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_C = 'N'  THEN 'A3'

							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_D = 'N'  THEN 'A4'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_D = 'N'  THEN  'A4'

							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_E = 'N'  THEN 'A5'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_E = 'N'  THEN  'A5'

							WHEN CORP_SE_CD = 'C34010' AND CHK_B = 'N'  THEN 'B1'
							WHEN CORP_SE_CD IN ('C34020','C34030') AND CHK_B = 'N'  THEN 'B2'
							ELSE ''
							END
					) AS ICPT_RSN_DTL_CD
				FROM
					(SELECT
						BRNO
						,CORP_SE_CD
						,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = EA.CORP_SE_CD) AS CORP_SE_NM
						,CORP_DTL_SE_CD
						,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SHAP' AND CD_VL = EA.CORP_DTL_SE_CD) AS CORP_DTL_SE_NM

						,NVL(MNGMST_YN,'N') AS CHK_A_A
						,(CASE WHEN TO_NUMBER(NVL(INVST_AMT,0)) >=  300000 THEN 'Y'
									ELSE 'N' END
						)  AS CHK_A_B
						,(CASE WHEN TO_DATE('20240224' , 'YYYYMMDD') -  NVL(CORP_FNDN_DAY, SYSDATE) >= 365 * 3 THEN 'Y' /*2024년 마감일 기준으로*/
									ELSE 'N' END
						)  AS CHK_A_C
						,(CASE WHEN INVST_EXPND_FRMER_NOPE >= 20 THEN 'Y'
									ELSE 'N' END
						)  AS CHK_A_D
						,(CASE WHEN  NVL(FRMER_INVST_AMT / NULLIF(INVST_AMT,0)*100 , 0) >= 50 THEN 'Y'
									ELSE 'N' END
						)  AS CHK_A_E
						,(CASE WHEN EXISTS (SELECT COUNT(*)
															FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND TYPE_SE_NO = '8'
															  AND YR = #{yr}
															  AND BRNO = EA.BRNO
															  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PST.YR AND BRNO = PST.BRNO AND ITEM_CD = PST.ITEM_CD)
													)
											THEN 'Y'
											ELSE 'N'
											END
						) AS CHK_B
					FROM (SELECT * FROM TB_EV_APO WHERE APO_SE = '1' AND BRNO = #{brno}) EA )
			) CHK
		WHERE 1=1
		  AND EAM.YR = RR.YR(+)
		  AND EAM.BRNO = RR.BRNO(+)
		  AND EAM.BRNO = CHK.BRNO(+)
	</select>

	<!-- 출자출하조직 등록결과 리스트 -->
	<select id="selectIsoList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.selectIsoList */
			TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.BRNO
			,TOTAL.UO_BRNO
			,TOTAL.YR
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.CORP_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER
			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER
					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT

					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = ITEM.CTGRY_CD) AS CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS UO_CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, (TOTA.UO_SPMT_AMT + TOTA.UO_OTHER_SPMT_AMT + TOTB.UO_SPMT_AMT + TOTB.UO_OTHER_SPMT_AMT) AS UO_SPMT_AMT_TOT

							, ROUND(NVL( TOTA.UO_SPMT_AMT / NULLIF( TOTA.UO_SPMT_AMT + TOTA.UO_OTHER_SPMT_AMT , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(NVL( (TOTA.UO_SPMT_AMT + TOTB.UO_SPMT_AMT) / NULLIF( TOTA.UO_SPMT_AMT + TOTA.UO_OTHER_SPMT_AMT + TOTB.UO_SPMT_AMT + TOTB.UO_OTHER_SPMT_AMT, 0 ) , 0 ) * 100 , 2) AS UO_SPMT_AMT_TOT_RT
							, ITEM.STBLT_YN
						FROM
							(SELECT
									YR
									,BRNO
									,UO_BRNO
									,ITEM_CD
									,(SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = PST.UO_BRNO AND YR = PST.YR AND ITEM_CD = PST.ITEM_CD) AS CTGRY_CD
									,(SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = PST.UO_BRNO AND YR = PST.YR AND ITEM_CD = PST.ITEM_CD) AS STTG_UPBR_ITEM_SE
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = PST.ITEM_CD) AS ITEM_NM
									, STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
								WHERE 1=1
									AND TYPE_SE_NO = '8'
									AND APO_SE = '2'
									AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = PST.UO_BRNO AND YR = PST.YR AND ITEM_CD = PST.ITEM_CD)
									AND UO_BRNO =  #{brno}
									AND YR = #{yr}
							) ITEM ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								AND APO_SE = '2'
								AND TYPE_SE_NO IN ('5')
								AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															AND STBLT_YN = 'Y'
															AND NVL(EXCL_YN,'N') != 'Y'
															AND APO_SE = '2'
															AND UO_BRNO = #{brno}
															AND YR = #{yr}
														)
								AND UO_BRNO = #{brno}
								AND YR = #{yr}
									GROUP BY  UO_BRNO , BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								AND APO_SE = '2'
								AND TYPE_SE_NO IN ('7')
								AND UO_BRNO = #{brno}
								AND YR = #{yr}
								GROUP BY UO_BRNO, BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)
						AND ITEM.BRNO = TOTA.BRNO(+)
						AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
						AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)
						AND ITEM.BRNO = TOTB.BRNO(+)
				)TOT
		)TOTAL
		WHERE 1=1
		  AND  (NVL(TOTAL.UO_SPMT_AMT,0) != 0
				OR NVL(TOTAL.UO_SPMT_AMT_OTHER,0) != 0
				OR NVL(TOTAL.UO_OTHER_SPMT_AMT,0) != 0
				OR NVL(TOTAL.UO_OTHER_SPMT_AMT_OTHER,0) != 0 )
		ORDER BY ITEM_CD , BRNO
	</select>
	<!-- 출자출하조직 총괄 리스트 -->
	<select id="selectIsoTotList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.selectIsoTotList */
			TOT.YR
			,TOT.BRNO
			,TOT.CORP_NM
			,TOT.CORP_SE_CD
			,TOT.CORP_SE_NM
			,TOT.CORP_DTL_SE_CD
			,TOT.CORP_DTL_SE_NM
			,TOT.ICPT_RSN_CD
			,TOT.ICPT_RSN_DTL_CD
			,TOT.MNGR_STBLT_YN
			,TOT.MNGR_ICPT_RSN_CD
			,TOT.MNGR_ICPT_RSN_DTL_CD
			,TOT.MNGR_ITR_RT
			,TOT.APO_SE
			,TOT.UO_BRNO
			,TOT.STBLT_YN
			,TOT.STBLT_ITEM_LIST
			,DECODE(TOT.STBLT_YN
						,'Y',(SELECT
									(CASE WHEN NVL(ERR.MNGR_ITR_RT,'') IS NOT NULL
												THEN ERR.MNGR_ITR_RT
												ELSE ERR.ITR_RT
												END)
								FROM TB_EV_REG_RSLT ERR
								WHERE 1=1
								  AND APO_SE = '1'
								  AND YR = TOT.YR
								  AND BRNO = TOT.UO_BRNO
								)
						,'N',TOT.ORG_ITR_RT
						,''
			) AS ITR_RT
			,TOT.RMRK
			,NVL((SELECT ISO_FUND_APLY_AMT
					FROM TB_EV_APLY_MNG
					WHERE 1=1
					  AND YR = TOT.YR
					  AND BRNO = TOT.BRNO
					  AND UO_BRNO = TOT.UO_BRNO
					),0
			) AS ISO_FUND_APLY_AMT
		FROM
			(SELECT
				EAM.YR
				,EAM.BRNO
				,EAM.APO_SE
				,#{brno} AS UO_BRNO
				,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS CORP_NM
				,CHK.CORP_SE_CD
				,CHK.CORP_SE_NM
				,CHK.CORP_DTL_SE_CD
				,CHK.CORP_DTL_SE_NM
				,CHK.ICPT_RSN_CD
				,CHK.ICPT_RSN_DTL_CD
				,(CASE WHEN CHK.ICPT_RSN_CD IN ('A','B','C') THEN 'N'
						ELSE 'Y'
						END
				) AS STBLT_YN
				,RR.MNGR_STBLT_YN
				,RR.MNGR_ICPT_RSN_CD
				,RR.MNGR_ICPT_RSN_DTL_CD
				,RR.MNGR_ITR_RT
				,(SELECT LISTAGG(ITEM_NM, ' , ') WITHIN GROUP (ORDER BY ITEM_NM) AS STBLT_YN_NM
								FROM (SELECT
											(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
										FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
										WHERE 1=1
										  AND STBLT_YN = 'Y'
										  AND 'Y' = (SELECT STBLT_YN
										  				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
										  				WHERE 1=1
										  				  AND APO_SE = '1'
										  				  AND TYPE_SE_NO = '8'
										  				  AND YR = A.YR
										  				  AND BRNO = A.UO_BRNO
										  				  AND ITEM_CD = A.ITEM_CD)
										  AND APO_SE = EAM.APO_SE
										  AND TYPE_SE_NO = '8'
										  AND YR = EAM.YR
										  AND BRNO = EAM.BRNO
										  AND UO_BRNO = #{brno}
										)
				) AS STBLT_ITEM_LIST
				,RR.ITR_RT AS ORG_ITR_RT
				,RR.RMRK
			FROM
				(SELECT * FROM TB_EV_APLY_MNG
					WHERE YR = #{yr} AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD  WHERE UO_BRNO = #{brno})
				) EAM
				, (SELECT * FROM TB_EV_REG_RSLT
					WHERE UO_BRNO = #{brno} AND YR = #{yr}
				) RR
				,(SELECT
						BRNO
						,CORP_SE_CD
						,CORP_SE_NM
						,CORP_DTL_SE_CD
						,CORP_DTL_SE_NM
						,(CASE
								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND (CHK_A_A != 'Y' OR CHK_A_B != 'Y' OR CHK_A_C != 'Y' OR CHK_A_D != 'Y' OR CHK_A_E != 'Y' )  THEN  'A'
								WHEN CORP_SE_CD = 'C34030' AND (CHK_A_A != 'Y' OR CHK_A_B != 'Y' OR CHK_A_C != 'Y' OR CHK_A_D != 'Y' OR CHK_A_E != 'Y' )  THEN  'A'

								WHEN CORP_SE_CD IN ('C34010','C34020','C34030') AND CHK_B != 'Y'  THEN  'B'
								WHEN CORP_SE_CD IN ('C34010','C34020','C34030') AND CHK_C != 'Y'  THEN  'C'
								ELSE ''
								END
						) AS ICPT_RSN_CD
						,(CASE WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_A = 'N'  THEN 'A1'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_A = 'N'  THEN 'A1'

								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_B = 'N'  THEN 'A2'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_B = 'N'  THEN 'A2'

								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_C = 'N'  THEN 'A3'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_C = 'N'  THEN 'A3'

								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_D = 'N'  THEN 'A4'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_D = 'N'  THEN  'A4'

								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_E = 'N'  THEN 'A5'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_E = 'N'  THEN  'A5'

								WHEN CORP_SE_CD = 'C34010' AND CHK_B = 'N'  THEN 'B1'
								WHEN CORP_SE_CD IN ('C34020','C34030') AND CHK_B = 'N'  THEN 'B2'
								WHEN CORP_SE_CD = 'C34010' AND CHK_C = 'N'  THEN 'C1'
								WHEN CORP_SE_CD IN ('C34020','C34030') AND CHK_C = 'N'  THEN 'C2'
								ELSE ''
								END
						) AS ICPT_RSN_DTL_CD
					FROM
						(SELECT
							BRNO
							,CORP_SE_CD
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = EA.CORP_SE_CD) AS CORP_SE_NM
							,CORP_DTL_SE_CD
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SHAP' AND CD_VL = EA.CORP_DTL_SE_CD) AS CORP_DTL_SE_NM

							,NVL(MNGMST_YN,'N') AS CHK_A_A
							,(CASE WHEN TO_NUMBER(NVL(INVST_AMT,0)) >=  100000 THEN 'Y'
										ELSE 'N' END
							)  AS CHK_A_B
							,(CASE WHEN TO_DATE('20240224' , 'YYYYMMDD') -  NVL(CORP_FNDN_DAY, SYSDATE) >= 365 THEN 'Y'
										ELSE 'N' END
							)  AS CHK_A_C
							,(CASE WHEN INVST_EXPND_FRMER_NOPE >= 5 THEN 'Y'
										ELSE 'N' END
							)  AS CHK_A_D
							,(CASE WHEN  NVL(FRMER_INVST_AMT / NULLIF(INVST_AMT,0)*100 , 0) >= 50 THEN 'Y'
										ELSE 'N' END
							)  AS CHK_A_E
							,(CASE WHEN EXISTS (SELECT COUNT(*)
																FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
																WHERE 1=1
																  AND STBLT_YN = 'Y'
																  AND APO_SE = '2'
																  AND 'Y' = (SELECT STBLT_YN
																  				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
																  				WHERE 1=1
																  				  AND APO_SE = '1'
																  				  AND TYPE_SE_NO = '8'
																  				  AND YR = PST.YR
																  				  AND BRNO = PST.UO_BRNO
																  				  AND ITEM_CD = PST.ITEM_CD)
																  AND TYPE_SE_NO = '8'
																  AND YR = #{yr}
																  AND BRNO = EA.BRNO
																  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PST.YR AND BRNO = #{brno} AND ITEM_CD = PST.ITEM_CD)
														)
												THEN 'Y'
												ELSE 'N'
												END
							) AS CHK_B
							,(SELECT
									(CASE WHEN MNGR_STBLT_YN IS NOT NULL
											THEN MNGR_STBLT_YN
											ELSE STBLT_YN
											END)
								FROM TB_EV_REG_RSLT
								WHERE 1=1
								  AND YR = #{yr}
								  AND BRNO = #{brno}
							) AS CHK_C
					FROM (SELECT *
							FROM TB_EV_APO
							WHERE 1=1
							  AND APO_SE = '2'
							  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = #{brno})
							) EA
					)
				) CHK
			WHERE 1=1
			  AND EAM.YR = RR.YR(+)
			  AND EAM.BRNO = RR.BRNO(+)
			  AND EAM.BRNO = CHK.BRNO(+)
			) TOT
	</select>
	<!-- 생산자조직 등록결과 리스트 -->
	<select id="selectFrmhsList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.selectFrmhsList */
			TOTAL.BRNO
			,DECODE(TOTAL.APO_SE , '1' , TOTAL.BRNO , '2' , TOTAL.UO_BRNO , '')AS UO_BRNO
			,TOTAL.APO_SE
			,DECODE(TOTAL.APO_SE,'1','통합조직','2','출자출하조직','') AS APO_SE_NM
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = TOTAL.BRNO) AS CORP_NM
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = TOTAL.UO_BRNO) AS UO_CORP_NM
			,TOTAL.PRDCR_OGNZ_SN
			,TOTAL.PRDCR_OGNZ_NM
			,TOTAL.YR
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.CTGRY_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = TOTAL.CTGRY_CD) AS CTGRY_NM
			,TOTAL.ITEM_CD
			,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = TOTAL.ITEM_CD) AS ITEM_NM
			,TOTAL.TRMT_TYPE
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'TRMT_TYPE' AND CD_VL = TOTAL.TRMT_TYPE) AS TRMT_TYPE_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = TOTAL.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
			,TOTAL.CNT
			,TOTAL.SPMT_PRC_TOT
			,TOTAL.PRDCTN_VLM_TOT
			,TOTAL.EC_SPMT_VLM_TOT
			,TOTAL.EC_SPMT_PLAN_VLM_TOT
			,TOTAL.EC_SPMT_RATE_A
			,TOTAL.EC_SPMT_RATE_B
			,(CASE WHEN APRV = '1' THEN
									(CASE WHEN TOTAL.STTG_UPBR_ITEM_SE = '1' THEN
																				(CASE WHEN TO_NUMBER(TOTAL.CNT) >= 5 AND TO_NUMBER(TOTAL.SPMT_PRC_TOT) >= 200000 AND TO_NUMBER(TOTAL.EC_SPMT_RATE_A) >= 80
																					THEN 'Y'
																					ELSE 'N' END)
										WHEN TOTAL.STTG_UPBR_ITEM_SE = '2' THEN 'Y'
										ELSE 'N' END)
					WHEN APRV = '2' THEN
									(CASE WHEN TRMT_TYPE = '1' THEN
																	(CASE WHEN TO_NUMBER(TOTAL.CNT) >= 5  AND TO_NUMBER(TOTAL.SPMT_PRC_TOT) >= 50000 AND TO_NUMBER(TOTAL.EC_SPMT_RATE_B) >= 80
																		THEN 'Y'
																		ELSE 'N' END)
											WHEN TRMT_TYPE = '2' THEN
																	(CASE WHEN TO_NUMBER(TOTAL.CNT) >= 5 AND TO_NUMBER(TOTAL.SPMT_PRC_TOT) >= 50000
																		THEN 'Y'
																		ELSE 'N' END)
											WHEN TRMT_TYPE = '3' THEN
																	(CASE WHEN TO_NUMBER(TOTAL.SPMT_PRC_TOT) >= 50000
																		THEN 'Y'
																		ELSE 'N' END)
										ELSE 'N' END)
				ELSE 'N'
				END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
		FROM (SELECT
			TEFA.BRNO
			,TEFA.UO_BRNO
			,TEFA.PRDCR_OGNZ_SN
			,TEFA.PRDCR_OGNZ_NM
			,TEFA.YR
			,TEFA.APO_SE
			,TEFA.ITEM_CD
			,TEFA.CTGRY_CD
			,TEFA.STTG_UPBR_ITEM_SE
			,TEFA.STBLT_YN AS ORG_STBLT_YN
			,NVL(TEFA.TRMT_TYPE,'0') AS TRMT_TYPE
			,(SELECT APO_SE FROM TB_EV_APO WHERE BRNO = TEFA.BRNO) AS APO_SE_CHK
			,(SELECT NVL(APRV,'0')
				FROM TB_EV_APO
				WHERE BRNO = (CASE WHEN TEFA.APO_SE = '1'
									THEN NVL(TEFA.BRNO,'')
									ELSE NVL(TEFA.UO_BRNO,'') END)
			) AS APRV
			,CNT
			,TEFPSS.SPMT_PRC_TOT
			,TEFPSS.PRDCTN_VLM_TOT
			,TEFPSS.EC_SPMT_VLM_TOT
			,TEFPSS.EC_SPMT_PLAN_VLM_TOT
			,ROUND(NVL( TEFPSS.EC_SPMT_VLM_TOT/ NULLIF( TEFPSS.PRDCTN_VLM_TOT, 0 ) , 0 ) * 100 , 2 ) AS EC_SPMT_RATE_A
			,ROUND(NVL( TEFPSS.EC_SPMT_VLM_TOT/ NULLIF( TEFPSS.EC_SPMT_PLAN_VLM_TOT, 0 ) , 0 ) * 100 , 2 ) AS EC_SPMT_RATE_B
		FROM (SELECT *
					FROM TB_EV_FRMHS_APO
					WHERE 1=1
					  AND ITEM_CD IN (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = #{yr} AND BRNO = #{brno})
					  AND (UO_BRNO = #{brno} OR BRNO = #{brno})
					  AND NVL(EXCL_YN,'N') != 'Y'
					  AND YR = #{yr}
					) TEFA
		LEFT JOIN (SELECT
								PRDCR_OGNZ_SN
								,YR
								,BRNO
								,COUNT(PRDCR_OGNZ_SN) AS CNT
								,SUM(NVL(SPMT_PRC,0)) AS SPMT_PRC_TOT
								,SUM(NVL(PRDCTN_VLM,0)) AS PRDCTN_VLM_TOT
								,SUM(NVL(EC_SPMT_VLM,0)) AS EC_SPMT_VLM_TOT
								,SUM(NVL(EC_SPMT_PLAN_VLM,0)) AS EC_SPMT_PLAN_VLM_TOT
							FROM TB_EV_FRMHS_PRDCTN_EC_SPMT_STTN
							WHERE 1=1
							  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
														FROM TB_EV_FRMHS_APO
														WHERE 1=1
														  AND YR = #{yr}
														  AND NVL(EXCL_YN,'N') != 'Y'
														  AND ITEM_CD IN (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = #{yr} AND BRNO = #{brno})
														  AND (UO_BRNO = #{brno} OR BRNO = #{brno})
													)
							  AND YR = #{yr}
							GROUP BY PRDCR_OGNZ_SN , YR , BRNO
							)TEFPSS
		ON TEFA.PRDCR_OGNZ_SN = TEFPSS.PRDCR_OGNZ_SN
		AND TEFA.YR = TEFPSS.YR(+)
		AND TEFA.BRNO = TEFPSS.BRNO(+)
		)TOTAL
		ORDER BY ITEM_CD , UO_BRNO DESC , BRNO , PRDCR_OGNZ_SN
	</select>

	<insert id="insertUoTotList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		MERGE INTO TB_EV_REG_RSLT CLT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.insertUoTotList */
		USING DUAL
			ON (
					CLT.BRNO		= #{brno}
				AND CLT.YR			= #{yr}
				AND CLT.APO_SE		= '1'
				)
		WHEN MATCHED THEN
				 UPDATE
					   SET
						  FUND_APLY_AMT_TOT		= #{fundAplyAmtTot}
						, FUND_APLY_AMT_STBLT_TOT = #{fundAplyAmtStbltTot}
						, STBLT_ITEM_LIST		= #{stbltItemList}

						, STBLT_YN				= #{stbltYn}
						, ICPT_RSN_CD			= #{icptRsnCd}
						, ICPT_RSN_DTL_CD		= #{icptRsnDtlCd}
						, ITR_RT				= #{itrRt}

						, MNGR_STBLT_YN			= #{mngrStbltYn}
						, MNGR_ICPT_RSN_CD		= #{mngrIcptRsnCd}
						, MNGR_ICPT_RSN_DTL_CD	= #{mngrIcptRsnDtlCd}
						, MNGR_ITR_RT			= #{mngrItrRt}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

					WHERE 1=1
					  AND CLT.BRNO		= #{brno}
					  AND CLT.YR		= #{yr}
					  AND CLT.APO_SE	= '1'

		WHEN NOT MATCHED THEN
			 INSERT
					(
						YR
					  , BRNO
					  , APO_SE

					  , FUND_APLY_AMT_TOT
					  , FUND_APLY_AMT_STBLT_TOT
					  , STBLT_ITEM_LIST

					  , STBLT_YN
					  , ICPT_RSN_CD
					  , ICPT_RSN_DTL_CD
					  , ITR_RT

					  , MNGR_STBLT_YN
					  , MNGR_ICPT_RSN_CD
					  , MNGR_ICPT_RSN_DTL_CD
					  , MNGR_ITR_RT

					  , RMRK

					  , SYS_FRST_INPT_DT
					  , SYS_FRST_INPT_USER_ID
					  , SYS_FRST_INPT_PRGRM_ID
					  , SYS_LAST_CHG_DT
					  , SYS_LAST_CHG_USER_ID
					  , SYS_LAST_CHG_PRGRM_ID
					)
				VALUES
					(
						#{yr}
					  , #{brno}
					  , '1'

					  , #{fundAplyAmtTot}
					  , #{fundAplyAmtStbltTot}
					  , #{stbltItemList}

					  , #{stbltYn}
					  , #{icptRsnCd}
					  , #{icptRsnDtlCd}
					  , #{itrRt}

					  , #{mngrStbltYn}
					  , #{mngrIcptRsnCd}
					  , #{mngrIcptRsnDtlCd}
					  , #{mngrItrRt}

					  , #{rmrk}

					  , SYSDATE
					  , #{sysFrstInptUserId}
					  , #{sysFrstInptPrgrmId}
					  , SYSDATE
					  , #{sysLastChgUserId}
					  , #{sysLastChgPrgrmId}
					)
	</insert>

	<insert id="insertIsoTotList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		MERGE INTO TB_EV_REG_RSLT CLT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.insertIsoTotList */
		USING DUAL
			ON (
					CLT.BRNO		= #{brno}
				AND CLT.UO_BRNO		= #{uoBrno}
				AND CLT.YR			= #{yr}
				AND CLT.APO_SE		= '2'
				)
		WHEN MATCHED THEN
				 UPDATE
					   SET
						  STBLT_ITEM_LIST		= #{stbltItemList}

						, STBLT_YN				= #{stbltYn}
						, ICPT_RSN_CD			= #{icptRsnCd}
						, ICPT_RSN_DTL_CD		= #{icptRsnDtlCd}
						, ITR_RT				= #{itrRt}

						, MNGR_STBLT_YN			= #{mngrStbltYn}
						, MNGR_ICPT_RSN_CD		= #{mngrIcptRsnCd}
						, MNGR_ICPT_RSN_DTL_CD	= #{mngrIcptRsnDtlCd}
						, MNGR_ITR_RT			= #{mngrItrRt}

						, RMRK					= #{rmrk}

						, SYS_LAST_CHG_DT		= SYSDATE
						, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
						, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

					WHERE 1=1
					  AND CLT.BRNO		= #{brno}
					  AND CLT.UO_BRNO	= #{uoBrno}
					  AND CLT.YR		= #{yr}
					  AND CLT.APO_SE	= '2'

		WHEN NOT MATCHED THEN
			 INSERT
					(
						YR
					  , BRNO
					  , UO_BRNO
					  , APO_SE

					  , STBLT_ITEM_LIST

					  , STBLT_YN
					  , ICPT_RSN_CD
					  , ICPT_RSN_DTL_CD
					  , ITR_RT

					  , MNGR_STBLT_YN
					  , MNGR_ICPT_RSN_CD
					  , MNGR_ICPT_RSN_DTL_CD
					  , MNGR_ITR_RT

					  , RMRK

					  , SYS_FRST_INPT_DT
					  , SYS_FRST_INPT_USER_ID
					  , SYS_FRST_INPT_PRGRM_ID
					  , SYS_LAST_CHG_DT
					  , SYS_LAST_CHG_USER_ID
					  , SYS_LAST_CHG_PRGRM_ID
					)
				VALUES
					(
						#{yr}
					  , #{brno}
					  , #{uoBrno}
					  , '2'

					  , #{stbltItemList}

					  , #{stbltYn}
					  , #{icptRsnCd}
					  , #{icptRsnDtlCd}
					  , #{itrRt}

					  , #{mngrStbltYn}
					  , #{mngrIcptRsnCd}
					  , #{mngrIcptRsnDtlCd}
					  , #{mngrItrRt}

					  , #{rmrk}

					  , SYSDATE
					  , #{sysFrstInptUserId}
					  , #{sysFrstInptPrgrmId}
					  , SYSDATE
					  , #{sysLastChgUserId}
					  , #{sysLastChgPrgrmId}
					)
	</insert>
	<select id="selectRawDataList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.selectRawDataList */
			ERR.YR
			, ERR.BRNO
			, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_NM
			, DECODE(ERR.APO_SE , '1' , '통합조직' , '2' , '출자출하조직') AS APO_SE
			, DECODE(ERR.APO_SE , '1' , ERR.BRNO , '2' , ERR.UO_BRNO) AS UO_BRNO
			, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = DECODE(ERR.APO_SE , '1' , ERR.BRNO , '2' , ERR.UO_BRNO)) AS UO_CORP_NM

			, (SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_SE_CD
			, (SELECT CD_VL_NM
				FROM TB_COM_CD_DTL
				WHERE 1=1
				  AND CD_ID = 'CORP_SE_CD'
				  AND CD_VL = (SELECT CORP_SE_CD
				  				FROM TB_EV_APO
				  				WHERE 1=1
				  				  AND BRNO = ERR.BRNO
				  				)
			) AS CORP_SE_NM

			, (SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = ERR.BRNO) AS CORP_DTL_SE_CD
			, (SELECT CD_VL_NM
				FROM TB_COM_CD_DTL
				WHERE 1=1
				  AND CD_ID = 'CORP_SHAP'
				  AND CD_VL = (SELECT CORP_DTL_SE_CD
				  				FROM TB_EV_APO
				  				WHERE 1=1
				  				  AND BRNO = ERR.BRNO
				  				)
			) AS CORP_DTL_SE_NM

			, STBLT_ITEM_LIST
			, DECODE(ERR.APO_SE
							, '2' , (SELECT ISO_FUND_APLY_AMT
										FROM TB_EV_APLY_MNG
										WHERE 1=1
										  AND YR = ERR.YR
										  AND BRNO = ERR.BRNO
										  AND UO_BRNO = ERR.UO_BRNO
										)
							,NULL
			) AS ISO_FUND_APLY_AMT
			, FUND_APLY_AMT_TOT
			, DECODE(ERR.APO_SE
						, '1' , (NVL((SELECT PRUO_FUND_APLY_AMT
										FROM TB_EV_APLY_MNG
										WHERE 1=1
										  AND BRNO = ERR.BRNO
										  AND YR = ERR.YR
										  AND APO_SE = '1'
									),0)
								+ NVL((SELECT SUM(ISO_FUND_APLY_AMT)
										FROM TB_EV_APLY_MNG TEAM
										WHERE 1=1
										  AND YR = ERR.YR
										  AND UO_BRNO = ERR.BRNO
										  AND APO_SE = '2'
										  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = ERR.BRNO)
										  AND BRNO = (SELECT BRNO
										  				FROM TB_EV_REG_RSLT TERR
										  				WHERE 1=1
										  				  AND APO_SE = '2'
										  				  AND YR = TEAM.YR
										  				  AND BRNO = TEAM.BRNO
										  				  AND UO_BRNO = ERR.BRNO
										  				  AND 'Y' = (CASE WHEN TERR.MNGR_STBLT_YN = 'Y' THEN 'Y'
										  									WHEN TERR.MNGR_STBLT_YN = 'N' THEN 'N'
										  									ELSE TERR.STBLT_YN
										  									END)
										  				)
										  ),0)
								)
						,NULL
			)AS FUND_APLY_AMT_STBLT_TOT
			, STBLT_YN
			, ITR_RT
			, ICPT_RSN_CD
			, DECODE(ERR.ICPT_RSN_CD , 'A' , '기본요건 미충족'
										,'B' ,'세부요건 미충족'
										,'C' , '통합조직 탈락'
										,'EX1' , '-'
										,'EX2' , '-'
										,''
			)AS ICPT_RSN_NM
			, ICPT_RSN_DTL_CD
			, DECODE(ERR.ICPT_RSN_DTL_CD , 'A1' , '농업경영체 미등록'
											,'A2' ,'출자자본금 1억원 미달'
											,'A3' ,'설립 후 운영실적 1년 미만'
											,'A4' ,'농업인 주주 5명 미만'
											,'A5' ,'농업인 주주 지분 50% 미만'
											,'A6' ,'원예농산물 취급액 50% 미만'
											,'A7' ,'조공설립계획 미수립'
											,'A8' ,'현장실사 미참여'
											,'B1' ,'품목 부적합(농협조직)'
											,'B2' ,'품목 부적합(농업법인, 협동조합)'
											,'C1' , '통합조직 탈락(농협조직)'
											,'C2' , '통합조직 탈락(농업법인, 협동조합)'
											,'-' , '-'
											,''
			)AS ICPT_RSN_DTL_NM
			, DECODE(ERR.ICPT_RSN_CD , 'A' , '기존자금 회수'
										,'B' ,'최고금리'
										,'C' , '최고금리'
										,'EX1' , '최고금리'
										,'EX2' , '기존자금 회수'
										,''
			)AS PNLTY
			, MNGR_STBLT_YN
			, MNGR_ITR_RT
			, MNGR_ICPT_RSN_CD
			, DECODE(ERR.MNGR_ICPT_RSN_CD , 'A' , '기본요건 미충족'
											,'B' ,'세부요건 미충족'
											,'C' , '통합조직 탈락'
											,'EX1' , '-'
											,'EX2' , '-'
											,''
			)AS MNGR_ICPT_RSN_NM
			, MNGR_ICPT_RSN_DTL_CD
			, DECODE(ERR.MNGR_ICPT_RSN_DTL_CD , 'A1' , '농업경영체 미등록'
												,'A2' ,'출자자본금 1억원 미달'
												,'A3' ,'설립 후 운영실적 1년 미만'
												,'A4' ,'농업인 주주 5명 미만'
												,'A5' ,'농업인 주주 지분 50% 미만'
												,'A6' ,'원예농산물 취급액 50% 미만'
												,'A7' ,'조공설립계획 미수립'
												,'A8' ,'현장실사 미참여'
												,'B1' ,'품목 부적합(농협조직)'
												,'B2' ,'품목 부적합(농업법인, 협동조합)'
												,'C1' , '통합조직 탈락(농협조직)'
												,'C2' , '통합조직 탈락(농업법인, 협동조합)'
												,'-' , '-'
												,''
			)AS MNGR_ICPT_RSN_DTL_NM
			, DECODE(ERR.MNGR_ICPT_RSN_CD , 'A' , '기존자금 회수'
											,'B' ,'최고금리'
											,'C' , '최고금리'
											,'EX1' , '최고금리'
											,'EX2' , '기존자금 회수'
											,''
			)AS MNGR_PNLTY
			, RMRK
		FROM TB_EV_REG_RSLT ERR
		WHERE 1=1
			AND YR = #{yr}
			AND BRNO NOT IN (SELECT BRNO
								FROM TB_COM_USER
								WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61')
							)
			AND BRNO NOT IN (SELECT BRNO
								FROM TB_COM_USER
								WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51')
								)
			AND UO_BRNO NOT IN (SELECT BRNO
									FROM TB_COM_USER
									WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51')
								)
		ORDER BY UO_BRNO , APO_SE DESC
	</select>


	<!-- 통합조직 선정여부 일괄 조회 -->
	<select id="selectUoIcptRsnList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.selectUoIcptRsnList */
			EAM.YR
			,EAM.BRNO
			,EAM.APO_SE
			,CHK.ICPT_RSN_CD
			,CHK.ICPT_RSN_DTL_CD
			,(CASE WHEN CHK.ICPT_RSN_CD IN ('A','B') THEN 'N'
					ELSE 'Y'
					END
			) AS STBLT_YN
			,(NVL(EAM.PRUO_FUND_APLY_AMT,0)
				+ NVL((SELECT SUM(ISO_FUND_APLY_AMT)
						FROM TB_EV_APLY_MNG
						WHERE 1=1
						  AND YR = EAM.YR
						  AND UO_BRNO = EAM.BRNO
						  AND APO_SE = '2'
						  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = EAM.BRNO) ),0)
			) AS FUND_APLY_AMT_TOT
			,(NVL(EAM.PRUO_FUND_APLY_AMT,0)
				+ NVL((SELECT SUM(ISO_FUND_APLY_AMT)
						FROM TB_EV_APLY_MNG TEAM
						WHERE 1=1
						  AND YR = EAM.YR
						  AND UO_BRNO = EAM.BRNO
						  AND APO_SE = '2'
						  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = EAM.BRNO)
						  AND BRNO = (SELECT BRNO
						  				FROM TB_EV_REG_RSLT TERR
						  				WHERE 1=1
						  				  AND APO_SE = '2'
						  				  AND YR = TEAM.YR
						  				  AND BRNO = TEAM.BRNO
						  				  AND UO_BRNO = EAM.BRNO
						  				  AND 'Y' = (CASE WHEN TERR.MNGR_STBLT_YN = 'Y' THEN 'Y'
						  									WHEN TERR.MNGR_STBLT_YN = 'N' THEN 'N'
						  									ELSE TERR.STBLT_YN
						  									END)
						  				)
						  ),0)
			) AS FUND_APLY_AMT_STBLT_TOT
			,(SELECT LISTAGG(ITEM_NM, ' , ') WITHIN GROUP (ORDER BY ITEM_NM) AS STBLT_YN_NM
								FROM (SELECT
											(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
										FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
										WHERE 1=1
										  AND STBLT_YN = 'Y'
										  AND APO_SE = EAM.APO_SE
										  AND TYPE_SE_NO = '8'
										  AND YR = EAM.YR
										  AND BRNO = EAM.BRNO
										)
				) AS STBLT_ITEM_LIST
			,DECODE( CHK.ICPT_RSN_DTL_CD
							, 'B1' ,  3
							, 'B2' ,  2.5
							, 'C1' ,  3
							, 'C2' ,  2.5
							, NULL
			)AS ITR_RT
			,RR.MNGR_STBLT_YN
			,RR.MNGR_ICPT_RSN_CD
			,RR.MNGR_ICPT_RSN_DTL_CD
			,RR.MNGR_ITR_RT
			,RR.RMRK
		FROM
			(SELECT *
				FROM TB_EV_APLY_MNG
				WHERE 1=1
				  AND APO_SE = '1'
				  AND YR = #{yr}
			) EAM
			, (SELECT *
					FROM TB_EV_REG_RSLT
					WHERE 1=1
					  AND APO_SE = '1'
					  AND YR = #{yr}
			) RR
			,(SELECT
					BRNO
					,CORP_SE_CD
					,CORP_SE_NM
					,CORP_DTL_SE_CD
					,CORP_DTL_SE_NM
					,(CASE
							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND (CHK_A_A != 'Y' OR CHK_A_B != 'Y' OR CHK_A_C != 'Y' OR CHK_A_D != 'Y' OR CHK_A_E != 'Y' )  THEN  'A'
							WHEN CORP_SE_CD = 'C34030' AND (CHK_A_A != 'Y' OR CHK_A_B != 'Y' OR CHK_A_C != 'Y' OR CHK_A_D != 'Y' OR CHK_A_E != 'Y' )  THEN  'A'

							WHEN CORP_SE_CD IN ('C34010','C34020','C34030') AND CHK_B != 'Y'  THEN  'B'
							ELSE ''
							END
					) AS ICPT_RSN_CD
					,(CASE WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_A = 'N'  THEN 'A1'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_A = 'N'  THEN 'A1'

							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_B = 'N'  THEN 'A2'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_B = 'N'  THEN 'A2'

							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_C = 'N'  THEN 'A3'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_C = 'N'  THEN 'A3'

							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_D = 'N'  THEN 'A4'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_D = 'N'  THEN  'A4'

							WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_E = 'N'  THEN 'A5'
							WHEN CORP_SE_CD = 'C34030' AND CHK_A_E = 'N'  THEN  'A5'

							WHEN CORP_SE_CD = 'C34010' AND CHK_B = 'N'  THEN 'B1'
							WHEN CORP_SE_CD IN ('C34020','C34030') AND CHK_B = 'N'  THEN 'B2'
							ELSE ''
							END
					) AS ICPT_RSN_DTL_CD
				FROM
					(SELECT
						BRNO
						,CORP_SE_CD
						,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = EA.CORP_SE_CD) AS CORP_SE_NM
						,CORP_DTL_SE_CD
						,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SHAP' AND CD_VL = EA.CORP_DTL_SE_CD) AS CORP_DTL_SE_NM

						,NVL(MNGMST_YN,'N') AS CHK_A_A
						,(CASE WHEN TO_NUMBER(NVL(INVST_AMT,0)) >=  300000 THEN 'Y'
									ELSE 'N' END
						)  AS CHK_A_B
						,(CASE WHEN TO_DATE('20240224' , 'YYYYMMDD') -  NVL(CORP_FNDN_DAY, SYSDATE) >= 365 * 3 THEN 'Y' /*2024년 마감일 기준으로*/
									ELSE 'N' END
						)  AS CHK_A_C
						,(CASE WHEN INVST_EXPND_FRMER_NOPE >= 20 THEN 'Y'
									ELSE 'N' END
						)  AS CHK_A_D
						,(CASE WHEN  NVL(FRMER_INVST_AMT / NULLIF(INVST_AMT,0)*100 , 0) >= 50 THEN 'Y'
									ELSE 'N' END
						)  AS CHK_A_E
						,(CASE WHEN EXISTS (SELECT COUNT(*)
															FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND TYPE_SE_NO = '8'
															  AND YR = #{yr}
															  AND BRNO = EA.BRNO
															  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PST.YR AND BRNO = PST.BRNO AND ITEM_CD = PST.ITEM_CD)
													)
											THEN 'Y'
											ELSE 'N'
											END
						) AS CHK_B
					FROM
						(SELECT *
							FROM TB_EV_APO
							WHERE APO_SE = '1'
							AND BRNO IN (SELECT BRNO FROM TB_EV_APLY_MNG WHERE YR = #{yr} AND APO_SE = '1')
						) EA
					)
			) CHK
		WHERE 1=1
		  AND EAM.YR = RR.YR(+)
		  AND EAM.BRNO = RR.BRNO(+)
		  AND EAM.BRNO = CHK.BRNO(+)
	</select>
	<!-- 출자출하조직 총괄 리스트 -->
	<select id="selectIsoIcptRsnList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT /* com.at.apcss.pd.pcorm.mapper.PrdcrCrclOgnVluIdctrMngMapper.selectIsoIcptRsnList */
			TOT.YR
			,TOT.BRNO
			,TOT.ICPT_RSN_CD
			,TOT.ICPT_RSN_DTL_CD
			,TOT.MNGR_STBLT_YN
			,TOT.MNGR_ICPT_RSN_CD
			,TOT.MNGR_ICPT_RSN_DTL_CD
			,TOT.MNGR_ITR_RT
			,TOT.APO_SE
			,TOT.UO_BRNO
			,TOT.STBLT_YN
			,TOT.STBLT_ITEM_LIST
			,DECODE(TOT.STBLT_YN
						,'Y',(SELECT
									(CASE WHEN NVL(ERR.MNGR_ITR_RT,'') IS NOT NULL
												THEN ERR.MNGR_ITR_RT
												ELSE ERR.ITR_RT
												END)
								FROM TB_EV_REG_RSLT ERR
								WHERE 1=1
								  AND APO_SE = '1'
								  AND YR = TOT.YR
								  AND BRNO = TOT.UO_BRNO
								)
						,'N',TOT.ORG_ITR_RT
						,''
			) AS ITR_RT
			,TOT.RMRK
			,NVL((SELECT ISO_FUND_APLY_AMT
					FROM TB_EV_APLY_MNG
					WHERE 1=1
					  AND YR = TOT.YR
					  AND BRNO = TOT.BRNO
					  AND UO_BRNO = TOT.UO_BRNO
					),0
			) AS ISO_FUND_APLY_AMT
		FROM
			(SELECT
				EAM.YR
				,EAM.BRNO
				,EAM.APO_SE
				,#{brno} AS UO_BRNO
				,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = EAM.BRNO) AS CORP_NM
				,CHK.CORP_SE_CD
				,CHK.CORP_SE_NM
				,CHK.CORP_DTL_SE_CD
				,CHK.CORP_DTL_SE_NM
				,CHK.ICPT_RSN_CD
				,CHK.ICPT_RSN_DTL_CD
				,(CASE WHEN CHK.ICPT_RSN_CD IN ('A','B','C') THEN 'N'
						ELSE 'Y'
						END
				) AS STBLT_YN
				,RR.MNGR_STBLT_YN
				,RR.MNGR_ICPT_RSN_CD
				,RR.MNGR_ICPT_RSN_DTL_CD
				,RR.MNGR_ITR_RT
				,(SELECT LISTAGG(ITEM_NM, ' , ') WITHIN GROUP (ORDER BY ITEM_NM) AS STBLT_YN_NM
								FROM (SELECT
											(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
										FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
										WHERE 1=1
										  AND STBLT_YN = 'Y'
										  AND 'Y' = (SELECT STBLT_YN
										  				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
										  				WHERE 1=1
										  				  AND APO_SE = '1'
										  				  AND TYPE_SE_NO = '8'
										  				  AND YR = A.YR
										  				  AND BRNO = A.UO_BRNO
										  				  AND ITEM_CD = A.ITEM_CD)
										  AND APO_SE = EAM.APO_SE
										  AND TYPE_SE_NO = '8'
										  AND YR = EAM.YR
										  AND BRNO = EAM.BRNO
										  AND UO_BRNO = #{brno}
										)
				) AS STBLT_ITEM_LIST
				,DECODE( CHK.ICPT_RSN_DTL_CD
							, 'A1' ,  '-'
							, 'A2' ,  '-'
							, 'A3' ,  '-'
							, 'A4' ,  '-'
							, 'A5' ,  '-'
							, 'B1' ,  3
							, 'B2' ,  2.5
							, 'C1' ,  3
							, 'C2' ,  2.5
							, NULL
				)AS ORG_ITR_RT
				,RR.RMRK
			FROM
				(SELECT * FROM TB_EV_APLY_MNG
					WHERE YR = #{yr} AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD  WHERE UO_BRNO = #{brno})
				) EAM
				, (SELECT * FROM TB_EV_REG_RSLT
					WHERE UO_BRNO = #{brno} AND YR = #{yr}
				) RR
				,(SELECT
						BRNO
						,CORP_SE_CD
						,CORP_SE_NM
						,CORP_DTL_SE_CD
						,CORP_DTL_SE_NM
						,(CASE
								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND (CHK_A_A != 'Y' OR CHK_A_B != 'Y' OR CHK_A_C != 'Y' OR CHK_A_D != 'Y' OR CHK_A_E != 'Y' )  THEN  'A'
								WHEN CORP_SE_CD = 'C34030' AND (CHK_A_A != 'Y' OR CHK_A_B != 'Y' OR CHK_A_C != 'Y' OR CHK_A_D != 'Y' OR CHK_A_E != 'Y' )  THEN  'A'

								WHEN CORP_SE_CD IN ('C34010','C34020','C34030') AND CHK_B != 'Y'  THEN  'B'
								WHEN CORP_SE_CD IN ('C34010','C34020','C34030') AND CHK_C != 'Y'  THEN  'C'
								ELSE ''
								END
						) AS ICPT_RSN_CD
						,(CASE WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_A = 'N'  THEN 'A1'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_A = 'N'  THEN 'A1'

								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_B = 'N'  THEN 'A2'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_B = 'N'  THEN 'A2'

								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_C = 'N'  THEN 'A3'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_C = 'N'  THEN 'A3'

								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_D = 'N'  THEN 'A4'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_D = 'N'  THEN  'A4'

								WHEN CORP_SE_CD = 'C34020' AND CORP_DTL_SE_CD in ('020001','020002') AND CHK_A_E = 'N'  THEN 'A5'
								WHEN CORP_SE_CD = 'C34030' AND CHK_A_E = 'N'  THEN  'A5'

								WHEN CORP_SE_CD = 'C34010' AND CHK_B = 'N'  THEN 'B1'
								WHEN CORP_SE_CD IN ('C34020','C34030') AND CHK_B = 'N'  THEN 'B2'
								WHEN CORP_SE_CD = 'C34010' AND CHK_C = 'N'  THEN 'C1'
								WHEN CORP_SE_CD IN ('C34020','C34030') AND CHK_C = 'N'  THEN 'C2'
								ELSE ''
								END
						) AS ICPT_RSN_DTL_CD
					FROM
						(SELECT
							BRNO
							,CORP_SE_CD
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = EA.CORP_SE_CD) AS CORP_SE_NM
							,CORP_DTL_SE_CD
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SHAP' AND CD_VL = EA.CORP_DTL_SE_CD) AS CORP_DTL_SE_NM

							,NVL(MNGMST_YN,'N') AS CHK_A_A
							,(CASE WHEN TO_NUMBER(NVL(INVST_AMT,0)) >=  100000 THEN 'Y'
										ELSE 'N' END
							)  AS CHK_A_B
							,(CASE WHEN TO_DATE('20240224' , 'YYYYMMDD') -  NVL(CORP_FNDN_DAY, SYSDATE) >= 365 THEN 'Y'
										ELSE 'N' END
							)  AS CHK_A_C
							,(CASE WHEN INVST_EXPND_FRMER_NOPE >= 5 THEN 'Y'
										ELSE 'N' END
							)  AS CHK_A_D
							,(CASE WHEN  NVL(FRMER_INVST_AMT / NULLIF(INVST_AMT,0)*100 , 0) >= 50 THEN 'Y'
										ELSE 'N' END
							)  AS CHK_A_E
							,(CASE WHEN EXISTS (SELECT COUNT(*)
																FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PST
																WHERE 1=1
																  AND STBLT_YN = 'Y'
																  AND APO_SE = '2'
																  AND 'Y' = (SELECT STBLT_YN
																  				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
																  				WHERE 1=1
																  				  AND APO_SE = '1'
																  				  AND TYPE_SE_NO = '8'
																  				  AND YR = PST.YR
																  				  AND BRNO = PST.UO_BRNO
																  				  AND ITEM_CD = PST.ITEM_CD)
																  AND TYPE_SE_NO = '8'
																  AND YR = #{yr}
																  AND BRNO = EA.BRNO
																  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = PST.YR AND BRNO = #{brno} AND ITEM_CD = PST.ITEM_CD)
														)
												THEN 'Y'
												ELSE 'N'
												END
							) AS CHK_B
							,(SELECT
									(CASE WHEN MNGR_STBLT_YN IS NOT NULL
											THEN MNGR_STBLT_YN
											ELSE STBLT_YN
											END)
								FROM TB_EV_REG_RSLT
								WHERE 1=1
								  AND YR = #{yr}
								  AND BRNO = #{brno}
							) AS CHK_C
					FROM (SELECT *
							FROM TB_EV_APO
							WHERE 1=1
							  AND APO_SE = '2'
							  AND BRNO IN (SELECT ISO_BRNO FROM TB_EV_APO_UO_CD WHERE UO_BRNO = #{brno})
							) EA
					)
				) CHK
			WHERE 1=1
			  AND EAM.YR = RR.YR(+)
			  AND EAM.BRNO = RR.BRNO(+)
			  AND EAM.BRNO = CHK.BRNO(+)
			) TOT
	</select>

	<select id="selectRawDataIsoList" parameterType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO" resultType="com.at.apcss.pd.pcorm.vo.PrdcrCrclOgnVluIdctrMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectRawDataList */
			TOTAL.YR
			,TOTAL.UO_BRNO
			,TOTAL.UO_CORP_NM
			,TOTAL.BRNO
			,TOTAL.CORP_NM
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER
			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
			,(SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN)
				FROM TB_EV_REG_RSLT ERR
				WHERE 1=1
				  AND BRNO = TOTAL.BRNO
				  AND UO_BRNO = TOTAL.UO_BRNO
				  AND YR = TOTAL.YR
				  AND APO_SE = '1'
			) AS LAST_STBLT_YN

			,ALAMT.TOT_TRMT_PRFMNC_AMT
			,ALAMT.DDC_TOT
			,ALAMT.AJMT_AMT
			,ALAMT.SPMT_PRFMNC_AMT
			,ALAMT.SLS_CPRTN_TOT
			,ALAMT.SPMT_RT

			,ALAMT.CORP_SE_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = ALAMT.CORP_SE_CD) AS CORP_SE_NM
			,ALAMT.CORP_DTL_SE_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SHAP' AND CD_VL = ALAMT.CORP_DTL_SE_CD) AS CORP_DTL_SE_NM
			,ALAMT.UO_CORP_SE_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SE_CD' AND CD_VL = ALAMT.UO_CORP_SE_CD) AS UO_CORP_SE_NM
			,ALAMT.UO_CORP_DTL_SE_CD
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CORP_SHAP' AND CD_VL = ALAMT.UO_CORP_DTL_SE_CD) AS UO_CORP_DTL_SE_NM
			,DECODE(  (SELECT COUNT(*) FROM TB_EV_APO_UO_CD WHERE ISO_BRNO = ALAMT.BRNO) , 1, 'N' , 'Y') AS UO_BRNO_CNT
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER
					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT

					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = ITEM.CTGRY_CD) AS CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS UO_CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, ITEM.STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD)AS STTG_UPBR_ITEM_SE
									, (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD)AS CTGRY_CD
									, UO_BRNO
									, BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
									, STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
									WHERE 1=1
									  AND APO_SE = '2'
									  AND TYPE_SE_NO = '8'
									  AND YR = #{yr}
									  AND BRNO NOT IN (SELECT BRNO
														FROM TB_COM_USER
														WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61')
														)
									  AND UO_BRNO NOT IN (SELECT BRNO
															FROM TB_COM_USER
															WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51')
															)
									  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = A.UO_BRNO AND YR = A.YR AND ITEM_CD = A.ITEM_CD)
							) ITEM ,
							(SELECT

									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT B
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = B.UO_BRNO AND YR = B.YR AND ITEM_CD = B.ITEM_CD)
								  AND YR = #{yr}
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
																		FROM TB_EV_FRMHS_APO
																		WHERE 1=1
																		  AND STBLT_YN = 'Y'
																		  AND APO_SE = '2'
																		  AND NVL(EXCL_YN,'N') != 'Y'
																	  	  AND BRNO = B.BRNO
																	  	  AND UO_BRNO = B.UO_BRNO
																	  	  AND YR = B.YR
														)
								GROUP BY BRNO, UO_BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT C
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('7')
								  AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE BRNO = C.UO_BRNO AND YR = C.YR AND ITEM_CD = C.ITEM_CD)
								  AND YR = #{yr}
								GROUP BY  BRNO , UO_BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						  AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						  AND ITEM.BRNO = TOTA.BRNO(+)
						  AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)
						  AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
						  AND ITEM.BRNO = TOTB.BRNO(+)
						  AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)
				)TOT
		)TOTAL
		,(SELECT
				BRNO
				,UO_BRNO
				,ITEM_CD
				,(SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = IAPS.BRNO) AS CORP_SE_CD
				,(SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = IAPS.BRNO) AS CORP_DTL_SE_CD
				,(SELECT CORP_SE_CD FROM TB_EV_APO WHERE BRNO = IAPS.UO_BRNO) AS UO_CORP_SE_CD
				,(SELECT CORP_DTL_SE_CD FROM TB_EV_APO WHERE BRNO = IAPS.UO_BRNO) AS UO_CORP_DTL_SE_CD
				,(NVL(DDC_EXPRT_AMT,0) + NVL(DDC_AMT,0) + NVL(DDC_ARMY_DLVGDS_AMT,0) + NVL(DDC_MLSR_AMT,0) + NVL(AJMT_AMT,0)) AS TOT_TRMT_PRFMNC_AMT
				,(NVL(DDC_EXPRT_AMT,0) + NVL(DDC_AMT,0) + NVL(DDC_ARMY_DLVGDS_AMT,0) + NVL(DDC_MLSR_AMT,0)) AS DDC_TOT
				, AJMT_AMT
				, SPMT_PRFMNC_AMT
				,(NVL(SLS_CPRTN_SORT_TRST_AMT,0) + NVL(SLS_CPRTN_TRST_AMT,0) + NVL(SLS_CPRTN_SORT_EMSPAP_AMT,0)) AS SLS_CPRTN_TOT
				,ROUND(NVL( SPMT_PRFMNC_AMT / NULLIF( AJMT_AMT, 0 ) , 0 ) * 100 , 2) AS SPMT_RT
			FROM TB_EV_UO_ISO_ALL_PRCHS_SLS IAPS
			WHERE 1=1
			  AND APO_SE = '2'
			  AND PRCHS_SLS_SE = '2'
			  AND YR = #{yr}
		)ALAMT
		WHERE 1=1
		  AND TOTAL.BRNO = ALAMT.BRNO(+)
		  AND TOTAL.UO_BRNO = ALAMT.UO_BRNO(+)
		  AND TOTAL.ITEM_CD = ALAMT.ITEM_CD(+)
		ORDER BY UO_BRNO , BRNO , ITEM_CD , STBLT_YN
	</select>
</mapper>