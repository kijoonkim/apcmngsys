<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : BrnoMngMapper.xml                                    				-->
<!-- DESC : 변경된 사업자번호 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2024.11.11  	ljw        		Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.pd.bsm.mapper.BrnoMngMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.bsm.mapper.BrnoMngMapper.selectBrnoMng				-->
	<!-- DESC : 변경된 사업자번호 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.11  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectBrnoMng" parameterType="com.at.apcss.pd.bsm.vo.BrnoMngVO" resultType="com.at.apcss.pd.bsm.vo.BrnoMngVO">
		SELECT /* com.at.apcss.pd.bsm.mapper.BrnoMngMapper.selectBrnoMng */
			MNG_NO
			, CORP_NM
			, BRNO
			, CRNO
			, RMRK
			, INDCT_SEQ
			, DEL_YN
			, CLSBIZ_YMD
			, TO_CHAR(SYS_FRST_INPT_DT,'YYYYMMDD') AS REG_DT

		  FROM TB_EV_BRNO_MNG BM
		 WHERE 1=1
		   AND DEL_YN = 'N'
		   AND MNG_NO = #{mngNo}
		ORDER BY MNG_NO ASC
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.bsm.mapper.BrnoMngMapper.selectBrnoMngList			-->
	<!-- DESC : 변경된 사업자번호 리스트를 조회.                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.11  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectBrnoMngList" parameterType="com.at.apcss.pd.bsm.vo.BrnoMngVO" resultType="com.at.apcss.pd.bsm.vo.BrnoMngVO">

		<!-- Start 페이징 -->
		<if test='pagingYn != null and pagingYn.equals("Y")'>
			SELECT
				  ROWNUM AS ROW_SEQ
				, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
				, pt0.*
			  FROM (
		</if>

		<![CDATA[
			SELECT /* com.at.apcss.pd.bsm.mapper.BrnoMngMapper.selectBrnoMng */
				MNG_NO
				, CORP_NM
				, BRNO
				, CRNO
				, RMRK
				, INDCT_SEQ
				, DEL_YN
				, CLSBIZ_YMD
				, TO_CHAR(SYS_FRST_INPT_DT,'YYYYMMDD') AS REG_DT

			  FROM TB_EV_BRNO_MNG BM
			 WHERE 1=1
			   AND DEL_YN = 'N'
			   AND BRNO = '0'
		]]>

			<if test='brno != null and brno != ""'>
				AND MNG_NO IN (SELECT MNG_NO FROM TB_EV_BRNO_MNG WHERE BM.BRNO = #{brno})
			</if>
			<if test='corpNm != null and corpNm != ""'>
				AND BM.CORP_NM LIKE '%' || #{corpNm} || '%'
			</if>

		ORDER BY MNG_NO ASC

		<!-- 페이징 -->
		<if test='pagingYn != null and pagingYn.equals("Y")'>
			  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
		</if>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.bsm.mapper.BrnoMngMapper.selectDtlBrnoMngList		-->
	<!-- DESC : 변경된 사업자번호 상세 목록 조회.                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.11  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectDtlBrnoMngList" parameterType="com.at.apcss.pd.bsm.vo.BrnoMngVO" resultType="com.at.apcss.pd.bsm.vo.BrnoMngVO">

		<!-- Start 페이징 -->
		<if test='pagingYn != null and pagingYn.equals("Y")'>
			SELECT
				  ROWNUM AS ROW_SEQ
				, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
				, pt0.*
			  FROM (
		</if>
			SELECT /* com.at.apcss.pd.bsm.mapper.BrnoMngMapper.selectDtlBrnoMngList */
				MNG_NO
				, CORP_NM
				, BRNO
				, CRNO
				, RMRK
				, INDCT_SEQ
				, DEL_YN
				, CLSBIZ_YMD
				, TO_CHAR(SYS_FRST_INPT_DT,'YYYYMMDD') AS REG_DT

			  FROM TB_EV_BRNO_MNG BM
			 WHERE 1=1
			   AND DEL_YN = 'N'
			   AND BRNO != '0'
			   AND MNG_NO = #{mngNo}

		ORDER BY MNG_NO ASC

		<!-- 페이징 -->
		<if test='pagingYn != null and pagingYn.equals("Y")'>
			  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
		</if>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.bsm.mapper.BrnoMngMapper.insertBrnoMng				-->
	<!-- DESC : 변경된 사업자번호 등록                                           			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.11  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<insert id="insertBrnoMng" parameterType="com.at.apcss.pd.bsm.vo.BrnoMngVO">
		MERGE INTO TB_EV_BRNO_MNG EBM  /* com.at.apcss.pd.bsm.mapper.BrnoMngMapper.insertBrnoMng */
		USING DUAL
			ON (
				EBM.MNG_NO  = #{mngNo}
				AND EBM.BRNO  = #{brno}
				)
		WHEN MATCHED THEN
			UPDATE
				SET
					CORP_NM		= #{corpNm}
				  , CRNO		= #{crno}
				  , RMRK		= #{rmrk}
				  , INDCT_SEQ	= #{indctSeq}
				  , CLSBIZ_YMD	= #{clsbizYmd}
				  , DEL_YN		= 'N'
				, SYS_LAST_CHG_DT		= SYSDATE
				, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
				, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}
		WHEN NOT MATCHED THEN
			INSERT /* com.at.apcss.pd.bsm.mapper.BrnoMngMapper.insertBrnoMng */
				(
					CORP_NM
				  , BRNO
				  , CRNO
				  , RMRK
				  , INDCT_SEQ
				  , CLSBIZ_YMD

				<if test='mngNo != null and mngNo != ""'>
				  , MNG_NO
				</if>

				  , SYS_FRST_INPT_DT
				  , SYS_FRST_INPT_USER_ID
				  , SYS_FRST_INPT_PRGRM_ID
				  , SYS_LAST_CHG_DT
				  , SYS_LAST_CHG_USER_ID
				  , SYS_LAST_CHG_PRGRM_ID
				)
			VALUES
				(
				    #{corpNm}
				  , #{brno}
				  , #{crno}
				  , #{rmrk}
				  , #{indctSeq}
				  , #{clsbizYmd}

				<if test='mngNo != null and mngNo != ""'>
				  , #{mngNo}
				</if>

				  , SYSDATE
				  , #{sysFrstInptUserId}
				  , #{sysFrstInptPrgrmId}
				  , SYSDATE
				  , #{sysLastChgUserId}
				  , #{sysLastChgPrgrmId}
				)
	</insert>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.bsm.mapper.BrnoMngMapper.updateBrnoMng				-->
	<!-- DESC : 변경된 사업자번호 수정                                             			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.11  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<update id="updateBrnoMng" parameterType="com.at.apcss.pd.bsm.vo.BrnoMngVO">
		UPDATE /* com.at.apcss.pd.bsm.mapper.BrnoMngMapper.upateBrnoMng */
			TB_EV_BRNO_MNG
		   SET
				CORP_NM		= #{corpNm}
			  , CRNO		= #{crno}
			  , RMRK		= #{rmrk}
			  , INDCT_SEQ	= #{indctSeq}
			  , CLSBIZ_YMD	= #{clsbizYmd}
			<if test='brno != null and brno != ""'>
			  , DEL_YN		= #{delYn}
			</if>

			, SYS_LAST_CHG_DT		= SYSDATE
			, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
			, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}
		WHERE 1=1
		  AND MNG_NO = #{mngNo}
		  AND BRNO = #{brno}
	</update>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.bsm.mapper.BrnoMngMapper.deleteBrnoMng				-->
	<!-- DESC : 변경된 사업자번호 삭제.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.11  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<update id="deleteBrnoMng" parameterType="com.at.apcss.pd.bsm.vo.BrnoMngVO">
		<![CDATA[
			UPDATE /* com.at.apcss.pd.bsm.mapper.BrnoMngMapper.deleteBrnoMng */
				TB_EV_BRNO_MNG
			   SET
					DEL_YN = #{delYn}
		]]>
		<![CDATA[
				, SYS_LAST_CHG_DT		= SYSDATE
				, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
				, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}
			WHERE 1=1
			  AND MNG_NO = #{mngNo}
		]]>
			<if test='brno != "0" and brno != null and brno != ""'>
			  AND BRNO = #{brno}
			</if>
	</update>
	<!--
	<delete id="deleteBrnoMng" parameterType="com.at.apcss.pd.bsm.vo.BrnoMngVO">
		<![CDATA[
		DELETE FROM TB_EV_BRNO_MNG
		 WHERE MNG_NO 	= #{mngNo}
		   AND BRNO 	= #{brno}
		]]>
	</delete>
	-->

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.bsm.mapper.BrnoMngMapper.selectBrnoMngRowDataList	-->
	<!-- DESC : 로우데이터 리스트 조회                                             			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.11.11  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectBrnoMngRowDataList" parameterType="com.at.apcss.pd.bsm.vo.BrnoMngVO" resultType="com.at.apcss.pd.bsm.vo.BrnoMngVO">
		SELECT /* com.at.apcss.pd.bsm.mapper.BrnoMngMapper.selectBrnoMngRowDataList */
			MNG_NO
			, CORP_NM
			, BRNO
			, CRNO
			, RMRK
			, INDCT_SEQ
			, CLSBIZ_YMD
			, TO_CHAR(SYS_FRST_INPT_DT,'YYYYMMDD') AS REG_DT
		  FROM TB_EV_BRNO_MNG BM
		 WHERE 1=1
		ORDER BY BM.MNG_NO ASC
	</select>
</mapper>