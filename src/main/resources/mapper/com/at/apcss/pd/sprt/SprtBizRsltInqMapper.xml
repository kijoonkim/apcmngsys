<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


<mapper namespace="com.at.apcss.pd.sprt.mapper.SprtBizRsltInqMapper">

    <select id="selectSprtBizRsltInqList" parameterType="com.at.apcss.pd.sprt.vo.SprtBizRsltInqVO" resultType="com.at.apcss.pd.sprt.vo.SprtBizRsltInqVO">

        SELECT
        ROWNUM AS ROW_SEQ
        , COUNT(*) OVER() AS TOTAL_RECORD_COUNT
        , pt0.*
        FROM (


        SELECT T1.SPRT_BIZ_YR AS SPRT_BIZ_YR
             , T1.SPRT_BIZ_NM AS SPRT_BIZ_NM
             , T1.BZMN_CONM AS BZMN_CONM
             , T1. CRNO AS CRNO
             , T1.BRNO AS BRNO
             , ( SELECT FN_GET_COM_CD_VL_NM('UNTY_CTPV', T1.STDG_CTPV_CD) FROM DUAL ) AS STDG_CTPV_CD
             , ( SELECT FN_GET_COM_CD_VL_EXPLN('UNTY_SGG', T1.STDG_CD) FROM DUAL ) AS STDG_SGG_CD
             , T1.SLCTN_YR AS SLCTN_YR
             , T1.SPRT_YR AS SPRT_YR
             , T1.ALTMNT_AMT AS ALTMNT_AMT
             , T1.ONSLF_BRDN_AMT AS ONSLF_BRDN_AMT
             , T1.ALTMNT_INT AS ALTMNT_INT
             , T1.RMRK AS RMRK

             , ( SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = T2.ATRB_NM ) AS ITEM_CD
             , ( SELECT FN_GET_COM_CD_VL_NM ('WRHS_SE_CD', T3.ATRB_NM) FROM DUAL) AS BIZ_TYPE

        FROM ( 	SELECT A.SPRT_BIZ_YR AS SPRT_BIZ_YR
                       , A.SPRT_BIZ_NM AS SPRT_BIZ_NM
                       , C.BZMN_CONM AS BZMN_CONM
                       , CASE
                             WHEN C.PSN_SE_CD = '2' THEN B.CRNO
                             ELSE ''
                          END AS CRNO
                       , CASE
                             WHEN C.PSN_SE_CD = '2' THEN B.BRNO
                             ELSE ''
                          END AS BRNO
                       , C.STDG_CTPV_CD AS STDG_CTPV_CD
                       , C.STDG_CD AS STDG_CD
                       , D.SLCTN_YR AS SLCTN_YR
                       , D.SPRT_YR AS SPRT_YR
                       , D.ALTMNT_AMT AS ALTMNT_AMT
                       , D.ALTMNT_INT AS ALTMNT_INT
                       , D.RMRK AS RMRK
                       , D.ONSLF_BRDN_AMT AS ONSLF_BRDN_AMT
                       , D.SPRT_BIZ_CD AS SPRT_BIZ_CD
                       , D.SPRT_OGNZ_ID AS SPRT_OGNZ_ID
                       , D.REG_SEQ AS REG_SEQ
                  FROM TB_EV_SPRT_BIZ_MSTR A
                     , TB_EV_SPRT_BIZ_OGNZ B
                     , TB_COM_CORP_BZMN C
                     , TB_EV_SPRT_BIZ_ALTMNT D
                  WHERE 1=1
                    AND A.SPRT_BIZ_YR = B.SPRT_BIZ_YR
                    AND A.SPRT_BIZ_CD = B.SPRT_BIZ_CD
                    AND B.BRNO = C.BRNO
                    AND B.SPRT_BIZ_YR = D.SPRT_BIZ_YR
                    AND B.SPRT_BIZ_CD = D.SPRT_BIZ_CD
                    AND B.SPRT_OGNZ_ID = D.SPRT_OGNZ_ID
                    AND C.USE_YN = 'Y'
                    AND A.DEL_YN = 'N'
                    AND B.DEL_YN = 'N'
                    AND C.DEL_YN = 'N'
                    AND D.DEL_YN = 'N'
                <if test='sprtBizSe != null and sprtBizSe != ""'>
                    AND A.SPRT_BIZ_CD = #{sprtBizSe}
                </if>
                <if test='crtrYmdFrom != null and crtrYmdFrom != "" and crtrYmdTo != null and crtrYmdTo != ""'>
                    AND A.SPRT_BIZ_YR BETWEEN #{crtrYmdFrom} AND #{crtrYmdTo}
                </if>
                    AND B.CRNO LIKE '%' || #{crno} || '%'
                    AND B.BRNO LIKE '%' || #{brno} || '%'
                    AND C.BZMN_CONM LIKE '%' || #{corpNm} || '%'
                <if test='sprtYmdFrom != null and sprtYmdFrom != "" and sprtYmdTo != null and sprtYmdTo != ""'>
                    AND D.SPRT_YR BETWEEN #{sprtYmdFrom} AND #{sprtYmdTo}
                </if>
            ) T1
           , ( SELECT ATRB_NM
                    , SPRT_BIZ_YR
                    , SPRT_BIZ_CD
                    , SPRT_OGNZ_ID
                    , REG_SEQ
                 FROM TB_EV_SPRT_BIZ_ALTMNT_ATRB
                WHERE 1=1
                  AND ATRB_CD = 'ITEM_CD'
                  AND DEL_YN = 'N'
            ) T2
           , ( SELECT ATRB_NM
                    , SPRT_BIZ_YR
                    , SPRT_BIZ_CD
                    , SPRT_OGNZ_ID
                    , REG_SEQ
                 FROM TB_EV_SPRT_BIZ_ALTMNT_ATRB
                WHERE 1=1
                  AND ATRB_CD = 'WRHS_SE_CD'
                  AND DEL_YN = 'N'
            ) T3
        WHERE 1=1
          AND T1.SPRT_BIZ_YR = T2.SPRT_BIZ_YR(+)
          AND T1.SPRT_BIZ_CD = T2.SPRT_BIZ_CD(+)
          AND T1.SPRT_OGNZ_ID = T2.SPRT_OGNZ_ID(+)
          AND T1.REG_SEQ = T2.REG_SEQ(+)
          AND T1.SPRT_BIZ_YR = T3.SPRT_BIZ_YR(+)
          AND T1.SPRT_BIZ_CD = T3.SPRT_BIZ_CD(+)
          AND T1.SPRT_OGNZ_ID = T3.SPRT_OGNZ_ID(+)
          AND T1.REG_SEQ = T3.REG_SEQ(+)
        ) pt0


    </select>

    <select id="selectSprtBizRsltInqSeCd" parameterType="com.at.apcss.pd.sprt.vo.SprtBizRsltInqVO" resultType="com.at.apcss.pd.sprt.vo.SprtBizRsltInqVO">
        SELECT MIN(SPRT_BIZ_YR) AS SPRT_BIZ_YR_MIN
             , MAX(SPRT_BIZ_YR) AS SPRT_BIZ_YR_MAX
             , SPRT_BIZ_CD
             , SPRT_BIZ_NM
        FROM TB_EV_SPRT_BIZ_MSTR
        WHERE 1=1
          AND DEL_YN = 'N'
        GROUP BY SPRT_BIZ_NM, SPRT_BIZ_CD
        ORDER BY SPRT_BIZ_NM
    </select>

</mapper>
