<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : BbsMapper.xml                                    				-->
<!-- DESC : 게시판 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.bbs.mapper.BbsMngMapper.selectBbs				-->
	<!-- DESC : 게시판 테이블 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectInvShipOgnGenalTblMng" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvShipOgnGenalTblMng */
			'a' as BRNO
		FROM DUAL
		WHERE 1=1
    </select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectItemStbltYn			-->
	<!-- DESC : 출자출하조직 총괄표 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectInvShipOgnGenalTblMngList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectItemStbltYn */
			TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.BRNO
			,TOTAL.UO_BRNO
			,TOTAL.YR
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.CORP_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER
			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER
					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT

					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							, ITEM.STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							, ITEM.CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, (SELECT STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO ='8'
								  AND BRNO = ITEM.BRNO
								  AND UO_BRNO = ITEM.UO_BRNO
								  AND YR = ITEM.YR
								  AND ITEM_CD = ITEM.ITEM_CD
							) AS STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, STTG_UPBR_ITEM_SE
									, CTGRY_CD
									, TO_CHAR(BRNO) AS UO_BRNO
									, #{brno} AS BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = AYGC.ITEM_CD) AS ITEM_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = AYGC.CTGRY_CD) AS CTGRY_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = AYGC.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
								FROM TB_EV_APO_YR_GPC_CD AYGC
								WHERE 1=1
								<if test='uoBrno != null and uoBrno != ""'>
							  	  AND BRNO = #{uoBrno}
							  	</if>
							  	<if test='yr != null and yr != ""'>
							  	  AND YR = #{yr}
							  	</if>
							) ITEM ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
					  													FROM TB_EV_FRMHS_APO
					  													WHERE 1=1
					  													  AND STBLT_YN = 'Y'
					  													  AND APO_SE = '2'
					  													  AND NVL(EXCL_YN,'N') != 'Y'
					  													<if test='brno != null and brno != ""'>
																	  	  AND BRNO = #{brno}
																	  	</if>
																	  	<if test='yr != null and yr != ""'>
																	  	  AND YR = #{yr}
																	  	</if>
					  									)
								<if test='uoBrno != null and uoBrno != ""'>
							  	  AND UO_BRNO = #{uoBrno}
							  	</if>
							  	<if test='brno != null and brno != ""'>
							  	  AND BRNO = #{brno}
							  	</if>
							  	<if test='yr != null and yr != ""'>
							  	  AND YR = #{yr}
							  	</if>

									GROUP BY  BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('7')
								<if test='uoBrno != null and uoBrno != ""'>
							  	  AND UO_BRNO = #{uoBrno}
							  	</if>
							  	<if test='brno != null and brno != ""'>
							  	  AND BRNO = #{brno}
							  	</if>
							  	<if test='yr != null and yr != ""'>
							  	  AND YR = #{yr}
							  	</if>

								GROUP BY  BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
				)TOT
		)TOTAL
		ORDER BY TOTAL.STTG_UPBR_ITEM_SE
	</select>


	<select id="selectInvShipOgnGenalTblMngIsoList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		<!-- Start 페이징 -->
		<if test='pagingYn != null and pagingYn.equals("Y")'>
			SELECT
				  ROWNUM AS ROW_SEQ
				, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
				, pt0.*
			  FROM (
		</if>

		SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvShipOgnGenalTblMngUoList */
			TEA.APO_CD
			,TEA.APO_SE
			,TEA.BRNO
			,TEA.CRNO
			, TRIM(TEA.CTPV) AS CTPV
			, TRIM(TEA.SGG) AS SGG
			,TEA.CORP_NM
			,TEA.CORP_SE_CD
			,TEAM.YR
		FROM TB_EV_APO TEA
			,TB_EV_APLY_MNG TEAM
		WHERE 1=1
		  AND TEA.BRNO = TEAM.BRNO(+)
		  AND TEA.APO_SE = '2'
		<if test='brno != null and brno != ""'>
		  AND TEA.BRNO = #{brno}
		</if>
		<if test='yr != null and yr != ""'>
		  AND TEAM.YR = #{yr}
		</if>
		<if test='cmptnInst != null and cmptnInst != ""'>
		  AND TEA.CMPTN_INST = #{cmptnInst}
		</if>
		<if test='ctpv != null and ctpv != ""'>
		  AND TRIM(TEA.CTPV) = #{ctpv}
		</if>

		<if test='corpSeCd != null and corpSeCd != ""'>
		  AND TEA.CORP_SE_CD = #{corpSeCd}
		</if>
		<if test='corpDtlSeCd != null and corpDtlSeCd != ""'>
		  AND TEA.CORP_DTL_SE_CD = #{corpDtlSeCd}
		</if>
		<if test='corpNm != null and corpNm != ""'>
		  AND CM.CORP_NM LIKE '%' || #{corpNm} || '%'
		</if>

		<!-- 페이징 -->
		<if test='pagingYn != null and pagingYn.equals("Y")'>
			  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
		</if>
	</select>

	<update id="updateStbltYn" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		UPDATE /* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.updateStbltYn */
			TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
		   SET
			  STBLT_YN				= #{stbltYn}
			, SYS_LAST_CHG_DT		= SYSDATE
			, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
			, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

		 WHERE 1=1
		   AND APO_SE 			= '2'
		   AND YR				= #{yr}
		   AND BRNO				= #{brno}
		   AND UO_BRNO 			= #{uoBrno}
		   AND ITEM_CD 			= #{itemCd}
	</update>

	<select id="selectRawDataList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectRawDataList */
			TOTAL.YR
			,TOTAL.UO_BRNO
			,TOTAL.UO_CORP_NM
			,TOTAL.BRNO
			,TOTAL.CORP_NM
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER
			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
			,DECODE(TOTAL.UO_STBLT_YN
					, 'Y' , DECODE(TOTAL.ORG_STBLT_YN , 'Y' , TOTAL.LAST_STBLT_YN , '')
					, ''
			) AS LAST_STBLT_YN
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER
					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT
					/* 20240603 승인형 작년 기준인것을 올해 기준으로 변경 60 -> 50 , 60 -> 40 */
					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 50 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 40 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
					,(SELECT STBLT_YN
						FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
						WHERE 1=1
						  AND APO_SE = '1'
						  AND TYPE_SE_NO = '8'
						  AND YR = TOT.YR
						  AND BRNO = TOT.UO_BRNO
						  AND ITEM_CD = TOT.ITEM_CD
					) AS UO_STBLT_YN
					,(SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN)
						FROM TB_EV_REG_RSLT ERR
						WHERE 1=1
						  AND BRNO = TOT.BRNO
						  AND YR = TOT.YR
						  AND 'Y' = DECODE(APO_SE ,'1' , 'Y' , '2' ,DECODE(ERR.UO_BRNO , TOT.UO_BRNO , 'Y' , 'N')
						)
					) AS LAST_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = ITEM.CTGRY_CD) AS CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS UO_CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, ITEM.STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD)AS STTG_UPBR_ITEM_SE
									, (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD)AS CTGRY_CD
									, UO_BRNO
									, BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
									, STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
									WHERE 1=1
									  AND APO_SE = '2'
									  AND TYPE_SE_NO = '8'
									  AND YR = #{yr}
									  AND BRNO NOT IN (SELECT BRNO
														FROM TB_COM_USER
														WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61')
														)
									  AND UO_BRNO NOT IN (SELECT BRNO
															FROM TB_COM_USER
															WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51')
															)
									  AND ITEM_CD = (SELECT ITEM_CD
									  					FROM TB_EV_APO_YR_GPC_CD
									  					WHERE 1=1
									  					  AND APO_SE = '2'
									  					  AND YR = A.YR
									  					  AND BRNO = A.BRNO
									  					  AND UO_BRNO = A.UO_BRNO
									  					  AND ITEM_CD = A.ITEM_CD)
							) ITEM ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT B
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND ITEM_CD = (SELECT ITEM_CD
								  					FROM TB_EV_APO_YR_GPC_CD
								  					WHERE 1=1
								  					  AND APO_SE = '2'
								  					  AND YR = B.YR
								  					  AND BRNO = B.BRNO
								  					  AND UO_BRNO = B.UO_BRNO
								  					  AND ITEM_CD = B.ITEM_CD)
								  AND YR = #{yr}
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND APO_SE = '2'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND YR = B.YR
															  AND BRNO = B.BRNO
															  AND UO_BRNO = B.UO_BRNO
														)
								GROUP BY BRNO, UO_BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTB
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5','7')
								  AND OGNZ_STBLT_YN = DECODE(PSTB.TYPE_SE_NO, '5' , 'N' , '7' ,'0' ,'')
								  AND (
								  		PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
														FROM TB_EV_FRMHS_APO
														WHERE 1=1
														  AND STBLT_YN = 'Y'
														  AND NVL(EXCL_YN,'N') != 'Y'
														  AND APO_SE = '2'
														  AND YR = PSTA.YR
														  AND BRNO = PSTA.BRNO
														  AND UO_BRNO = PSTA.UO_BRNO
													)
										OR
										PRDCR_OGNZ_SN = '0'
										)
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTB.YR
													  AND BRNO = PSTB.BRNO
													  AND UO_BRNO = PSTB.UO_BRNO
													)
								  AND YR = #{yr}
								GROUP BY  BRNO , UO_BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						  AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						  AND ITEM.BRNO = TOTA.BRNO(+)
						  AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)
						  AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
						  AND ITEM.BRNO = TOTB.BRNO(+)
						  AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)
				)TOT
		)TOTAL
		ORDER BY UO_BRNO , BRNO , ITEM_CD , STBLT_YN
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectInvShipOgnGenalTblMngListNew	-->
	<!-- DESC : 2025 총괄표 조회                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.23  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectInvShipOgnGenalTblMngListNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvShipOgnGenalTblMngListNew */
			TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.BRNO
			,TOTAL.UO_BRNO
			,TOTAL.YR
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.CORP_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER

			,TOTAL.UO_SPMT_VLM
			,TOTAL.UO_SPMT_VLM_OTHER
			,TOTAL.UO_OTHER_SPMT_VLM
			,TOTAL.UO_OTHER_SPMT_VLM_OTHER

			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_VLM_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER

					,TOT.UO_SPMT_VLM
					,TOT.UO_SPMT_VLM_OTHER
					,TOT.UO_OTHER_SPMT_VLM
					,TOT.UO_OTHER_SPMT_VLM_OTHER

					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_VLM_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT
					/* 20240603 승인형 작년 기준인것을 올해 기준으로 변경 60 -> 50 , 60 -> 40 */
					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 50 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 40 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							, ITEM.STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							, ITEM.CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, TOTA.UO_SPMT_VLM 	AS UO_SPMT_VLM
							, TOTB.UO_SPMT_VLM 	AS UO_SPMT_VLM_OTHER

							, TOTA.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM
							, TOTB.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT
							, (NVL(TOTA.UO_SPMT_VLM,0) + NVL(TOTA.UO_OTHER_SPMT_VLM,0) + NVL(TOTB.UO_SPMT_VLM,0) + NVL(TOTB.UO_OTHER_SPMT_VLM,0)) AS UO_SPMT_VLM_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, (SELECT STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO ='8'
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND BRNO = ITEM.BRNO
								  AND UO_BRNO = ITEM.UO_BRNO
								  AND YR = ITEM.YR
								  AND ITEM_CD = ITEM.ITEM_CD
							) AS STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, STTG_UPBR_ITEM_SE
									, CTGRY_CD
									, UO_BRNO
									, BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = AYGC.ITEM_CD) AS ITEM_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = AYGC.CTGRY_CD) AS CTGRY_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = AYGC.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
								FROM TB_EV_APO_YR_GPC_CD AYGC
								WHERE 1=1
								  AND APO_SE = '2'
								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='uoBrno != null and uoBrno != ""'>
								  AND UO_BRNO = #{uoBrno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>
							) ITEM ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS UO_SPMT_VLM
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS UO_OTHER_SPMT_VLM
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTA
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND OGNZ_STBLT_YN = 'Y'
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTA.YR
													  AND BRNO = PSTA.BRNO
													  AND UO_BRNO = PSTA.UO_BRNO
													)
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND APO_SE = '2'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND YR = PSTA.YR
															  AND BRNO = PSTA.BRNO
															  AND UO_BRNO = PSTA.UO_BRNO
															  AND TRMT_TYPE = PSTA.TRMT_TYPE
														)
								<if test='uoBrno != null and uoBrno != ""'>
								  AND UO_BRNO = #{uoBrno}
								</if>
								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>
									GROUP BY  BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS UO_SPMT_VLM
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS UO_OTHER_SPMT_VLM
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTB
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5','7')
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND OGNZ_STBLT_YN = DECODE(PSTB.TYPE_SE_NO, '5' , 'N' , '7' ,'0' ,'')
								  AND (
								  		PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'N'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND APO_SE = '2'
															  AND YR = PSTB.YR
															  AND BRNO = PSTB.BRNO
															  AND UO_BRNO = PSTB.UO_BRNO
															  AND TRMT_TYPE = PSTB.TRMT_TYPE
															)
										OR
										PRDCR_OGNZ_SN = '0'
										)
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTB.YR
													  AND BRNO = PSTB.BRNO
													  AND UO_BRNO = PSTB.UO_BRNO
													)
								<if test='uoBrno != null and uoBrno != ""'>
								  AND UO_BRNO = #{uoBrno}
								</if>
								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>
								GROUP BY  BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
				)TOT
		)TOTAL
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectRawDataList2025	-->
	<!-- DESC : 출자출하조직 총괄표 로우데이터 2025년                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.02.17  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectRawDataList2025" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvShipOgnGenalTblMngListNew */
			TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.BRNO
			,TOTAL.UO_BRNO
			,TOTAL.YR
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.CORP_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER

			,TOTAL.UO_SPMT_VLM
			,TOTAL.UO_SPMT_VLM_OTHER
			,TOTAL.UO_OTHER_SPMT_VLM
			,TOTAL.UO_OTHER_SPMT_VLM_OTHER

			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_VLM_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
		FROM
			(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER

					,TOT.UO_SPMT_VLM
					,TOT.UO_SPMT_VLM_OTHER
					,TOT.UO_OTHER_SPMT_VLM
					,TOT.UO_OTHER_SPMT_VLM_OTHER

					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_VLM_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT
					/* 20240603 승인형 작년 기준인것을 올해 기준으로 변경 60 -> 50 , 60 -> 40 */
					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 50 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 40 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							, ITEM.STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							, ITEM.CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, TOTA.UO_SPMT_VLM 	AS UO_SPMT_VLM
							, TOTB.UO_SPMT_VLM 	AS UO_SPMT_VLM_OTHER

							, TOTA.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM
							, TOTB.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT
							, (NVL(TOTA.UO_SPMT_VLM,0) + NVL(TOTA.UO_OTHER_SPMT_VLM,0) + NVL(TOTB.UO_SPMT_VLM,0) + NVL(TOTB.UO_OTHER_SPMT_VLM,0)) AS UO_SPMT_VLM_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, (SELECT STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO ='8'
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND BRNO = ITEM.BRNO
								  AND UO_BRNO = ITEM.UO_BRNO
								  AND YR = ITEM.YR
								  AND ITEM_CD = ITEM.ITEM_CD
							) AS STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, STTG_UPBR_ITEM_SE
									, CTGRY_CD
									, UO_BRNO
									, BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = AYGC.ITEM_CD) AS ITEM_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = AYGC.CTGRY_CD) AS CTGRY_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = AYGC.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
								FROM TB_EV_APO_YR_GPC_CD AYGC
								WHERE 1=1
								  AND APO_SE = '2'
								  AND STTG_UPBR_ITEM_SE IN ('1','2')
								  AND YR = #{yr}
								  AND ITEM_CD = (SELECT ITEM_CD
										  					FROM TB_EV_APO_YR_GPC_CD
										  					WHERE 1=1
										  					  AND APO_SE = '1'
										  					  AND STTG_UPBR_ITEM_SE IN ('1','2')
										  					  AND YR = AYGC.YR
										  					  AND BRNO = AYGC.UO_BRNO
										  					  AND ITEM_CD = AYGC.ITEM_CD)
							) ITEM ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS UO_SPMT_VLM
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS UO_OTHER_SPMT_VLM
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTA
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND OGNZ_STBLT_YN = 'Y'
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTA.YR
													  AND BRNO = PSTA.BRNO
													  AND UO_BRNO = PSTA.UO_BRNO
													)
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND APO_SE = '2'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND YR = PSTA.YR
															  AND BRNO = PSTA.BRNO
															  AND UO_BRNO = PSTA.UO_BRNO
															  AND TRMT_TYPE = PSTA.TRMT_TYPE
														)
								  AND YR = #{yr}
								GROUP BY  UO_BRNO, BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS UO_SPMT_VLM
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS UO_OTHER_SPMT_VLM
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTB
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5','7')
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND OGNZ_STBLT_YN = DECODE(PSTB.TYPE_SE_NO, '5' , 'N' , '7' ,'0' ,'')
								  AND (
								  		PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'N'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND APO_SE = '2'
															  AND YR = PSTB.YR
															  AND BRNO = PSTB.BRNO
															  AND UO_BRNO = PSTB.UO_BRNO
															  AND TRMT_TYPE = PSTB.TRMT_TYPE
															)
										OR
										PRDCR_OGNZ_SN = '0'
										)
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTB.YR
													  AND BRNO = PSTB.BRNO
													  AND UO_BRNO = PSTB.UO_BRNO
													)
								  AND YR = #{yr}
								GROUP BY  UO_BRNO, BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						AND ITEM.BRNO = TOTA.BRNO(+)
						AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)
						AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)

						AND ITEM.BRNO = TOTB.BRNO(+)
						AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)
						AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
				)TOT
			)TOTAL
		ORDER BY UO_BRNO , BRNO , ITEM_CD , STBLT_YN
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectIsoClsfTot	-->
	<!-- DESC : 부류별 합계                                            					-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.26  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectIsoClsfTot" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectIsoClsfTot */
			BRNO
			, (CASE WHEN CLSF_CD IN ('2', '3', '4') THEN '원예농산물'
				ELSE '기타품목'
				END
			) AS CLSF_SE_NM
			, (CASE WHEN CLSF_CD IN ('2', '3', '4') THEN '1'
				ELSE '2'
				END
			) AS CLSF_SE_CD
			, CLSF_CD
			, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CLSF_CD' AND CD_VL = A.CLSF_CD) AS CLSF_NM
			, SUM( NVL( DECODE(YR,#{yr}-1,TOT_TRMT_PRFMNC_VLM,'') , 0 ) ) AS PRV_TOT_VLM
			, SUM( NVL( DECODE(YR,#{yr}-1,TOT_TRMT_PRFMNC_AMT,'') , 0 ) ) AS PRV_TOT_AMT

			, SUM( NVL( DECODE(YR,#{yr},TOT_TRMT_PRFMNC_VLM,'') , 0 ) ) AS TOT_VLM
			, SUM( NVL( DECODE(YR,#{yr},TOT_TRMT_PRFMNC_AMT,'') , 0 ) ) AS TOT_AMT
		FROM (
				SELECT
					YR
					, BRNO
					, TOT_TRMT_PRFMNC_VLM
					, TOT_TRMT_PRFMNC_AMT
					,(SELECT CLSF_CD
						FROM TB_EV_APO_YR_GPC_CD
						WHERE 1=1
						  AND APO_SE = '2'
						  AND YR = APS.YR
						  AND BRNO = APS.BRNO
						  AND ITEM_CD = APS.ITEM_CD
						  AND STTG_UPBR_ITEM_SE = APS.STTG_UPBR_ITEM_SE
					) AS CLSF_CD
				FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
				WHERE 1=1
				  AND DEL_YN = 'N'
				  AND NVL(TMPR_STRG_YN,'N') = 'N'
				  AND ITEM_CD = (SELECT ITEM_CD
				  					FROM TB_EV_APO_YR_GPC_CD
				  					WHERE 1=1
				  					  AND APO_SE = '2'
				  					  AND YR = APS.YR
				  					  AND BRNO = APS.BRNO
				  					  AND ITEM_CD = APS.ITEM_CD
				  					  AND STTG_UPBR_ITEM_SE = APS.STTG_UPBR_ITEM_SE)
				  AND APO_SE = '2'
				  AND PRCHS_SLS_SE = '2'
				  AND BRNO = #{brno}
				) A
		GROUP BY BRNO , CLSF_CD

		UNION ALL

		SELECT
			BRNO
			, DECODE(CLSF_SE_CD, '1' , '원예농산물' , '기타품목') AS CLSF_SE_NM
			, CLSF_SE_CD
			, '' AS CLSF_CD
			, '소계' AS CLSF_NM
			, SUM( NVL( DECODE(YR,#{yr}-1,TOT_TRMT_PRFMNC_VLM,'') , 0 ) ) AS PRV_TOT_VLM
			, SUM( NVL( DECODE(YR,#{yr}-1,TOT_TRMT_PRFMNC_AMT,'') , 0 ) ) AS PRV_TOT_AMT

			, SUM( NVL( DECODE(YR,#{yr},TOT_TRMT_PRFMNC_VLM,'') , 0 ) ) AS TOT_VLM
			, SUM( NVL( DECODE(YR,#{yr},TOT_TRMT_PRFMNC_AMT,'') , 0 ) ) AS TOT_AMT
		FROM (
				SELECT
					YR
					, BRNO
					, TOT_TRMT_PRFMNC_VLM
					, TOT_TRMT_PRFMNC_AMT
					,(SELECT CASE WHEN CLSF_CD IN ('2', '3', '4') THEN '1'
									ELSE '2'
									END
						FROM TB_EV_APO_YR_GPC_CD
						WHERE 1=1
						  AND APO_SE = '2'
						  AND YR = APS.YR
						  AND BRNO = APS.BRNO
						  AND ITEM_CD = APS.ITEM_CD
						  AND STTG_UPBR_ITEM_SE = APS.STTG_UPBR_ITEM_SE
					) AS CLSF_SE_CD
				FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
				WHERE 1=1
				  AND DEL_YN = 'N'
				  AND NVL(TMPR_STRG_YN,'N') = 'N'
				  AND ITEM_CD = (SELECT ITEM_CD
				  					FROM TB_EV_APO_YR_GPC_CD
				  					WHERE 1=1
				  					  AND APO_SE = '2'
				  					  AND YR = APS.YR
				  					  AND BRNO = APS.BRNO
				  					  AND ITEM_CD = APS.ITEM_CD
				  					  AND STTG_UPBR_ITEM_SE = APS.STTG_UPBR_ITEM_SE)
				  AND APO_SE = '2'
				  AND PRCHS_SLS_SE = '2'
				  AND BRNO = #{brno}
				) A
		GROUP BY  BRNO , CLSF_SE_CD

		ORDER BY CLSF_SE_CD,CLSF_CD
	</select>
</mapper>