<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : BbsMapper.xml                                    				-->
<!-- DESC : 게시판 정보 mapper                                             			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.fm.bbs.mapper.BbsMngMapper.selectBbs				-->
	<!-- DESC : 게시판 테이블 단건조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectInvShipOgnGenalTblMng" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvShipOgnGenalTblMng */
			'a' as BRNO
		FROM DUAL
		WHERE 1=1
    </select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectItemStbltYn			-->
	<!-- DESC : 출자출하조직 총괄표 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.06.29  	jcshin        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectInvShipOgnGenalTblMngList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectItemStbltYn */
			TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.BRNO
			,TOTAL.UO_BRNO
			,TOTAL.YR
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.CORP_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER
			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER
					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT

					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							, ITEM.STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							, ITEM.CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, (SELECT STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO ='8'
								  AND BRNO = ITEM.BRNO
								  AND UO_BRNO = ITEM.UO_BRNO
								  AND YR = ITEM.YR
								  AND ITEM_CD = ITEM.ITEM_CD
							) AS STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, STTG_UPBR_ITEM_SE
									, CTGRY_CD
									, TO_CHAR(BRNO) AS UO_BRNO
									, #{brno} AS BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = AYGC.ITEM_CD) AS ITEM_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = AYGC.CTGRY_CD) AS CTGRY_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = AYGC.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
								FROM TB_EV_APO_YR_GPC_CD AYGC
								WHERE 1=1
								<if test='uoBrno != null and uoBrno != ""'>
							  	  AND BRNO = #{uoBrno}
							  	</if>
							  	<if test='yr != null and yr != ""'>
							  	  AND YR = #{yr}
							  	</if>
							) ITEM ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
					  													FROM TB_EV_FRMHS_APO
					  													WHERE 1=1
					  													  AND STBLT_YN = 'Y'
					  													  AND APO_SE = '2'
					  													  AND NVL(EXCL_YN,'N') != 'Y'
					  													<if test='brno != null and brno != ""'>
																	  	  AND BRNO = #{brno}
																	  	</if>
																	  	<if test='yr != null and yr != ""'>
																	  	  AND YR = #{yr}
																	  	</if>
					  									)
								<if test='uoBrno != null and uoBrno != ""'>
							  	  AND UO_BRNO = #{uoBrno}
							  	</if>
							  	<if test='brno != null and brno != ""'>
							  	  AND BRNO = #{brno}
							  	</if>
							  	<if test='yr != null and yr != ""'>
							  	  AND YR = #{yr}
							  	</if>

									GROUP BY  BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('7')
								<if test='uoBrno != null and uoBrno != ""'>
							  	  AND UO_BRNO = #{uoBrno}
							  	</if>
							  	<if test='brno != null and brno != ""'>
							  	  AND BRNO = #{brno}
							  	</if>
							  	<if test='yr != null and yr != ""'>
							  	  AND YR = #{yr}
							  	</if>

								GROUP BY  BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
				)TOT
		)TOTAL
		ORDER BY TOTAL.STTG_UPBR_ITEM_SE
	</select>


	<select id="selectInvShipOgnGenalTblMngIsoList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		<!-- Start 페이징 -->
		<if test='pagingYn != null and pagingYn.equals("Y")'>
			SELECT
				  ROWNUM AS ROW_SEQ
				, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
				, pt0.*
			  FROM (
		</if>

		SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvShipOgnGenalTblMngUoList */
			TEA.APO_CD
			,TEA.APO_SE
			,TEA.BRNO
			,TEA.CRNO
			, TRIM(TEA.CTPV) AS CTPV
			, TRIM(TEA.SGG) AS SGG
			,TEA.CORP_NM
			,TEA.CORP_SE_CD
			,TEAM.YR
		FROM TB_EV_APO TEA
			,TB_EV_APLY_MNG TEAM
		WHERE 1=1
		  AND TEA.BRNO = TEAM.BRNO(+)
		  AND TEA.APO_SE = '2'
		<if test='brno != null and brno != ""'>
		  AND TEA.BRNO = #{brno}
		</if>
		<if test='yr != null and yr != ""'>
		  AND TEAM.YR = #{yr}
		</if>
		<if test='cmptnInst != null and cmptnInst != ""'>
		  AND TEA.CMPTN_INST = #{cmptnInst}
		</if>
		<if test='ctpv != null and ctpv != ""'>
		  AND TRIM(TEA.CTPV) = #{ctpv}
		</if>

		<if test='corpSeCd != null and corpSeCd != ""'>
		  AND TEA.CORP_SE_CD = #{corpSeCd}
		</if>
		<if test='corpDtlSeCd != null and corpDtlSeCd != ""'>
		  AND TEA.CORP_DTL_SE_CD = #{corpDtlSeCd}
		</if>
		<if test='corpNm != null and corpNm != ""'>
		  AND CM.CORP_NM LIKE '%' || #{corpNm} || '%'
		</if>

		<!-- 페이징 -->
		<if test='pagingYn != null and pagingYn.equals("Y")'>
			  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
		</if>
	</select>

	<update id="updateStbltYn" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		UPDATE /* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.updateStbltYn */
			TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
		   SET
			  STBLT_YN				= #{stbltYn}
			, SYS_LAST_CHG_DT		= SYSDATE
			, SYS_LAST_CHG_USER_ID	= #{sysLastChgUserId}
			, SYS_LAST_CHG_PRGRM_ID	= #{sysLastChgPrgrmId}

		 WHERE 1=1
		   AND APO_SE 			= '2'
		   AND YR				= #{yr}
		   AND BRNO				= #{brno}
		   AND UO_BRNO 			= #{uoBrno}
		   AND ITEM_CD 			= #{itemCd}
	</update>

	<select id="selectRawDataList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectRawDataList */
			TOTAL.YR
			,TOTAL.UO_BRNO
			,TOTAL.UO_CORP_NM
			,TOTAL.BRNO
			,TOTAL.CORP_NM
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER
			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
			,DECODE(TOTAL.UO_STBLT_YN
					, 'Y' , DECODE(TOTAL.ORG_STBLT_YN , 'Y' , TOTAL.LAST_STBLT_YN , '')
					, ''
			) AS LAST_STBLT_YN
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER
					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT
					/* 20240603 승인형 작년 기준인것을 올해 기준으로 변경 60 -> 50 , 60 -> 40 */
					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 50 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 40 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
					,(SELECT STBLT_YN
						FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
						WHERE 1=1
						  AND APO_SE = '1'
						  AND TYPE_SE_NO = '8'
						  AND YR = TOT.YR
						  AND BRNO = TOT.UO_BRNO
						  AND ITEM_CD = TOT.ITEM_CD
					) AS UO_STBLT_YN
					,(SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN)
						FROM TB_EV_REG_RSLT ERR
						WHERE 1=1
						  AND BRNO = TOT.BRNO
						  AND YR = TOT.YR
						  AND 'Y' = DECODE(APO_SE ,'1' , 'Y' , '2' ,DECODE(ERR.UO_BRNO , TOT.UO_BRNO , 'Y' , 'N')
						)
					) AS LAST_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = ITEM.CTGRY_CD) AS CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS UO_CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, ITEM.STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD)AS STTG_UPBR_ITEM_SE
									, (SELECT CTGRY_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = A.YR AND BRNO = A.UO_BRNO AND ITEM_CD = A.ITEM_CD)AS CTGRY_CD
									, UO_BRNO
									, BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = A.ITEM_CD) AS ITEM_NM
									, STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
									WHERE 1=1
									  AND APO_SE = '2'
									  AND TYPE_SE_NO = '8'
									  AND YR = #{yr}
									  AND BRNO NOT IN (SELECT BRNO
														FROM TB_COM_USER
														WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61')
														)
									  AND UO_BRNO NOT IN (SELECT BRNO
															FROM TB_COM_USER
															WHERE USER_ID IN ('at11','at12','at13','at14','at15','at16','at17','at51')
															)
									  AND ITEM_CD = (SELECT ITEM_CD
									  					FROM TB_EV_APO_YR_GPC_CD
									  					WHERE 1=1
									  					  AND APO_SE = '2'
									  					  AND YR = A.YR
									  					  AND BRNO = A.BRNO
									  					  AND UO_BRNO = A.UO_BRNO
									  					  AND ITEM_CD = A.ITEM_CD)
							) ITEM ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT B
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND ITEM_CD = (SELECT ITEM_CD
								  					FROM TB_EV_APO_YR_GPC_CD
								  					WHERE 1=1
								  					  AND APO_SE = '2'
								  					  AND YR = B.YR
								  					  AND BRNO = B.BRNO
								  					  AND UO_BRNO = B.UO_BRNO
								  					  AND ITEM_CD = B.ITEM_CD)
								  AND YR = #{yr}
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND APO_SE = '2'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND YR = B.YR
															  AND BRNO = B.BRNO
															  AND UO_BRNO = B.UO_BRNO
														)
								GROUP BY BRNO, UO_BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTB
								WHERE 1=1
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5','7')
								  AND OGNZ_STBLT_YN = DECODE(PSTB.TYPE_SE_NO, '5' , 'N' , '7' ,'0' ,'')
								  AND (
								  		PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
														FROM TB_EV_FRMHS_APO
														WHERE 1=1
														  AND STBLT_YN = 'Y'
														  AND NVL(EXCL_YN,'N') != 'Y'
														  AND APO_SE = '2'
														  AND YR = PSTA.YR
														  AND BRNO = PSTA.BRNO
														  AND UO_BRNO = PSTA.UO_BRNO
													)
										OR
										PRDCR_OGNZ_SN = '0'
										)
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTB.YR
													  AND BRNO = PSTB.BRNO
													  AND UO_BRNO = PSTB.UO_BRNO
													)
								  AND YR = #{yr}
								GROUP BY  BRNO , UO_BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						  AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						  AND ITEM.BRNO = TOTA.BRNO(+)
						  AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)
						  AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
						  AND ITEM.BRNO = TOTB.BRNO(+)
						  AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)
				)TOT
		)TOTAL
		ORDER BY UO_BRNO , BRNO , ITEM_CD , STBLT_YN
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvstSpmtOgnzOvsTableRawDataList	-->
	<!-- DESC : 출자출하조직 구 총괄표 Raw data                                              		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.23  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvstSpmtOgnzOvsTableRawDataList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		<![CDATA[
			SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvstSpmtOgnzOvsTableRawDataList */
				TOTAL.ITEM_CD
				 ,TOTAL.ITEM_NM
				 ,TOTAL.STTG_UPBR_ITEM_SE
				 ,TOTAL.STTG_UPBR_ITEM_NM
				 ,TOTAL.CTGRY_CD
				 ,TOTAL.CTGRY_NM
				 ,TOTAL.BRNO
				 ,TOTAL.UO_BRNO
				 ,TOTAL.YR
				 ,TOTAL.APRV
				 ,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
				 , TOTAL.UO_NM
				 ,TOTAL.CORP_NM
				 ,TOTAL.UO_SPMT_AMT
				 ,TOTAL.UO_SPMT_AMT_OTHER
				 ,TOTAL.UO_OTHER_SPMT_AMT
				 ,TOTAL.UO_OTHER_SPMT_AMT_OTHER
				 ,TOTAL.UO_SPMT_AMT_TOT
				 ,TOTAL.UO_SPMT_AMT_RT
				 ,TOTAL.UO_SPMT_AMT_TOT_RT
				 ,TOTAL.CHK_A_A
				 ,TOTAL.CHK_A_B
				 ,TOTAL.CHK_A_C
				 ,TOTAL.CHK_B_A
				 ,TOTAL.CHK_B_B
				 ,TOTAL.CHK_B_C
				 , (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
							 (CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
									   THEN 'Y'
								   ELSE 'N' END)
						 WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
						 WHEN  TOTAL.APRV = '2' THEN
							 (CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
									   THEN 'Y'
								   ELSE 'N' END)
						 ELSE 'N' END
				) AS STBLT_YN
				 ,TOTAL.ORG_STBLT_YN
				 ,DECODE(TOTAL.UO_STBLT_YN
				, 'Y' , DECODE(TOTAL.ORG_STBLT_YN , 'Y' , TOTAL.LAST_STBLT_YN , '')
				, ''
				) AS LAST_STBLT_YN
			FROM
				(SELECT
					 TOT.ITEM_CD
					  ,TOT.ITEM_NM
					  ,TOT.STTG_UPBR_ITEM_SE
					  ,TOT.STTG_UPBR_ITEM_NM
					  ,TOT.CTGRY_CD
					  ,TOT.CTGRY_NM
					  ,TOT.BRNO
					  ,TOT.UO_BRNO
					  ,TOT.YR
					  ,TOT.APRV
					  ,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					  ,TOT.UO_NM
					  ,TOT.CORP_NM
					  ,TOT.UO_SPMT_AMT
					  ,TOT.UO_SPMT_AMT_OTHER
					  ,TOT.UO_OTHER_SPMT_AMT
					  ,TOT.UO_OTHER_SPMT_AMT_OTHER
					  ,TOT.UO_SPMT_AMT_TOT
					  ,TOT.UO_SPMT_AMT_RT
					  ,TOT.UO_SPMT_AMT_TOT_RT

					  ,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					  ,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					  ,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 60 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					  ,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					  ,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					  ,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					  ,TOT.STBLT_YN AS ORG_STBLT_YN
					  ,(SELECT STBLT_YN
						FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
						WHERE 1=1
						  AND APO_SE = '1'
						  AND TYPE_SE_NO = '8'
						  AND YR = TOT.YR
						  AND BRNO = TOT.UO_BRNO
						  AND ITEM_CD = TOT.ITEM_CD
					) AS UO_STBLT_YN
					  ,(
						SELECT NVL(ERR.MNGR_STBLT_YN , ERR.STBLT_YN)
						FROM TB_EV_REG_RSLT ERR
						WHERE 1=1
						  AND BRNO = TOT.BRNO
						  AND YR = TOT.YR
						  AND 'Y' = DECODE(APO_SE ,'1' , 'Y' , '2' ,DECODE(ERR.UO_BRNO , TOT.UO_BRNO , 'Y' , 'N'))
					) AS LAST_STBLT_YN
				 FROM
					 (SELECT
						  ITEM.ITEM_CD
						   , ITEM.ITEM_NM
						   , ITEM.STTG_UPBR_ITEM_SE
						   , ITEM.STTG_UPBR_ITEM_NM
						   , ITEM.CTGRY_CD
						   , ITEM.CTGRY_NM
						   , ITEM.BRNO
						   , ITEM.UO_BRNO
						   , ITEM.YR
						   , (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
						   , ITEM.UO_NM
						   , (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM
						   , TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
						   , TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER
						   , TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
						   , TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER
						   , (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT
						   , ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
						   , ROUND(
									 NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											  /
										  NULLIF(
												  (NVL(TOTA.UO_SPMT_AMT,0)
													  + NVL(TOTA.UO_OTHER_SPMT_AMT,0)
													  + NVL(TOTB.UO_SPMT_AMT,0)
													  + NVL(TOTB.UO_OTHER_SPMT_AMT,0))
											  , 0 )
										 , 0 ) * 100
							 , 2
							 ) AS UO_SPMT_AMT_TOT_RT
						   , (SELECT STBLT_YN
							  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
							  WHERE 1=1
								AND APO_SE = '2'
								AND TYPE_SE_NO ='8'
								AND BRNO = ITEM.BRNO
								AND UO_BRNO = ITEM.UO_BRNO
								AND YR = ITEM.YR
								AND ITEM_CD = ITEM.ITEM_CD
						 ) AS STBLT_YN
					  FROM
						  (
							  SELECT
								  ITEM.ITEM_CD
								   , ITEM.YR
								   , ITEM.STTG_UPBR_ITEM_SE
								   , ITEM.CTGRY_CD
								   , TO_CHAR(ITEM.BRNO) AS UO_BRNO
								   , APO.BRNO AS BRNO
								   , APO.UO_NM
								   , APO.UO_BRNO		AS X_UO_BRNO
								   , APO.APO_SE
								   , APO.APO_CD
								   , APO.CORP_NM
								   , APO.CRNO
								   ,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = ITEM.ITEM_CD) AS ITEM_NM
								   ,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = ITEM.CTGRY_CD) AS CTGRY_NM
								   ,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = ITEM.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
							  FROM
								  (
									  SELECT
										  CM.UO_NM
										   , CM.UO_BRNO
										   , CM.APO_SE
										   , CM.APO_CD
										   , CM.CORP_NM
										   , CM.CRNO
										   , CM.BRNO
										   , EAM.YR
									  FROM TB_EV_APLY_MNG EAM
											   LEFT JOIN TB_EV_APO CM
														 ON CM.BRNO = EAM.BRNO
															 AND CM.APO_CD IS NOT NULL
									  WHERE EAM.YR = #{yr}
										AND NOT EXISTS (
										  SELECT 1
										  FROM TB_COM_USER X
										  WHERE X.USER_ID IN (
											  SELECT CD.CD_VL
											  FROM TB_COM_CD_DTL CD
											  WHERE CD.CD_ID = 'SYS_EXCLD_USER_ID'
												AND CD.USE_YN = 'Y'
												AND CD.DEL_YN = 'N'
										  )
											AND X.BRNO = CM.BRNO
									  )
								  ) APO
									  JOIN TB_EV_APO_YR_GPC_CD ITEM
										   ON ITEM.YR = APO.YR
											   AND ITEM.BRNO = NVL(APO.UO_BRNO, APO.BRNO)
						  ) ITEM
							  LEFT JOIN (
							  SELECT
								  A.UO_BRNO
								   , A.BRNO
								   , A.ITEM_CD
								   , SUM(A.UO_SPMT_AMT)	AS UO_SPMT_AMT
								   , SUM(A.UO_OTHER_SPMT_AMT) AS UO_OTHER_SPMT_AMT
							  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
							  WHERE A.APO_SE = '2'
								AND A.TYPE_SE_NO IN ('5')
								AND A.PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
														FROM TB_EV_FRMHS_APO X
														WHERE X.STBLT_YN = 'Y'
														  AND X.APO_SE = '2'
														  AND NVL(X.EXCL_YN,'N') <> 'Y'
														  AND X.BRNO = A.BRNO
														  AND X.YR = A.YR
							  )
								AND A.YR = #{yr}
							  GROUP BY A.UO_BRNO, A.BRNO, A.ITEM_CD
						  ) TOTA
										ON TOTA.BRNO = ITEM.BRNO
											AND TOTA.ITEM_CD = ITEM.ITEM_CD
											AND NVL(TOTA.UO_BRNO, '*') = NVL(ITEM.UO_BRNO, NVL(TOTA.UO_BRNO, '*'))
							  LEFT JOIN (
							  SELECT
								  A.UO_BRNO
								   , A.BRNO
								   , A.ITEM_CD
								   , SUM(A.UO_SPMT_AMT)	AS UO_SPMT_AMT
								   , SUM(A.UO_OTHER_SPMT_AMT) AS UO_OTHER_SPMT_AMT
							  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT A
							  WHERE A.APO_SE = '2'
								AND A.TYPE_SE_NO IN ('7')
								AND A.YR = #{yr}
							  GROUP BY A.UO_BRNO, A.BRNO, A.ITEM_CD
						  ) TOTB
										ON TOTB.BRNO = ITEM.BRNO
											AND TOTB.ITEM_CD = ITEM.ITEM_CD
											AND NVL(TOTB.UO_BRNO, '*') = NVL(ITEM.UO_BRNO, NVL(TOTB.UO_BRNO, '*'))
					 )TOT
				)TOTAL
			ORDER BY UO_BRNO , BRNO , ITEM_CD , STBLT_YN
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvstOldSpmtOgnzOvsTableRawDataList	-->
	<!-- DESC : 출자출하조직 구 총괄표 Raw data OLD                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.23  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectInvstOldSpmtOgnzOvsTableRawDataList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		<![CDATA[
			SELECT /* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvstOldSpmtOgnzOvsTableRawDataList */
				T.YR							AS YR
				 , T.UO_BRNO					AS UO_BRNO
				 , T.BRNO						AS BRNO
				 , T.CORP_NM					AS CORP_NM
				 , T.ITEM_CD						AS ITEM_CD
				 , T.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
				 , T.CTGRY_CD					AS CTGRY_CD
				 , T.APRV							AS APRV

				 , (SELECT X.ITEM_NM FROM TB_ITEM_CRTR X WHERE X.ITEM_CD = T.ITEM_CD) AS ITEM_NM
				 , (SELECT FN_GET_COM_CD_VL_NM('STTG_UPBR_ITEM_SE', T.STTG_UPBR_ITEM_SE) FROM DUAL) AS STTG_UPBR_ITEM_NM
				 , (SELECT FN_GET_COM_CD_VL_NM('CTGRY_CD', T.CTGRY_CD) FROM DUAL) AS CTGRY_NM
				 , (SELECT FN_GET_COM_CD_VL_NM('APRV_UPBR_SE_CD', T.APRV) FROM DUAL) AS APRV_NM

				 , T.UO_SPMT_AMT						AS UO_SPMT_AMT
				 , T.UO_SPMT_AMT_OTHER				AS UO_SPMT_AMT_OTHER
				 , T.UO_OTHER_SPMT_AMT				AS UO_OTHER_SPMT_AMT
				 , T.UO_OTHER_SPMT_AMT_OTHER	AS UO_OTHER_SPMT_AMT_OTHER
				 , T.UO_SPMT_AMT_TOT					AS UO_SPMT_AMT_TOT
				 , T.UO_SPMT_AMT_RT					AS UO_SPMT_AMT_RT
				 , T.UO_SPMT_AMT_TOT_RT			AS UO_SPMT_AMT_TOT_RT

				 , T.CHK_A_A			AS CHK_A_A
				 , T.CHK_A_B			AS CHK_A_B
				 , T.CHK_A_C			AS CHK_A_C
				 , T.CHK_B_A			AS CHK_B_A
				 , T.CHK_B_B			AS CHK_B_B
				 , T.CHK_B_C			AS CHK_B_C

				 , CASE T.APRV
					   WHEN '1' THEN
						   CASE T.STTG_UPBR_ITEM_SE
							   WHEN '1' THEN
								   CASE
									   WHEN T.CHK_A_A = 'Y' AND T.CHK_A_B = 'Y' AND T.CHK_A_C = 'Y' THEN 'Y'
									   ELSE 'N'
									   END
							   WHEN '2' THEN 'Y'
							   ELSE 'N'
							   END
					   WHEN '2' THEN
						   CASE
							   WHEN T.CHK_B_A = 'Y' AND T.CHK_B_C = 'Y' THEN 'Y'
							   ELSE 'N'
							   END
					   ELSE 'N'
				END							AS STBLT_YN
				 , T.ORG_STBLT_YN		AS ORG_STBLT_YN

				 , CASE
					   WHEN T.ORG_STBLT_YN = 'Y' THEN NULL
					   ELSE (
						   SELECT
							   FN_GET_ISO_STBLT_YN_NM (
									   T.APRV
								   , T.STTG_UPBR_ITEM_SE
								   , T.CHK_A_A
								   , T.CHK_A_B
								   , T.CHK_A_C
								   , T.CHK_B_A
								   , T.CHK_B_B
								   , T.CHK_B_C
								   )
						   FROM DUAL
					   )
				END							AS STBLT_YN_NM

			FROM (
					 SELECT
						 TOT.YR							AS YR
						  , TOT.UO_BRNO					AS UO_BRNO
						  , TOT.BRNO							AS BRNO
						  , TOT.CORP_NM					AS CORP_NM
						  , TOT.ITEM_CD						AS ITEM_CD
						  , TOT.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
						  , TOT.CTGRY_CD					AS CTGRY_CD
						  , (SELECT X.APRV FROM TB_EV_APO X WHERE X.BRNO = TOT.UO_BRNO) AS APRV
						  , TOT.UO_SPMT_AMT						AS UO_SPMT_AMT
						  , TOT.UO_SPMT_AMT_OTHER				AS UO_SPMT_AMT_OTHER
						  , TOT.UO_OTHER_SPMT_AMT				AS UO_OTHER_SPMT_AMT
						  , TOT.UO_OTHER_SPMT_AMT_OTHER	AS UO_OTHER_SPMT_AMT_OTHER
						  , TOT.UO_SPMT_AMT_TOT					AS UO_SPMT_AMT_TOT
						  , TOT.UO_SPMT_AMT_RT					AS UO_SPMT_AMT_RT
						  , TOT.UO_SPMT_AMT_TOT_RT			AS UO_SPMT_AMT_TOT_RT
						  , TOT.STBLT_YN								AS ORG_STBLT_YN
						  , CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END			AS CHK_A_A
						  , CASE WHEN TOT.UO_SPMT_AMT_RT >= 60 THEN 'Y' ELSE 'N' END			AS CHK_A_B
						  , CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 60 THEN 'Y' ELSE 'N' END 	AS CHK_A_C
						  , CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END			AS CHK_B_A
						  , CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END			AS CHK_B_B
						  , CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END	AS CHK_B_C

					 FROM (
							  SELECT
								  ITEM.YR							AS YR
								   , ITEM.UO_BRNO					AS UO_BRNO
								   , ITEM.BRNO						AS BRNO
								   , ITEM.CORP_NM					AS CORP_NM
								   , ITEM.ITEM_CD					AS ITEM_CD
								   , ITEM.STTG_UPBR_ITEM_SE	As STTG_UPBR_ITEM_SE
								   , ITEM.CTGRY_CD					AS CTGRY_CD
								   , TOTA.UO_SPMT_AMT 				AS UO_SPMT_AMT
								   , TOTB.UO_SPMT_AMT 				AS UO_SPMT_AMT_OTHER
								   , TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
								   , TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

								   , NVL(TOTA.UO_SPMT_AMT, 0)
								  + NVL(TOTA.UO_OTHER_SPMT_AMT, 0)
								  + NVL(TOTB.UO_SPMT_AMT, 0)
								  + NVL(TOTB.UO_OTHER_SPMT_AMT, 0) AS UO_SPMT_AMT_TOT
								   , ROUND(
										  NVL(
													  NVL(TOTA.UO_SPMT_AMT, 0)
													  /
													  NULLIF(
																  NVL(TOTA.UO_SPMT_AMT, 0) + NVL(TOTA.UO_OTHER_SPMT_AMT, 0)
														  , 0)
											  , 0) * 100
								  , 2)												AS UO_SPMT_AMT_RT
								   , ROUND(
										  NVL(
													  (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT, 0))
													  /
													  NULLIF(
															  (NVL(TOTA.UO_SPMT_AMT, 0)
																  + NVL(TOTA.UO_OTHER_SPMT_AMT, 0)
																  + NVL(TOTB.UO_SPMT_AMT, 0)
																  + NVL(TOTB.UO_OTHER_SPMT_AMT, 0))
														  , 0)
											  , 0 ) * 100
								  , 2)												AS UO_SPMT_AMT_TOT_RT
								   , (
								  SELECT X.STBLT_YN
								  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT X
								  WHERE X.YR = ITEM.YR
									AND X.UO_BRNO = ITEM.UO_BRNO
									AND X.BRNO = ITEM.BRNO
									AND X.ITEM_CD = ITEM.ITEM_CD
									AND X.APO_SE = '2'
									AND X.TYPE_SE_NO ='8'
									AND X.DEL_YN = 'N'
							  )														AS STBLT_YN
							  FROM (
									   SELECT
										   APO.APO_CD		AS APO_CD
											, EAM.APO_SE		AS APO_SE
											, APO.CORP_NM	AS CORP_NM
											, APO.CRNO		AS CRNO
											, APO.BRNO			AS BRNO
											, EAM.YR			AS YR
											, UC.UO_BRNO		AS UO_BRNO
											, GC.ITEM_CD		AS ITEM_CD
											, GC.CTGRY_CD	AS CTGRY_CD
											, GC.STTG_UPBR_ITEM_SE		AS STTG_UPBR_ITEM_SE
									   FROM TB_EV_APLY_MNG EAM

												JOIN TB_EV_APO APO
													 ON APO.BRNO = EAM.BRNO
														 AND APO.DEL_YN = 'N'

												JOIN TB_EV_APO_UO_CD UC
													 ON UC.ISO_BRNO = EAM.BRNO
														 AND UC.DEL_YN = 'N'

												LEFT JOIN TB_EV_APO_YR_GPC_CD GC
														  ON GC.YR = EAM.YR
															  AND GC.BRNO = UC.UO_BRNO
															  AND GC.DEL_YN = 'N'

									   WHERE EAM.APO_SE = '2'
										 AND EAM.YR = #{yr}
										 AND NOT EXISTS (
											   SELECT 1
											   FROM TB_COM_USER X
											   WHERE X.USER_ID IN (
												   SELECT CD.CD_VL
												   FROM TB_COM_CD_DTL CD
												   WHERE CD.CD_ID = 'SYS_EXCLD_USER_ID'
													 AND CD.USE_YN = 'Y'
													 AND CD.DEL_YN = 'N'
											   		)
												 AND X.BRNO = EAM.BRNO
										   )

								   ) ITEM
									   LEFT JOIN (
								  SELECT
									  SLS.UO_BRNO	AS UO_BRNO
									   , SLS.BRNO			AS BRNO
									   , SLS.YR				AS YR
									   , SLS.ITEM_CD		AS ITEM_CD
									   , NVL(SUM(SLS.UO_SPMT_AMT), 0)				AS UO_SPMT_AMT
									   , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT
								  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
								  WHERE SLS.APO_SE = '2'
									AND SLS.TYPE_SE_NO IN ('5')
									AND SLS.DEL_YN = 'N'
									AND SLS.PRDCR_OGNZ_SN IN (
									  SELECT X.PRDCR_OGNZ_SN
									  FROM TB_EV_FRMHS_APO X
									  WHERE X.APO_SE = SLS.APO_SE
										AND X.BRNO = SLS.BRNO
										AND X.YR = SLS.YR
										AND X.STBLT_YN = 'Y'
										AND NVL(X.EXCL_YN, 'N') <> 'Y'
								  )
								  GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
							  ) TOTA
												 ON TOTA.YR = ITEM.YR
													 AND TOTA.UO_BRNO = ITEM.UO_BRNO
													 AND TOTA.BRNO = ITEM.BRNO
													 AND TOTA.ITEM_CD = ITEM.ITEM_CD

									   LEFT JOIN (
								  SELECT
									  SLS.UO_BRNO	AS UO_BRNO
									   , SLS.BRNO			AS BRNO
									   , SLS.YR				AS YR
									   , SLS.ITEM_CD		AS ITEM_CD
									   , NVL(SUM(SLS.UO_SPMT_AMT), 0)				AS UO_SPMT_AMT
									   , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT
								  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
								  WHERE SLS.APO_SE = '2'
									AND SLS.TYPE_SE_NO IN ('7')
									AND SLS.DEL_YN = 'N'
								  GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
							  ) TOTB
												 ON TOTB.YR = ITEM.YR
													 AND TOTB.UO_BRNO = ITEM.UO_BRNO
													 AND TOTB.BRNO = ITEM.BRNO
													 AND TOTB.ITEM_CD = ITEM.ITEM_CD
						  ) TOT
				 ) T
			ORDER BY UO_BRNO, BRNO, ITEM_CD, STBLT_YN
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectIsoPrchsSlsSummaryList	-->
	<!-- DESC : 출자출하조직 매입매출 총괄 목록 조회                                    -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.07.16  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectIsoPrchsSlsSummaryList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		<![CDATA[
			SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectIsoPrchsSlsSummaryList */
				   TOT.YR				AS YR
				 , TOT.ITEM_CD			AS ITEM_CD
				 , TOT.ITEM_NM			AS ITEM_NM
				 , TOT.BRNO				AS BRNO
				 , TOT.CRNO			AS CRNO
				 , TOT.CORP_NM		AS CORP_NM
				 , TOT.APRV				AS APRV
				 , (SELECT FN_GET_COM_CD_VL_NM('APRV_UPBR_SE_CD', TOT.APRV) FROM DUAL) AS APRV_NM
				 , TOT.APO_CD			AS APO_CD
				 , TOT.APO_SE			AS APO_SE
				 , TOT.UO_BRNO		AS UO_BRNO
				 , (SELECT MAX(X.CORP_NM) FROM TB_EV_APO X WHERE X.BRNO = TOT.UO_BRNO)	AS UO_CORP_NM
				 , TOT.CTGRY_CD		AS CTGRY_CD
				 , TOT.CLSF_CD		AS CLSF_CD
				 , TOT.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
				 , TOT.UO_SPMT_AMT						AS UO_SPMT_AMT
				 , TOT.UO_SPMT_AMT_OTHER				AS UO_SPMT_AMT_OTHER
				 , TOT.UO_OTHER_SPMT_AMT				AS UO_OTHER_SPMT_AMT
				 , TOT.UO_OTHER_SPMT_AMT_OTHER	AS UO_OTHER_SPMT_AMT_OTHER
				 , TOT.UO_SPMT_VLM						AS UO_SPMT_VLM
				 , TOT.UO_SPMT_VLM_OTHER				AS UO_SPMT_VLM_OTHER
				 , TOT.UO_OTHER_SPMT_VLM				AS UO_OTHER_SPMT_VLM
				 , TOT.UO_OTHER_SPMT_VLM_OTHER	AS UO_OTHER_SPMT_VLM_OTHER
				 , TOT.UO_SPMT_VLM_TOT					AS UO_SPMT_VLM_TOT
				 , TOT.UO_SPMT_AMT_TOT					AS UO_SPMT_AMT_TOT

				 , TOT.UO_SPMT_AMT_RT			AS UO_SPMT_AMT_RT
				 , TOT.UO_SPMT_AMT_TOT_RT		AS UO_SPMT_AMT_TOT_RT

				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'AA'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_A_A
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'AB'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_A_B
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'AC'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_A_C
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'BA'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_B_A
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'BB'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_B_B
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'BC'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_B_C
				 , TOT.ORG_STBLT_YN	AS ORG_STBLT_YN
				 , (
					SELECT
						FN_GET_ISO_SPMT_STBLT_YN (
								TOT.YR
								, TOT.APRV
								, TOT.STTG_UPBR_ITEM_SE
								, TOT.UO_SPMT_AMT
								, TOT.UO_SPMT_AMT_RT
								, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS STBLT_YN
				 , (
					SELECT
						FN_GET_ISO_SPMT_STBLT_NM (
								TOT.YR
								, TOT.APRV
								, TOT.STTG_UPBR_ITEM_SE
								, TOT.UO_SPMT_AMT
								, TOT.UO_SPMT_AMT_RT
								, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS STBLT_YN_NM
				, (
					SELECT X.ACTN_MTTR
					  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT X
					 WHERE X.BRNO = TOT.BRNO
						AND X.YR = TOT.YR
						AND X.APO_SE = '2'
						AND X.TYPE_SE_NO = '8'
						AND X.ITEM_CD = TOT.ITEM_CD
						AND X.UO_BRNO = TOT.UO_BRNO
						AND X.DEL_YN = 'N'
				) 	AS ACTN_MTTR
			FROM (
					 SELECT
						 ITEM.YR				AS YR
						  , ITEM.ITEM_CD		AS ITEM_CD
						  , IC.ITEM_NM			AS ITEM_NM
						  , ITEM.BRNO			AS BRNO
						  , ITEM.CRNO			AS CRNO
						  , ITEM.CORP_NM		AS CORP_NM
						  , (SELECT X.APRV FROM TB_EV_APO X WHERE X.BRNO = ITEM.UO_BRNO)	AS APRV
						  , ITEM.APO_CD			AS APO_CD
						  , ITEM.APO_SE			AS APO_SE
						  , ITEM.UO_BRNO		AS UO_BRNO
						  , ITEM.CTGRY_CD		AS CTGRY_CD
						  , ITEM.CLSF_CD		AS CLSF_CD
						  , ITEM.STTG_UPBR_ITEM_SE		AS STTG_UPBR_ITEM_SE

						  , TOTA.UO_SPMT_AMT 				AS UO_SPMT_AMT
						  , TOTB.UO_SPMT_AMT 				AS UO_SPMT_AMT_OTHER

						  , TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
						  , TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

						  , TOTA.UO_SPMT_VLM 	AS UO_SPMT_VLM
						  , TOTB.UO_SPMT_VLM 	AS UO_SPMT_VLM_OTHER

						  , TOTA.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM
						  , TOTB.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM_OTHER
						  , NVL(TOTA.TOT_VLM, 0) + NVL(TOTB.TOT_VLM, 0)	AS UO_SPMT_VLM_TOT
						  , NVL(TOTA.TOT_AMT, 0) + NVL(TOTB.TOT_AMT, 0)	AS UO_SPMT_AMT_TOT

						  , ROUND(
									 NVL(TOTA.UO_SPMT_AMT, 0)
									 /
									 NULLIF(NVL(TOTA.TOT_AMT, 0), 0)
								 * 100
						 , 2)	AS UO_SPMT_AMT_RT
						  , ROUND(
									 (
										 NVL(TOTA.UO_SPMT_AMT, 0) + NVL(TOTB.UO_SPMT_AMT, 0)
										 )
									 /
									 NULLIF(NVL(TOTA.TOT_AMT, 0) + NVL(TOTB.TOT_AMT, 0), 0)
								 * 100
						 , 2)	AS UO_SPMT_AMT_TOT_RT
						  , (
							 SELECT X.STBLT_YN
							 FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT X
							 WHERE X.BRNO = ITEM.BRNO
							   AND X.UO_BRNO = ITEM.UO_BRNO
							   AND X.YR = ITEM.YR
							   AND X.ITEM_CD = ITEM.ITEM_CD
							   AND X.APO_SE = '2'
							   AND X.TYPE_SE_NO = '8'
							   AND NVL(X.TMPR_STRG_YN, 'N') = 'N'
							   AND X.DEL_YN = 'N'
						 ) AS ORG_STBLT_YN

					 FROM (
							  SELECT
								  EAM.APO_SE			AS APO_SE
								   , APO.APO_CD			AS APO_CD
								   , APO.CORP_NM		AS CORP_NM
								   , APO.CRNO			AS CRNO
								   , EAM.BRNO				AS BRNO
								   , EAM.YR				AS YR
								   , EAM.UO_BRNO		AS ORGNL_UO_BRNO
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
									, EAM.UO_BRNO		AS UO_BRNO
			</when>
			<otherwise>
									, GC.UO_BRNO		AS UO_BRNO
			</otherwise>
		</choose>
		<![CDATA[
								   , GC.ITEM_CD			AS ITEM_CD
								   , 'Y'						AS ORG

		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
						, GC.CTGRY_CD			AS CTGRY_CD
						, GC.CLSF_CD			AS CLSF_CD
						, GC.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
			</when>
			<otherwise>
						, CASE GC.STTG_UPBR_ITEM_SE
							WHEN '3' THEN GC.CTGRY_CD
							ELSE UGC.CTGRY_CD
						END		AS CTGRY_CD
						, CASE GC.STTG_UPBR_ITEM_SE
							WHEN '3' THEN GC.CLSF_CD
							ELSE UGC.CLSF_CD
						END		AS CLSF_CD
						, CASE GC.STTG_UPBR_ITEM_SE
							WHEN '3' THEN GC.STTG_UPBR_ITEM_SE
							ELSE UGC.STTG_UPBR_ITEM_SE
						END		AS STTG_UPBR_ITEM_SE
			</otherwise>
		</choose>

		<![CDATA[
							  FROM TB_EV_APLY_MNG EAM

							   JOIN TB_EV_APO APO
								ON APO.BRNO = EAM.BRNO
								AND APO.DEL_YN = 'N'
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
							   JOIN TB_EV_APO_YR_GPC_CD GC
								ON GC.YR = EAM.YR
								AND GC.BRNO = EAM.UO_BRNO
								AND GC.DEL_YN = 'N'
			</when>
			<otherwise>
							   JOIN TB_EV_APO_YR_GPC_CD GC
								ON GC.YR = EAM.YR
								AND GC.BRNO = EAM.BRNO
								AND GC.DEL_YN = 'N'
			</otherwise>
		</choose>
		<![CDATA[
						   		LEFT JOIN TB_EV_APO_YR_GPC_CD UGC
								 ON UGC.YR = EAM.YR
								 AND UGC.BRNO = GC.UO_BRNO
								 AND UGC.ITEM_CD = GC.ITEM_CD
								 AND UGC.DEL_YN = 'N'

							  WHERE EAM.APO_SE = '2'
								AND EAM.YR = #{yr}
								AND EAM.BRNO = #{brno}
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
				<if test='uoBrno != null and uoBrno != ""'>
					AND GC.BRNO = #{uoBrno}
				</if>
			</when>
			<otherwise>
				<if test='uoBrno != null and uoBrno != ""'>
					AND GC.UO_BRNO = #{uoBrno}
				</if>
			</otherwise>
		</choose>

		<![CDATA[
								AND NOT EXISTS (
								  SELECT 1
								  FROM TB_COM_USER X
								  WHERE X.USER_ID IN (
									  SELECT CD.CD_VL
									  FROM TB_COM_CD_DTL CD
									  WHERE CD.CD_ID = 'SYS_EXCLD_USER_ID'
										AND CD.USE_YN = 'Y'
										AND CD.DEL_YN = 'N'
								  )
									AND X.BRNO IN (EAM.BRNO, EAM.UO_BRNO)
							  )
						  ) ITEM

						  LEFT JOIN (
						 	SELECT
								 SLS.UO_BRNO		AS UO_BRNO
								  , SLS.BRNO				AS BRNO
								  , SLS.YR					AS YR
								  , SLS.ITEM_CD			AS ITEM_CD

								  , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_SPMT_VLM
								  , NVL(SUM(SLS.UO_SPMT_AMT), 0)				AS UO_SPMT_AMT
								  , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_OTHER_SPMT_VLM
								  , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT

								  , NVL(SUM(SLS.UO_SPMT_VLM), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_VLM), 0)	AS TOT_VLM
								  , NVL(SUM(SLS.UO_SPMT_AMT), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0)	AS TOT_AMT

								  , SUM(CASE SLS.TRMT_TYPE WHEN '2' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS SORT_TRST_VLM
								  , SUM(CASE SLS.TRMT_TYPE WHEN '2' THEN SLS.UO_SPMT_AMT ELSE 0 END) 	AS SORT_TRST_AMT
								  , SUM(CASE SLS.TRMT_TYPE WHEN '1' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS TRST_VLM
								  , SUM(CASE SLS.TRMT_TYPE WHEN '1' THEN SLS.UO_SPMT_AMT ELSE 0 END) 	AS TRST_AMT
								  , SUM(CASE SLS.TRMT_TYPE WHEN '3' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS SORT_EMSPAP_VLM
								  , SUM(CASE SLS.TRMT_TYPE WHEN '3' THEN SLS.UO_SPMT_AMT ELSE 0 END)	AS SORT_EMSPAP_AMT

							 FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
							 WHERE SLS.APO_SE = '2'
							   AND SLS.TYPE_SE_NO IN ('5')
							   AND SLS.DEL_YN = 'N'
							   AND NVL(SLS.TMPR_STRG_YN,'N') = 'N'
							   AND SLS.OGNZ_STBLT_YN = 'Y'
							   AND SLS.PRDCR_OGNZ_SN IN (
								 SELECT X.PRDCR_OGNZ_SN
								 FROM TB_EV_FRMHS_APO X
								 WHERE X.APO_SE = SLS.APO_SE
								   AND X.BRNO = SLS.BRNO
								   AND X.YR = SLS.YR
								   AND X.STBLT_YN = 'Y'
								   AND NVL(X.EXCL_YN, 'N') <> 'Y'
								   AND X.UO_BRNO = SLS.UO_BRNO
								   AND X.TRMT_TYPE = SLS.TRMT_TYPE
						 	)
						 GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
					 ) TOTA
						ON TOTA.YR = ITEM.YR
						AND TOTA.UO_BRNO = ITEM.UO_BRNO
						AND TOTA.BRNO = ITEM.BRNO
						AND TOTA.ITEM_CD = ITEM.ITEM_CD
						AND ITEM.ORG = 'Y'

				  LEFT JOIN (
						 SELECT
							 SLS.UO_BRNO	AS UO_BRNO
							  , SLS.BRNO			AS BRNO
							  , SLS.YR				AS YR
							  , SLS.ITEM_CD		AS ITEM_CD
							  , NVL(SUM(SLS.UO_SPMT_AMT), 0)			AS UO_SPMT_AMT
							  , NVL(SUM(SLS.UO_SPMT_VLM), 0)			AS UO_SPMT_VLM
							  , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT
							  , NVL(SUM(SLS.UO_SPMT_VLM), 0)			AS UO_OTHER_SPMT_VLM
							  , NVL(SUM(SLS.UO_SPMT_VLM), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_VLM), 0)	AS TOT_VLM
							  , NVL(SUM(SLS.UO_SPMT_AMT), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0)	AS TOT_AMT

						 FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
						 WHERE SLS.APO_SE = '2'
						   AND SLS.TYPE_SE_NO IN ('5', '7')
						   AND NVL(SLS.TMPR_STRG_YN, 'N') = 'N'
						   AND SLS.DEL_YN = 'N'
						   AND SLS.OGNZ_STBLT_YN =
							   CASE SLS.TYPE_SE_NO
								   WHEN '5' THEN 'N'
								   WHEN '7' THEN '0'
								   ELSE NULL
								   END
						   AND SLS.PRDCR_OGNZ_SN IN (
								 SELECT X.PRDCR_OGNZ_SN
								 FROM TB_EV_FRMHS_APO X
								 WHERE X.APO_SE = SLS.APO_SE
								   AND X.BRNO = SLS.BRNO
								   AND X.YR = SLS.YR
								   AND X.STBLT_YN = 'N'
								   AND NVL(X.EXCL_YN, 'N') <> 'Y'
								   AND X.UO_BRNO = SLS.UO_BRNO
								   AND X.TRMT_TYPE = SLS.TRMT_TYPE
								 UNION ALL
								 SELECT 0
								 FROM DUAL
							 )
						 GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
					 ) TOTB
						ON TOTB.YR = ITEM.YR
						AND TOTB.UO_BRNO = ITEM.UO_BRNO
						AND TOTB.BRNO = ITEM.BRNO
						AND TOTB.ITEM_CD = ITEM.ITEM_CD
						AND ITEM.ORG = 'Y'

					  LEFT JOIN TB_ITEM_CRTR IC
						ON IC.ITEM_CD = ITEM.ITEM_CD
						AND ITEM.ORG = 'Y'
						AND IC.DEL_YN = 'N'
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
				/*
				WHERE (
					ITEM.STTG_UPBR_ITEM_SE = '3'
					OR
					(
					ITEM.STTG_UPBR_ITEM_SE IN ('1', '2')
					AND EXISTS (
							SELECT 1
							FROM TB_EV_APO_YR_GPC_CD X
							WHERE X.YR = PS.YR
							AND X.BRNO = ITEM.UO_BRNO
							AND X.ITEM_CD = ITEM.ITEM_CD
							AND X.DEL_YN = 'N'
						)
					)
				)
				 */
				WHERE ITEM.ITEM_CD IS NOT NULL
			</when>
			<otherwise>
				WHERE ITEM.ITEM_CD IS NOT NULL
			</otherwise>
		</choose>
		<![CDATA[
				 ) TOT
			WHERE TOT.UO_BRNO IS NOT NULL
			ORDER BY STTG_UPBR_ITEM_SE, ITEM_CD, UO_BRNO
		]]>
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectInvShipOgnGenalTblMngListNew	-->
	<!-- DESC : 2025 총괄표 조회                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.23  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectInvShipOgnGenalTblMngListNew" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvShipOgnGenalTblMngListNew */
			TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.BRNO
			,TOTAL.UO_BRNO
			,TOTAL.YR
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.CORP_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER

			,TOTAL.UO_SPMT_VLM
			,TOTAL.UO_SPMT_VLM_OTHER
			,TOTAL.UO_OTHER_SPMT_VLM
			,TOTAL.UO_OTHER_SPMT_VLM_OTHER

			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_VLM_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
			,(SELECT
					ACTN_MTTR
				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
				WHERE BRNO = TOTAL.BRNO
				AND YR = TOTAL.YR
				AND APO_SE = '2'
				AND TYPE_SE_NO = '8'
				AND ITEM_CD = TOTAL.ITEM_CD
				AND UO_BRNO = TOTAL.UO_BRNO
			) AS ACTN_MTTR
		FROM
				(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER

					,TOT.UO_SPMT_VLM
					,TOT.UO_SPMT_VLM_OTHER
					,TOT.UO_OTHER_SPMT_VLM
					,TOT.UO_OTHER_SPMT_VLM_OTHER

					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_VLM_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT
					/* 20240603 승인형 작년 기준인것을 올해 기준으로 변경 60 -> 50 , 60 -> 40 */
					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 50 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 40 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							, ITEM.STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							, ITEM.CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, TOTA.UO_SPMT_VLM 	AS UO_SPMT_VLM
							, TOTB.UO_SPMT_VLM 	AS UO_SPMT_VLM_OTHER

							, TOTA.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM
							, TOTB.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT
							, (NVL(TOTA.UO_SPMT_VLM,0) + NVL(TOTA.UO_OTHER_SPMT_VLM,0) + NVL(TOTB.UO_SPMT_VLM,0) + NVL(TOTB.UO_OTHER_SPMT_VLM,0)) AS UO_SPMT_VLM_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, (SELECT STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO ='8'
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND BRNO = ITEM.BRNO
								  AND UO_BRNO = ITEM.UO_BRNO
								  AND YR = ITEM.YR
								  AND ITEM_CD = ITEM.ITEM_CD
							) AS STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, STTG_UPBR_ITEM_SE
									, CTGRY_CD
									, UO_BRNO
									, BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = AYGC.ITEM_CD) AS ITEM_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = AYGC.CTGRY_CD) AS CTGRY_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = AYGC.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
								FROM TB_EV_APO_YR_GPC_CD AYGC
								WHERE 1=1
								  AND APO_SE = '2'
								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='uoBrno != null and uoBrno != ""'>
								  AND UO_BRNO = #{uoBrno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>
							) ITEM ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS UO_SPMT_VLM
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS UO_OTHER_SPMT_VLM
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTA
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND OGNZ_STBLT_YN = 'Y'
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTA.YR
													  AND BRNO = PSTA.BRNO
													  AND UO_BRNO = PSTA.UO_BRNO
													)
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND APO_SE = '2'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND YR = PSTA.YR
															  AND BRNO = PSTA.BRNO
															  AND UO_BRNO = PSTA.UO_BRNO
															  AND TRMT_TYPE = PSTA.TRMT_TYPE
														)
								<if test='uoBrno != null and uoBrno != ""'>
								  AND UO_BRNO = #{uoBrno}
								</if>
								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>
									GROUP BY  BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS UO_SPMT_VLM
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS UO_OTHER_SPMT_VLM
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTB
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5','7')
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND OGNZ_STBLT_YN = DECODE(PSTB.TYPE_SE_NO, '5' , 'N' , '7' ,'0' ,'')
								  AND (
								  		PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'N'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND APO_SE = '2'
															  AND YR = PSTB.YR
															  AND BRNO = PSTB.BRNO
															  AND UO_BRNO = PSTB.UO_BRNO
															  AND TRMT_TYPE = PSTB.TRMT_TYPE
															)
										OR
										PRDCR_OGNZ_SN = '0'
										)
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTB.YR
													  AND BRNO = PSTB.BRNO
													  AND UO_BRNO = PSTB.UO_BRNO
													)
								<if test='uoBrno != null and uoBrno != ""'>
								  AND UO_BRNO = #{uoBrno}
								</if>
								<if test='brno != null and brno != ""'>
								  AND BRNO = #{brno}
								</if>
								<if test='yr != null and yr != ""'>
								  AND YR = #{yr}
								</if>
								GROUP BY  BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)
						AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
				)TOT
		)TOTAL
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectIsoPrchsSlsRawdataList	-->
	<!-- DESC : 출자출하조직 총괄표 rawdata 목록을 조회 한다								-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.07.16  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectIsoPrchsSlsRawdataList" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		<![CDATA[
			SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectIsoPrchsSlsRawdataList */
				   TOT.YR				AS YR
				 , TOT.ITEM_CD			AS ITEM_CD
				 , TOT.ITEM_NM			AS ITEM_NM
				 , TOT.BRNO				AS BRNO
				 , TOT.CRNO				AS CRNO
				 , TOT.CORP_NM			AS CORP_NM
				 , TOT.APRV				AS APRV
				 , (SELECT FN_GET_COM_CD_VL_NM('APRV_UPBR_SE_CD', TOT.APRV) FROM DUAL) AS APRV_NM
				 , TOT.APO_CD			AS APO_CD
				 , TOT.APO_SE			AS APO_SE
				 , TOT.UO_BRNO			AS UO_BRNO
				 , (SELECT MAX(X.CORP_NM) FROM TB_EV_APO X WHERE X.BRNO = TOT.UO_BRNO)	AS UO_CORP_NM
			     , TOT.UO_APO_CD		AS UO_APO_CD
				 , TOT.CTGRY_CD		AS CTGRY_CD
			     , (SELECT FN_GET_COM_CD_VL_NM('CTGRY_CD', TOT.CTGRY_CD) FROM DUAL) AS CTGRY_NM
				 , TOT.CLSF_CD		AS CLSF_CD
			     , (SELECT FN_GET_COM_CD_VL_NM('CLSF_CD', TOT.CLSF_CD) FROM DUAL) AS CLSF_CD_NM
				 , TOT.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
			     , (SELECT FN_GET_COM_CD_VL_NM('STTG_UPBR_ITEM_SE', TOT.STTG_UPBR_ITEM_SE) FROM DUAL) AS STTG_UPBR_ITEM_SE_NM
				 , TOT.UO_SPMT_AMT						AS UO_SPMT_AMT
				 , TOT.UO_SPMT_AMT_OTHER				AS UO_SPMT_AMT_OTHER
				 , TOT.UO_OTHER_SPMT_AMT				AS UO_OTHER_SPMT_AMT
				 , TOT.UO_OTHER_SPMT_AMT_OTHER	AS UO_OTHER_SPMT_AMT_OTHER
				 , TOT.UO_SPMT_VLM						AS UO_SPMT_VLM
				 , TOT.UO_SPMT_VLM_OTHER				AS UO_SPMT_VLM_OTHER
				 , TOT.UO_OTHER_SPMT_VLM				AS UO_OTHER_SPMT_VLM
				 , TOT.UO_OTHER_SPMT_VLM_OTHER	AS UO_OTHER_SPMT_VLM_OTHER
				 , TOT.UO_SPMT_VLM_TOT					AS UO_SPMT_VLM_TOT
				 , TOT.UO_SPMT_AMT_TOT					AS UO_SPMT_AMT_TOT

				 , TOT.UO_SPMT_AMT_RT			AS UO_SPMT_AMT_RT
				 , TOT.UO_SPMT_AMT_TOT_RT		AS UO_SPMT_AMT_TOT_RT

				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'AA'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_A_A
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'AB'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_A_B
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'AC'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_A_C
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'BA'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_B_A
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'BB'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_B_B
				 , (
					SELECT
						FN_GET_ISO_SPMT_CHK_YN (
								TOT.YR
							, 'BC'
							, TOT.UO_SPMT_AMT
							, TOT.UO_SPMT_AMT_RT
							, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS CHK_B_C

				 , (
					SELECT
						FN_GET_ISO_SPMT_STBLT_YN (
								TOT.YR
								, TOT.APRV
								, TOT.STTG_UPBR_ITEM_SE
								, TOT.UO_SPMT_AMT
								, TOT.UO_SPMT_AMT_RT
								, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS STBLT_YN
				, TOT.ORG_STBLT_YN	AS ORG_STBLT_YN
				 , (
					SELECT
						FN_GET_ISO_SPMT_STBLT_NM (
								TOT.YR
								, TOT.APRV
								, TOT.STTG_UPBR_ITEM_SE
								, TOT.UO_SPMT_AMT
								, TOT.UO_SPMT_AMT_RT
								, TOT.UO_SPMT_AMT_TOT_RT
							)
					FROM DUAL
				)	AS STBLT_YN_NM
				, (
					SELECT X.ACTN_MTTR
					  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT X
					 WHERE X.BRNO = TOT.BRNO
						AND X.YR = TOT.YR
						AND X.APO_SE = '2'
						AND X.TYPE_SE_NO = '8'
						AND X.ITEM_CD = TOT.ITEM_CD
						AND X.UO_BRNO = TOT.UO_BRNO
						AND X.DEL_YN = 'N'
				) 	AS ACTN_MTTR
			FROM (
					 SELECT
						 ITEM.YR				AS YR
						  , ITEM.ITEM_CD		AS ITEM_CD
						  , IC.ITEM_NM			AS ITEM_NM
						  , ITEM.BRNO			AS BRNO
						  , ITEM.CRNO			AS CRNO
						  , ITEM.CORP_NM		AS CORP_NM
						  , (SELECT X.APRV FROM TB_EV_APO X WHERE X.BRNO = ITEM.UO_BRNO)	AS APRV
						  , ITEM.APO_CD			AS APO_CD
						  , ITEM.APO_SE			AS APO_SE
						  , ITEM.UO_BRNO		AS UO_BRNO
					      , ITEM.UO_APO_CD		AS UO_APO_CD
						  , ITEM.CTGRY_CD		AS CTGRY_CD
						  , ITEM.CLSF_CD		AS CLSF_CD
						  , ITEM.STTG_UPBR_ITEM_SE		AS STTG_UPBR_ITEM_SE

						  , TOTA.UO_SPMT_AMT 				AS UO_SPMT_AMT
						  , TOTB.UO_SPMT_AMT 				AS UO_SPMT_AMT_OTHER

						  , TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
						  , TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

						  , TOTA.UO_SPMT_VLM 	AS UO_SPMT_VLM
						  , TOTB.UO_SPMT_VLM 	AS UO_SPMT_VLM_OTHER

						  , TOTA.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM
						  , TOTB.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM_OTHER
						  , NVL(TOTA.TOT_VLM, 0) + NVL(TOTB.TOT_VLM, 0)	AS UO_SPMT_VLM_TOT
						  , NVL(TOTA.TOT_AMT, 0) + NVL(TOTB.TOT_AMT, 0)	AS UO_SPMT_AMT_TOT

						  , ROUND(
									 NVL(TOTA.UO_SPMT_AMT, 0)
									 /
									 NULLIF(NVL(TOTA.TOT_AMT, 0), 0)
								 * 100
						 , 2)	AS UO_SPMT_AMT_RT
						  , ROUND(
									 (
										 NVL(TOTA.UO_SPMT_AMT, 0) + NVL(TOTB.UO_SPMT_AMT, 0)
										 )
									 /
									 NULLIF(NVL(TOTA.TOT_AMT, 0) + NVL(TOTB.TOT_AMT, 0), 0)
								 * 100
						 , 2)	AS UO_SPMT_AMT_TOT_RT
						  , (
							 SELECT X.STBLT_YN
							 FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT X
							 WHERE X.BRNO = ITEM.BRNO
							   AND X.UO_BRNO = ITEM.UO_BRNO
							   AND X.YR = ITEM.YR
							   AND X.ITEM_CD = ITEM.ITEM_CD
							   AND X.APO_SE = '2'
							   AND X.TYPE_SE_NO = '8'
							   AND NVL(X.TMPR_STRG_YN, 'N') = 'N'
							   AND X.DEL_YN = 'N'
						 ) AS ORG_STBLT_YN

					 FROM (
							  SELECT
								  EAM.APO_SE			AS APO_SE
								   , APO.APO_CD			AS APO_CD
								   , APO.CORP_NM		AS CORP_NM
								   , APO.CRNO			AS CRNO
								   , EAM.BRNO				AS BRNO
								   , EAM.YR				AS YR
								   , EAM.UO_BRNO		AS ORGNL_UO_BRNO
							       , NVL(
										EAM.UO_CD
							        	, (
							        	 	SELECT MAX(X.APO_CD)
							        	 	  FROM TB_EV_APO X
							        	 	 WHERE X.BRNO = EAM.UO_BRNO
							        	)
							        )	AS UO_APO_CD
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
				, EAM.UO_BRNO		AS UO_BRNO
			</when>
			<otherwise>
				, GC.UO_BRNO		AS UO_BRNO
			</otherwise>
		</choose>
		<![CDATA[
								   , GC.ITEM_CD			AS ITEM_CD
								   , 'Y'						AS ORG

		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
				, GC.CTGRY_CD			AS CTGRY_CD
				, GC.CLSF_CD			AS CLSF_CD
				, GC.STTG_UPBR_ITEM_SE	AS STTG_UPBR_ITEM_SE
			</when>
			<otherwise>
				, CASE GC.STTG_UPBR_ITEM_SE
					WHEN '3' THEN GC.CTGRY_CD
					ELSE UGC.CTGRY_CD
				END		AS CTGRY_CD
				, CASE GC.STTG_UPBR_ITEM_SE
					WHEN '3' THEN GC.CLSF_CD
					ELSE UGC.CLSF_CD
				END		AS CLSF_CD
				, CASE GC.STTG_UPBR_ITEM_SE
					WHEN '3' THEN GC.STTG_UPBR_ITEM_SE
					ELSE UGC.STTG_UPBR_ITEM_SE
				END		AS STTG_UPBR_ITEM_SE
			</otherwise>
		</choose>

		<![CDATA[
							  FROM TB_EV_APLY_MNG EAM
							   JOIN TB_EV_APO APO
								ON APO.BRNO = EAM.BRNO
								AND APO.DEL_YN = 'N'
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
				JOIN TB_EV_APO_YR_GPC_CD GC
				ON GC.YR = EAM.YR
				AND GC.BRNO = EAM.UO_BRNO
				AND GC.DEL_YN = 'N'
			</when>
			<otherwise>
				JOIN TB_EV_APO_YR_GPC_CD GC
				ON GC.YR = EAM.YR
				AND GC.BRNO = EAM.BRNO
				AND GC.DEL_YN = 'N'
			</otherwise>
		</choose>
		<![CDATA[
							LEFT JOIN TB_EV_APO_YR_GPC_CD UGC
							 ON UGC.YR = EAM.YR
							 AND UGC.BRNO = GC.UO_BRNO
							 AND UGC.ITEM_CD = GC.ITEM_CD
							 AND UGC.DEL_YN = 'N'

							  WHERE EAM.APO_SE = '2'
								AND EAM.YR = #{yr}
								AND NOT EXISTS (
								  SELECT 1
								  FROM TB_COM_USER X
								  WHERE X.USER_ID IN (
										  SELECT CD.CD_VL
										  FROM TB_COM_CD_DTL CD
										  WHERE CD.CD_ID = 'SYS_EXCLD_USER_ID'
											AND CD.USE_YN = 'Y'
											AND CD.DEL_YN = 'N'
								  		)
									AND X.BRNO IN (EAM.BRNO, EAM.UO_BRNO)
							  	)
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
			</when>
			<otherwise>
							    AND EXISTS (
									SELECT 1
									  FROM TB_EV_APO_YR_GPC_CD X
									 WHERE X.YR = EAM.YR
									   AND X.BRNO = GC.UO_BRNO
									   AND X.APO_SE = '1'
									   AND X.STTG_UPBR_ITEM_SE IN ('1', '2')
									   AND X.ITEM_CD = GC.ITEM_CD
									   AND X.DEL_YN = 'N'
							    )
			</otherwise>
		</choose>
		<![CDATA[
						  ) ITEM

						  LEFT JOIN (
						 	SELECT
								 SLS.UO_BRNO		AS UO_BRNO
								  , SLS.BRNO				AS BRNO
								  , SLS.YR					AS YR
								  , SLS.ITEM_CD			AS ITEM_CD

								  , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_SPMT_VLM
								  , NVL(SUM(SLS.UO_SPMT_AMT), 0)				AS UO_SPMT_AMT
								  , NVL(SUM(SLS.UO_SPMT_VLM), 0)				AS UO_OTHER_SPMT_VLM
								  , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT

								  , NVL(SUM(SLS.UO_SPMT_VLM), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_VLM), 0)	AS TOT_VLM
								  , NVL(SUM(SLS.UO_SPMT_AMT), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0)	AS TOT_AMT

								  , SUM(CASE SLS.TRMT_TYPE WHEN '2' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS SORT_TRST_VLM
								  , SUM(CASE SLS.TRMT_TYPE WHEN '2' THEN SLS.UO_SPMT_AMT ELSE 0 END) 	AS SORT_TRST_AMT
								  , SUM(CASE SLS.TRMT_TYPE WHEN '1' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS TRST_VLM
								  , SUM(CASE SLS.TRMT_TYPE WHEN '1' THEN SLS.UO_SPMT_AMT ELSE 0 END) 	AS TRST_AMT
								  , SUM(CASE SLS.TRMT_TYPE WHEN '3' THEN SLS.UO_SPMT_VLM ELSE 0 END) 	AS SORT_EMSPAP_VLM
								  , SUM(CASE SLS.TRMT_TYPE WHEN '3' THEN SLS.UO_SPMT_AMT ELSE 0 END)	AS SORT_EMSPAP_AMT

							 FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
							 WHERE SLS.APO_SE = '2'
							   AND SLS.TYPE_SE_NO IN (5)
							   AND SLS.DEL_YN = 'N'
							   AND NVL(SLS.TMPR_STRG_YN,'N') = 'N'
							   AND SLS.OGNZ_STBLT_YN = 'Y'
							   AND SLS.PRDCR_OGNZ_SN IN (
								 SELECT X.PRDCR_OGNZ_SN
								 FROM TB_EV_FRMHS_APO X
								 WHERE X.APO_SE = SLS.APO_SE
								   AND X.BRNO = SLS.BRNO
								   AND X.YR = SLS.YR
								   AND X.STBLT_YN = 'Y'
								   AND NVL(X.EXCL_YN, 'N') <> 'Y'
								   AND X.UO_BRNO = SLS.UO_BRNO
								   AND X.TRMT_TYPE = SLS.TRMT_TYPE
						 	)
						 GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
					 ) TOTA
						ON TOTA.YR = ITEM.YR
						AND TOTA.UO_BRNO = ITEM.UO_BRNO
						AND TOTA.BRNO = ITEM.BRNO
						AND TOTA.ITEM_CD = ITEM.ITEM_CD
						AND ITEM.ORG = 'Y'

				  LEFT JOIN (
						 SELECT
							 SLS.UO_BRNO	AS UO_BRNO
							  , SLS.BRNO			AS BRNO
							  , SLS.YR				AS YR
							  , SLS.ITEM_CD		AS ITEM_CD
							  , NVL(SUM(SLS.UO_SPMT_AMT), 0)			AS UO_SPMT_AMT
							  , NVL(SUM(SLS.UO_SPMT_VLM), 0)			AS UO_SPMT_VLM
							  , NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0) 	AS UO_OTHER_SPMT_AMT
							  , NVL(SUM(SLS.UO_SPMT_VLM), 0)			AS UO_OTHER_SPMT_VLM
							  , NVL(SUM(SLS.UO_SPMT_VLM), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_VLM), 0)	AS TOT_VLM
							  , NVL(SUM(SLS.UO_SPMT_AMT), 0) + NVL(SUM(SLS.UO_OTHER_SPMT_AMT), 0)	AS TOT_AMT

						 FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT SLS
						 WHERE SLS.APO_SE = '2'
						   AND SLS.TYPE_SE_NO IN (5, 7)
						   AND NVL(SLS.TMPR_STRG_YN, 'N') = 'N'
						   AND SLS.DEL_YN = 'N'
						   AND SLS.OGNZ_STBLT_YN =
							   CASE SLS.TYPE_SE_NO
								   WHEN '5' THEN 'N'
								   WHEN '7' THEN '0'
								   ELSE NULL
								   END
						   AND SLS.PRDCR_OGNZ_SN IN (
								 SELECT X.PRDCR_OGNZ_SN
								 FROM TB_EV_FRMHS_APO X
								 WHERE X.APO_SE = SLS.APO_SE
								   AND X.BRNO = SLS.BRNO
								   AND X.YR = SLS.YR
								   AND X.STBLT_YN = 'N'
								   AND NVL(X.EXCL_YN, 'N') <> 'Y'
								   AND X.UO_BRNO = SLS.UO_BRNO
								   AND X.TRMT_TYPE = SLS.TRMT_TYPE
								 UNION ALL
								 SELECT 0
								 FROM DUAL
							 )
						 GROUP BY  SLS.UO_BRNO, SLS.BRNO, SLS.YR, SLS.ITEM_CD
					 ) TOTB
						ON TOTB.YR = ITEM.YR
						AND TOTB.UO_BRNO = ITEM.UO_BRNO
						AND TOTB.BRNO = ITEM.BRNO
						AND TOTB.ITEM_CD = ITEM.ITEM_CD
						AND ITEM.ORG = 'Y'

					  LEFT JOIN TB_ITEM_CRTR IC
						ON IC.ITEM_CD = ITEM.ITEM_CD
						AND ITEM.ORG = 'Y'
						AND IC.DEL_YN = 'N'
		]]>
		<choose>
			<when test='oldDataYn != null and oldDataYn.equals("Y")'>
				/*
				WHERE (
				ITEM.STTG_UPBR_ITEM_SE = '3'
				OR
				(
				ITEM.STTG_UPBR_ITEM_SE IN ('1', '2')
				AND EXISTS (
				SELECT 1
				FROM TB_EV_APO_YR_GPC_CD X
				WHERE X.YR = PS.YR
				AND X.BRNO = ITEM.UO_BRNO
				AND X.ITEM_CD = ITEM.ITEM_CD
				AND X.DEL_YN = 'N'
				)
				)
				)
				*/
				WHERE ITEM.ITEM_CD IS NOT NULL
				 AND EXISTS (
						SELECT 1
						  FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT X
						 WHERE X.YR = ITEM.YR
						   AND X.BRNO = ITEM.BRNO
						   AND X.UO_BRNO = ITEM.UO_BRNO
						   AND X.ITEM_CD = ITEM.ITEM_CD
				  		   AND X.APO_SE = '2'
						   AND X.TYPE_SE_NO = 8
						   AND X.DEL_YN = 'N'
					)
			</when>
			<otherwise>
				WHERE ITEM.ITEM_CD IS NOT NULL
			</otherwise>
		</choose>
		<![CDATA[
				 ) TOT
			WHERE TOT.UO_BRNO IS NOT NULL
			ORDER BY UO_BRNO, BRNO, ITEM_CD, STBLT_YN
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectRawDataList2025	-->
	<!-- DESC : 출자출하조직 총괄표 로우데이터 2025년                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.02.17  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectRawDataList2025" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectInvShipOgnGenalTblMngListNew */
			TOTAL.ITEM_CD
			,TOTAL.ITEM_NM
			,TOTAL.STTG_UPBR_ITEM_SE
			,TOTAL.STTG_UPBR_ITEM_NM
			,TOTAL.CTGRY_CD
			,TOTAL.CTGRY_NM
			,TOTAL.BRNO
			,TOTAL.UO_BRNO
			,TOTAL.YR
			,TOTAL.APRV
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOTAL.APRV) AS APRV_NM
			,TOTAL.CORP_NM
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = TOTAL.UO_BRNO) AS UO_CORP_NM
			,TOTAL.UO_SPMT_AMT
			,TOTAL.UO_SPMT_AMT_OTHER
			,TOTAL.UO_OTHER_SPMT_AMT
			,TOTAL.UO_OTHER_SPMT_AMT_OTHER

			,TOTAL.UO_SPMT_VLM
			,TOTAL.UO_SPMT_VLM_OTHER
			,TOTAL.UO_OTHER_SPMT_VLM
			,TOTAL.UO_OTHER_SPMT_VLM_OTHER

			,TOTAL.UO_SPMT_AMT_TOT
			,TOTAL.UO_SPMT_VLM_TOT
			,TOTAL.UO_SPMT_AMT_RT
			,TOTAL.UO_SPMT_AMT_TOT_RT

			,TOTAL.CHK_A_A
			,TOTAL.CHK_A_B
			,TOTAL.CHK_A_C

			,TOTAL.CHK_B_A
			,TOTAL.CHK_B_B
			,TOTAL.CHK_B_C
			, (CASE WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '1' THEN
																(CASE WHEN  TOTAL.CHK_A_A = 'Y' AND TOTAL.CHK_A_B = 'Y' AND TOTAL.CHK_A_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					WHEN TOTAL.APRV = '1' AND STTG_UPBR_ITEM_SE = '2' THEN 'Y'
					WHEN  TOTAL.APRV = '2' THEN
																(CASE WHEN  TOTAL.CHK_B_A = 'Y' AND TOTAL.CHK_B_C = 'Y'
																			THEN 'Y'
																			ELSE 'N' END)
					ELSE 'N' END
			) AS STBLT_YN
			,TOTAL.ORG_STBLT_YN
			,(SELECT
					ACTN_MTTR
				FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
				WHERE BRNO = TOTAL.BRNO
				AND YR = TOTAL.YR
				AND APO_SE = '2'
				AND TYPE_SE_NO = '8'
				AND ITEM_CD = TOTAL.ITEM_CD
				AND UO_BRNO = TOTAL.UO_BRNO
			) AS ACTN_MTTR
		FROM
			(SELECT
					TOT.ITEM_CD
					,TOT.ITEM_NM
					,TOT.STTG_UPBR_ITEM_SE
					,TOT.STTG_UPBR_ITEM_NM
					,TOT.CTGRY_CD
					,TOT.CTGRY_NM
					,TOT.BRNO
					,TOT.UO_BRNO
					,TOT.YR
					,TOT.APRV
					,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'APRV_UPBR_SE_CD' AND CD_VL = TOT.APRV) AS APRV_NM
					,TOT.CORP_NM
					,TOT.UO_SPMT_AMT
					,TOT.UO_SPMT_AMT_OTHER
					,TOT.UO_OTHER_SPMT_AMT
					,TOT.UO_OTHER_SPMT_AMT_OTHER

					,TOT.UO_SPMT_VLM
					,TOT.UO_SPMT_VLM_OTHER
					,TOT.UO_OTHER_SPMT_VLM
					,TOT.UO_OTHER_SPMT_VLM_OTHER

					,TOT.UO_SPMT_AMT_TOT
					,TOT.UO_SPMT_VLM_TOT
					,TOT.UO_SPMT_AMT_RT
					,TOT.UO_SPMT_AMT_TOT_RT
					/* 20240603 승인형 작년 기준인것을 올해 기준으로 변경 60 -> 50 , 60 -> 40 */
					,(CASE WHEN TOT.UO_SPMT_AMT >= 500000 THEN 'Y' ELSE 'N' END) AS CHK_A_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 50 THEN 'Y' ELSE 'N' END) AS CHK_A_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >= 40 THEN 'Y' ELSE 'N' END) AS CHK_A_C

					,(CASE WHEN TOT.UO_SPMT_AMT >= 300000 THEN 'Y' ELSE 'N' END) AS CHK_B_A
					,(CASE WHEN TOT.UO_SPMT_AMT_RT >= 100 THEN 'Y' ELSE 'N' END) AS CHK_B_B
					,(CASE WHEN TOT.UO_SPMT_AMT_TOT_RT >=  20 THEN 'Y' ELSE 'N' END) AS CHK_B_C
					,TOT.STBLT_YN AS ORG_STBLT_YN
				FROM
					(SELECT
							ITEM.ITEM_CD
							, ITEM.ITEM_NM
							, ITEM.STTG_UPBR_ITEM_SE
							, ITEM.STTG_UPBR_ITEM_NM
							, ITEM.CTGRY_CD
							, ITEM.CTGRY_NM
							, ITEM.BRNO
							, ITEM.UO_BRNO
							, ITEM.YR
							, (SELECT APRV FROM TB_EV_APO WHERE BRNO = ITEM.UO_BRNO) AS APRV
							, (SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = ITEM.BRNO) AS CORP_NM

							, TOTA.UO_SPMT_AMT 	AS UO_SPMT_AMT
							, TOTB.UO_SPMT_AMT 	AS UO_SPMT_AMT_OTHER

							, TOTA.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT
							, TOTB.UO_OTHER_SPMT_AMT 	AS UO_OTHER_SPMT_AMT_OTHER

							, TOTA.UO_SPMT_VLM 	AS UO_SPMT_VLM
							, TOTB.UO_SPMT_VLM 	AS UO_SPMT_VLM_OTHER

							, TOTA.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM
							, TOTB.UO_OTHER_SPMT_VLM 	AS UO_OTHER_SPMT_VLM_OTHER

							, (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0) + NVL(TOTB.UO_OTHER_SPMT_AMT,0)) AS UO_SPMT_AMT_TOT
							, (NVL(TOTA.UO_SPMT_VLM,0) + NVL(TOTA.UO_OTHER_SPMT_VLM,0) + NVL(TOTB.UO_SPMT_VLM,0) + NVL(TOTB.UO_OTHER_SPMT_VLM,0)) AS UO_SPMT_VLM_TOT

							, ROUND(NVL( NVL(TOTA.UO_SPMT_AMT,0) / NULLIF( NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTA.UO_OTHER_SPMT_AMT,0) , 0 ) , 0 ) * 100 , 2 ) AS UO_SPMT_AMT_RT
							, ROUND(
									NVL( (NVL(TOTA.UO_SPMT_AMT,0) + NVL(TOTB.UO_SPMT_AMT,0))
											/
											NULLIF(
													(NVL(TOTA.UO_SPMT_AMT,0)
															+ NVL(TOTA.UO_OTHER_SPMT_AMT,0)
															+ NVL(TOTB.UO_SPMT_AMT,0)
															+ NVL(TOTB.UO_OTHER_SPMT_AMT,0))
													, 0 )
										, 0 ) * 100
									, 2
							) AS UO_SPMT_AMT_TOT_RT
							, (SELECT STBLT_YN
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO ='8'
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND BRNO = ITEM.BRNO
								  AND UO_BRNO = ITEM.UO_BRNO
								  AND YR = ITEM.YR
								  AND ITEM_CD = ITEM.ITEM_CD
							) AS STBLT_YN
						FROM
							(SELECT
									ITEM_CD
									, YR
									, STTG_UPBR_ITEM_SE
									, CTGRY_CD
									, UO_BRNO
									, BRNO
									,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = AYGC.ITEM_CD) AS ITEM_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CTGRY_CD' AND CD_VL = AYGC.CTGRY_CD) AS CTGRY_NM
									,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = AYGC.STTG_UPBR_ITEM_SE) AS STTG_UPBR_ITEM_NM
								FROM TB_EV_APO_YR_GPC_CD AYGC
								WHERE 1=1
								  AND APO_SE = '2'
								  AND BRNO NOT IN (SELECT BRNO
													FROM TB_COM_USER
													WHERE USER_ID IN ('at21','at22','at23','at24','at25','at26','at27','at61','beop11','beop12')
													)
								  AND STTG_UPBR_ITEM_SE IN ('1','2')
								  AND YR = #{yr}
								  AND ITEM_CD = (SELECT ITEM_CD
										  					FROM TB_EV_APO_YR_GPC_CD
										  					WHERE 1=1
										  					  AND APO_SE = '1'
										  					  AND STTG_UPBR_ITEM_SE IN ('1','2')
										  					  AND YR = AYGC.YR
										  					  AND BRNO = AYGC.UO_BRNO
										  					  AND ITEM_CD = AYGC.ITEM_CD)
							) ITEM ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS UO_SPMT_VLM
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS UO_OTHER_SPMT_VLM
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTA
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5')
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND OGNZ_STBLT_YN = 'Y'
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTA.YR
													  AND BRNO = PSTA.BRNO
													  AND UO_BRNO = PSTA.UO_BRNO
													)
								  AND PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'Y'
															  AND APO_SE = '2'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND YR = PSTA.YR
															  AND BRNO = PSTA.BRNO
															  AND UO_BRNO = PSTA.UO_BRNO
															  AND TRMT_TYPE = PSTA.TRMT_TYPE
														)
								  AND YR = #{yr}
								GROUP BY  UO_BRNO, BRNO , ITEM_CD
							) TOTA ,
							(SELECT
									BRNO
									, UO_BRNO
									, ITEM_CD
									, SUM( NVL( UO_SPMT_VLM , 0 ) ) AS UO_SPMT_VLM
									, SUM( NVL( UO_SPMT_AMT , 0 ) ) AS UO_SPMT_AMT
									, SUM( NVL( UO_OTHER_SPMT_VLM , 0 ) ) AS UO_OTHER_SPMT_VLM
									, SUM( NVL( UO_OTHER_SPMT_AMT , 0 ) ) AS UO_OTHER_SPMT_AMT
								FROM TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT PSTB
								WHERE 1=1
								  AND DEL_YN = 'N'
								  AND APO_SE = '2'
								  AND TYPE_SE_NO IN ('5','7')
								  AND NVL(TMPR_STRG_YN,'N') = 'N'
								  AND OGNZ_STBLT_YN = DECODE(PSTB.TYPE_SE_NO, '5' , 'N' , '7' ,'0' ,'')
								  AND (
								  		PRDCR_OGNZ_SN IN (SELECT PRDCR_OGNZ_SN
															FROM TB_EV_FRMHS_APO
															WHERE 1=1
															  AND STBLT_YN = 'N'
															  AND NVL(EXCL_YN,'N') != 'Y'
															  AND APO_SE = '2'
															  AND YR = PSTB.YR
															  AND BRNO = PSTB.BRNO
															  AND UO_BRNO = PSTB.UO_BRNO
															  AND TRMT_TYPE = PSTB.TRMT_TYPE
															)
										OR
										PRDCR_OGNZ_SN = '0'
										)
								  AND ITEM_CD IN (SELECT ITEM_CD
													FROM TB_EV_APO_YR_GPC_CD
													WHERE 1=1
													  AND APO_SE = '2'
													  AND YR = PSTB.YR
													  AND BRNO = PSTB.BRNO
													  AND UO_BRNO = PSTB.UO_BRNO
													)
								  AND YR = #{yr}
								GROUP BY  UO_BRNO, BRNO , ITEM_CD
							) TOTB
						WHERE 1=1
						AND ITEM.BRNO = TOTA.BRNO(+)
						AND ITEM.UO_BRNO = TOTA.UO_BRNO(+)
						AND ITEM.ITEM_CD = TOTA.ITEM_CD(+)

						AND ITEM.BRNO = TOTB.BRNO(+)
						AND ITEM.UO_BRNO = TOTB.UO_BRNO(+)
						AND ITEM.ITEM_CD = TOTB.ITEM_CD(+)
				)TOT
			)TOTAL
		ORDER BY UO_BRNO , BRNO , ITEM_CD , STBLT_YN
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.isom.mapper.InvShipOgnSpeczItmPurSalMngMapper.selectIsoClsfTot	-->
	<!-- DESC : 부류별 합계                                            					-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.12.26  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectIsoClsfTot" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO" resultType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		SELECT	/* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.selectIsoClsfTot */
			BRNO
			, (CASE WHEN CLSF_CD IN ('2', '3', '4') THEN '원예농산물'
				ELSE '기타품목'
				END
			) AS CLSF_SE_NM
			, (CASE WHEN CLSF_CD IN ('2', '3', '4') THEN '1'
				ELSE '2'
				END
			) AS CLSF_SE_CD
			, CLSF_CD
			, (SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'CLSF_CD' AND CD_VL = A.CLSF_CD) AS CLSF_NM
			, SUM( NVL( DECODE(YR,#{yr}-1,TOT_TRMT_PRFMNC_VLM,'') , 0 ) ) AS PRV_TOT_VLM
			, SUM( NVL( DECODE(YR,#{yr}-1,TOT_TRMT_PRFMNC_AMT,'') , 0 ) ) AS PRV_TOT_AMT

			, SUM( NVL( DECODE(YR,#{yr},TOT_TRMT_PRFMNC_VLM,'') , 0 ) ) AS TOT_VLM
			, SUM( NVL( DECODE(YR,#{yr},TOT_TRMT_PRFMNC_AMT,'') , 0 ) ) AS TOT_AMT
		FROM (
				SELECT
					YR
					, BRNO
					, TOT_TRMT_PRFMNC_VLM
					, TOT_TRMT_PRFMNC_AMT
					,(SELECT CLSF_CD
						FROM TB_EV_APO_YR_GPC_CD
						WHERE 1=1
						  AND APO_SE = '2'
						  AND YR = APS.YR
						  AND BRNO = APS.BRNO
						  AND ITEM_CD = APS.ITEM_CD
						  AND STTG_UPBR_ITEM_SE = APS.STTG_UPBR_ITEM_SE
					) AS CLSF_CD
				FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
				WHERE 1=1
				  AND DEL_YN = 'N'
				  AND NVL(TMPR_STRG_YN,'N') = 'N'
				  AND ITEM_CD = (SELECT ITEM_CD
				  					FROM TB_EV_APO_YR_GPC_CD
				  					WHERE 1=1
				  					  AND APO_SE = '2'
				  					  AND YR = APS.YR
				  					  AND BRNO = APS.BRNO
				  					  AND ITEM_CD = APS.ITEM_CD
				  					  AND STTG_UPBR_ITEM_SE = APS.STTG_UPBR_ITEM_SE)
				  AND APO_SE = '2'
				  AND PRCHS_SLS_SE = '2'
				  AND BRNO = #{brno}
				) A
		GROUP BY BRNO , CLSF_CD

		UNION ALL

		SELECT
			BRNO
			, DECODE(CLSF_SE_CD, '1' , '원예농산물' , '기타품목') AS CLSF_SE_NM
			, CLSF_SE_CD
			, '' AS CLSF_CD
			, '소계' AS CLSF_NM
			, SUM( NVL( DECODE(YR,#{yr}-1,TOT_TRMT_PRFMNC_VLM,'') , 0 ) ) AS PRV_TOT_VLM
			, SUM( NVL( DECODE(YR,#{yr}-1,TOT_TRMT_PRFMNC_AMT,'') , 0 ) ) AS PRV_TOT_AMT

			, SUM( NVL( DECODE(YR,#{yr},TOT_TRMT_PRFMNC_VLM,'') , 0 ) ) AS TOT_VLM
			, SUM( NVL( DECODE(YR,#{yr},TOT_TRMT_PRFMNC_AMT,'') , 0 ) ) AS TOT_AMT
		FROM (
				SELECT
					YR
					, BRNO
					, TOT_TRMT_PRFMNC_VLM
					, TOT_TRMT_PRFMNC_AMT
					,(SELECT CASE WHEN CLSF_CD IN ('2', '3', '4') THEN '1'
									ELSE '2'
									END
						FROM TB_EV_APO_YR_GPC_CD
						WHERE 1=1
						  AND APO_SE = '2'
						  AND YR = APS.YR
						  AND BRNO = APS.BRNO
						  AND ITEM_CD = APS.ITEM_CD
						  AND STTG_UPBR_ITEM_SE = APS.STTG_UPBR_ITEM_SE
					) AS CLSF_SE_CD
				FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
				WHERE 1=1
				  AND DEL_YN = 'N'
				  AND NVL(TMPR_STRG_YN,'N') = 'N'
				  AND ITEM_CD = (SELECT ITEM_CD
				  					FROM TB_EV_APO_YR_GPC_CD
				  					WHERE 1=1
				  					  AND APO_SE = '2'
				  					  AND YR = APS.YR
				  					  AND BRNO = APS.BRNO
				  					  AND ITEM_CD = APS.ITEM_CD
				  					  AND STTG_UPBR_ITEM_SE = APS.STTG_UPBR_ITEM_SE)
				  AND APO_SE = '2'
				  AND PRCHS_SLS_SE = '2'
				  AND BRNO = #{brno}
				) A
		GROUP BY  BRNO , CLSF_SE_CD

		ORDER BY CLSF_SE_CD,CLSF_CD
	</select>

	<!-- 조치사항 업데이트 -->
	<update id="updateItemIsoActnMttr" parameterType="com.at.apcss.pd.isom.vo.InvShipOgnGenalTblMngVO">
		UPDATE /* com.at.apcss.pd.isom.mapper.InvShipOgnGenalTblMngMapper.updateItemIsoActnMttr */
			TB_EV_UO_ISO_PRCHS_PRCHS_SLS_TOT
		SET
			ACTN_MTTR	= #{actnMttr}
		WHERE 1=1
		  AND APO_SE	= '2'
		  AND TYPE_SE_NO = '8'
		  AND ITEM_CD	= #{itemCd}
		  AND BRNO		= #{brno}
		  AND UO_BRNO	= #{uoBrno}
		  AND YR		= #{yr}
	</update>
</mapper>