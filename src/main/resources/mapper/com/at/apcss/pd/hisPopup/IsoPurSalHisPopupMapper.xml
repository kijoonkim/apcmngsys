<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : IsoPurSalHisPopupMapper.xml                                    		-->
<!-- DESC : 출자출하조직 총 매입 매출 과거조회 mapper                                             		-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2025.01.10  	ljw        		Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.pd.hisPopup.mapper.IsoPurSalHisPopupMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.hisPopup.mapper.IsoPurSalHisPopupMapper.selectHisIsoPurSal2024	-->
	<!-- DESC : 출자출하조직 총 매입 매출 조회 2024년                                     		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.01.10  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectHisIsoPurSal2024" parameterType="com.at.apcss.pd.hisPopup.vo.IsoPurSalVO" resultType="com.at.apcss.pd.hisPopup.vo.IsoPurSalVO">
		SELECT	/* com.at.apcss.pd.hisPopup.mapper.IsoPurSalHisPopupMapper.selectHisIsoPurSal2024 */
			YR
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = APS.BRNO) AS CORP_NM
			,UO_BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = APS.UO_BRNO) AS UO_CORP_NM
			,ITEM_CD
			,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = APS.ITEM_CD) AS ITEM_NM
			,PRCHS_SLS_SE
			,DECODE(APS.STTG_UPBR_ITEM_SE
					, '3' , APS.STTG_UPBR_ITEM_SE
					, (SELECT STTG_UPBR_ITEM_SE
						FROM TB_EV_APO_YR_GPC_CD
						WHERE 1=1
						  AND APO_SE = '1'
						  AND YR = APS.YR
						  AND BRNO = APS.UO_BRNO
						  AND ITEM_CD = APS.ITEM_CD)
			) AS STTG_UPBR_ITEM_SE
			,(SELECT CD_VL_NM
				FROM TB_COM_CD_DTL
				WHERE 1=1
				  AND CD_ID = 'STTG_UPBR_ITEM_SE'
				  AND CD_VL = DECODE(APS.STTG_UPBR_ITEM_SE
				  						, '3' , APS.STTG_UPBR_ITEM_SE
				  						, (SELECT STTG_UPBR_ITEM_SE
				  							FROM TB_EV_APO_YR_GPC_CD
				  							WHERE 1=1
				  							  AND APO_SE = '1'
				  							  AND YR = APS.YR
				  							  AND BRNO = APS.UO_BRNO
				  							  AND ITEM_CD = APS.ITEM_CD)
				  						)
			) AS STTG_UPBR_ITEM_NM
			,DECODE(APS.STTG_UPBR_ITEM_SE
					, '3' , APS.CTGRY_CD
					, (SELECT CTGRY_CD
						FROM TB_EV_APO_YR_GPC_CD
						WHERE 1=1
						  AND APO_SE = '1'
						  AND YR = APS.YR
						  AND BRNO = APS.UO_BRNO
						  AND ITEM_CD = APS.ITEM_CD)
			) AS CTGRY_CD
			,(SELECT CD_VL_NM
				FROM TB_COM_CD_DTL
				WHERE 1=1
				  AND CD_ID = 'CTGRY_CD'
				  AND CD_VL = DECODE(APS.STTG_UPBR_ITEM_SE
				  						, '3' , APS.CTGRY_CD
				  						, (SELECT CTGRY_CD
				  							FROM TB_EV_APO_YR_GPC_CD
				  							WHERE 1=1
				  							  AND APO_SE = '1'
				  							  AND YR = APS.YR
				  							  AND BRNO = APS.UO_BRNO
				  							  AND ITEM_CD = APS.ITEM_CD)
				  					)
			) AS CTGRY_NM

			/*매입*/
			, NVL(APS.PRCHS_TRST_VLM, 0) AS PRCHS_TRST_VLM
			, NVL(APS.PRCHS_TRST_AMT, 0) AS PRCHS_TRST_AMT
			, NVL(APS.PRCHS_EMSPAP_VLM, 0) AS PRCHS_EMSPAP_VLM
			, NVL(APS.PRCHS_EMSPAP_AMT, 0) AS PRCHS_EMSPAP_AMT

			, (NVL(APS.PRCHS_TRST_VLM, 0) + NVL(APS.PRCHS_EMSPAP_VLM, 0) + NVL(APS.ETC_VLM, 0)) AS PRCHS_TOT_VLM
			, (NVL(APS.PRCHS_TRST_AMT, 0) + NVL(APS.PRCHS_EMSPAP_AMT, 0) + NVL(APS.ETC_AMT, 0)) AS PRCHS_TOT_AMT

			, NVL(APS.ETC_VLM, 0) AS ETC_VLM
			, NVL(APS.ETC_AMT, 0) AS ETC_AMT

			/*매출*/
			, NVL(APS.SLS_CPRTN_SORT_TRST_VLM, 0) AS SLS_CPRTN_SORT_TRST_VLM
			, NVL(APS.SLS_CPRTN_SORT_TRST_AMT, 0) AS SLS_CPRTN_SORT_TRST_AMT
			, NVL(APS.SLS_CPRTN_TRST_VLM, 0) AS SLS_CPRTN_TRST_VLM
			, NVL(APS.SLS_CPRTN_TRST_AMT, 0) AS SLS_CPRTN_TRST_AMT
			, NVL(APS.SLS_CPRTN_SORT_EMSPAP_VLM, 0) AS SLS_CPRTN_SORT_EMSPAP_VLM
			, NVL(APS.SLS_CPRTN_SORT_EMSPAP_AMT, 0) AS SLS_CPRTN_SORT_EMSPAP_AMT
			/*전속출하실적 합계*/
			, (NVL(APS.SLS_CPRTN_TRST_VLM, 0) + NVL(APS.SLS_CPRTN_SORT_TRST_VLM, 0) + NVL(APS.SLS_CPRTN_SORT_EMSPAP_VLM, 0)) AS SLS_CPRTN_TOT_VLM
			, (NVL(APS.SLS_CPRTN_TRST_AMT, 0) + NVL(APS.SLS_CPRTN_SORT_TRST_AMT, 0) + NVL(APS.SLS_CPRTN_SORT_EMSPAP_AMT, 0)) AS SLS_CPRTN_TOT_AMT
			/* 단순기표 */
			, NVL(APS.SMPL_INPT_VLM, 0) AS SMPL_INPT_VLM
			, NVL(APS.SMPL_INPT_AMT, 0) AS SMPL_INPT_AMT
			/* 총 취급실적 */
			, NVL(APS.TOT_SPMT_PRFMNC_VLM, 0) AS TOT_SPMT_PRFMNC_VLM
			, NVL(APS.TOT_SPMT_PRFMNC_AMT, 0) AS TOT_SPMT_PRFMNC_AMT

			, NVL(APS.SLS_SMPL_TRST_VLM, 0) AS SLS_SMPL_TRST_VLM
			, NVL(APS.SLS_SMPL_TRST_AMT, 0) AS SLS_SMPL_TRST_AMT
			, NVL(APS.SLS_SMPL_EMSPAP_VLM, 0) AS SLS_SMPL_EMSPAP_VLM
			, NVL(APS.SLS_SMPL_EMSPAP_AMT, 0) AS SLS_SMPL_EMSPAP_AMT

			, NVL(APS.SLS_EMSPAP_VLM, 0) AS SLS_EMSPAP_VLM
			, NVL(APS.SLS_EMSPAP_AMT, 0) AS SLS_EMSPAP_AMT
			, NVL(APS.SLS_TRST_VLM, 0) AS SLS_TRST_VLM
			, NVL(APS.SLS_TRST_AMT, 0) AS SLS_TRST_AMT

			--, APS.SLS_TOT_VLM
			--, APS.SLS_TOT_AMT

			/*공제*/
			, NVL(APS.DDC_EXPRT_VLM, 0) AS DDC_EXPRT_VLM
			, NVL(APS.DDC_EXPRT_AMT, 0) AS DDC_EXPRT_AMT
			, NVL(APS.DDC_VLM, 0) AS DDC_VLM
			, NVL(APS.DDC_AMT, 0) AS DDC_AMT
			, NVL(APS.DDC_ARMY_DLVGDS_VLM, 0) AS DDC_ARMY_DLVGDS_VLM
			, NVL(APS.DDC_ARMY_DLVGDS_AMT, 0) AS DDC_ARMY_DLVGDS_AMT
			, NVL(APS.DDC_MLSR_VLM, 0) AS DDC_MLSR_VLM
			, NVL(APS.DDC_MLSR_AMT, 0) AS DDC_MLSR_AMT
			/* 공제 합계 */
			, (NVL(APS.DDC_EXPRT_VLM, 0) + NVL(APS.DDC_VLM, 0) + NVL(APS.DDC_ARMY_DLVGDS_VLM, 0) + NVL(APS.DDC_MLSR_VLM, 0)) AS DDC_TOT_VLM
			, (NVL(APS.DDC_EXPRT_AMT, 0) + NVL(APS.DDC_AMT, 0) + NVL(APS.DDC_ARMY_DLVGDS_AMT, 0) + NVL(APS.DDC_MLSR_AMT, 0)) AS DDC_TOT_AMT

			, NVL(APS.SPMT_PRFMNC_VLM, 0) AS SPMT_PRFMNC_VLM
			, NVL(APS.SPMT_PRFMNC_AMT, 0) AS SPMT_PRFMNC_AMT
			/* 조정 취급실적 */
			, NVL(APS.AJMT_VLM, 0) AS AJMT_VLM
			, NVL(APS.AJMT_AMT, 0) AS AJMT_AMT

			/* 총 취급 실적 */
			, NVL(APS.TOT_TRMT_PRFMNC_VLM, 0) AS TOT_TRMT_PRFMNC_VLM
			, NVL(APS.TOT_TRMT_PRFMNC_AMT, 0) AS TOT_TRMT_PRFMNC_AMT

			, ROUND(NVL( APS.SPMT_PRFMNC_AMT  / NULLIF( APS.AJMT_AMT  , 0 ) , 0 ) * 100 , 2 ) AS SPMT_RT_AMT

		FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
		WHERE 1=1
		  AND APO_SE = '2'
		  AND YR = #{yr}
		  AND BRNO = #{brno}
		  AND (
		  			APS.STTG_UPBR_ITEM_SE = '3'
		  			OR
		  			(APS.STTG_UPBR_ITEM_SE IN ('1','2') AND ITEM_CD = (SELECT ITEM_CD FROM TB_EV_APO_YR_GPC_CD WHERE YR = APS.YR AND BRNO = APS.UO_BRNO AND ITEM_CD = APS.ITEM_CD) )
		  		)
		ORDER BY PRCHS_SLS_SE , DECODE(APS.STTG_UPBR_ITEM_SE, '3' , APS.STTG_UPBR_ITEM_SE , (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE APO_SE = '1' AND YR = APS.YR AND BRNO = APS.UO_BRNO AND ITEM_CD = APS.ITEM_CD) )
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.pd.hisPopup.mapper.IsoPurSalHisPopupMapper.selectHisIsoPurSal2025	-->
	<!-- DESC : 출자출하조직 총 매입 매출 조회 2024년                                     		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.01.10  	ljw        		Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectHisIsoPurSal2025" parameterType="com.at.apcss.pd.hisPopup.vo.IsoPurSalVO" resultType="com.at.apcss.pd.hisPopup.vo.IsoPurSalVO">
		SELECT /* com.at.apcss.pd.hisPopup.mapper.IsoPurSalHisPopupMapper.selectHisIsoPurSal2025 */
			YR
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = APS.BRNO) AS CORP_NM
			,UO_BRNO
			,(SELECT CORP_NM FROM TB_EV_APO WHERE BRNO = APS.UO_BRNO) AS UO_CORP_NM
			,ITEM_CD
			,(SELECT ITEM_NM FROM TB_ITEM_CRTR WHERE ITEM_CD = APS.ITEM_CD) AS ITEM_NM
			,PRCHS_SLS_SE
			,DECODE(APS.STTG_UPBR_ITEM_SE, '3' , STTG_UPBR_ITEM_SE , (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE APO_SE = '2' AND YR = APS.YR AND BRNO = APS.BRNO AND UO_BRNO = APS.UO_BRNO AND ITEM_CD = APS.ITEM_CD) ) AS STTG_UPBR_ITEM_SE
			,(SELECT CD_VL_NM FROM TB_COM_CD_DTL WHERE CD_ID = 'STTG_UPBR_ITEM_SE' AND CD_VL = DECODE(APS.STTG_UPBR_ITEM_SE, '3' , STTG_UPBR_ITEM_SE , (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE APO_SE = '2' AND YR = APS.YR AND BRNO = APS.BRNO AND UO_BRNO = APS.UO_BRNO AND ITEM_CD = APS.ITEM_CD) )) AS STTG_UPBR_ITEM_NM
			,(SELECT CTGRY_CD
				FROM TB_EV_APO_YR_GPC_CD
				WHERE 1=1
				  AND YR = APS.YR
				  AND APO_SE = '2'
				  AND BRNO = APS.BRNO
				  AND (
						STTG_UPBR_ITEM_SE = '3'
						OR
						(STTG_UPBR_ITEM_SE != '3' AND UO_BRNO = APS.UO_BRNO)
						)
				  AND ITEM_CD = APS.ITEM_CD
			) AS CTGRY_CD
			,(SELECT CD_VL_NM
				FROM TB_COM_CD_DTL
				WHERE 1=1
				  AND CD_ID = 'CTGRY_CD'
				  AND CD_VL = (SELECT CTGRY_CD
								FROM TB_EV_APO_YR_GPC_CD
								WHERE YR = APS.YR
								  AND APO_SE = '2'
								  AND BRNO = APS.BRNO
								  AND (
										STTG_UPBR_ITEM_SE = '3'
										OR
										(STTG_UPBR_ITEM_SE != '3' AND UO_BRNO = APS.UO_BRNO)
									)
								  AND ITEM_CD = APS.ITEM_CD)
			) AS CTGRY_NM

			,(SELECT CLSF_CD
				FROM TB_EV_APO_YR_GPC_CD
				WHERE 1=1
				  AND YR = APS.YR
				  AND APO_SE = '2'
				  AND BRNO = APS.BRNO
				  AND (
						STTG_UPBR_ITEM_SE = '3'
						OR
						(STTG_UPBR_ITEM_SE != '3' AND UO_BRNO = APS.UO_BRNO)
						)
				  AND ITEM_CD = APS.ITEM_CD
			) AS CLSF_CD
			,(SELECT CD_VL_NM
				FROM TB_COM_CD_DTL
				WHERE 1=1
				  AND CD_ID = 'CLSF_CD'
				  AND CD_VL = (SELECT CLSF_CD
								FROM TB_EV_APO_YR_GPC_CD
								WHERE YR = APS.YR
								  AND APO_SE = '2'
								  AND BRNO = APS.BRNO
								  AND (
										STTG_UPBR_ITEM_SE = '3'
										OR
										(STTG_UPBR_ITEM_SE != '3' AND UO_BRNO = APS.UO_BRNO)
									)
								  AND ITEM_CD = APS.ITEM_CD)
			) AS CLSF_NM

			/*매입*/
			/*수탁*/
			, NVL(APS.PRCHS_SORT_TRST_VLM, 0) AS PRCHS_SORT_TRST_VLM
			, NVL(APS.PRCHS_SORT_TRST_AMT, 0) AS PRCHS_SORT_TRST_AMT
			, NVL(APS.PRCHS_SPMT_TRST_VLM, 0) AS PRCHS_SPMT_TRST_VLM
			, NVL(APS.PRCHS_SPMT_TRST_AMT, 0) AS PRCHS_SPMT_TRST_AMT
			, NVL(APS.PRCHS_SMPL_TRST_VLM, 0) AS PRCHS_SMPL_TRST_VLM
			, NVL(APS.PRCHS_SMPL_TRST_AMT, 0) AS PRCHS_SMPL_TRST_AMT
			, NVL(APS.PRCHS_TRST_VLM, 0) AS PRCHS_TRST_VLM
			, NVL(APS.PRCHS_TRST_AMT, 0) AS PRCHS_TRST_AMT

			, NVL(APS.PRCHS_SORT_EMSPAP_VLM, 0) AS PRCHS_SORT_EMSPAP_VLM
			, NVL(APS.PRCHS_SORT_EMSPAP_AMT, 0) AS PRCHS_SORT_EMSPAP_AMT
			, NVL(APS.PRCHS_SMPL_EMSPAP_VLM, 0) AS PRCHS_SMPL_EMSPAP_VLM
			, NVL(APS.PRCHS_SMPL_EMSPAP_AMT, 0) AS PRCHS_SMPL_EMSPAP_AMT
			, NVL(APS.PRCHS_EMSPAP_VLM, 0) AS PRCHS_EMSPAP_VLM
			, NVL(APS.PRCHS_EMSPAP_AMT, 0) AS PRCHS_EMSPAP_AMT

			, (NVL(APS.PRCHS_TRST_VLM, 0) + NVL(APS.PRCHS_EMSPAP_VLM, 0)) AS PRCHS_TOT_VLM
			, (NVL(APS.PRCHS_TRST_AMT, 0) + NVL(APS.PRCHS_EMSPAP_AMT, 0)) AS PRCHS_TOT_AMT

			/*공제*/
			, NVL(APS.DDC_EXPRT_VLM, 0) AS DDC_EXPRT_VLM
			, NVL(APS.DDC_EXPRT_AMT, 0) AS DDC_EXPRT_AMT
			, NVL(APS.DDC_VLM, 0) AS DDC_VLM
			, NVL(APS.DDC_AMT, 0) AS DDC_AMT
			, NVL(APS.DDC_ARMY_DLVGDS_VLM, 0) AS DDC_ARMY_DLVGDS_VLM
			, NVL(APS.DDC_ARMY_DLVGDS_AMT, 0) AS DDC_ARMY_DLVGDS_AMT
			, NVL(APS.DDC_MLSR_VLM, 0) AS DDC_MLSR_VLM
			, NVL(APS.DDC_MLSR_AMT, 0) AS DDC_MLSR_AMT
			/* 공제 합계 */
			, (NVL(APS.DDC_EXPRT_VLM, 0) + NVL(APS.DDC_VLM, 0) + NVL(APS.DDC_ARMY_DLVGDS_VLM, 0) + NVL(APS.DDC_MLSR_VLM, 0)) AS DDC_TOT_VLM
			, (NVL(APS.DDC_EXPRT_AMT, 0) + NVL(APS.DDC_AMT, 0) + NVL(APS.DDC_ARMY_DLVGDS_AMT, 0) + NVL(APS.DDC_MLSR_AMT, 0)) AS DDC_TOT_AMT

			, NVL(APS.AJMT_VLM, 0) AS AJMT_VLM
			, NVL(APS.AJMT_AMT, 0) AS AJMT_AMT

			/* 총 실적 */
			, NVL(APS.TOT_TRMT_PRFMNC_VLM, 0) AS TOT_TRMT_PRFMNC_VLM
			, NVL(APS.TOT_TRMT_PRFMNC_AMT, 0) AS TOT_TRMT_PRFMNC_AMT
			, NVL(APS.TOT_SPMT_PRFMNC_VLM, 0) AS TOT_SPMT_PRFMNC_VLM
			, NVL(APS.TOT_SPMT_PRFMNC_AMT, 0) AS TOT_SPMT_PRFMNC_AMT

		FROM TB_EV_UO_ISO_ALL_PRCHS_SLS APS
		WHERE 1=1
		  AND YR = #{yr}
		  AND APO_SE = '2'
		  AND BRNO = #{brno}
		  AND ITEM_CD = (SELECT ITEM_CD
							FROM TB_EV_APO_YR_GPC_CD
							WHERE APO_SE = '2'
							  AND YR = APS.YR
							  AND BRNO = APS.BRNO
							  AND (
							  		STTG_UPBR_ITEM_SE = '3'
							  		OR
							  		(STTG_UPBR_ITEM_SE != '3' AND UO_BRNO = APS.UO_BRNO)
							  		)
							  AND ITEM_CD = APS.ITEM_CD)
		ORDER BY PRCHS_SLS_SE , DECODE(APS.STTG_UPBR_ITEM_SE, '3' , APS.STTG_UPBR_ITEM_SE , (SELECT STTG_UPBR_ITEM_SE FROM TB_EV_APO_YR_GPC_CD WHERE APO_SE = '2' AND YR = APS.YR AND BRNO = APS.BRNO AND UO_BRNO = APS.UO_BRNO AND ITEM_CD = APS.ITEM_CD) )
	</select>

</mapper>