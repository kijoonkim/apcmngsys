<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : SlsPrfmncMapper.xml                                   				-->
<!-- DESC : 매출실적조회 mapper                   				                 	-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.08.18  	하민우        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.am.sls.mapper.SlsPrfmncMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.sls.mapper.SlsPrfmncMapper.selectSlsPrfmncList		-->
	<!-- DESC : 매출실적조회 목록 조회.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.18  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectSlsPrfmncList" parameterType="com.at.apcss.am.sls.vo.SlsPrfmncVO" resultType="com.at.apcss.am.sls.vo.SlsPrfmncVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
	    		, (SELECT FN_GET_VRTY_NM(pt0.ITEM_CD, pt0.VRTY_CD, pt0.APC_CD) FROM DUAL)			AS VRTY_NM
	    		, (SELECT FN_GET_SPCFCT_NM(pt0.ITEM_CD, pt0.SPCFCT_CD, pt0.APC_CD) FROM DUAL)		AS SPCFCT_NM
	    		, (SELECT FN_GET_GDS_NM(pt0.GDS_CD, pt0.APC_CD) FROM DUAL)							AS GDS_NM
    		 FROM (
    	</if>
    	<if test='pagingYn == null or pagingYn.equals("N")'>
    		SELECT
    			  pt0.*
	    		, (SELECT FN_GET_VRTY_NM(pt0.ITEM_CD, pt0.VRTY_CD, pt0.APC_CD) FROM DUAL)			AS VRTY_NM
	    		, (SELECT FN_GET_SPCFCT_NM(pt0.ITEM_CD, pt0.SPCFCT_CD, pt0.APC_CD) FROM DUAL)		AS SPCFCT_NM
	    		, (SELECT FN_GET_GDS_NM(pt0.GDS_CD, pt0.APC_CD) FROM DUAL)							AS GDS_NM
    		 FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
	    	SELECT /* com.at.apcss.am.sls.mapper.SlsPrfmncMapper.selectSlsPrfmncList */
	    		   SP.APC_CD						AS APC_CD
	    		 , SP.SLS_YMD						AS SLS_YMD
	    		 , SP.ITEM_CD						AS ITEM_CD
	    		 , SP.VRTY_CD						AS VRTY_CD
	    		 , SP.SPCFCT_CD						AS SPCFCT_CD
	    		 , SP.GDS_CD						AS GDS_CD
	    		 , CI.CNPT_NM				 		AS CNPT_NM
	    		 , SP.BRND_CD						AS BRND_CD
	    		 , SP.SPMT_YMD						AS SPMT_YMD
	    		 , SP.SLS_UNTPRC					AS SLS_UNTPRC
	    		 , SP.QNTT							AS QNTT
	    		 , SP.WGHT							AS WGHT
	    		 , SP.CFMTN_AMT						AS CFMTN_AMT
	    		 , SUM(SP.QNTT)	OVER()				AS TOT_QNTT
	    		 , SUM(SP.WGHT)	OVER()				AS TOT_WGHT
	    		 , SUM(SP.CFMTN_AMT) OVER()			AS TOT_CFMTN_AMT
			  FROM TB_SLS_PRFMNC SP
			     , TB_SPMT_PRFMNC_COM PC
			     , TB_SPMT_PRFMNC_DTL PD
			     , TB_CNPT_INFO CI
			 WHERE SP.APC_CD = PC.APC_CD
			   AND SP.APC_CD = PD.APC_CD
			   AND SP.APC_CD = CI.APC_CD
			   AND SP.SPMT_YMD = PC.SPMT_YMD
			   AND SP.CNPT_CD = PC.CNPT_CD
			   AND SP.VRTY_CD = PD.VRTY_CD
			   AND SP.SPCFCT_CD = PD.SPCFCT_CD
			   AND SP.QNTT = PD.SPMT_QNTT
			   AND SP.WGHT = PD.SPMT_WGHT
			   AND SP.BRND_CD = PD.BRND_CD
			   AND SP.GDS_CD = PD.GDS_CD
	    	   AND SP.CNPT_CD = CI.CNPT_CD
			   AND PC.SPMTNO = PD.SPMTNO
			   AND SP.DEL_YN = 'N'
			   AND PC.DEL_YN = 'N'
			   AND PD.DEL_YN = 'N'
	    	   AND CI.DEL_YN = 'N'
		]]>
		<if test='apcCd != null and apcCd != ""'>
			   AND SP.APC_CD = #{apcCd}
		</if>
		<if test='slsYmdFrom != null and slsYmdFrom != ""'>
		   	   AND SP.SLS_YMD >= #{slsYmdFrom}
		</if>
		<if test='slsYmdTo != null and slsYmdTo != ""'>
		       AND #{slsYmdTo} >= SP.SLS_YMD
		</if>
		<if test='cnptNm != null and cnptNm != ""'>
		       AND CI.CNPT_NM LIKE '%' ||  #{cnptNm} || '%'
		</if>
		<if test='itemCd != null and itemCd != ""'>
		       AND SP.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
		       AND SP.VRTY_CD = #{vrtyCd}
		</if>
    	<![CDATA[
		 	 GROUP BY PC.SPMTNO
	    		 	, SP.SLS_YMD
	    		 	, SP.SLS_SN
	    		 	, SP.ITEM_CD
	    		 	, SP.VRTY_CD
	    		 	, SP.SPCFCT_CD
	    		 	, SP.GDS_CD
	    		 	, SP.BRND_CD
	    		 	, SP.SPMT_YMD
	    		 	, SP.SLS_UNTPRC
	    		 	, SP.QNTT
	    		 	, SP.WGHT
	    		 	, SP.CFMTN_AMT
	    		 	, SP.CNPT_CD
		 	 		, SP.APC_CD
	    		 	, CI.CNPT_NM
	    		 	, SP.DEL_YN
		]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<if test='pagingYn == null or pagingYn.equals("N")'>
    		  ) pt0
    	</if>
    	<!-- End 페이징 -->
    </select>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.sls.mapper.SlsPrfmncMapper.insertSlsPrfmnc			-->
	<!-- DESC : 매출실적조회 목록 등록.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.18  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertSlsPrfmnc" parameterType="com.at.apcss.am.sls.vo.SlsPrfmncVO">
    	<![CDATA[
    	INSERT INTO TB_SLS_PRFMNC
    		(
    			APC_CD
		   	  , SLS_YMD
		      , SLS_SN
    		  , CNPT_CD
    		  , GDS_CD
    		  , QNTT
    		  , WGHT
    		  , ITEM_CD
    		  , VRTY_CD
    		  , SPCFCT_CD
    		  , GRD_CD
    		  , BRND_CD
    		  , SPMT_YMD
    		  , SLS_UNTPRC
    		  , RKNG_AMT
    		  , CFMTN_AMT
    		  , CFMTN_YN
    		  , DEL_YN
    		  , SYS_FRST_INPT_DT
    		  , SYS_FRST_INPT_USER_ID
    		  , SYS_FRST_INPT_PRGRM_ID
    		  , SYS_LAST_CHG_DT
    		  , SYS_LAST_CHG_USER_ID
    		  , SYS_LAST_CHG_PRGRM_ID
    		)
   		VALUES
   			(
		 	    #{apcCd}
		   	  , #{slsYmd}
		   	  , #{slsSn}
    		  , #{cnptCd}
    		  , #{gdsCd}
    		  , #{qntt}
    		  , #{wght}
    		  , #{itemCd}
    		  , #{vrtyCd}
    		  , #{spcfctCd}
    		  , #{grdCd}
    		  , #{brndCd}
    		  , #{spmtYmd}
    		  , #{slsUntprc}
    		  , #{rkngAmt}
    		  , #{cfmtnAmt}
    		  , #{cfmtnYn}
    		  , #{delYn}
    		  , SYSDATE
    		  , #{sysFrstInptUserId}
    		  , #{sysFrstInptPrgrmId}
    		  , SYSDATE
    		  , #{sysLastChgUserId}
    		  , #{sysLastChgPrgrmId}
   			)
    	]]>
    </insert>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.sls.mapper.SlsPrfmncMapper.updateSlsPrfmnc			-->
	<!-- DESC : 매출실적조회 목록 수정.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.18  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<update id="updateSlsPrfmnc" parameterType="com.at.apcss.am.sls.vo.SlsPrfmncVO">
		<![CDATA[
		UPDATE TB_SLS_PRFMNC
		   SET SYS_LAST_CHG_DT 			= SYSDATE
    		 , SYS_LAST_CHG_USER_ID		= #{sysLastChgUserId}
    		 , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    		 , CNPT_CD 					= #{cnptCd}
    		 , GDS_CD 					= #{gdsCd}
    		 , QNTT 					= #{qntt}
    		 , WGHT 					= #{wght}
    		 , ITEM_CD 					= #{itemCd}
    		 , VRTY_CD 					= #{vrtyCd}
    		 , SPCFCT_CD 				= #{spcfctCd}
    		 , GRD_CD 					= #{grdCd}
    		 , BRND_CD 					= #{brndCd}
    		 , SPMT_YMD 				= #{spmtYmd}
    		 , SLS_UNTPRC 				= #{slsUntprc}
    		 , RKNG_AMT 				= #{rkngAmt}
    		 , CFMTN_AMT 				= #{cfmtnAmt}
    		 , CFMTN_YN 				= #{cfmtnYn}
    		 , DEL_YN					= #{delYn}
		 WHERE APC_CD 					= #{apcCd}
		   AND SLS_YMD 					= #{slsYmd}
		   AND SLS_SN 					= #{slsSn}
		]]>
	</update>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.sls.mapper.SlsPrfmncMapper.deleteSlsPrfmnc			-->
	<!-- DESC : 매출실적조회 목록 삭제.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.18  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<delete id="deleteSlsPrfmnc" parameterType="com.at.apcss.am.sls.vo.SlsPrfmncVO">
		<![CDATA[
		DELETE FROM TB_SLS_PRFMNC
		 WHERE APC_CD 		= #{apcCd}
		   AND SLS_YMD 		= #{slsYmd}
		   AND SLS_SN 		= #{slsSn}
		]]>
	</delete>

</mapper>


