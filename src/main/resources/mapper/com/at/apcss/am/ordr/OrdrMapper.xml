<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : OrdrMapper.xml                                   			-->
<!-- DESC : 발주정보조회 mapper                   				                 	-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.08.24  	하민우        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.am.ordr.mapper.OrdrMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.ordr.mapper.OrdrMapper.selectOrdrList				-->
	<!-- DESC : 발주정보 목록 조회.	                         	             	 		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.24  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectOrdrList" parameterType="com.at.apcss.am.ordr.vo.OrdrVO" resultType="com.at.apcss.am.ordr.vo.OrdrVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
	    		, (SELECT FN_GET_ITEM_NM(pt0.ITEM_CD, pt0.APC_CD) FROM DUAL)						AS ITEM_NM
	    		, (SELECT FN_GET_VRTY_NM(pt0.ITEM_CD, pt0.VRTY_CD, pt0.APC_CD) FROM DUAL)			AS VRTY_NM
	    		, (SELECT FN_GET_SPCFCT_NM(pt0.ITEM_CD, pt0.SPCFCT_CD, pt0.APC_CD) FROM DUAL)		AS SPCFCT_NM
	    		, (SELECT FN_GET_GDS_NM(pt0.GDS_CD, pt0.APC_CD) FROM DUAL)							AS GDS_NM
    		 FROM (
    	</if>
    	<if test='pagingYn == null or pagingYn.equals("N")'>
    		SELECT
    			  pt0.*
	    		, (SELECT FN_GET_ITEM_NM(pt0.ITEM_CD, pt0.APC_CD) FROM DUAL)						AS ITEM_NM
	    		, (SELECT FN_GET_VRTY_NM(pt0.ITEM_CD, pt0.VRTY_CD, pt0.APC_CD) FROM DUAL)			AS VRTY_NM
	    		, (SELECT FN_GET_SPCFCT_NM(pt0.ITEM_CD, pt0.SPCFCT_CD, pt0.APC_CD) FROM DUAL)		AS SPCFCT_NM
	    		, (SELECT FN_GET_GDS_NM(pt0.GDS_CD, pt0.APC_CD) FROM DUAL)							AS GDS_NM
    		 FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
	    	SELECT /* com.at.apcss.am.ordr.mapper.OrdrMapper.selectOrdrList */
	    		   OI.APC_CD							AS APC_CD
    		  	 , OI.APC_SE_CD							AS APC_SE_CD
    		  	 , OI.RCPT_CFMTN_YMD					AS RCPT_CFMTN_YMD
    		  	 , OI.OUTORDR_TYPE						AS OUTORDR_TYPE
			  	 , OI.OUTORDRNO							AS OUTORDRNO
    		  	 , OI.APC_CNPT_NM						AS APC_CNPT_NM
    		  	 , OI.APC_CNPT_CD						AS APC_CNPT_CD
    		  	 , OI.WRHS_YMD							AS WRHS_YMD
    		  	 , OI.OUTORDR_YMD						AS OUTORDR_YMD
    		  	 , OI.OUTORDR_PRSN						AS OUTORDR_PRSN
    		  	 , OI.SPLY_PRSN							AS SPLY_PRSN
    		  	 , OI.GDS_CD							AS GDS_CD
    		  	 , OI.DLDTN								AS DLDTN
    		  	 , OI.ITEM_CD							AS ITEM_CD
    		  	 , OI.VRTY_CD							AS VRTY_CD
    		  	 , OI.SPCFCT_CD							AS SPCFCT_CD
    		  	 , OI.BX_GDS_QNTT						AS BX_GDS_QNTT
    		  	 , OI.OUTORDR_QNTT						AS OUTORDR_QNTT
    	   	  	 , OI.PIECE_QNTT						AS PIECE_QNTT
    	 	  	 , OI.UNIT								AS UNIT
    		  	 , OI.BX_UNTPRC							AS BX_UNTPRC
    		  	 , OI.OUTORDR_UNTPRC					AS OUTORDR_UNTPRC
    		  	 , OI.OUTORDR_UNIT						AS OUTORDR_UNIT
    		  	 , OI.LOT								AS LOT
    		  	 , OI.TX_AMT							AS TX_AMT
    		  	 , OI.OUTORDR_AMT						AS OUTORDR_AMT
    		  	 , OI.WRHS_TYPE							AS WRHS_TYPE
    		  	 , OI.DOCNO								AS DOCNO
    		  	 , OI.DOCK_INFO							AS DOCK_INFO
    		  	 , OI.CNTR_SE							AS CNTR_SE
    		  	 , OI.BUYER_NM							AS BUYER_NM
    		  	 , OI.CNTR_RCVD_WRHS_YMD				AS CNTR_RCVD_WRHS_YMD
    		  	 , OI.CNTR_NM							AS CNTR_NM
    		  	 , OI.DLVGDS_SE_CD						AS DLVGDS_SE_CD
    		  	 , OI.ETC								AS ETC
    		  	 , OI.RCPT_CFMTN_APC_CD					AS RCPT_CFMTN_APC_CD
    		  	 , OI.PCKG_CMNDNO						AS PCKG_CMNDNO
    		  	 , SC.SPMT_YMD							AS SPMT_YMD
			  FROM TB_OUTORDR_INFO OI
			     , TB_SPMT_PRFMNC_COM SC
			     , TB_SPMT_PRFMNC_DTL SD
			 WHERE OI.APC_CD = SC.APC_CD
			   AND OI.APC_CD = SD.APC_CD
			   AND OI.VRTY_CD = SD.VRTY_CD
			   AND OI.SPCFCT_CD = SD.SPCFCT_CD
			   AND OI.GDS_CD = SD.GDS_CD
			   AND SC.SPMTNO = SD.SPMTNO
			   AND OI.APC_CNPT_CD = SC.CNPT_CD
			   AND OI.DEL_YN = 'N'
			   AND SC.DEL_YN = 'N'
			   AND SD.DEL_YN = 'N'
		]]>
<!-- 		<if test='apcSeCd != null and apcSeCd == "1"'> -->
<!-- 			   		AND OI.APC_CD = '0000' -->
<!-- 	   		<if test='rcptYn != null and rcptYn == "Y"'> -->
<!-- 	   			<if test='apcCd != null and apcCd != ""'> -->
<!-- 			   			AND OI.RCPT_CFMTN_APC_CD = #{apcCd} -->
<!-- 				</if> -->
<!-- 			   		AND OI.RCPT_CFMTN_YMD IS NOT NULL -->
<!-- 			</if> -->
<!-- 			<if test='rcptYn != null and rcptYn == "N"'> -->
<!-- 			   		AND OI.RCPT_CFMTN_YMD IS NULL -->
<!-- 			</if> -->
<!-- 		</if> -->
<!-- 		<if test='apcSeCd != null and apcSeCd == "2"'> -->
<!-- 			<if test='apcCd != null and apcCd != ""'> -->
<!-- 			   		AND OI.APC_CD = #{apcCd} -->
<!-- 			</if> -->
<!-- 			<if test='rcptYn != null and rcptYn == "Y"'> -->
<!-- 			   		AND OI.RCPT_CFMTN_YMD IS NOT NULL -->
<!-- 			</if> -->
<!-- 			<if test='rcptYn != null and rcptYn == "N"'> -->
<!-- 			   		AND OI.RCPT_CFMTN_YMD IS NULL -->
<!-- 			</if> -->
<!-- 		</if> -->
		<if test='rcptYn != null and rcptYn == "Y"'>
			   AND ((
						(OI.APC_SE_CD = '1' AND OI.APC_CD = '0000' AND OI.RCPT_CFMTN_APC_CD = #{apcCd})
	         			OR
	         			(OI.APC_SE_CD = '2' AND OI.APC_CD = #{apcCd}))
      				AND OI.RCPT_CFMTN_YMD IS NOT NULL)
		</if>
		<if test='rcptYn != null and rcptYn == "N"'>
			   AND ((
						(OI.APC_SE_CD = '1' AND OI.APC_CD = '0000')
         				OR
         				(OI.APC_SE_CD = '2' AND OI.APC_CD = #{apcCd}))
      				AND OI.RCPT_CFMTN_YMD IS NULL)
		</if>
		<if test='outordrYmdFrom != null and outordrYmdFrom != ""'>
		   	   AND OI.OUTORDR_YMD >= #{outordrYmdFrom}
		</if>
		<if test='outordrYmdTo != null and outordrYmdTo != ""'>
		       AND #{outordrYmdTo} >= OI.OUTORDR_YMD
		</if>
		<if test='outordrType != null and outordrType != ""'>
		   	   AND OI.OUTORDR_TYPE = #{outordrType}
		</if>
		<if test='apcCnptNm != null and apcCnptNm != ""'>
		       AND OI.APC_CNPT_NM LIKE '%' ||  #{apcCnptNm} || '%'
		</if>
		<if test='itemCd != null and itemCd != ""'>
		       AND OI.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
		       AND OI.VRTY_CD = #{vrtyCd}
		</if>
		<if test='wrhsYmd != null and wrhsYmd != ""'>
		   	   AND OI.WRHS_YMD = #{wrhsYmd}
		</if>
		<if test='gdsNm != null and gdsNm != ""'>
		   	   AND SP.SLS_YMD >= #{gdsNm}
		</if>
    	<![CDATA[
		 	 GROUP BY OI.RCPT_CFMTN_YMD
    		  	 	, OI.OUTORDR_TYPE
			  	 	, OI.OUTORDRNO
    		  	 	, OI.APC_CNPT_NM
    		  	 	, OI.APC_CNPT_CD
    		  	 	, OI.WRHS_YMD
    		  	 	, OI.OUTORDR_YMD
    		  	 	, OI.OUTORDR_PRSN
    		  	 	, OI.SPLY_PRSN
    		  	 	, OI.GDS_CD
    		  	 	, OI.DLDTN
    		  	 	, OI.ITEM_CD
    		  	 	, OI.VRTY_CD
    		  	 	, OI.SPCFCT_CD
    		  	 	, OI.BX_GDS_QNTT
    		  	 	, OI.OUTORDR_QNTT
    	   	  	 	, OI.PIECE_QNTT
    	 	  	 	, OI.UNIT
    		  	 	, OI.BX_UNTPRC
    		  	 	, OI.OUTORDR_UNTPRC
    		  	 	, OI.OUTORDR_UNIT
    		  	 	, OI.LOT
    		  	 	, OI.TX_AMT
    		  	 	, OI.OUTORDR_AMT
    		  	 	, OI.WRHS_TYPE
    		  	 	, OI.DOCNO
    		  	 	, OI.DOCK_INFO
    		  	 	, OI.CNTR_SE
    		  	 	, OI.BUYER_NM
    		  	 	, OI.CNTR_RCVD_WRHS_YMD
    		  	 	, OI.CNTR_NM
    		  	 	, OI.DLVGDS_SE_CD
    		  	 	, OI.ETC
    		  	 	, OI.RCPT_CFMTN_APC_CD
    		  	 	, OI.PCKG_CMNDNO
    		  	 	, OI.APC_CD
    		  	 	, OI.APC_SE_CD
    		  	 	, SC.SPMT_YMD
		]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<if test='pagingYn == null or pagingYn.equals("N")'>
    		  ) pt0
    	</if>
    	<!-- End 페이징 -->
    </select>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.ordr.mapper.OrdrMapper.insertOrdr					-->
	<!-- DESC : 발주정보 등록.	                         	             	 			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.24  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertOrdr" parameterType="com.at.apcss.am.ordr.vo.OrdrVO">
    	<![CDATA[
    	INSERT INTO TB_OUTORDR_INFO
    		(
    			APC_CD
			  , APC_SE_CD
			  , OUTORDRNO
    		  , RCPTN_SE_CD
    		  , RCPTNNO
    		  , RCPT_CFMTN_APC_CD
    		  , RCPT_CFMTN_YMD
    		  , PCKG_CMNDNO
    		  , DOCNO
    		  , CNPT_ORDRNO
    		  , OUTORDR_TYPE
    		  , WRHS_TYPE
    		  , OUTORDR_YMD
    		  , OUTORDR_PRSN
    		  , OUTORDR_PRSN_CD
    		  , DOCK_INFO
    		  , SPLY_PRSN
    		  , GDS_CD
    		  , ITEM_CD
    		  , VRTY_CD
    		  , SPCFCT_CD
    		  , TPND
    		  , TPNB
    		  , DIAMONDLINE
    		  , DLDTN
    		  , BX_GDS_QNTT
    		  , OUTORDR_QNTT
    	   	  , PIECE_QNTT
    	 	  , UNIT
    		  , BX_UNTPRC
    		  , OUTORDR_UNTPRC
    		  , OUTORDR_UNIT
    		  , LOT
    		  , TX_AMT
    		  , OUTORDR_AMT
    		  , DLDTN_CD
    		  , WRHS_YMD
    		  , DLVGDS_NM
    		  , DLVGDS_CD
    		  , APC_CNPT_NM
    		  , APC_CNPT_CD
    		  , CNTR_SE
    		  , CNTR_RCVD_WRHS_YMD
    		  , CNTR_CD
    		  , CNTR_NM
    		  , DLVGDS_SE_CD
    		  , ETC
    		  , BUYER_NM
    		  , DEL_YN
    		  , SYS_FRST_INPT_DT
    		  , SYS_FRST_INPT_USER_ID
    		  , SYS_FRST_INPT_PRGRM_ID
    		  , SYS_LAST_CHG_DT
    		  , SYS_LAST_CHG_USER_ID
    		  , SYS_LAST_CHG_PRGRM_ID
    		)
   		VALUES
   			(
		 	    #{apcCd}
			  , #{apcSeCd}
			  , #{outordrno}
    		  , #{rcptnSeCd}
    		  , #{rcptnno}
    		  , #{rcptCfmtnApcCd}
    		  , #{rcptCfmtnYmd}
    		  , #{pckgCmndno}
    		  , #{docno}
    		  , #{cnptOrdrno}
    		  , #{outordrType}
    		  , #{wrhsType}
    		  , #{outordrYmd}
    		  , #{outordrPrsn}
    		  , #{outordrPrsnCd}
    		  , #{dockInfo}
    		  , #{splyPrsn}
    		  , #{gdsCd}
    		  , #{itemCd}
    		  , #{vrtyCd}
    		  , #{spcfctCd}
    		  , #{tpnd}
    		  , #{tpnb}
    		  , #{diamondline}
    		  , #{dldtn}
    		  , #{bxGdsQntt}
    		  , #{outordrQntt}
    		  , #{pieceQntt}
    		  , #{unit}
    		  , #{bxUntprc}
    		  , #{outordrUntprc}
    		  , #{outordrUnit}
    		  , #{lot}
    		  , #{txAmt}
    		  , #{outordrAmt}
    		  , #{dldtnCd}
    		  , #{wrhsYmd}
    		  , #{dlvgdsNm}
    		  , #{dlvgdsCd}
    		  , #{apcCnptNm}
    		  , #{apcCnptCd}
    		  , #{cntrSe}
    		  , #{cntrRcvdWrhsYmd}
    		  , #{cntrCd}
    		  , #{cntrNm}
    		  , #{dlvgdsSeCd}
    		  , #{etc}
    		  , #{buyerNm}
    		  , #{delYn}
    		  , SYSDATE
    		  , #{sysFrstInptUserId}
    		  , #{sysFrstInptPrgrmId}
    		  , SYSDATE
    		  , #{sysLastChgUserId}
    		  , #{sysLastChgPrgrmId}
   			)
    	]]>
    </insert>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.ordr.mapper.OrdrMapper.updateOrdr					-->
	<!-- DESC : 발주정보 수정.	                         	             	 			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.24  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<update id="updateOrdr" parameterType="com.at.apcss.am.ordr.vo.OrdrVO">
		<![CDATA[
		UPDATE TB_OUTORDR_INFO
		   SET SYS_LAST_CHG_DT 			= SYSDATE
    		 , SYS_LAST_CHG_USER_ID		= #{sysLastChgUserId}
    		 , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
    		 , RCPTN_SE_CD 				= #{rcptnSeCd}
    		 , RCPTNNO 					= #{rcptnno}
    		 , RCPT_CFMTN_APC_CD 		= #{rcptCfmtnApcCd}
    		 , RCPT_CFMTN_YMD 			= #{rcptCfmtnYmd}
    		 , PCKG_CMNDNO 				= #{pckgCmndno}
    		 , DOCNO 					= #{docno}
    		 , CNPT_ORDRNO 				= #{cnptOrdrno}
    		 , OUTORDR_TYPE 			= #{outordrType}
    		 , WRHS_TYPE 				= #{wrhsType}
    		 , OUTORDR_YMD 				= #{outordrYmd}
    		 , OUTORDR_PRSN 			= #{outordrPrsn}
    		 , OUTORDR_PRSN_CD 			= #{outordrPrsnCd}
    		 , DOCK_INFO 				= #{dockInfo}
    		 , SPLY_PRSN 				= #{splyPrsn}
    		 , GDS_CD 					= #{gdsCd}
    		 , ITEM_CD 					= #{itemCd}
    		 , VRTY_CD 					= #{vrtyCd}
    		 , SPCFCT_CD 				= #{spcfctCd}
    		 , TPND 					= #{tpnd}
    		 , TPNB 					= #{tpnb}
    		 , DIAMONDLINE 				= #{diamondline}
    		 , DLDTN 					= #{dldtn}
    		 , BX_GDS_QNTT 				= #{bxGdsQntt}
    		 , OUTORDR_QNTT 			= #{outordrQntt}
    		 , PIECE_QNTT 				= #{pieceQntt}
    		 , UNIT 					= #{unit}
    		 , BX_UNTPRC 				= #{bxUntprc}
    		 , OUTORDR_UNTPRC 			= #{outordrUntprc}
    		 , OUTORDR_UNIT 			= #{outordrUnit}
    		 , LOT 						= #{lot}
    		 , TX_AMT 					= #{txAmt}
    		 , OUTORDR_AMT 				= #{outordrAmt}
    		 , DLDTN_CD 				= #{dldtnCd}
    		 , WRHS_YMD 				= #{wrhsYmd}
    		 , DLVGDS_NM 				= #{dlvgdsNm}
    		 , DLVGDS_CD 				= #{dlvgdsCd}
    		 , APC_CNPT_NM 				= #{apcCnptNm}
    		 , APC_CNPT_CD 				= #{apcCnptCd}
    		 , CNTR_SE 					= #{cntrSe}
    		 , CNTR_RCVD_WRHS_YMD 		= #{cntrRcvdWrhsYmd}
    		 , CNTR_CD 					= #{cntrCd}
    		 , CNTR_NM 					= #{cntrNm}
    		 , DLVGDS_SE_CD 			= #{dlvgdsSeCd}
    		 , ETC 						= #{etc}
    		 , BUYER_NM 				= #{buyerNm}
    		 , DEL_YN					= #{delYn}
		 WHERE APC_CD 					= #{apcCd}
		   AND APC_SE_CD 				= #{apcSeCd}
		   AND OUTORDRNO 				= #{outordrno}
		]]>
	</update>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.ordr.mapper.OrdrMapper.deleteOrdr					-->
	<!-- DESC : 발주정보 삭제.	                         	             		 		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.24  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<delete id="deleteOrdr" parameterType="com.at.apcss.am.ordr.vo.OrdrVO">
		<![CDATA[
		DELETE FROM TB_OUTORDR_INFO
		 WHERE APC_CD 		= #{apcCd}
		   AND APC_SE_CD 	= #{apcSeCd}
		   AND OUTORDRNO 	= #{outordrno}
		]]>
	</delete>
</mapper>


