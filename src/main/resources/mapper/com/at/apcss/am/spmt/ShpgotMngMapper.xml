<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : SpmtCmndMapper.xml                                   				-->
<!-- DESC : 반품 기준 mapper                   				                -->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.08.16  	하민우        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.am.spmt.mapper.ShpgotMngMapper">
    <!-- ==========================================================================	-->
    <!-- NAME : com.at.apcss.am.spmt.mapper.ShpgotMngMapper.insertShpgotApcCrtr	    -->
    <!-- DESC : 반품기준 목록 생성.	                         	                        -->
    <!-- ==========================================================================	-->
    <!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
    <!-- ===========  	============  	===========================================	-->
    <!-- 2025.01.04  	손민성        	Initial Creation                            -->
    <!-- ==========================================================================	-->
    <insert id="insertShpgotApcCrtr" parameterType="list">
        MERGE INTO TB_SHPGOT_APC_CRTR SAC
            USING (
                <foreach collection="list" item="item" index="index" separator="UNION">
                    SELECT
                        #{item.apcCd} AS APC_CD
                    ,   #{item.shpgotCrtrType} AS SHPGOT_CRTR_TYPE
                    ,   #{item.crtrCd} AS CRTR_CD
                    ,   #{item.crtrVl} AS CRTR_VL
                    ,   #{item.crtrIndctNm} AS CRTR_INDCT_NM
                    ,   #{item.indctSeq} AS INDCT_SEQ
                    ,   #{item.useYn} AS USE_YN
                    ,   #{item.rmrk} AS RMRK
                    ,   #{item.sysLastChgUserId} AS SYS_LAST_CHG_USER_ID
                    ,   #{item.sysLastChgPrgrmId} AS SYS_LAST_CHG_PRGRM_ID
                    ,   #{item.sysFrstInptUserId} AS SYS_FRST_INPT_USER_ID
                    ,   #{item.sysFrstInptPrgrmId} AS SYS_FRST_INPT_PRGRM_ID
                    ,   #{item.shpgotTrgtCd} AS SHPGOT_TRGT_CD
                    FROM DUAL
                </foreach>
                ) source
            ON (
                    SAC.APC_CD = source.APC_CD
                AND SAC.SHPGOT_CRTR_TYPE = source.SHPGOT_CRTR_TYPE
                AND SAC.CRTR_CD = source.CRTR_CD
                )
            WHEN MATCHED THEN
            UPDATE
                SET
                     CRTR_VL = source.CRTR_VL
                    ,CRTR_INDCT_NM = source.CRTR_INDCT_NM
                    ,INDCT_SEQ = source.INDCT_SEQ
                    ,USE_YN = source.USE_YN
                    ,RMRK = source.RMRK
                    ,SYS_LAST_CHG_DT = SYSDATE
                    ,SYS_LAST_CHG_USER_ID = source.SYS_LAST_CHG_USER_ID
                    ,SYS_LAST_CHG_PRGRM_ID = source.SYS_LAST_CHG_PRGRM_ID
                    ,SHPGOT_TRGT_CD = source.SHPGOT_TRGT_CD
            WHEN NOT MATCHED THEN
            INSERT
            (
                 APC_CD
                ,SHPGOT_CRTR_TYPE
                ,CRTR_CD
                ,CRTR_VL
                ,CRTR_INDCT_NM
                ,INDCT_SEQ
                ,USE_YN
                ,SYS_FRST_INPT_DT
                ,SYS_FRST_INPT_USER_ID
                ,SYS_FRST_INPT_PRGRM_ID
                ,SYS_LAST_CHG_DT
                ,SYS_LAST_CHG_USER_ID
                ,SYS_LAST_CHG_PRGRM_ID
                ,RMRK
                ,SHPGOT_TRGT_CD
            )
        VALUES
            (
                 source.APC_CD
                ,source.SHPGOT_CRTR_TYPE
                ,source.CRTR_CD
                ,source.CRTR_VL
                ,source.CRTR_INDCT_NM
                ,source.INDCT_SEQ
                ,source.USE_YN
                ,SYSDATE
                ,source.SYS_FRST_INPT_USER_ID
                ,source.SYS_FRST_INPT_PRGRM_ID
                ,SYSDATE
                ,source.SYS_LAST_CHG_USER_ID
                ,source.SYS_LAST_CHG_PRGRM_ID
                ,source.RMRK
                ,source.SHPGOT_TRGT_CD
            )
    </insert>

    <!-- ==========================================================================	-->
    <!-- NAME : com.at.apcss.am.spmt.mapper.SpmtCmndMapper.selectSpmtCmndTrgList	-->
    <!-- DESC : 출하지시대상내역 목록 조회.	                         	            -->
    <!-- ==========================================================================	-->
    <!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
    <!-- ===========  	============  	===========================================	-->
    <!-- 2023.08.23  	정희운        	Initial Creation                            -->
    <!-- 2023.10.04  	김호        	Initial 쿼리 수정                           -->
    <!-- ==========================================================================	-->
    <insert id="insertShpgotApcCrtrDtl" parameterType="list">
        MERGE INTO TB_SHPGOT_APC_CRTR_DTL SACD
        USING (
        <foreach collection="list" item="item" index="index" separator="UNION">
            SELECT
            #{item.apcCd} AS APC_CD
            ,   #{item.shpgotCrtrType} AS SHPGOT_CRTR_TYPE
            ,   #{item.crtrCd} AS CRTR_CD
            ,   #{item.dtlSn} AS DTL_SN
            ,   #{item.dtlCd} AS DTL_CD
            ,   #{item.dtlVl} AS DTL_VL
            ,   #{item.dtlIndctNm} AS DTL_INDCT_NM
            ,   #{item.indctSeq} AS INDCT_SEQ
            ,   #{item.useYn} AS USE_YN
            ,   #{item.rmrk} AS RMRK
            ,   #{item.sysLastChgUserId} AS SYS_LAST_CHG_USER_ID
            ,   #{item.sysLastChgPrgrmId} AS SYS_LAST_CHG_PRGRM_ID
            ,   #{item.sysFrstInptUserId} AS SYS_FRST_INPT_USER_ID
            ,   #{item.sysFrstInptPrgrmId} AS SYS_FRST_INPT_PRGRM_ID
            FROM DUAL
        </foreach>
        ) source
        ON (
                SACD.APC_CD = source.APC_CD
            AND SACD.SHPGOT_CRTR_TYPE = source.SHPGOT_CRTR_TYPE
            AND SACD.CRTR_CD = source.CRTR_CD
            AND SACD.DTL_SN = source.DTL_SN
        )
        WHEN MATCHED THEN
        UPDATE
            SET
                 DTL_CD = source.DTL_CD
                ,DTL_VL = source.DTL_VL
                ,DTL_INDCT_NM = source.DTL_INDCT_NM
                ,INDCT_SEQ = source.INDCT_SEQ
                ,USE_YN = source.USE_YN
                ,RMRK = source.RMRK
                ,SYS_LAST_CHG_DT = SYSDATE
                ,SYS_LAST_CHG_USER_ID = source.SYS_LAST_CHG_USER_ID
                ,SYS_LAST_CHG_PRGRM_ID = source.SYS_LAST_CHG_PRGRM_ID
        WHEN NOT MATCHED THEN
        INSERT
        (
             APC_CD
            ,SHPGOT_CRTR_TYPE
            ,CRTR_CD
            ,DTL_SN
            ,DTL_CD
            ,DTL_VL
            ,DTL_INDCT_NM
            ,INDCT_SEQ
            ,USE_YN
            ,DEL_YN
            ,SYS_FRST_INPT_DT
            ,SYS_FRST_INPT_PRGRM_ID
            ,SYS_FRST_INPT_USER_ID
            ,SYS_LAST_CHG_DT
            ,SYS_LAST_CHG_USER_ID
            ,SYS_LAST_CHG_PRGRM_ID
            ,RMRK
        )
        VALUES
        (
             source.APC_CD
            ,source.SHPGOT_CRTR_TYPE
            ,source.CRTR_CD
            ,source.DTL_SN
            ,source.DTL_CD
            ,source.DTL_VL
            ,source.DTL_INDCT_NM
            ,source.INDCT_SEQ
            ,source.USE_YN
            ,'N'
            ,SYSDATE
            ,source.SYS_FRST_INPT_PRGRM_ID
            ,source.SYS_FRST_INPT_USER_ID
            ,SYSDATE
            ,source.SYS_LAST_CHG_USER_ID
            ,source.SYS_LAST_CHG_PRGRM_ID
            ,source.RMRK
        );
    </insert>
    <!-- ==========================================================================	-->
    <!-- NAME : com.at.apcss.am.spmt.mapper.ShpgotMngMapper.insertShpgotApcCrtrSingle	-->
    <!-- DESC : 반품 기준 목록 생성.    	                         	                -->
    <!-- ==========================================================================	-->
    <!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
    <!-- ===========  	============  	===========================================	-->
    <!-- 2025.01.03  	손민성        	Initial Creation                            -->
    <!-- ==========================================================================	-->
    <insert id="insertShpgotApcCrtrSingle" parameterType="com.at.apcss.am.spmt.vo.ShpgotApcCrtrVO">
        INSERT INTO TB_SHPGOT_APC_CRTR
        (
                 APC_CD
                ,SHPGOT_CRTR_TYPE
                ,CRTR_CD
                ,CRTR_VL
                ,CRTR_INDCT_NM
                ,INDCT_SEQ
                ,USE_YN
                ,SYS_FRST_INPT_DT
                ,SYS_FRST_INPT_USER_ID
                ,SYS_FRST_INPT_PRGRM_ID
                ,SYS_LAST_CHG_DT
                ,SYS_LAST_CHG_USER_ID
                ,SYS_LAST_CHG_PRGRM_ID
                ,RMRK
            )
        VALUES
            (
                 #{apcCd}
                ,#{shpgotCrtrType}
                ,#{crtrCd}
                ,#{crtrVl}
                ,#{crtrIndctNm}
                ,#{indctSeq}
                ,#{useYn}
                ,SYSDATE
                ,#{sysFrstInptUserId}
                ,#{sysFrstInptPrgrmId}
                ,SYSDATE
                ,#{sysLastChgUserId}
                ,#{sysLastChgPrgrmId}
                ,#{rmrk}
            )
    </insert>
    <!-- ==========================================================================	-->
    <!-- NAME : com.at.apcss.am.spmt.mapper.ShpgotMngMapper.selectShpgotApcCrtrList	-->
    <!-- DESC : 반품 기준 목록 조회.    	                         	                -->
    <!-- ==========================================================================	-->
    <!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
    <!-- ===========  	============  	===========================================	-->
    <!-- 2025.01.03  	손민성        	Initial Creation                            -->
    <!-- ==========================================================================	-->
    <select id="selectShpgotApcCrtrList" parameterType="com.at.apcss.am.spmt.vo.ShpgotApcCrtrVO" resultType="com.at.apcss.am.spmt.vo.ShpgotApcCrtrVO">
        SELECT
              APC_CD
             ,SHPGOT_CRTR_TYPE
             ,CRTR_CD
             ,CRTR_VL
             ,CRTR_INDCT_NM
             ,INDCT_SEQ
             ,USE_YN
             ,DEL_YN
             ,SYS_FRST_INPT_DT
             ,SYS_FRST_INPT_USER_ID
             ,SYS_FRST_INPT_PRGRM_ID
             ,SYS_LAST_CHG_DT
             ,SYS_LAST_CHG_USER_ID
             ,SYS_LAST_CHG_PRGRM_ID
             ,RMRK
             ,SHPGOT_TRGT_CD
        FROM
            TB_SHPGOT_APC_CRTR
        WHERE
            APC_CD = #{apcCd}
        <if test='shpgotCrtrType != null and shpgotCrtrType != ""'>
            AND SHPGOT_CRTR_TYPE = #{shpgotCrtrType}
        </if>
    </select>
    <!-- ==========================================================================	-->
    <!-- NAME : com.at.apcss.am.spmt.mapper.ShpgotMngMapper.selectShpgotApcCrtrDtlList	-->
    <!-- DESC : 반품 기준 상세목록 조회.    	                         	                -->
    <!-- ==========================================================================	-->
    <!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
    <!-- ===========  	============  	===========================================	-->
    <!-- 2025.01.03  	손민성        	Initial Creation                            -->
    <!-- ==========================================================================	-->
    <select id="selectShpgotApcCrtrDtlList" parameterType="com.at.apcss.am.spmt.vo.ShpgotApcCrtrVO" resultType="com.at.apcss.am.spmt.vo.ShpgotApcCrtrDtlVO">
        SELECT
             APC_CD
            ,SHPGOT_CRTR_TYPE
            ,CRTR_CD
            ,DTL_SN
            ,DTL_CD
            ,DTL_VL
            ,DTL_INDCT_NM
            ,INDCT_SEQ
            ,USE_YN
            ,DEL_YN
            ,SYS_FRST_INPT_DT
            ,SYS_FRST_INPT_PRGRM_ID
            ,SYS_FRST_INPT_USER_ID
            ,SYS_LAST_CHG_DT
            ,SYS_LAST_CHG_USER_ID
            ,SYS_LAST_CHG_PRGRM_ID
            ,RMRK
        FROM
        TB_SHPGOT_APC_CRTR_DTL
        WHERE
        APC_CD = #{apcCd}
        <if test='shpgotCrtrType != null and shpgotCrtrType != ""'>
            AND SHPGOT_CRTR_TYPE = #{shpgotCrtrType}
        </if>
    </select>

</mapper>