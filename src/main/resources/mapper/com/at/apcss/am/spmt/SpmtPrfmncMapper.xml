<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : SpmtPrfmncMapper.xml                                   				-->
<!-- DESC : 출하실적조회 mapper                   				                -->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.08.17  	하민우        	Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.selectSpmtPrfmncList	-->
	<!-- DESC : 출하실적조회 목록 조회.	                         	             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.17  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectSpmtPrfmncList" parameterType="com.at.apcss.am.spmt.vo.SpmtPrfmncVO" resultType="com.at.apcss.am.spmt.vo.SpmtPrfmncVO">
    	<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		SELECT
    			  ROWNUM AS ROW_SEQ
    			, COUNT(*) OVER() AS TOTAL_RECORD_COUNT
    			, pt0.*
    			, (SELECT FN_GET_GDS_NM(pt0.GDS_CD, pt0.APC_CD) FROM DUAL)						AS GDS_NM
    			, (SELECT FN_GET_VRTY_NM(pt0.ITEM_CD, pt0.VRTY_CD, pt0.APC_CD) FROM DUAL)		AS VRTY_NM
    		 	, (SELECT FN_GET_SPCFCT_NM(pt0.ITEM_CD, pt0.SPCFCT_CD, pt0.APC_CD) FROM DUAL)	AS SPCFCT_NM
    		 	, (SELECT FN_GET_CNPT_NM(pt0.CNPT_CD, pt0.APC_CD) FROM DUAL)					AS CNPT_NM
    		 	, (SELECT FN_GET_TRSPRT_CO_NM(pt0.TRSPRT_CO_CD, pt0.APC_CD) FROM DUAL)			AS TRSPRT_CO_NM
    		 FROM (
    	</if>
    	<if test='pagingYn == null or pagingYn.equals("N")'>
    		SELECT
    			  pt0.*
    			, (SELECT FN_GET_GDS_NM(pt0.GDS_CD, pt0.APC_CD) FROM DUAL)						AS GDS_NM
    			, (SELECT FN_GET_VRTY_NM(pt0.ITEM_CD, pt0.VRTY_CD, pt0.APC_CD) FROM DUAL)		AS VRTY_NM
    		 	, (SELECT FN_GET_SPCFCT_NM(pt0.ITEM_CD, pt0.SPCFCT_CD, pt0.APC_CD) FROM DUAL)	AS SPCFCT_NM
    		 	, (SELECT FN_GET_CNPT_NM(pt0.CNPT_CD, pt0.APC_CD) FROM DUAL)					AS CNPT_NM
    		 	, (SELECT FN_GET_TRSPRT_CO_NM(pt0.TRSPRT_CO_CD, pt0.APC_CD) FROM DUAL)			AS TRSPRT_CO_NM
    		 FROM (
    	</if>
    	<!-- End 페이징 -->
    	<![CDATA[
	    	SELECT /* com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.selectSpmtPrfmncList */
	    		   PC.APC_CD						AS APC_CD
	    		 , PC.SPMT_YMD						AS SPMT_YMD
	    		 , PD.BRND_CD						AS BRND_CD
	    		 , PD.GDS_CD						AS GDS_CD
	    		 , VC.ITEM_CD						AS ITEM_CD
	    		 , PD.VRTY_CD						AS VRTY_CD
	    		 , PD.SPCFCT_CD						AS SPCFCT_CD
	    		 , PC.CNPT_CD						AS CNPT_CD
	    		 , PC.DLDTN							AS DLDTN
	    		 , PC.TRSPRT_CO_CD					AS TRSPRT_CO_CD
	    		 , PC.VHCLNO						AS VHCLNO
	    		 , PC.TRSPRT_CST					AS TRSPRT_CST
	    		 , PD.SPMT_QNTT						AS SPMT_QNTT
	    		 , PD.SPMT_WGHT						AS SPMT_WGHT
	    		 , SUM(PC.TRSPRT_CST) OVER()		AS TOT_TRSPRT_CST
	    		 , SUM(PD.SPMT_QNTT) OVER()			AS TOT_SPMT_QNTT
	    		 , SUM(PD.SPMT_WGHT) OVER()			AS TOT_SPMT_WGHT
			  FROM
				   TB_SPMT_PRFMNC_COM		PC
				 , TB_SPMT_PRFMNC_DTL		PD
				 , TB_APC_VRTY_CRTR			VC
				 , TB_GDS_INVNTR			GI
				 , TB_CNPT_INFO 			CI
			 WHERE PC.APC_CD = PD.APC_CD
			   AND PC.APC_CD = VC.APC_CD
			   AND PC.APC_CD = GI.APC_CD
			   AND PC.APC_CD = CI.APC_CD
			   AND PC.SPMTNO = PD.SPMTNO
	    	   AND PC.CNPT_CD = CI.CNPT_CD
			   AND PD.VRTY_CD = VC.VRTY_CD
			   AND PD.VRTY_CD = GI.VRTY_CD
			   AND PD.SPCFCT_CD = GI.SPCFCT_CD
			   AND VC.ITEM_CD = GI.ITEM_CD
			   AND PD.PCKGNO = GI.PCKGNO
			   AND PD.PCKG_SN = GI.PCKG_SN
			   AND PD.SPMT_QNTT = GI.SPMT_QNTT
			   AND PD.SPMT_WGHT = GI.SPMT_WGHT
			   AND PC.DEL_YN = 'N'
			   AND PD.DEL_YN = 'N'
			   AND VC.DEL_YN = 'N'
			   AND GI.DEL_YN = 'N'
	    	   AND CI.DEL_YN = 'N'
		]]>
		<if test='apcCd != null and apcCd != ""'>
			   AND PC.APC_CD = #{apcCd}
		</if>
		<if test='spmtYmdFrom != null and spmtYmdFrom != ""'>
		   	   AND PC.SPMT_YMD >= #{spmtYmdFrom}
		</if>
		<if test='spmtYmdTo != null and spmtYmdTo != ""'>
		   	   AND #{spmtYmdTo} >= PC.SPMT_YMD
		</if>
		<if test='cnptNm != null and cnptNm != ""'>
		       AND CI.CNPT_NM LIKE '%' ||  #{cnptNm} || '%'
		</if>
		<if test='trsprtCoCd != null and trsprtCoCd != ""'>
		       AND PC.TRSPRT_CO_CD = #{trsprtCoCd}
		</if>
		<if test='itemCd != null and itemCd != ""'>
		       AND VC.ITEM_CD in (SELECT COL1  FROM TABLE(FN_SYS_SPLIT_STRING(#{itemCd})))
		</if>
		<if test='vrtyNm != null and vrtyNm != ""'>
			   AND PD.VRTY_NM in (SELECT COL1  FROM TABLE(FN_SYS_SPLIT_STRING(#{vrtyNm})))
		</if>
		<if test='warehouseSeCd != null and warehouseSeCd != ""'>
		       AND GI.WAREHOUSE_SE_CD = #{warehouseSeCd}
		</if>
		<if test='dldtn != null and dldtn != ""'>
		       AND PC.DLDTN LIKE '%' ||  #{dldtn} || '%'
		</if>
		<if test='vhclno != null and vhclno != ""'>
		       AND PC.VHCLNO LIKE '%' ||  #{vhclno} || '%'
		</if>
		<![CDATA[
		 	 GROUP BY PC.SPMTNO
	    		 	, PC.SPMT_YMD
	    		 	, PD.PCKGNO
	    		 	, PD.PCKG_SN
	    		 	, PD.BRND_CD
	    		 	, PD.GDS_CD
	    		 	, VC.ITEM_CD
	    		 	, PD.VRTY_CD
	    		 	, PD.SPCFCT_CD
	    		 	, PC.DLDTN
	    		 	, PC.TRSPRT_CO_CD
	    		 	, PC.VHCLNO
	    		 	, PC.TRSPRT_CST
	    		 	, PD.SPMT_QNTT
	    		 	, PD.SPMT_WGHT
	    		 	, PC.CNPT_CD
	    		 	, PC.DEL_YN
	    		 	, CI.CNPT_NM
	    		 	, PC.APC_CD
		]]>
		<!-- Start 페이징 -->
    	<if test='pagingYn != null and pagingYn.equals("Y")'>
    		  ) pt0
			OFFSET (#{currentPageNo} - 1) * #{recordCountPerPage} ROWS
			FETCH FIRST #{recordCountPerPage} ROWS ONLY
    	</if>
    	<if test='pagingYn == null or pagingYn.equals("N")'>
    		  ) pt0
    	</if>
    	<!-- End 페이징 -->
    </select>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.selectSpmtPrfmncDtl	-->
	<!-- DESC : 출하실적 상세 목록 조회.	                         	            -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.21  	김호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectSpmtPrfmncDtl" parameterType="com.at.apcss.am.spmt.vo.SpmtPrfmncVO" resultType="com.at.apcss.am.spmt.vo.SpmtPrfmncVO">
		<![CDATA[
		SELECT  /* com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.selectSpmtPrfmncDtl */
		       PD.APC_CD            AS APC_CD
		     , PD.SPMTNO            AS SPMTNO
		     , PD.PCKGNO            AS PCKGNO
		     , PD.PCKG_SN           AS PCKG_SN
		     , PD.VRTY_CD           AS VRTY_CD
		     , PD.GDS_GRD           AS GDS_GRD
		     , PD.SPCFCT_CD         AS SPCFCT_CD
		     , PD.SPMT_QNTT         AS SPMT_QNTT
		     , PD.SPMT_WGHT         AS SPMT_WGHT
		     , PD.BRND_CD           AS BRND_CD
		     , PD.GDS_CD            AS GDS_CD
		     , PD.PRDCR_CD          AS PRDCR_CD
		     , PD.DEL_YN            AS DEL_YN
		     , PD.SPMT_CMNDNO       AS SPMT_CMNDNO
		     , PD.SPMT_PCKG_UNIT_CD AS SPMT_PCKG_UNIT_CD

		  FROM TB_SPMT_PRFMNC_DTL PD
		 WHERE PD.APC_CD = #{apcCd}
		   AND PD.SPMTNO = #{spmtno}
		]]>
	</select>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.insertSpmtPrfmncCom	-->
	<!-- DESC : 출하실적 공통 등록.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.21  	김호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertSpmtPrfmncCom" parameterType="com.at.apcss.am.spmt.vo.SpmtPrfmncVO">
    	<![CDATA[
    	INSERT INTO TB_SPMT_PRFMNC_COM /* com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.insertSpmtPrfmncCom */
    		(
    			APC_CD
    		  , SPMTNO
    		  ,	SPMT_YMD
    		  , CNPT_CD
    		  ,	TRSPRT_CO_CD
    		  ,	RMRK
    		  ,	VHCLNO
    		  ,	DLDTN
    		  ,	TRSPRT_CST
    		  ,	SPMT_SE_CD
    		  ,	SPMT_PRSN_DCLRNLO
    		  ,	PLOR_CD
    		  , SYS_FRST_INPT_DT
    		  , SYS_FRST_INPT_USER_ID
    		  , SYS_FRST_INPT_PRGRM_ID
    		  , SYS_LAST_CHG_DT
    		  , SYS_LAST_CHG_USER_ID
    		  , SYS_LAST_CHG_PRGRM_ID
    		)
   		VALUES
   			(
   				#{apcCd}
    		  , #{spmtno}
    		  ,	#{spmtYmd}
    		  , #{cnptCd}
    		  ,	#{trsprtCoCd}
    		  ,	#{rmrk}
    		  ,	#{vhclno}
    		  ,	#{dldtn}
    		  ,	#{trsprtCst}
    		  ,	#{spmtSeCd}
    		  ,	#{spmtPrsnDclrnlo}
    		  ,	#{plorCd}
    		  , SYSDATE
    		  , #{sysFrstInptUserId}
    		  , #{sysFrstInptPrgrmId}
    		  , SYSDATE
    		  , #{sysLastChgUserId}
    		  , #{sysLastChgPrgrmId}
   			)
    	]]>
    </insert>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.insertSpmtPrfmncDtl	-->
	<!-- DESC : 출하실적 상세 등록.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.21  	김호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertSpmtPrfmncDtl" parameterType="com.at.apcss.am.spmt.vo.SpmtPrfmncVO">
    	<![CDATA[
    	INSERT INTO TB_SPMT_PRFMNC_DTL /* com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.insertSpmtPrfmncDtl */
    		(
    		    APC_CD
    		  ,	SPMTNO
    		  ,	PCKGNO
    		  ,	PCKG_SN
    		  ,	VRTY_CD
    		  ,	GDS_GRD
    		  ,	SPCFCT_CD
    		  ,	SPMT_QNTT
    		  ,	SPMT_WGHT
    		  ,	BRND_CD
    		  ,	GDS_CD
    		  ,	PRDCR_CD
    		  ,	SPMT_CMNDNO
    		  ,	SPMT_PCKG_UNIT_CD
    		  , OUTORDRNO
    		  , SYS_FRST_INPT_DT
    		  , SYS_FRST_INPT_USER_ID
    		  , SYS_FRST_INPT_PRGRM_ID
    		  , SYS_LAST_CHG_DT
    		  , SYS_LAST_CHG_USER_ID
    		  , SYS_LAST_CHG_PRGRM_ID
    		)
   		VALUES
   			(
   				#{apcCd}
    		  ,	#{spmtno}
    		  ,	#{pckgno}
    		  ,	#{pckgSn}
    		  ,	#{vrtyCd}
    		  ,	#{gdsGrd}
    		  ,	#{spcfctCd}
    		  ,	#{spmtQntt}
    		  ,	#{spmtWght}
    		  ,	#{brndCd}
    		  ,	#{gdsCd}
    		  ,	#{prdcrCd}
    		  ,	#{spmtCmndno}
    		  ,	#{spmtPckgUnitCd}
    		  , #{outordrno}
    		  , SYSDATE
    		  , #{sysFrstInptUserId}
    		  , #{sysFrstInptPrgrmId}
    		  , SYSDATE
    		  , #{sysLastChgUserId}
    		  , #{sysLastChgPrgrmId}
   			)
    	]]>
    </insert>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.deleteSpmtPrfmncCom	-->
	<!-- DESC : 출하실적 공통 삭제.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.21  	김호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<delete id="deleteSpmtPrfmncCom" parameterType="com.at.apcss.am.spmt.vo.SpmtCmndVO">
		<![CDATA[
		UPDATE TB_SPMT_PRFMNC_COM
		   SET SYS_LAST_CHG_DT			= SYSDATE
	    	 , SYS_LAST_CHG_USER_ID		= #{sysLastChgUserId}
	    	 , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
		   	 , DEL_YN 					= 'Y'
		 WHERE APC_CD 	= #{apcCd}
		   AND SPMTNO	= #{spmtno}
		]]>
	</delete>
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.deleteSpmtPrfmncCom	-->
	<!-- DESC : 출하실적 상세 삭제.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.21  	김호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<delete id="deleteSpmtPrfmncDtl" parameterType="com.at.apcss.am.spmt.vo.SpmtCmndVO">
		<![CDATA[
		UPDATE TB_SPMT_PRFMNC_DTL
		   SET SYS_LAST_CHG_DT			= SYSDATE
	    	 , SYS_LAST_CHG_USER_ID		= #{sysLastChgUserId}
	    	 , SYS_LAST_CHG_PRGRM_ID 	= #{sysLastChgPrgrmId}
		   	 , DEL_YN 					= 'Y'
		 WHERE APC_CD 	= #{apcCd}
		   AND SPMTNO	= #{spmtno}
		   AND PCKGNO   = #{pckgno}
		]]>
	</delete>
	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.selectSpmtPrfmnDtlcList-->
	<!-- DESC : 출하실적 등록 내역.	                         	             	 	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.21  	김호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectSpmtPrfmncDtlList" parameterType="com.at.apcss.am.spmt.vo.SpmtPrfmncVO" resultType="com.at.apcss.am.spmt.vo.SpmtPrfmncVO">
		<![CDATA[
		SELECT pt0.*  /* com.at.apcss.am.spmt.mapper.SpmtPrfmncMapper.selectSpmtPrfmnDtlcList */
		     , (SELECT FN_GET_VRTY_NM(pt0.ITEM_CD, pt0.VRTY_CD, pt0.APC_CD) FROM DUAL) AS VRTY_NM
		     , (SELECT FN_GET_SPCFCT_NM(pt0.ITEM_CD, pt0.SPCFCT_CD, pt0.APC_CD) FROM DUAL) AS SPCFCT_NM
		     , (SELECT FN_GET_SPCFCT_NM(pt0.ITEM_CD, pt0.SPCFCT_CD, pt0.APC_CD) FROM DUAL )  AS SPCFCT_NM
		     , (SELECT FN_GET_COM_CD_VL_NM('GDS_GRD', pt0.GDS_GRD) FROM DUAL) AS GDS_GRD_NM
		     , (SELECT FN_GET_SPMT_PCKG_UNIT_NM(pt0.SPMT_PCKG_UNIT_CD, pt0.APC_CD) FROM DUAL)     AS SPMT_PCKG_UNIT_NM
		     , (SELECT FN_GET_CNPT_NM(pt0.CNPT_CD, pt0.APC_CD) FROM DUAL) AS CNPT_NM
		     , (SELECT FN_GET_TRSPRT_CO_NM(pt0.TRSPRT_CO_CD, pt0.APC_CD) FROM DUAL) AS TRSPRT_CO_NM
		 FROM (SELECT PD.APC_CD                 AS APC_CD
				    , PD.SPMTNO                 AS SPMTNO
				    , PC.SPMT_YMD               AS SPMT_YMD
				    , GI.ITEM_CD                AS ITEM_CD
				    , GI.VRTY_CD                AS VRTY_CD
				    , GI.SPCFCT_CD              AS SPCFCT_CD
				    , PD.GDS_GRD                AS GDS_GRD
				    , PD.SPMT_PCKG_UNIT_CD      AS SPMT_PCKG_UNIT_CD
				    , MAX(PC.CNPT_CD)           AS CNPT_CD
				    , MAX(PC.TRSPRT_CO_CD)      AS TRSPRT_CO_CD
				    , MAX(PC.RMRK)              AS RMRK
				    , MAX(PC.DEL_YN)            AS DEL_YN
				    , MAX(PC.VHCLNO)            AS VHCLNO
				    , MAX(PC.DLDTN)             AS DLDTN
				    , MAX(PC.TRSPRT_CST)        AS TRSPRT_CST
				    , MAX(PC.SPMT_SE_CD)        AS SPMT_SE_CD
				    , MAX(PC.SPMT_PRSN_DCLRNLO) AS SPMT_PRSN_DCLRNLO
				    , MAX(PC.PLOR_CD)           AS PLOR_CD
				    , MAX(PD.PCKGNO)            AS PCKGNO
				    , MAX(PD.PCKG_SN)           AS PCKG_SN
				    , MAX(PD.BRND_CD)           AS BRND_CD
				    , MAX(PD.GDS_CD)            AS GDS_CD
				    , MAX(PD.PRDCR_CD)          AS PRDCR_CD
				    , MAX(PD.SPMT_CMNDNO)       AS SPMT_CMNDNO
				    , SUM(PD.SPMT_QNTT) AS SPMT_QNTT
				    , SUM(PD.SPMT_WGHT) AS SPMT_WGHT
			     FROM TB_SPMT_PRFMNC_COM PC
				    , TB_SPMT_PRFMNC_DTL PD
				    , TB_GDS_INVNTR GI
			    WHERE PD.APC_CD = GI.APC_CD
			      AND PD.PCKGNO = GI.PCKGNO
				  AND PC.SPMTNO = PD.SPMTNO
				  AND PC.DEL_YN = 'N'
				  AND PD.DEL_YN = 'N'
				  AND GI.DEL_YN = 'N'
		]]>
		<if test='apcCd != null and apcCd != ""'>
		   	   AND PD.APC_CD = #{apcCd}
		</if>
		<if test='spmtYmd != null and spmtYmd != ""'>
		   	   AND PC.SPMT_YMD = #{spmtYmd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
		   	   AND GI.VRTY_CD = #{vrtyCd}
		</if>
		<![CDATA[
		 		 GROUP BY PD.APC_CD, PD.SPMTNO, PC.SPMT_YMD , GI.VRTY_CD, GI.SPCFCT_CD, PD.GDS_GRD, PD.SPMT_PCKG_UNIT_CD, GI.ITEM_CD
		 	) pt0
		]]>
	</select>

</mapper>


