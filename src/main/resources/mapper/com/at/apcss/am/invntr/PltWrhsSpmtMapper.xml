<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : PltWrhsMapper.xml                                   				-->
<!-- DESC : 입고실적 mapper                                            			-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2023.08.31  	정희운        		Initial Creation                        -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.am.invntr.mapper.PltWrhsSpmtMapper">


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.wrhs.mapper.PltWrhsMapper.selectPltWrhsSpmtList		-->
	<!-- DESC : 팔레트/박스 재고 목록 조회.	                                        -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.22  	김현호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectPltBxMngList" parameterType="com.at.apcss.am.cmns.vo.PltBxVO" resultType="com.at.apcss.am.cmns.vo.PltBxVO">
    	<![CDATA[
			SELECT /* com.at.apcss.am.cmns.mapper.PltBxMapper.selectPltWrhsSpmtList */
					pt0.*
			     , (SELECT FN_GET_COM_CD_VL_NM('PLT_BX_SE_CD', pt0.PLT_BX_SE_CD) FROM DUAL)     AS PLT_BX_SE_NM
			     , (SELECT FN_GET_COM_CD_VL_NM('PLT_CNPT', pt0.RMRK) FROM DUAL)                 AS PLT_CNPT_NM
			     , (BSS_INVNTR_QNTT + NVL(WRHS_QNTT, 0) - NVL(SPMT_QNTT, 0))                    AS YSTD_BSS_INVNTR_QNTT
			  FROM (
			        SELECT
			              PBI.APC_CD                AS APC_CD
			            , PBI.PLT_BX_SE_CD          AS PLT_BX_SE_CD
			            , PBI.PLT_BX_CD             AS PLT_BX_CD
			            , PBI.PLT_BX_NM             AS PLT_BX_NM
			            , PBI.UNIT_WGHT             AS UNIT_WGHT
			            , PBI.USE_YN                AS USE_YN
			            , PBI.DEL_YN                AS DEL_YN
			            , PBI.BSS_INVNTR_QNTT       AS BSS_INVNTR_QNTT
			            , PBI.UNIT_CD               AS UNIT_CD
			            , PBI.RMRK                  AS RMRK
			            , (SELECT SUM(QNTT)
			                 FROM TB_PLT_WRHS_SPMT X
			                WHERE X.APC_CD= PBI.APC_CD
			                  AND X.PLT_BX_SE_CD = PBI.PLT_BX_SE_CD
			                  AND X.PLT_BX_CD = PBI.PLT_BX_CD
			                  AND X.JOB_YMD = TO_CHAR(SYSDATE, 'YYYYMMDD')
			                  AND X.WRHS_SPMT_SE_CD = '1'
			                  AND X.DEL_YN = 'N'
			               ) AS WRHS_QNTT
			            , (SELECT SUM(QNTT)
			                 FROM TB_PLT_WRHS_SPMT X
			                WHERE X.APC_CD = PBI.APC_CD
			                  AND X.PLT_BX_SE_CD = PBI.PLT_BX_SE_CD
			                  AND X.PLT_BX_CD = PBI.PLT_BX_CD
			                  AND X.JOB_YMD = TO_CHAR(SYSDATE, 'YYYYMMDD')
			                  AND X.WRHS_SPMT_SE_CD = '2'
			                  AND X.DEL_YN = 'N'
			              ) AS SPMT_QNTT
			         FROM TB_PLT_BX_INFO PBI
			         WHERE 1=1
         ]]>
		         <if test='apcCd != null and apcCd != ""'>
				    	AND APC_CD 					= #{apcCd}
				</if>
		<![CDATA[
      			) pt0
		]]>
    </select>
    
    
    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.wrhs.mapper.PltWrhsMapper.insertPltWrhsSpmt			-->
	<!-- DESC : 팔레트/박스 입출 내역 등록.	                                       	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.22  	김현호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertPltWrhsSpmt" parameterType="com.at.apcss.am.invntr.vo.PltWrhsSpmtVO">
    	<![CDATA[
	    	INSERT /* com.at.apcss.am.cmns.mapper.PltBxMapper.insertPltWrhsSpmt */
	    		INTO TB_PLT_WRHS_SPMT
	    		(
					APC_CD
					, JOB_YMD
					, WRHS_SPMT_SE_CD
					, PLT_BX_SE_CD
					, PLT_BX_CD
					, PRDCR_CD
					, SN
					, PLT_NM
					, UNIT_WGHT
					, QNTT
					, RMRK
					, DEL_YN
					, WRHS_SPMT_TYPE
					, PRCSNO
					, PRCS_SN
					, SYS_FRST_INPT_DT
					, SYS_FRST_INPT_USER_ID
					, SYS_FRST_INPT_PRGRM_ID
					, SYS_LAST_CHG_DT
					, SYS_LAST_CHG_USER_ID
					, SYS_LAST_CHG_PRGRM_ID
				)
				VALUES
				(
					#{apcCd}
					, #{jobYmd}
					, #{wrhsSpmtSeCd}
					, #{pltBxSeCd}
					, #{pltBxCd}
					, #{prdcrCd}
					, (SELECT FN_GET_WRHS_SPMT_SN(
						#{apcCd},
						#{jobYmd}
						) FROM
						DUAL)
					, #{pltNm}
					, #{unitWght}
					, #{qntt}
					, #{rmrk}
					, #{delYn}
					, #{wrhsSpmtType}
					, #{prcsno}
					, #{prcsSn}
					, SYSDATE
					, #{sysFrstInptUserId}
					, #{sysFrstInptPrgrmId}
					, SYSDATE
					, #{sysLastChgUserId}
					, #{sysLastChgPrgrmId}
				)
    	]]>
    </insert>
    
   	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.wrhs.mapper.PltWrhsMapper.selectPltWrhsSpmtList		-->
	<!-- DESC : 팔레트/박스 입출 목록 조회.	                                       	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.11.22  	김현호        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectPltWrhsSpmtList" parameterType="com.at.apcss.am.invntr.vo.PltWrhsSpmtVO" resultType="com.at.apcss.am.invntr.vo.PltWrhsSpmtVO">
		<![CDATA[
			  SELECT pt0.*
				 , (SELECT FN_GET_COM_CD_VL_NM('PLT_BX_SE_CD', pt0.PLT_BX_SE_CD) FROM DUAL) AS PLT_BX_SE_NM
			     , (SELECT FN_GET_COM_CD_VL_NM('WRHS_SPMT_SE_CD', pt0.WRHS_SPMT_SE_CD) FROM DUAL) AS WRHS_SPMT_SE_NM
			     , (SELECT FN_GET_COM_CD_VL_NM('WRHS_SPMT_TYPE', pt0.WRHS_SPMT_TYPE) FROM DUAL) AS WRHS_SPMT_TYPE_NM
			     , (SELECT FN_GET_COM_CD_VL_NM('PLT_CNPT', pt0.PLT_CNPT_CD) FROM DUAL)                  AS PLT_CNPT_NM
			     , (SELECT FN_GET_PRDCR_NM(pt0.PRDCR_CD, pt0.APC_CD) FROM DUAL) AS PRDCR_NM
			  FROM (
			        SELECT /* com.at.apcss.am.wrhs.mapper.PltWrhsMapper.selectPltWrhsSpmtList */
			               PWS.APC_CD               AS APC_CD
			             , PWS.JOB_YMD              AS JOB_YMD
			             , PWS.WRHS_SPMT_SE_CD      AS WRHS_SPMT_SE_CD
			             , PWS.PLT_BX_SE_CD         AS PLT_BX_SE_CD
			             , PWS.PLT_BX_CD            AS PLT_BX_CD
			             , PWS.PRDCR_CD             AS PRDCR_CD
			             , PWS.PLT_NM               AS PLT_NM
			             , PWS.RMRK                 AS RMRK
			             , PWS.SN                   AS SN
			             , PWS.UNIT_WGHT            AS UNIT_WGHT
			             , PWS.QNTT                 AS QNTT
			             , PWS.PRCSNO               AS PRCSNO
			             , PWS.PRCS_SN              AS PRCS_SN
			             , PWS.WRHS_SPMT_TYPE       AS WRHS_SPMT_TYPE
			             , (SELECT RMRK
			                  FROM TB_PLT_BX_INFO X
			                 WHERE X.APC_CD = PWS.APC_CD
			                   AND X.DEL_YN = 'N'
			                   AND X.PLT_BX_SE_CD = PWS.PLT_BX_SE_CD
			                   AND X.PLT_BX_CD = PWS.PLT_BX_CD
			              ) AS PLT_CNPT_CD
			          FROM TB_PLT_WRHS_SPMT PWS
			         WHERE PWS.DEL_YN = 'N'
		]]>
        <if test='apcCd != null and apcCd != ""'>
				    	AND PWS.APC_CD 					= #{apcCd}
		</if>
		<![CDATA[
			        ) pt0
		]]>
    </select>
    
    
    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.wrhs.mapper.PltWrhsMapper.deletePltWrhsSpmt			-->
	<!-- DESC : 팔레트/박스 입출 목록 삭제.	                         	            -->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2023.08.16  	하민우        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<delete id="deletePltWrhsSpmt" parameterType="com.at.apcss.am.invntr.vo.PltWrhsSpmtVO">
		<![CDATA[
		DELETE FROM TB_PLT_WRHS_SPMT
		 WHERE APC_CD 						= #{apcCd}
		   AND JOB_YMD 						= #{jobYmd}
		   AND WRHS_SPMT_SE_CD 				= #{wrhsSpmtSeCd}
		   AND PLT_BX_SE_CD 				= #{pltBxSeCd}
		   AND PLT_BX_CD 					= #{pltBxCd}
		   AND SEQ_NO 						= #{seqNo}
		]]>
		<if test='prdcrCd != null and prdcrCd != ""'>
		   AND PRDCR_CD 					= #{prdcrCd}
		</if>
	</delete>
</mapper>