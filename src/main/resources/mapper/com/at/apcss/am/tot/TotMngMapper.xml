<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : asstMapper.xml                                   			-->
<!-- DESC : 집계 mapper                                             	-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2024.10.08  	박승진       Initial Creation                            -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.am.tot.mapper.TotMngMapper">

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectCrtr  				-->
	<!-- DESC : 집계 기준 단건 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectCrtr" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO" resultType="com.at.apcss.am.tot.vo.TotCrtrVO">
		<![CDATA[
	    	SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectCrtr */
				C.APC_CD			AS APC_CD
				 , C.TOT_CRTR_TYPE	AS TOT_CRTR_TYPE
				 , C.CRTR_CD		AS CRTR_CD
				 , C.CRTR_VL		AS CRTR_VL
				 , C.CRTR_INDCT_NM	AS CRTR_INDCT_NM
	    	     , C.TOT_DTL_TYPE	AS TOT_DTL_TYPE
				 , C.INDCT_SEQ		AS INDCT_SEQ
				 , C.USE_YN			AS USE_YN
				 , C.DEL_YN			AS DEL_YN

				 , (
				SELECT MAX(X.DTL_SN)
				FROM TB_TOT_CRTR_DTL X
				WHERE X.APC_CD = C.APC_CD
				  AND X.TOT_CRTR_TYPE = C.TOT_CRTR_TYPE
				  AND X.CRTR_CD = C.CRTR_CD
			)	AS MAX_DTL_SN

			FROM TB_TOT_CRTR C

			WHERE C.APC_CD = #{apcCd}
			  AND C.TOT_CRTR_TYPE = #{totCrtrType}
			  AND C.CRTR_CD = #{crtrCd}
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectCrtrList  				-->
	<!-- DESC : 집계 기준 목록 조회.                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectCrtrList" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO" resultType="com.at.apcss.am.tot.vo.TotCrtrVO">
		<![CDATA[
      		SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectCrtrList */

				  C.APC_CD				AS APC_CD
				, C.TOT_CRTR_TYPE	  	AS TOT_CRTR_TYPE
				, CT.CD_VL_NM			AS TOT_CRTR_TYPE_NM
				, CT.INDCT_SEQ			AS CRTR_TYPE_SEQ
				, C.CRTR_CD			    AS CRTR_CD
				, C.CRTR_VL			    AS CRTR_VL
        		, C.TOT_DTL_TYPE    	AS TOT_DTL_TYPE
				, C.CRTR_INDCT_NM		AS CRTR_INDCT_NM
				, C.INDCT_SEQ			AS INDCT_SEQ
				, C.INDCT_SEQ			AS CRTR_SEQ
				, C.USE_YN				AS USE_YN
      			, CC.CD_CHR_VL			AS TOT_CRTR_CHR_VL

			  FROM TB_TOT_CRTR C

			  JOIN TB_COM_CD_DTL CT
			    ON CT.CD_ID = 'TOT_CRTR_TYPE'
			   AND CT.APC_CD = '0000'
			   AND CT.CD_VL = C.TOT_CRTR_TYPE
			   AND CT.DEL_YN = 'N'

			  JOIN TB_COM_CD_DTL CC
			    ON CC.CD_ID = 'TOT_CRTR_CD'
			   AND CC.APC_CD = '0000'
			   AND CC.CD_VL = C.CRTR_CD
			   AND CC.DEL_YN = 'N'

			 WHERE C.DEL_YN = 'N'
		]]>

		<if test='apcCd != null and apcCd != ""'>
			AND C.APC_CD = #{apcCd}
		</if>

		<if test='totCrtrType != null and totCrtrType != ""'>
			AND C.TOT_CRTR_TYPE = #{totCrtrType}
		</if>

		<if test='crtrCd != null and crtrCd != ""'>
			AND C.CRTR_CD = #{crtrCd}
		</if>

		<if test='crtrIndctNm != null and crtrIndctNm != ""'>
			AND C.CRTR_INDCT_NM LIKE '%' || #{crtrIndctNm} || '%'
		</if>

		<if test='useYn != null and useYn != ""'>
			AND C.USE_YN = #{useYn}
		</if>

		<![CDATA[
			 ORDER BY CRTR_TYPE_SEQ, CRTR_SEQ
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectCrtrDtl  				-->
	<!-- DESC : 집계 기준 상세 단건 조회.                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectCrtrDtl" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO" resultType="com.at.apcss.am.tot.vo.TotCrtrVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectCrtrDtl */
				CD.APC_CD				    AS APC_CD
				 , CD.TOT_CRTR_TYPE		AS TOT_CRTR_TYPE
				 , CD.CRTR_CD			  AS CRTR_CD
				 , CD.DTL_SN				AS DTL_SN
				 , CD.DTL_CD				AS DTL_CD
				 , CD.DTL_VL				AS DTL_VL
				 , CD.DTL_INDCT_NM	AS DTL_INDCT_NM
				 , CD.TOT_DTL_PRCS_CD AS TOT_DTL_PRCS_CD
				 , CD.USE_YN				AS USE_YN
				 , CD.DEL_YN				AS DEL_YN

			FROM TB_TOT_CRTR_DTL CD

			WHERE CD.APC_CD = #{apcCd}
			  AND CD.TOT_CRTR_TYPE = #{totCrtrType}
			  AND CD.CRTR_CD = #{crtrCd}
			  AND CD.DTL_SN = #{dtlSn}
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectCrtrDtlList  				-->
	<!-- DESC : 집계 기준 상세 목록 조회.                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectCrtrDtlList" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO" resultType="com.at.apcss.am.tot.vo.TotCrtrVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectCrtrDtlList */
				  C.APC_CD				  AS APC_CD
				, C.TOT_CRTR_TYPE	AS TOT_CRTR_TYPE
				, CT.CD_VL_NM			  AS TOT_CRTR_TYPE_NM
				, CT.INDCT_SEQ			AS CRTR_TYPE_SEQ
				, C.CRTR_CD			  AS CRTR_CD
				, C.CRTR_VL			  AS CRTR_VL
				, C.CRTR_INDCT_NM	AS CRTR_INDCT_NM
        		, C.TOT_DTL_TYPE   AS TOT_DTL_TYPE
				, C.INDCT_SEQ			AS CRTR_SEQ
				, C.USE_YN				  AS CRTR_USE_YN
      			, CC.CD_CHR_VL			AS TOT_CRTR_CHR_VL
				, CD.DTL_SN				  AS DTL_SN
				, CD.DTL_CD				  AS DTL_CD
				, CD.DTL_VL				  AS DTL_VL
				, CD.DTL_INDCT_NM		AS DTL_INDCT_NM
        		, CD.TOT_DTL_PRCS_CD  AS TOT_DTL_PRCS_CD
				, CD.USE_YN				  AS CRTR_DTL_USE_YN
				, CD.INDCT_SEQ			AS INDCT_SEQ
				, CD.INDCT_SEQ			AS CRTR_DTL_SEQ
				, CD.USE_YN				  AS USE_YN

			  FROM TB_TOT_CRTR C

			  JOIN TB_COM_CD_DTL CT
			    ON CT.CD_ID = 'TOT_CRTR_TYPE'
			   AND CT.APC_CD = '0000'
			   AND CT.CD_VL = C.TOT_CRTR_TYPE
			   AND CT.DEL_YN = 'N'

			  JOIN TB_COM_CD_DTL CC
			    ON CC.CD_ID = 'TOT_CRTR_CD'
			   AND CC.APC_CD = '0000'
			   AND CC.CD_VL = C.CRTR_CD
			   AND CC.DEL_YN = 'N'

			  JOIN TB_TOT_CRTR_DTL CD
			    ON CD.APC_CD = C.APC_CD
			   AND CD.TOT_CRTR_TYPE = C.TOT_CRTR_TYPE
			   AND CD.CRTR_CD = C.CRTR_CD
			   AND CD.DEL_YN = 'N'

			 WHERE C.DEL_YN = 'N'
		]]>

		<if test='apcCd != null and apcCd != ""'>
			AND C.APC_CD = #{apcCd}
		</if>

		<if test='totCrtrType != null and totCrtrType != ""'>
			AND C.TOT_CRTR_TYPE = #{totCrtrType}
		</if>

		<if test='crtrCd != null and crtrCd != ""'>
			AND C.CRTR_CD = #{crtrCd}
		</if>

		<if test='crtrUseYn != null and crtrUseYn != ""'>
			AND C.USE_YN = #{crtrUseYn}
		</if>

		<if test='crtrDtlUseYn != null and crtrDtlUseYn != ""'>
			AND CD.USE_YN = #{crtrDtlUseYn}
		</if>

		<![CDATA[
			 ORDER BY CRTR_TYPE_SEQ, CRTR_SEQ, CRTR_DTL_SEQ, DTL_SN
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.insertCrtr  				-->
	<!-- DESC : 집계 기준 등록.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<insert id="insertCrtr" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO">
    	<![CDATA[
		INSERT /* com.at.apcss.am.tot.mapper.TotMngMapper.insertCrtr */
		INTO TB_TOT_CRTR (
						   APC_CD
						 , TOT_CRTR_TYPE
						 , CRTR_CD
						 , CRTR_VL
						 , CRTR_INDCT_NM
						 , TOT_DTL_TYPE
						 , INDCT_SEQ
						 , USE_YN
						 , DEL_YN
						 , SYS_FRST_INPT_DT
						 , SYS_FRST_INPT_USER_ID
						 , SYS_FRST_INPT_PRGRM_ID
						 , SYS_LAST_CHG_DT
						 , SYS_LAST_CHG_USER_ID
						 , SYS_LAST_CHG_PRGRM_ID
		) VALUES (

					 #{apcCd}
				 , #{totCrtrType}
				 , #{crtrCd}
				 , #{crtrVl}
				 , #{crtrIndctNm}
				 , #{totDtlType}
				 , #{indctSeq}
				 , #{useYn}
				 , 'N'
				 , SYSDATE
				 , #{sysFrstInptUserId}
				 , #{sysFrstInptPrgrmId}
				 , SYSDATE
				 , #{sysLastChgUserId}
				 , #{sysLastChgPrgrmId}
				 )
		]]>
    </insert>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.updateCrtr  	-->
	<!-- DESC : 집계 기준 수정.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<update id="updateCrtr" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO">
    	<![CDATA[
		UPDATE /* com.at.apcss.am.tot.mapper.TotMngMapper.updateCrtr */
			TB_TOT_CRTR
		SET
			CRTR_VL = #{crtrVl}
		  , CRTR_INDCT_NM = #{crtrIndctNm}
		  , TOT_DTL_TYPE = #{totDtlType}
		  , INDCT_SEQ = #{indctSeq}
		  , USE_YN = #{useYn}
		  , SYS_LAST_CHG_DT = SYSDATE
		  , SYS_LAST_CHG_USER_ID = #{sysLastChgUserId}
		  , SYS_LAST_CHG_PRGRM_ID = #{sysLastChgPrgrmId}
		WHERE APC_CD = #{apcCd}
		  AND TOT_CRTR_TYPE = #{totCrtrType}
		  AND CRTR_CD = #{crtrCd}
		]]>
    </update>

	<!-- ==========================================================================	-->
	<!-- com.at.apcss.am.tot.mapper.TotMngMapper.deleteCrtr				-->
	<!-- DESC : 집계기준정보 삭제.	                                       					-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.24  	박승진        		Initial Creation                        -->
	<!-- ==========================================================================	-->
	<delete id="deleteCrtr" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO">
		<![CDATA[
		DELETE /* com.at.apcss.am.tot.mapper.TotMngMapper.deleteCrtr */
		FROM TB_TOT_CRTR
		WHERE APC_CD = #{apcCd}
		  AND TOT_CRTR_TYPE = #{totCrtrType}
		  AND CRTR_CD = #{crtrCd}
		]]>
	</delete>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.insertCrtrDtl  				-->
	<!-- DESC : 집계 기준 상세 등록.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<insert id="insertCrtrDtl" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO">
    	<![CDATA[
		INSERT /* com.at.apcss.am.tot.mapper.TotMngMapper.insertCrtrDtl */
		INTO TB_TOT_CRTR_DTL (
							   APC_CD
							 , TOT_CRTR_TYPE
							 , CRTR_CD
							 , DTL_SN
							 , DTL_CD
							 , DTL_VL
							 , DTL_INDCT_NM
							 , TOT_DTL_PRCS_CD
							 , INDCT_SEQ
							 , USE_YN
							 , DEL_YN
							 , SYS_FRST_INPT_DT
							 , SYS_FRST_INPT_USER_ID
							 , SYS_FRST_INPT_PRGRM_ID
							 , SYS_LAST_CHG_DT
							 , SYS_LAST_CHG_USER_ID
							 , SYS_LAST_CHG_PRGRM_ID


		) VALUES (
					 #{apcCd}
				 , #{totCrtrType}
				 , #{crtrCd}
				 , #{dtlSn}
				 , #{dtlCd}
				 , #{dtlVl}
				 , #{dtlIndctNm}
				 , #{totDtlPrcsCd}
				 , #{indctSeq}
				 , #{useYn}
				 , 'N'
				 , SYSDATE
				 , #{sysFrstInptUserId}
				 , #{sysFrstInptPrgrmId}
				 , SYSDATE
				 , #{sysLastChgUserId}
				 , #{sysLastChgPrgrmId}
				 )
		]]>
    </insert>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.updateCrtrDtl  				-->
	<!-- DESC : 집계 기준 상세 수정.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<update id="updateCrtrDtl" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO">
    	<![CDATA[
		UPDATE /* com.at.apcss.am.tot.mapper.TotMngMapper.updateCrtrDtl */
			TB_TOT_CRTR_DTL
		SET
			DTL_CD = #{dtlCd}
		  , DTL_VL = #{dtlVl}
		  , DTL_INDCT_NM = #{dtlIndctNm}
		  , TOT_DTL_PRCS_CD = #{totDtlPrcsCd}
		  , INDCT_SEQ = #{indctSeq}
		  , USE_YN = #{useYn}
		  , SYS_LAST_CHG_DT = SYSDATE
		  , SYS_LAST_CHG_USER_ID = #{sysLastChgUserId}
		  , SYS_LAST_CHG_PRGRM_ID = #{sysLastChgPrgrmId}
		WHERE APC_CD = #{apcCd}
		  AND TOT_CRTR_TYPE = #{totCrtrType}
		  AND CRTR_CD = #{crtrCd}
		  AND DTL_SN = #{dtlSn}
		]]>
    </update>

	<!-- ==========================================================================	-->
	<!-- com.at.apcss.am.tot.mapper.TotMngMapper.deleteCrtrDtl						-->
	<!-- DESC : 집계기준 상세 삭제.	                                       			-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.24  	박승진        		Initial Creation                        -->
	<!-- ==========================================================================	-->
	<delete id="deleteCrtrDtl" parameterType="com.at.apcss.am.tot.vo.TotCrtrVO">
		<![CDATA[
		DELETE /* com.at.apcss.am.tot.mapper.TotMngMapper.deleteCrtrDtl */
		FROM TB_TOT_CRTR_DTL
		WHERE APC_CD = #{apcCd}
		  AND TOT_CRTR_TYPE = #{totCrtrType}
		  AND CRTR_CD = #{crtrCd}
		  AND DTL_SN = #{dtlSn}
		]]>
	</delete>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectLatestTotRsltMst  	-->
	<!-- DESC : 집계결과 최신 마스터정보 조회                                          	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectLatestTotRsltMst" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectLatestTotRsltMst */
				  MAX(RM.TOT_YMD)			AS TOT_YMD
				, MAX(RM.TOT_SN) KEEP (DENSE_RANK LAST ORDER BY RM.TOT_YMD NULLS FIRST, RM.TOT_SN)	AS TOT_SN
			  FROM TB_TOT_RSLT_MST RM
			 WHERE RM.APC_CD = #{apcCd}
			   AND RM.TOT_CRTR_TYPE = #{totCrtrType}
			   AND RM.TOT_YMD <= #{crtrYmd}
			   AND EXISTS (
					SELECT 1
					  FROM TB_TOT_RSLT_DTL X
					 WHERE X.APC_CD = RM.APC_CD
					   AND X.TOT_CRTR_TYPE = RM.TOT_CRTR_TYPE
					   AND X.TOT_YMD = RM.TOT_YMD
					   AND X.TOT_SN = RM.TOT_SN
					   AND X.CRTR_CD = 'TOT_TERM_KND'
					   AND X.DTL_CD = #{termKndCd}
					   AND X.DEL_YN = 'N'
				)
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectTotRsltTermList  		-->
	<!-- DESC : 집계기간 표시명 목록 조회                                          		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTotRsltTermList" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectTotRsltTermList */
				TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF), 'YYYYMM')				AS COL_MM
				 , TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF), 'YYYY')				AS COL_MM_YEAR
				 , TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF), 'FMMM')				AS COL_MM_MONTH
				 , TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF * 12), 'YYYY')			AS COL_YY
				 , TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF *3), 'Q'), 2, '0')				AS COL_QY
				 , TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF *3), 'YYYY')			AS COL_QY_YEAR
				 , TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF *3), 'Q')				AS COL_QY_MONTH
				 , TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF *6), 'Q') / 2), 2, '0')	AS COL_HY
				 , TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF *6), 'YYYY')			AS COL_HY_YEAR
				 , CEIL(TO_CHAR(ADD_MONTHS(DL.DT, DL.DIFF *6), 'Q') / 2)	AS COL_HY_MONTH
			FROM (
				SELECT
					(LEVEL - 1) * -1 AS DIFF
					 , TO_DATE(#{totYmd}, 'YYYYMMDD')	AS DT
				FROM DUAL
					CONNECT BY LEVEL <= 12
			) DL
		]]>
	</select>



	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectTotRawMtrWrhsList  	-->
	<!-- DESC : 집계조회 - 원물입고.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTotRawMtrWrhsList" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectTotRawMtrWrhsList */
			      RS.APC_CD			AS APC_CD
				, RS.PRDCR_CD		AS PRDCR_CD
				, RS.ITEM_CD		AS ITEM_CD
				, RS.VRTY_CD		AS VRTY_CD
				, RS.GRD_CD			AS GRD_CD
				, RS.SPCFCT_CD		AS SPCFCT_CD
    			, (SELECT FN_GET_PRDCR_NM(RS.PRDCR_CD, RS.APC_CD) FROM DUAL) AS PRDCR_NM
                , (SELECT FN_GET_ITEM_NM(RS.ITEM_CD, RS.APC_CD) FROM DUAL) AS ITEM_NM
                , (SELECT FN_GET_VRTY_NM(RS.ITEM_CD, RS.VRTY_CD, RS.APC_CD) FROM DUAL) AS VRTY_NM
                , (SELECT FN_GET_SPCFCT_NM(RS.ITEM_CD, RS.SPCFCT_CD, RS.APC_CD) FROM DUAL) AS SPCFCT_NM
    			, (SELECT FN_GET_GRD_NM_RAWMTR(RS.APC_CD, RS.ITEM_CD, RS.GRD_CD) FROM DUAL) AS GRD_NM
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_0 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_0
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_1 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_1
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_2 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_2
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_3 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_3
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_4 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_4
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_5 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_5
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_6 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_6
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_7 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_7
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_8 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_8
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_9 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_9
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_10 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_10
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_11 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_11
				, SUM(RS.TOT_WGHT)		AS TOT_WGHT

				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_0 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_0
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_1 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_1
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_2 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_2
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_3 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_3
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_4 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_4
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_5 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_5
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_6 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_6
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_7 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_7
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_8 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_8
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_9 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_9
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_10 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_10
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_11 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_11
				, SUM(RS.TOT_QNTT)		AS TOT_QNTT
			  FROM (
				SELECT
					  DL.APC_CD			AS APC_CD
					, DL.TOT_YMD		AS TOT_YMD
					, DL.TOT_SN			AS TOT_SN
			]]>
		<choose>
			<when test='termKndCd != null and termKndCd =="MM"'>
				-- 월별
				, TO_CHAR(DL.DT, 'YYYYMM')							AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')			AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')			AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')			AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')			AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')			AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')			AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')			AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')			AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')			AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')			AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')			AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="YY"'>
				-- 연별
				, TO_CHAR(DL.DT, 'YYYY')							AS T_0
				, TO_CHAR(DL.DT - (INTERVAL '1' YEAR), 'YYYY')		AS T_1
				, TO_CHAR(DL.DT - (INTERVAL '2' YEAR), 'YYYY')		AS T_2
				, TO_CHAR(DL.DT - (INTERVAL '3' YEAR), 'YYYY')		AS T_3
				, TO_CHAR(DL.DT - (INTERVAL '4' YEAR), 'YYYY')		AS T_4
				, TO_CHAR(DL.DT - (INTERVAL '5' YEAR), 'YYYY')		AS T_5
				, TO_CHAR(DL.DT - (INTERVAL '6' YEAR), 'YYYY')		AS T_6
				, TO_CHAR(DL.DT - (INTERVAL '7' YEAR), 'YYYY')		AS T_7
				, TO_CHAR(DL.DT - (INTERVAL '8' YEAR), 'YYYY')		AS T_8
				, TO_CHAR(DL.DT - (INTERVAL '9' YEAR), 'YYYY')		AS T_9
				, TO_CHAR(DL.DT - (INTERVAL '10' YEAR), 'YYYY')		AS T_10
				, TO_CHAR(DL.DT - (INTERVAL '11' YEAR), 'YYYY')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="HY"'>
				-- 반기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(CEIL(TO_CHAR(DL.DT, 'Q') / 2), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'Q') / 2), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'Q') / 2), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'Q') / 2), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'Q') / 2), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'Q') / 2), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'Q') / 2), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'Q') / 2), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'Q') / 2), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'Q') / 2), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'Q') / 2), 2, '0')		AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'Q') / 2), 2, '0')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="QY"'>
				-- 분기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(TO_CHAR(DL.DT, 'Q'), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'Q'), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'Q'), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'Q'), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'Q'), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'Q'), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'Q'), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'Q'), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'Q'), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'Q'), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'Q'), 2, '0')	AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'Q'), 2, '0')	AS T_11
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<![CDATA[
					, T.DTL_SN			AS DTL_SN
					, T.WRHS_YMD		AS WRHS_YMD
					, T.PRDCR_CD		AS PRDCR_CD
					, T.ITEM_CD			AS ITEM_CD
					, T.VRTY_CD			AS VRTY_CD
					, T.GRD_CD			AS GRD_CD
					, T.SPCFCT_CD		AS SPCFCT_CD
					, T.GDS_SE_CD		AS GDS_SE_CD
					, T.WRHS_SE_CD		AS WRHS_SE_CD
					, T.WAREHOUSE_SE_CD	AS WAREHOUSE_SE_CD
					, T.TOT_QNTT		AS TOT_QNTT
					, T.TOT_WGHT		AS TOT_WGHT
				  FROM (
					SELECT
						  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
						, #{apcCd}	AS APC_CD
						, #{totYmd}	AS TOT_YMD
						, #{totSn}	AS TOT_SN
					  FROM DUAL
				  ) DL
				LEFT JOIN TB_TOT_RAW_MTR_WRHS T
				  ON T.APC_CD = DL.APC_CD
				 AND T.TOT_YMD = DL.TOT_YMD
				 AND T.TOT_SN = DL.TOT_SN
				 AND T.DEL_YN = 'N'
			) RS
		 WHERE 1=1
		]]>

		<if test='itemCd != null and itemCd != ""'>
			AND RS.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
			AND RS.VRTY_CD = #{vrtyCd}
		</if>

		<![CDATA[
		 GROUP BY
		 	RS.APC_CD
		 	, RS.PRDCR_CD
			, RS.ITEM_CD
			, RS.VRTY_CD
			, RS.GRD_CD
			, RS.SPCFCT_CD
		 ORDER BY
		 	  ITEM_CD
			, VRTY_CD
			, PRDCR_CD
			, GRD_CD
			, SPCFCT_CD
		]]>
	</select>




	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectTotSortPrfmncList  	-->
	<!-- DESC : 집계조회 - 선별실적.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTotSortPrfmncList" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectTotSortPrfmncList */
			      RS.APC_CD			AS APC_CD
				, RS.PRDCR_CD		AS PRDCR_CD
				, RS.ITEM_CD		AS ITEM_CD
				, RS.VRTY_CD		AS VRTY_CD
				, RS.GRD_CD			AS GRD_CD
				, RS.SPCFCT_CD		AS SPCFCT_CD
    			, (SELECT FN_GET_PRDCR_NM(RS.PRDCR_CD, RS.APC_CD) FROM DUAL) AS PRDCR_NM
                , (SELECT FN_GET_ITEM_NM(RS.ITEM_CD, RS.APC_CD) FROM DUAL) AS ITEM_NM
                , (SELECT FN_GET_VRTY_NM(RS.ITEM_CD, RS.VRTY_CD, RS.APC_CD) FROM DUAL) AS VRTY_NM
                , (SELECT FN_GET_SPCFCT_NM(RS.ITEM_CD, RS.SPCFCT_CD, RS.APC_CD) FROM DUAL) AS SPCFCT_NM
    			, (SELECT FN_GET_GRD_NM_SORT(RS.APC_CD, RS.ITEM_CD, RS.GRD_CD) FROM DUAL) AS GRD_NM

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_11
				, SUM(RS.TOT_WGHT)		AS TOT_WGHT

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_11
				, SUM(RS.TOT_QNTT)		AS TOT_QNTT
			  FROM (
				SELECT
					  DL.APC_CD			AS APC_CD
					, DL.TOT_YMD		AS TOT_YMD
					, DL.TOT_SN			AS TOT_SN
			]]>
		<choose>
			<when test='termKndCd != null and termKndCd =="MM"'>
				-- 월별
				, TO_CHAR(DL.DT, 'YYYYMM')							AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')			AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')			AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')			AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')			AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')			AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')			AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')			AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')			AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')			AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')			AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')			AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="YY"'>
				-- 연별
				, TO_CHAR(DL.DT, 'YYYY')							AS T_0
				, TO_CHAR(DL.DT - (INTERVAL '1' YEAR), 'YYYY')		AS T_1
				, TO_CHAR(DL.DT - (INTERVAL '2' YEAR), 'YYYY')		AS T_2
				, TO_CHAR(DL.DT - (INTERVAL '3' YEAR), 'YYYY')		AS T_3
				, TO_CHAR(DL.DT - (INTERVAL '4' YEAR), 'YYYY')		AS T_4
				, TO_CHAR(DL.DT - (INTERVAL '5' YEAR), 'YYYY')		AS T_5
				, TO_CHAR(DL.DT - (INTERVAL '6' YEAR), 'YYYY')		AS T_6
				, TO_CHAR(DL.DT - (INTERVAL '7' YEAR), 'YYYY')		AS T_7
				, TO_CHAR(DL.DT - (INTERVAL '8' YEAR), 'YYYY')		AS T_8
				, TO_CHAR(DL.DT - (INTERVAL '9' YEAR), 'YYYY')		AS T_9
				, TO_CHAR(DL.DT - (INTERVAL '10' YEAR), 'YYYY')		AS T_10
				, TO_CHAR(DL.DT - (INTERVAL '11' YEAR), 'YYYY')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="HY"'>
				-- 반기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(CEIL(TO_CHAR(DL.DT, 'Q') / 2), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'Q') / 2), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'Q') / 2), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'Q') / 2), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'Q') / 2), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'Q') / 2), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'Q') / 2), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'Q') / 2), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'Q') / 2), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'Q') / 2), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'Q') / 2), 2, '0')		AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'Q') / 2), 2, '0')		AS T_11

			</when>
			<when test='termKndCd != null and termKndCd =="QY"'>
				-- 분기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(TO_CHAR(DL.DT, 'Q'), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'Q'), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'Q'), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'Q'), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'Q'), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'Q'), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'Q'), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'Q'), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'Q'), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'Q'), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'Q'), 2, '0')	AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'Q'), 2, '0')	AS T_11
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<![CDATA[
					, T.DTL_SN			AS DTL_SN
					, T.SORT_YMD		AS RSLT_YMD
					, T.PRDCR_CD		AS PRDCR_CD
					, T.ITEM_CD			AS ITEM_CD
					, T.VRTY_CD			AS VRTY_CD
					, T.GRD_CD			AS GRD_CD
					, T.SPCFCT_CD		AS SPCFCT_CD
					, T.GDS_SE_CD		AS GDS_SE_CD
					, T.WRHS_SE_CD		AS WRHS_SE_CD
					, T.WAREHOUSE_SE_CD	AS WAREHOUSE_SE_CD
					, T.TOT_QNTT		AS TOT_QNTT
					, T.TOT_WGHT		AS TOT_WGHT
				  FROM (
					SELECT
						  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
						, #{apcCd}	AS APC_CD
						, #{totYmd}	AS TOT_YMD
						, #{totSn}	AS TOT_SN
					  FROM DUAL
				  ) DL
				LEFT JOIN TB_TOT_SORT_PRFMNC T
				  ON T.APC_CD = DL.APC_CD
				 AND T.TOT_YMD = DL.TOT_YMD
				 AND T.TOT_SN = DL.TOT_SN
				 AND T.DEL_YN = 'N'
			) RS
		 WHERE 1=1
		]]>

		<if test='itemCd != null and itemCd != ""'>
			AND RS.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
			AND RS.VRTY_CD = #{vrtyCd}
		</if>

		<![CDATA[
		 GROUP BY
		 	RS.APC_CD
		 	, RS.PRDCR_CD
			, RS.ITEM_CD
			, RS.VRTY_CD
			, RS.SPCFCT_CD
			, RS.GRD_CD
		 ORDER BY
		 	  PRDCR_CD
			, ITEM_CD
			, VRTY_CD
			, SPCFCT_CD
			, GRD_CD
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectTotPckgPrfmncList  	-->
	<!-- DESC : 집계조회 - 포장실적.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTotPckgPrfmncList" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectTotPckgPrfmncList */
			      RS.APC_CD			AS APC_CD
				, RS.PRDCR_CD		AS PRDCR_CD
				, RS.ITEM_CD		AS ITEM_CD
				, RS.VRTY_CD		AS VRTY_CD
				, RS.GRD_CD			AS GRD_CD
				, RS.SPCFCT_CD		AS SPCFCT_CD
			    , RS.SPMT_PCKG_UNIT_CD	AS SPMT_PCKG_UNIT_CD

    			, (SELECT FN_GET_PRDCR_NM(RS.PRDCR_CD, RS.APC_CD) FROM DUAL) AS PRDCR_NM
                , (SELECT FN_GET_ITEM_NM(RS.ITEM_CD, RS.APC_CD) FROM DUAL) AS ITEM_NM
                , (SELECT FN_GET_VRTY_NM(RS.ITEM_CD, RS.VRTY_CD, RS.APC_CD) FROM DUAL) AS VRTY_NM
                , (SELECT FN_GET_SPCFCT_NM(RS.ITEM_CD, RS.SPCFCT_CD, RS.APC_CD) FROM DUAL) AS SPCFCT_NM
    			, (SELECT FN_GET_GRD_NM_GDS(RS.APC_CD, RS.ITEM_CD, RS.GRD_CD) FROM DUAL) AS GRD_NM
			     , (SELECT FN_GET_SPMT_PCKG_UNIT_NM(RS.SPMT_PCKG_UNIT_CD, RS.APC_CD) FROM DUAL) AS SPMT_PCKG_UNIT_NM

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_11
				, SUM(RS.TOT_WGHT)		AS TOT_WGHT

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_11
				, SUM(RS.TOT_QNTT)		AS TOT_QNTT
			  FROM (
				SELECT
					  DL.APC_CD			AS APC_CD
					, DL.TOT_YMD		AS TOT_YMD
					, DL.TOT_SN			AS TOT_SN
			]]>
		<choose>
			<when test='termKndCd != null and termKndCd =="MM"'>
				-- 월별
				, TO_CHAR(DL.DT, 'YYYYMM')							AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')			AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')			AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')			AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')			AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')			AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')			AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')			AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')			AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')			AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')			AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')			AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="YY"'>
				-- 연별
				, TO_CHAR(DL.DT, 'YYYY')							AS T_0
				, TO_CHAR(DL.DT - (INTERVAL '1' YEAR), 'YYYY')		AS T_1
				, TO_CHAR(DL.DT - (INTERVAL '2' YEAR), 'YYYY')		AS T_2
				, TO_CHAR(DL.DT - (INTERVAL '3' YEAR), 'YYYY')		AS T_3
				, TO_CHAR(DL.DT - (INTERVAL '4' YEAR), 'YYYY')		AS T_4
				, TO_CHAR(DL.DT - (INTERVAL '5' YEAR), 'YYYY')		AS T_5
				, TO_CHAR(DL.DT - (INTERVAL '6' YEAR), 'YYYY')		AS T_6
				, TO_CHAR(DL.DT - (INTERVAL '7' YEAR), 'YYYY')		AS T_7
				, TO_CHAR(DL.DT - (INTERVAL '8' YEAR), 'YYYY')		AS T_8
				, TO_CHAR(DL.DT - (INTERVAL '9' YEAR), 'YYYY')		AS T_9
				, TO_CHAR(DL.DT - (INTERVAL '10' YEAR), 'YYYY')		AS T_10
				, TO_CHAR(DL.DT - (INTERVAL '11' YEAR), 'YYYY')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="HY"'>
				-- 반기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(CEIL(TO_CHAR(DL.DT, 'Q') / 2), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'Q') / 2), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'Q') / 2), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'Q') / 2), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'Q') / 2), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'Q') / 2), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'Q') / 2), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'Q') / 2), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'Q') / 2), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'Q') / 2), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'Q') / 2), 2, '0')		AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'Q') / 2), 2, '0')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="QY"'>
				-- 분기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(TO_CHAR(DL.DT, 'Q'), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'Q'), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'Q'), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'Q'), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'Q'), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'Q'), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'Q'), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'Q'), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'Q'), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'Q'), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'Q'), 2, '0')	AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'Q'), 2, '0')	AS T_11
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<![CDATA[
					, T.DTL_SN			AS DTL_SN
					, T.PCKG_YMD		AS RSLT_YMD
					, T.PRDCR_CD		AS PRDCR_CD
					, T.ITEM_CD			AS ITEM_CD
					, T.VRTY_CD			AS VRTY_CD
					, T.GRD_CD			AS GRD_CD
					, T.SPCFCT_CD		AS SPCFCT_CD
					, T.SPMT_PCKG_UNIT_CD	AS SPMT_PCKG_UNIT_CD
					, T.GDS_SE_CD		AS GDS_SE_CD
					, T.WRHS_SE_CD		AS WRHS_SE_CD
					, T.WAREHOUSE_SE_CD	AS WAREHOUSE_SE_CD
					, T.TOT_QNTT		AS TOT_QNTT
					, T.TOT_WGHT		AS TOT_WGHT
				  FROM (
					SELECT
						  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
						, #{apcCd}	AS APC_CD
						, #{totYmd}	AS TOT_YMD
						, #{totSn}	AS TOT_SN
					  FROM DUAL
				  ) DL
				LEFT JOIN TB_TOT_PCKG_PRFMNC T
				  ON T.APC_CD = DL.APC_CD
				 AND T.TOT_YMD = DL.TOT_YMD
				 AND T.TOT_SN = DL.TOT_SN
				 AND T.DEL_YN = 'N'
			) RS
		 WHERE 1=1
		]]>

		<if test='itemCd != null and itemCd != ""'>
			AND RS.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
			AND RS.VRTY_CD = #{vrtyCd}
		</if>

		<![CDATA[
		 GROUP BY
		 	RS.APC_CD
		 	, RS.PRDCR_CD
		 	, RS.ITEM_CD
			, RS.VRTY_CD
			, RS.SPCFCT_CD
			, RS.GRD_CD
			, RS.SPMT_PCKG_UNIT_CD
		 ORDER BY
		 	  ITEM_CD
			, VRTY_CD
			, SPCFCT_CD
			, GRD_CD
			, SPMT_PCKG_UNIT_CD
		]]>
	</select>



	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectTotSpmtPrfmncList  	-->
	<!-- DESC : 집계조회 - 출하실적.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTotSpmtPrfmncList" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectTotSpmtPrfmncList */
			      RS.APC_CD			AS APC_CD
				, RS.PRDCR_CD		AS PRDCR_CD
				, RS.ITEM_CD		AS ITEM_CD
				, RS.VRTY_CD		AS VRTY_CD
				, RS.GRD_CD			AS GRD_CD
				, RS.SPCFCT_CD		AS SPCFCT_CD
			    , RS.SPMT_PCKG_UNIT_CD	AS SPMT_PCKG_UNIT_CD
				, RS.CNPT_CD		AS CNPT_CD

    			, (SELECT FN_GET_PRDCR_NM(RS.PRDCR_CD, RS.APC_CD) FROM DUAL) AS PRDCR_NM
                , (SELECT FN_GET_ITEM_NM(RS.ITEM_CD, RS.APC_CD) FROM DUAL) AS ITEM_NM
                , (SELECT FN_GET_VRTY_NM(RS.ITEM_CD, RS.VRTY_CD, RS.APC_CD) FROM DUAL) AS VRTY_NM
                , (SELECT FN_GET_SPCFCT_NM(RS.ITEM_CD, RS.SPCFCT_CD, RS.APC_CD) FROM DUAL) AS SPCFCT_NM
    			, (SELECT FN_GET_GRD_NM_GDS(RS.APC_CD, RS.ITEM_CD, RS.GRD_CD) FROM DUAL) AS GRD_NM
			    , (SELECT FN_GET_SPMT_PCKG_UNIT_NM(RS.SPMT_PCKG_UNIT_CD, RS.APC_CD) FROM DUAL) AS SPMT_PCKG_UNIT_NM
			    , (SELECT FN_GET_CNPT_NM(RS.CNPT_CD, RS.APC_CD) FROM DUAL) AS CNPT_NM

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_11
				, SUM(RS.TOT_WGHT)		AS TOT_WGHT

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_11
				, SUM(RS.TOT_QNTT)		AS TOT_QNTT
			  FROM (
				SELECT
					  DL.APC_CD			AS APC_CD
					, DL.TOT_YMD		AS TOT_YMD
					, DL.TOT_SN			AS TOT_SN
			]]>
		<choose>
			<when test='termKndCd != null and termKndCd =="MM"'>
				-- 월별
				, TO_CHAR(DL.DT, 'YYYYMM')							AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')			AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')			AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')			AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')			AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')			AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')			AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')			AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')			AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')			AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')			AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')			AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="YY"'>
				-- 연별
				, TO_CHAR(DL.DT, 'YYYY')							AS T_0
				, TO_CHAR(DL.DT - (INTERVAL '1' YEAR), 'YYYY')		AS T_1
				, TO_CHAR(DL.DT - (INTERVAL '2' YEAR), 'YYYY')		AS T_2
				, TO_CHAR(DL.DT - (INTERVAL '3' YEAR), 'YYYY')		AS T_3
				, TO_CHAR(DL.DT - (INTERVAL '4' YEAR), 'YYYY')		AS T_4
				, TO_CHAR(DL.DT - (INTERVAL '5' YEAR), 'YYYY')		AS T_5
				, TO_CHAR(DL.DT - (INTERVAL '6' YEAR), 'YYYY')		AS T_6
				, TO_CHAR(DL.DT - (INTERVAL '7' YEAR), 'YYYY')		AS T_7
				, TO_CHAR(DL.DT - (INTERVAL '8' YEAR), 'YYYY')		AS T_8
				, TO_CHAR(DL.DT - (INTERVAL '9' YEAR), 'YYYY')		AS T_9
				, TO_CHAR(DL.DT - (INTERVAL '10' YEAR), 'YYYY')		AS T_10
				, TO_CHAR(DL.DT - (INTERVAL '11' YEAR), 'YYYY')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="HY"'>
				-- 반기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(CEIL(TO_CHAR(DL.DT, 'Q') / 2), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'Q') / 2), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'Q') / 2), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'Q') / 2), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'Q') / 2), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'Q') / 2), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'Q') / 2), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'Q') / 2), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'Q') / 2), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'Q') / 2), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'Q') / 2), 2, '0')		AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'Q') / 2), 2, '0')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="QY"'>
				-- 분기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(TO_CHAR(DL.DT, 'Q'), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'Q'), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'Q'), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'Q'), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'Q'), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'Q'), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'Q'), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'Q'), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'Q'), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'Q'), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'Q'), 2, '0')	AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'Q'), 2, '0')	AS T_11
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<![CDATA[
					, T.DTL_SN			AS DTL_SN
					, T.SPMT_YMD		AS RSLT_YMD
					, T.PRDCR_CD		AS PRDCR_CD
					, T.ITEM_CD			AS ITEM_CD
					, T.VRTY_CD			AS VRTY_CD
					, T.GRD_CD			AS GRD_CD
					, T.SPCFCT_CD		AS SPCFCT_CD
					, T.SPMT_PCKG_UNIT_CD	AS SPMT_PCKG_UNIT_CD
					, T.CNPT_CD			AS CNPT_CD
					, T.GDS_SE_CD		AS GDS_SE_CD
					, T.WRHS_SE_CD		AS WRHS_SE_CD
					, T.WAREHOUSE_SE_CD	AS WAREHOUSE_SE_CD
					, T.TOT_QNTT		AS TOT_QNTT
					, T.TOT_WGHT		AS TOT_WGHT
				  FROM (
					SELECT
						  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
						, #{apcCd}	AS APC_CD
						, #{totYmd}	AS TOT_YMD
						, #{totSn}	AS TOT_SN
					  FROM DUAL
				  ) DL
				LEFT JOIN TB_TOT_SPMT_PRFMNC T
				  ON T.APC_CD = DL.APC_CD
				 AND T.TOT_YMD = DL.TOT_YMD
				 AND T.TOT_SN = DL.TOT_SN
				 AND T.DEL_YN = 'N'
			) RS
		 WHERE 1=1
		]]>

		<if test='itemCd != null and itemCd != ""'>
			AND RS.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
			AND RS.VRTY_CD = #{vrtyCd}
		</if>

		<![CDATA[
		 GROUP BY
		 	RS.APC_CD
		 	, RS.PRDCR_CD
		 	, RS.ITEM_CD
			, RS.VRTY_CD
			, RS.SPCFCT_CD
			, RS.GRD_CD
			, RS.SPMT_PCKG_UNIT_CD
			, RS.CNPT_CD
		 ORDER BY
			  CNPT_NM
			, ITEM_CD
			, VRTY_CD
			, SPCFCT_CD
			, GRD_CD
			, SPMT_PCKG_UNIT_CD
		]]>
	</select>



	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectTotRawMtrInvntrList  	-->
	<!-- DESC : 집계조회 - 원물재고.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTotRawMtrInvntrList" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectTotRawMtrInvntrList */
			      RS.APC_CD			AS APC_CD
				, RS.PRDCR_CD		AS PRDCR_CD
				, RS.ITEM_CD		AS ITEM_CD
				, RS.VRTY_CD		AS VRTY_CD
				, RS.GRD_CD			AS GRD_CD
				, RS.SPCFCT_CD		AS SPCFCT_CD
    			, (SELECT FN_GET_PRDCR_NM(RS.PRDCR_CD, RS.APC_CD) FROM DUAL) AS PRDCR_NM
                , (SELECT FN_GET_ITEM_NM(RS.ITEM_CD, RS.APC_CD) FROM DUAL) AS ITEM_NM
                , (SELECT FN_GET_VRTY_NM(RS.ITEM_CD, RS.VRTY_CD, RS.APC_CD) FROM DUAL) AS VRTY_NM
                , (SELECT FN_GET_SPCFCT_NM(RS.ITEM_CD, RS.SPCFCT_CD, RS.APC_CD) FROM DUAL) AS SPCFCT_NM
    			, (SELECT FN_GET_GRD_NM_RAWMTR(RS.APC_CD, RS.ITEM_CD, RS.GRD_CD) FROM DUAL) AS GRD_NM
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_0 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_0
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_1 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_1
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_2 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_2
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_3 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_3
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_4 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_4
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_5 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_5
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_6 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_6
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_7 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_7
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_8 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_8
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_9 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_9
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_10 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_10
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_11 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_11
				, SUM(RS.TOT_WGHT)		AS TOT_WGHT

				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_0 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_0
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_1 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_1
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_2 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_2
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_3 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_3
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_4 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_4
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_5 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_5
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_6 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_6
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_7 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_7
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_8 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_8
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_9 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_9
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_10 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_10
				, SUM(CASE WHEN RS.WRHS_YMD = RS.T_11 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_11
				, SUM(RS.TOT_QNTT)		AS TOT_QNTT
			  FROM (
				SELECT
					  DL.APC_CD			AS APC_CD
					, DL.TOT_YMD		AS TOT_YMD
					, DL.TOT_SN			AS TOT_SN
			]]>
		<choose>
			<when test='termKndCd != null and termKndCd =="MM"'>
				-- 월별
				, TO_CHAR(DL.DT, 'YYYYMM')							AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')			AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')			AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')			AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')			AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')			AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')			AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')			AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')			AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')			AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')			AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')			AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="YY"'>
				-- 연별
				, TO_CHAR(DL.DT, 'YYYY')							AS T_0
				, TO_CHAR(DL.DT - (INTERVAL '1' YEAR), 'YYYY')		AS T_1
				, TO_CHAR(DL.DT - (INTERVAL '2' YEAR), 'YYYY')		AS T_2
				, TO_CHAR(DL.DT - (INTERVAL '3' YEAR), 'YYYY')		AS T_3
				, TO_CHAR(DL.DT - (INTERVAL '4' YEAR), 'YYYY')		AS T_4
				, TO_CHAR(DL.DT - (INTERVAL '5' YEAR), 'YYYY')		AS T_5
				, TO_CHAR(DL.DT - (INTERVAL '6' YEAR), 'YYYY')		AS T_6
				, TO_CHAR(DL.DT - (INTERVAL '7' YEAR), 'YYYY')		AS T_7
				, TO_CHAR(DL.DT - (INTERVAL '8' YEAR), 'YYYY')		AS T_8
				, TO_CHAR(DL.DT - (INTERVAL '9' YEAR), 'YYYY')		AS T_9
				, TO_CHAR(DL.DT - (INTERVAL '10' YEAR), 'YYYY')		AS T_10
				, TO_CHAR(DL.DT - (INTERVAL '11' YEAR), 'YYYY')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="HY"'>
				-- 반기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(CEIL(TO_CHAR(DL.DT, 'Q') / 2), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'Q') / 2), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'Q') / 2), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'Q') / 2), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'Q') / 2), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'Q') / 2), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'Q') / 2), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'Q') / 2), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'Q') / 2), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'Q') / 2), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'Q') / 2), 2, '0')		AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'Q') / 2), 2, '0')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="QY"'>
				-- 분기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(TO_CHAR(DL.DT, 'Q'), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'Q'), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'Q'), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'Q'), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'Q'), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'Q'), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'Q'), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'Q'), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'Q'), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'Q'), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'Q'), 2, '0')	AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'Q'), 2, '0')	AS T_11
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<![CDATA[
					, T.DTL_SN			AS DTL_SN
					, T.WRHS_YMD		AS WRHS_YMD
					, T.PRDCR_CD		AS PRDCR_CD
					, T.ITEM_CD			AS ITEM_CD
					, T.VRTY_CD			AS VRTY_CD
					, T.GRD_CD			AS GRD_CD
					, T.SPCFCT_CD		AS SPCFCT_CD
					, T.GDS_SE_CD		AS GDS_SE_CD
					, T.WRHS_SE_CD		AS WRHS_SE_CD
					, T.WAREHOUSE_SE_CD	AS WAREHOUSE_SE_CD
					, T.TOT_QNTT		AS TOT_QNTT
					, T.TOT_WGHT		AS TOT_WGHT
				  FROM (
					SELECT
						  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
						, #{apcCd}	AS APC_CD
						, #{totYmd}	AS TOT_YMD
						, #{totSn}	AS TOT_SN
					  FROM DUAL
				  ) DL
				LEFT JOIN TB_TOT_RAW_MTR_INVNTR T
				  ON T.APC_CD = DL.APC_CD
				 AND T.TOT_YMD = DL.TOT_YMD
				 AND T.TOT_SN = DL.TOT_SN
				 AND T.DEL_YN = 'N'
			) RS
		 WHERE 1=1
		]]>

		<if test='itemCd != null and itemCd != ""'>
			AND RS.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
			AND RS.VRTY_CD = #{vrtyCd}
		</if>

		<![CDATA[
		 GROUP BY
		 	RS.APC_CD
		 	, RS.PRDCR_CD
			, RS.ITEM_CD
			, RS.VRTY_CD
			, RS.GRD_CD
			, RS.SPCFCT_CD
		 ORDER BY
		 	  ITEM_CD
			, VRTY_CD
			, PRDCR_CD
			, GRD_CD
			, SPCFCT_CD
		]]>
	</select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectTotSortInvntrList  	-->
	<!-- DESC : 집계조회 - 선별재고.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTotSortInvntrList" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectTotSortInvntrList */
			      RS.APC_CD			AS APC_CD
				, RS.PRDCR_CD		AS PRDCR_CD
				, RS.ITEM_CD		AS ITEM_CD
				, RS.VRTY_CD		AS VRTY_CD
				, RS.GRD_CD			AS GRD_CD
				, RS.SPCFCT_CD		AS SPCFCT_CD
    			, (SELECT FN_GET_PRDCR_NM(RS.PRDCR_CD, RS.APC_CD) FROM DUAL) AS PRDCR_NM
                , (SELECT FN_GET_ITEM_NM(RS.ITEM_CD, RS.APC_CD) FROM DUAL) AS ITEM_NM
                , (SELECT FN_GET_VRTY_NM(RS.ITEM_CD, RS.VRTY_CD, RS.APC_CD) FROM DUAL) AS VRTY_NM
                , (SELECT FN_GET_SPCFCT_NM(RS.ITEM_CD, RS.SPCFCT_CD, RS.APC_CD) FROM DUAL) AS SPCFCT_NM
    			, (SELECT FN_GET_GRD_NM_SORT(RS.APC_CD, RS.ITEM_CD, RS.GRD_CD) FROM DUAL) AS GRD_NM

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_11
				, SUM(RS.TOT_WGHT)		AS TOT_WGHT

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_11
				, SUM(RS.TOT_QNTT)		AS TOT_QNTT
			  FROM (
				SELECT
					  DL.APC_CD			AS APC_CD
					, DL.TOT_YMD		AS TOT_YMD
					, DL.TOT_SN			AS TOT_SN
			]]>
		<choose>
			<when test='termKndCd != null and termKndCd =="MM"'>
				-- 월별
				, TO_CHAR(DL.DT, 'YYYYMM')							AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')			AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')			AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')			AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')			AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')			AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')			AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')			AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')			AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')			AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')			AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')			AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="YY"'>
				-- 연별
				, TO_CHAR(DL.DT, 'YYYY')							AS T_0
				, TO_CHAR(DL.DT - (INTERVAL '1' YEAR), 'YYYY')		AS T_1
				, TO_CHAR(DL.DT - (INTERVAL '2' YEAR), 'YYYY')		AS T_2
				, TO_CHAR(DL.DT - (INTERVAL '3' YEAR), 'YYYY')		AS T_3
				, TO_CHAR(DL.DT - (INTERVAL '4' YEAR), 'YYYY')		AS T_4
				, TO_CHAR(DL.DT - (INTERVAL '5' YEAR), 'YYYY')		AS T_5
				, TO_CHAR(DL.DT - (INTERVAL '6' YEAR), 'YYYY')		AS T_6
				, TO_CHAR(DL.DT - (INTERVAL '7' YEAR), 'YYYY')		AS T_7
				, TO_CHAR(DL.DT - (INTERVAL '8' YEAR), 'YYYY')		AS T_8
				, TO_CHAR(DL.DT - (INTERVAL '9' YEAR), 'YYYY')		AS T_9
				, TO_CHAR(DL.DT - (INTERVAL '10' YEAR), 'YYYY')		AS T_10
				, TO_CHAR(DL.DT - (INTERVAL '11' YEAR), 'YYYY')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="HY"'>
				-- 반기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(CEIL(TO_CHAR(DL.DT, 'Q') / 2), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'Q') / 2), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'Q') / 2), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'Q') / 2), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'Q') / 2), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'Q') / 2), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'Q') / 2), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'Q') / 2), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'Q') / 2), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'Q') / 2), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'Q') / 2), 2, '0')		AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'Q') / 2), 2, '0')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="QY"'>
				-- 분기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(TO_CHAR(DL.DT, 'Q'), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'Q'), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'Q'), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'Q'), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'Q'), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'Q'), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'Q'), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'Q'), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'Q'), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'Q'), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'Q'), 2, '0')	AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'Q'), 2, '0')	AS T_11
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<![CDATA[
					, T.DTL_SN			AS DTL_SN
					, T.SORT_YMD		AS RSLT_YMD
					, T.PRDCR_CD		AS PRDCR_CD
					, T.ITEM_CD			AS ITEM_CD
					, T.VRTY_CD			AS VRTY_CD
					, T.GRD_CD			AS GRD_CD
					, T.SPCFCT_CD		AS SPCFCT_CD
					, T.GDS_SE_CD		AS GDS_SE_CD
					, T.WRHS_SE_CD		AS WRHS_SE_CD
					, T.WAREHOUSE_SE_CD	AS WAREHOUSE_SE_CD
					, T.TOT_QNTT		AS TOT_QNTT
					, T.TOT_WGHT		AS TOT_WGHT
				  FROM (
					SELECT
						  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
						, #{apcCd}	AS APC_CD
						, #{totYmd}	AS TOT_YMD
						, #{totSn}	AS TOT_SN
					  FROM DUAL
				  ) DL
				LEFT JOIN TB_TOT_SORT_INVNTR T
				  ON T.APC_CD = DL.APC_CD
				 AND T.TOT_YMD = DL.TOT_YMD
				 AND T.TOT_SN = DL.TOT_SN
				 AND T.DEL_YN = 'N'
			) RS
		 WHERE 1=1
		]]>

		<if test='itemCd != null and itemCd != ""'>
			AND RS.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
			AND RS.VRTY_CD = #{vrtyCd}
		</if>

		<![CDATA[
		 GROUP BY
		 	RS.APC_CD
		 	, RS.PRDCR_CD
			, RS.ITEM_CD
			, RS.VRTY_CD
			, RS.SPCFCT_CD
			, RS.GRD_CD
		 ORDER BY
		 	  PRDCR_CD
			, ITEM_CD
			, VRTY_CD
			, SPCFCT_CD
			, GRD_CD
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.selectTotGdsInvntrList  	-->
	<!-- DESC : 집계조회 - 상품재고.	                                             	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<select id="selectTotGdsInvntrList" parameterType="com.at.apcss.am.tot.vo.TotRsltVO" resultType="com.at.apcss.am.tot.vo.TotRsltVO">
		<![CDATA[
			SELECT /* com.at.apcss.am.tot.mapper.TotMngMapper.selectTotGdsInvntrList */
			      RS.APC_CD			AS APC_CD
				, RS.PRDCR_CD		AS PRDCR_CD
				, RS.ITEM_CD		AS ITEM_CD
				, RS.VRTY_CD		AS VRTY_CD
				, RS.GRD_CD			AS GRD_CD
				, RS.SPCFCT_CD		AS SPCFCT_CD
			    , RS.SPMT_PCKG_UNIT_CD	AS SPMT_PCKG_UNIT_CD

    			, (SELECT FN_GET_PRDCR_NM(RS.PRDCR_CD, RS.APC_CD) FROM DUAL) AS PRDCR_NM
                , (SELECT FN_GET_ITEM_NM(RS.ITEM_CD, RS.APC_CD) FROM DUAL) AS ITEM_NM
                , (SELECT FN_GET_VRTY_NM(RS.ITEM_CD, RS.VRTY_CD, RS.APC_CD) FROM DUAL) AS VRTY_NM
                , (SELECT FN_GET_SPCFCT_NM(RS.ITEM_CD, RS.SPCFCT_CD, RS.APC_CD) FROM DUAL) AS SPCFCT_NM
    			, (SELECT FN_GET_GRD_NM_GDS(RS.APC_CD, RS.ITEM_CD, RS.GRD_CD) FROM DUAL) AS GRD_NM
			     , (SELECT FN_GET_SPMT_PCKG_UNIT_NM(RS.SPMT_PCKG_UNIT_CD, RS.APC_CD) FROM DUAL) AS SPMT_PCKG_UNIT_NM

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_WGHT ELSE 0 END)		AS WGHT_11
				, SUM(RS.TOT_WGHT)		AS TOT_WGHT

				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_0 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_0
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_1 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_1
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_2 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_2
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_3 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_3
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_4 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_4
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_5 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_5
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_6 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_6
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_7 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_7
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_8 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_8
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_9 THEN RS.TOT_QNTT ELSE 0 END)		AS QNTT_9
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_10 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_10
				, SUM(CASE WHEN RS.RSLT_YMD = RS.T_11 THEN RS.TOT_QNTT ELSE 0 END)	AS QNTT_11
				, SUM(RS.TOT_QNTT)		AS TOT_QNTT
			  FROM (
				SELECT
					  DL.APC_CD			AS APC_CD
					, DL.TOT_YMD		AS TOT_YMD
					, DL.TOT_SN			AS TOT_SN
			]]>
		<choose>
			<when test='termKndCd != null and termKndCd =="MM"'>
				-- 월별
				, TO_CHAR(DL.DT, 'YYYYMM')							AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')			AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')			AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')			AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')			AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')			AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')			AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')			AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')			AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')			AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')			AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')			AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="YY"'>
				-- 연별
				, TO_CHAR(DL.DT, 'YYYY')							AS T_0
				, TO_CHAR(DL.DT - (INTERVAL '1' YEAR), 'YYYY')		AS T_1
				, TO_CHAR(DL.DT - (INTERVAL '2' YEAR), 'YYYY')		AS T_2
				, TO_CHAR(DL.DT - (INTERVAL '3' YEAR), 'YYYY')		AS T_3
				, TO_CHAR(DL.DT - (INTERVAL '4' YEAR), 'YYYY')		AS T_4
				, TO_CHAR(DL.DT - (INTERVAL '5' YEAR), 'YYYY')		AS T_5
				, TO_CHAR(DL.DT - (INTERVAL '6' YEAR), 'YYYY')		AS T_6
				, TO_CHAR(DL.DT - (INTERVAL '7' YEAR), 'YYYY')		AS T_7
				, TO_CHAR(DL.DT - (INTERVAL '8' YEAR), 'YYYY')		AS T_8
				, TO_CHAR(DL.DT - (INTERVAL '9' YEAR), 'YYYY')		AS T_9
				, TO_CHAR(DL.DT - (INTERVAL '10' YEAR), 'YYYY')		AS T_10
				, TO_CHAR(DL.DT - (INTERVAL '11' YEAR), 'YYYY')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="HY"'>
				-- 반기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(CEIL(TO_CHAR(DL.DT, 'Q') / 2), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -1 *6), 'Q') / 2), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -2 *6), 'Q') / 2), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -3 *6), 'Q') / 2), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -4 *6), 'Q') / 2), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -5 *6), 'Q') / 2), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -6 *6), 'Q') / 2), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -7 *6), 'Q') / 2), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -8 *6), 'Q') / 2), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -9 *6), 'Q') / 2), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -10 *6), 'Q') / 2), 2, '0')		AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'YYYY') || LPAD(CEIL(TO_CHAR(ADD_MONTHS(DL.DT, -11 *6), 'Q') / 2), 2, '0')		AS T_11
			</when>
			<when test='termKndCd != null and termKndCd =="QY"'>
				-- 분기
				, TO_CHAR(DL.DT, 'YYYY') || LPAD(TO_CHAR(DL.DT, 'Q'), 2, '0')	AS T_0
				, TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -1 *3), 'Q'), 2, '0')		AS T_1
				, TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -2 *3), 'Q'), 2, '0')		AS T_2
				, TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -3 *3), 'Q'), 2, '0')		AS T_3
				, TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -4 *3), 'Q'), 2, '0')		AS T_4
				, TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -5 *3), 'Q'), 2, '0')		AS T_5
				, TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -6 *3), 'Q'), 2, '0')		AS T_6
				, TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -7 *3), 'Q'), 2, '0')		AS T_7
				, TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -8 *3), 'Q'), 2, '0')		AS T_8
				, TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -9 *3), 'Q'), 2, '0')		AS T_9
				, TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -10 *3), 'Q'), 2, '0')	AS T_10
				, TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'YYYY') || LPAD(TO_CHAR(ADD_MONTHS(DL.DT, -11 *3), 'Q'), 2, '0')	AS T_11
			</when>
			<otherwise>
			</otherwise>
		</choose>
		<![CDATA[
					, T.DTL_SN			AS DTL_SN
					, T.PCKG_YMD		AS RSLT_YMD
					, T.PRDCR_CD		AS PRDCR_CD
					, T.ITEM_CD			AS ITEM_CD
					, T.VRTY_CD			AS VRTY_CD
					, T.GRD_CD			AS GRD_CD
					, T.SPCFCT_CD		AS SPCFCT_CD
					, T.SPMT_PCKG_UNIT_CD	AS SPMT_PCKG_UNIT_CD
					, T.GDS_SE_CD		AS GDS_SE_CD
					, T.WRHS_SE_CD		AS WRHS_SE_CD
					, T.WAREHOUSE_SE_CD	AS WAREHOUSE_SE_CD
					, T.TOT_QNTT		AS TOT_QNTT
					, T.TOT_WGHT		AS TOT_WGHT
				  FROM (
					SELECT
						  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
						, #{apcCd}	AS APC_CD
						, #{totYmd}	AS TOT_YMD
						, #{totSn}	AS TOT_SN
					  FROM DUAL
				  ) DL
				LEFT JOIN TB_TOT_GDS_INVNTR T
				  ON T.APC_CD = DL.APC_CD
				 AND T.TOT_YMD = DL.TOT_YMD
				 AND T.TOT_SN = DL.TOT_SN
				 AND T.DEL_YN = 'N'
			) RS
		 WHERE 1=1
		]]>

		<if test='itemCd != null and itemCd != ""'>
			AND RS.ITEM_CD = #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != ""'>
			AND RS.VRTY_CD = #{vrtyCd}
		</if>

		<![CDATA[
		 GROUP BY
		 	RS.APC_CD
		 	, RS.PRDCR_CD
		 	, RS.ITEM_CD
			, RS.VRTY_CD
			, RS.SPCFCT_CD
			, RS.GRD_CD
			, RS.SPMT_PCKG_UNIT_CD
		 ORDER BY
		 	  ITEM_CD
			, VRTY_CD
			, SPCFCT_CD
			, GRD_CD
			, SPMT_PCKG_UNIT_CD
		]]>
	</select>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.TotMngMapper.insertSptotRsltCrtRp		-->
	<!-- DESC : 집계생성		                        	             				-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.09.21  	신정철        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<insert id="insertSptotRsltCrt" statementType="CALLABLE" parameterType="com.at.apcss.am.tot.vo.TotRsltVO">
    	<![CDATA[
			{call /* com.at.apcss.am.tot.mapper.TotMngMapper.insertSptotRsltCrt */
				SP_TOT_RSLT_CRT (
					  #{sysLastChgUserId}
					, #{sysLastChgPrgrmId}
					, #{apcCd}
					, #{crtrYmd}
				    , #{totCrtrType}
				    , #{termKndCd}
					, #{rtnCd, jdbcType=VARCHAR, mode=OUT}
					, #{rtnMsg, jdbcType=VARCHAR, mode=OUT}
				)
			}
		]]>
    </insert>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.inserttotMngInfo  	-->
	<!-- DESC : 집계 기준 등록.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertTotMngInfo" parameterType="com.at.apcss.am.tot.vo.TotMngVO">
    	<![CDATA[
	    	INSERT /* com.at.apcss.am.tot.mapper.insertTotMngInfo  */
	    	  INTO TB_TOT_CRTR (
				APC_CD
				, TOT_CRTR_TYPE
				, CRTR_CD
				, CRTR_VL
				, CRTR_INDCT_NM
				, TOT_DTL_TYPE
				, INDCT_SEQ
				, USE_YN
				, DEL_YN
				, SYS_FRST_INPT_DT
				, SYS_FRST_INPT_USER_ID
				, SYS_FRST_INPT_PRGRM_ID
				, SYS_LAST_CHG_DT
				, SYS_LAST_CHG_USER_ID
				, SYS_LAST_CHG_PRGRM_ID



	    	  ) VALUES (

				#{apcCd}
				, #{totCrtrType}
				, #{crtrCd}
				, #{crtrVl}
				, #{crtrIndctNm}
				, #{totDtlType}
				, #{indctSeq}
				, #{useYn}
				, #{delYn}
				, SYSDATE
				, #{sysFrstInptUserId}
				, #{sysFrstInptPrgrmId}
				, SYSDATE
				, #{sysLastChgUserId}
				, #{sysLastChgPrgrmId}
	    	  )
		]]>
    </insert>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.inserttotMngDtlInfo  	-->
	<!-- DESC : 집계 상세 기준 등록.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <insert id="insertTotMngDtlInfo" parameterType="com.at.apcss.am.tot.vo.TotMngVO">
    	<![CDATA[
	    	INSERT /* com.at.apcss.am.tot.mapper.inserttotMngDtlInfo  */
	    	  INTO TB_TOT_CRTR_DTL (
				APC_CD
				, TOT_CRTR_TYPE
				, CRTR_CD
				, DTL_SN
				, DTL_CD
				, DTL_VL
				, DTL_INDCT_NM
				, TOT_DTL_PRCS_CD
				, INDCT_SEQ
				, USE_YN
				, DEL_YN
				, SYS_FRST_INPT_DT
				, SYS_FRST_INPT_USER_ID
				, SYS_FRST_INPT_PRGRM_ID
				, SYS_LAST_CHG_DT
				, SYS_LAST_CHG_USER_ID
				, SYS_LAST_CHG_PRGRM_ID


	    	  ) VALUES (
				#{apcCd}
				, #{totCrtrType}
				, #{crtrCd}
				, (SELECT COALESCE(MAX(DTL_SN), 0) + 1 FROM TB_TOT_CRTR_DTL)
				, #{dtlCd}
				, #{dtlVl}
				, #{dtlIndctNm}
				, #{totDtlPrcsCd}
				, #{indctSeq}
				, #{useYn}
				, #{delYn}
				, SYSDATE
				, #{sysFrstInptUserId}
				, #{sysFrstInptPrgrmId}
				, SYSDATE
				, #{sysLastChgUserId}
				, #{sysLastChgPrgrmId}
	    	  )
		]]>
    </insert>

	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selecttotMngInfoList  	-->
	<!-- DESC : 집계 기준 조회.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectTotMngInfoList" parameterType="com.at.apcss.am.tot.vo.TotMngVO" resultType="com.at.apcss.am.tot.vo.TotMngVO">
    	<![CDATA[
	    	SELECT /* com.at.apcss.am.tot.mapper.selecttotMngInfoList */
				*
			  FROM TB_TOT_CRTR TC
			 WHERE TC.APC_CD = #{apcCd}
		]]>

	   	  <if test='totCrtrType != null and totCrtrType != ""'>
	   		AND TC.TOT_CRTR_TYPE = #{totCrtrType}
		  </if>
		  ORDER BY TC.INDCT_SEQ
    </select>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selecttotMngInfoList  	-->
	<!-- DESC : 집계 기준상세 조회.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectTotMngInfoDtlList" parameterType="com.at.apcss.am.tot.vo.TotMngVO" resultType="com.at.apcss.am.tot.vo.TotMngVO">
    	<![CDATA[
	    	SELECT /* com.at.apcss.am.tot.mapper.selectTotMngInfoDtlList */
				TCD.APC_CD
				, TCD.TOT_CRTR_TYPE
				, TCD.CRTR_CD
				, TCD.DTL_SN
				, TCD.DTL_CD
				, TCD.DTL_VL
				, TCD.DTL_INDCT_NM
				, TCD.TOT_DTL_PRCS_CD
				, TCD.INDCT_SEQ
				, TCD.USE_YN
				, TCD.DEL_YN
				, (SELECT FN_GET_COM_CD_VL_NM('TOT_TERM_KND',TCD.DTL_CD,'0000') FROM DUAL) AS DTL_NM
			  FROM TB_TOT_CRTR_DTL TCD
			 WHERE TCD.APC_CD = #{apcCd}
			]]>
			<if test='totCrtrType != null and totCrtrType != ""'>
	   			AND TCD.TOT_CRTR_TYPE = #{totCrtrType}
		  	</if>
		  	<if test='crtrCd != null and crtrCd != ""'>
	   			AND TCD.CRTR_CD = #{crtrCd}
		  	</if>


		  ORDER BY TCD.DTL_SN

    </select>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.updatetotMngInfo  	-->
	<!-- DESC : 집계 기준 수정.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <update id="updateTotMngInfo" parameterType="com.at.apcss.am.tot.vo.TotMngVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.am.apc.mapper.ApcEvrmntStngMapper.updatetotMngInfo */
	    	  TB_TOT_CRTR SET
				CRTR_VL = #{crtrVl}
				, CRTR_INDCT_NM = #{crtrIndctNm}
				, TOT_DTL_TYPE = #{totDtlType}
				, INDCT_SEQ = #{indctSeq}
				, USE_YN = #{useYn}
				, SYS_LAST_CHG_DT = SYSDATE
				, SYS_LAST_CHG_USER_ID = #{sysLastChgUserId}
				, SYS_LAST_CHG_PRGRM_ID = #{sysLastChgPrgrmId}


			 WHERE APC_CD = #{apcCd}
			   AND TOT_CRTR_TYPE = #{totCrtrType}
			   AND CRTR_CD = #{crtrCd}
		]]>
    </update>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.updatetotMngDtlInfo  	-->
	<!-- DESC : 집계 상세기준 수정.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <update id="updateTotMngDtlInfo" parameterType="com.at.apcss.am.tot.vo.TotMngVO">
    	<![CDATA[
	    	UPDATE /* com.at.apcss.am.apc.mapper.ApcEvrmntStngMapper.updatetotMngDtlInfo */
	    	  TB_TOT_CRTR_DTL SET
				DTL_CD = #{dtlCd}
				, DTL_VL = #{dtlVl}
				, DTL_INDCT_NM = #{dtlIndctNm}
				, TOT_DTL_PRCS_CD = #{totDtlPrcsCd}
				, INDCT_SEQ = #{indctSeq}
				, USE_YN = #{useYn}
				, SYS_LAST_CHG_DT = SYSDATE
				, SYS_LAST_CHG_USER_ID = #{sysLastChgUserId}
				, SYS_LAST_CHG_PRGRM_ID = #{sysLastChgPrgrmId}



			 WHERE APC_CD = #{apcCd}
			   AND TOT_CRTR_TYPE = #{totCrtrType}
			   AND CRTR_CD = #{crtrCd}
			   AND DTL_SN = #{dtlSn}
		]]>
    </update>

    <!-- ==========================================================================	-->
	<!-- com.at.apcss.am.tot.mapper.totMngMapper.deletetotMngInfo				-->
	<!-- DESC : 집계기준정보 삭제.	                                       					-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.24  	박승진        		Initial Creation                        -->
	<!-- ==========================================================================	-->
    <delete id="deleteTotMngInfo" parameterType="com.at.apcss.am.tot.vo.TotMngVO">
		<![CDATA[
			DELETE /* com.at.apcss.am.tot.mapper.totMngMapper.deletetotMngInfo */
			  FROM TB_TOT_CRTR
			 WHERE APC_CD = #{apcCd}
			   AND TOT_CRTR_TYPE = #{totCrtrType}
			   AND CRTR_CD = #{crtrCd}
		]]>
	</delete>

	<!-- ==========================================================================	-->
	<!-- com.at.apcss.am.tot.mapper.totMngMapper.deletetotMngInfo				-->
	<!-- DESC : 집계기준상세정보 삭제.	                                       					-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.24  	박승진        		Initial Creation                        -->
	<!-- ==========================================================================	-->
    <delete id="deleteTotMngDtlInfo" parameterType="com.at.apcss.am.tot.vo.TotMngVO">
		<![CDATA[
			DELETE /* com.at.apcss.am.tot.mapper.totMngMapper.deletetotMngInfo */
			  FROM TB_TOT_CRTR_DTL
			 WHERE APC_CD = #{apcCd}
			   AND TOT_CRTR_TYPE = #{totCrtrType}
			   AND CRTR_CD = #{crtrCd}
			   AND DTL_SN = #{dtlSn}
		]]>
	</delete>


	<!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectSpmtPrfmncTotInfo  	-->
	<!-- DESC : 집계조회 - 출하.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectSpmtPrfmncTotInfo" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT
				* FROM TB_TOT_SPMT_PRFMNC A
				WHERE 1=1
					AND A.APC_CD = #{apcCd}
			]]>
			<if test='totYmdFrom != null and totYmdFrom != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdFrom}
    		</if>
    		<if test='totYmdTo != null and totYmdTo != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdTo}
    		</if>
			<if test='itemCd != null and itemCd != ""'>
	   			AND A.ITEM_CD = #{itemCd}
		  	</if>
		  	<if test='vrtyCd != null and vrtyCd != ""'>
	   			AND A.VRTY_CD = #{vrtyCd}
		  	</if>
    </select>


    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectGdsInvntrTotInfo  	-->
	<!-- DESC : 집계조회 - 상품.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectGdsInvntrTotInfo" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT
				* FROM TB_TOT_GDS_INVNTR A
				WHERE 1=1
					AND A.APC_CD = #{apcCd}
			]]>
			<if test='totYmdFrom != null and totYmdFrom != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdFrom}
    		</if>
    		<if test='totYmdTo != null and totYmdTo != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdTo}
    		</if>
			<if test='itemCd != null and itemCd != ""'>
	   			AND A.ITEM_CD = #{itemCd}
		  	</if>
		  	<if test='vrtyCd != null and vrtyCd != ""'>
	   			AND A.VRTY_CD = #{vrtyCd}
		  	</if>
    </select>

    <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectPckgPrfmncTotInfo  	-->
	<!-- DESC : 집계조회 - 포장.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectPckgPrfmncTotInfo" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT
				* FROM TB_TOT_PCKG_PRFMNC A
				WHERE 1=1
					AND A.APC_CD = #{apcCd}
			]]>
			<if test='totYmdFrom != null and totYmdFrom != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdFrom}
    		</if>
    		<if test='totYmdTo != null and totYmdTo != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdTo}
    		</if>
			<if test='itemCd != null and itemCd != ""'>
	   			AND A.ITEM_CD = #{itemCd}
		  	</if>
		  	<if test='vrtyCd != null and vrtyCd != ""'>
	   			AND A.VRTY_CD = #{vrtyCd}
		  	</if>
    </select>

     <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectRawMtrInvntrTotInfo  	-->
	<!-- DESC : 집계조회 - 원물재고.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectRawMtrInvntrTotInfo" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT
				* FROM TB_TOT_RAW_MTR_INVNTR A
				WHERE 1=1
					AND A.APC_CD = #{apcCd}
			]]>
			<if test='totYmdFrom != null and totYmdFrom != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdFrom}
    		</if>
    		<if test='totYmdTo != null and totYmdTo != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdTo}
    		</if>
			<if test='itemCd != null and itemCd != ""'>
	   			AND A.ITEM_CD = #{itemCd}
		  	</if>
		  	<if test='vrtyCd != null and vrtyCd != ""'>
	   			AND A.VRTY_CD = #{vrtyCd}
		  	</if>
    </select>




     <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectRawMtrWrhsTotInfo  	-->
	<!-- DESC : 집계조회 - 원물입고.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectRawMtrWrhsTotInfo" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT

    		    A.WRHS_YMD
    		    , A.ITEM_CD
    		    , A.VRTY_CD
    		          , AL

				* FROM TB_TOT_RAW_MTR_WRHS A
				WHERE 1=1
					AND A.APC_CD = #{apcCd}


			]]>
			<if test='totYmdFrom != null and totYmdFrom != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdFrom}
    		</if>
    		<if test='totYmdTo != null and totYmdTo != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdTo}
    		</if>
			<if test='itemCd != null and itemCd != ""'>
	   			AND A.ITEM_CD = #{itemCd}
		  	</if>
		  	<if test='vrtyCd != null and vrtyCd != ""'>
	   			AND A.VRTY_CD = #{vrtyCd}
		  	</if>
    </select>

     <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectSortInvntrTotInfo  	-->
	<!-- DESC : 집계조회 - 선별재고.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectSortInvntrTotInfo" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT
				* FROM TB_TOT_SORT_INVNTR A
				WHERE 1=1
					AND A.APC_CD = #{apcCd}
			]]>
			<if test='totYmdFrom != null and totYmdFrom != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdFrom}
    		</if>
    		<if test='totYmdTo != null and totYmdTo != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdTo}
    		</if>
			<if test='itemCd != null and itemCd != ""'>
	   			AND A.ITEM_CD = #{itemCd}
		  	</if>
		  	<if test='vrtyCd != null and vrtyCd != ""'>
	   			AND A.VRTY_CD = #{vrtyCd}
		  	</if>
    </select>

     <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectSortPrfmncTotInfo  	-->
	<!-- DESC : 집계조회 - 선별실적.	                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2024.10.08  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectSortPrfmncTotInfo" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT
				* FROM TB_TOT_SORT_PRFMNC A
				WHERE 1=1
					AND A.APC_CD = #{apcCd}
			]]>
			<if test='totYmdFrom != null and totYmdFrom != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdFrom}
    		</if>
    		<if test='totYmdTo != null and totYmdTo != ""'>
				AND A.TOT_YMD <![CDATA[>=]]> #{totYmdTo}
    		</if>
			<if test='itemCd != null and itemCd != ""'>
	   			AND A.ITEM_CD = #{itemCd}
		  	</if>
		  	<if test='vrtyCd != null and vrtyCd != ""'>
	   			AND A.VRTY_CD = #{vrtyCd}
		  	</if>
    </select>

     <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectItemClsSortPrfmncAnls  	-->
	<!-- DESC : 품목별 선별 실적 분석                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.01.22  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectItemClsSortPrfmncAnls" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT
				  A.APC_CD			AS APC_CD
				, A.ITEM_CD			AS ITEM_CD
				, A.VRTY_CD			AS VRTY_CD
				, A.SPCFCT_CD		AS SPCFCT_CD
				, A.GRD_CD			AS GRD_CD
				, (SELECT FN_GET_ITEM_NM(A.ITEM_CD, A.APC_CD) FROM DUAL) AS ITEM_NM
				, (SELECT FN_GET_VRTY_NM(A.ITEM_CD, A.VRTY_CD, A.APC_CD) FROM DUAL) AS VRTY_NM
				, (SELECT FN_GET_SPCFCT_NM(A.ITEM_CD, A.SPCFCT_CD, A.APC_CD) FROM DUAL) AS SPCFCT_NM
				, (SELECT FN_GET_GRD_NM_SORT(A.APC_CD, A.ITEM_CD, A.GRD_CD) FROM DUAL) 		AS GRD_NM
				, A.INPT_QNTT		AS INPT_QNTT
				, A.INPT_WGHT		AS INPT_WGHT
				, A.TOT_QNTT		AS TOT_QNTT
				, A.TOT_WGHT		AS TOT_WGHT
				, NVL(A.INPT_QNTT, 0) - NVL(A.TOT_QNTT, 0)		AS DIFF_QNTT
				, NVL(A.INPT_WGHT, 0) - NVL(A.TOT_WGHT, 0)		AS DIFF_WGHT
				, ROUND((A.TOT_QNTT / NULLIF(A.INPT_QNTT, 0)) * 100, 0)	AS RT_QNTT
				, ROUND((A.TOT_WGHT / NULLIF(A.INPT_WGHT, 0)) * 100, 0)	AS RT_WGHT
				, A.QNTT	AS QNTT
				, A.WGHT	AS WGHT
				, ROUND((A.QNTT / NULLIF(A.TOT_QNTT, 0)) * 100, 0)		AS RT_PART_QNTT
				, ROUND((A.WGHT / NULLIF(A.TOT_WGHT, 0)) * 100, 0)		AS RT_PART_WGHT
 			FROM (
				SELECT
					  T.APC_CD			AS APC_CD
					, T.ITEM_CD			AS ITEM_CD
					, T.VRTY_CD		AS VRTY_CD
					, T.SPCFCT_CD	AS SPCFCT_CD
					, T.GRD_CD			AS GRD_CD
					, T.QNTT			AS QNTT
					, T.WGHT			AS WGHT
					, SUM(T.QNTT) OVER (PARTITION BY T.APC_CD, T.ITEM_CD, T.VRTY_CD)	AS TOT_QNTT
					, SUM(T.WGHT) OVER (PARTITION BY T.APC_CD, T.ITEM_CD, T.VRTY_CD)	AS TOT_WGHT
					, INP.INPT_QNTT	AS INPT_QNTT
					, INP.INPT_WGHT	AS INPT_WGHT
				  FROM (
					SELECT
						  RP.APC_CD		AS APC_CD
						, RI.ITEM_CD		AS ITEM_CD
						, RI.VRTY_CD		AS VRTY_CD
						, RI.SPCFCT_CD	AS SPCFCT_CD
						, RI.GRD_CD			AS GRD_CD
						, SUM(RP.SORT_QNTT)	AS QNTT
						, SUM(RP.SORT_WGHT)	AS WGHT
					  FROM TB_SORT_PRFMNC RP
					  JOIN TB_SORT_INVNTR RI
					    ON RI.APC_CD = RP.APC_CD
					   AND RI.SORTNO = RP.SORTNO
					   AND RI.SORT_SN = RP.SORT_SN
					   AND RI.DEL_YN = 'N'
					 WHERE RP.APC_CD = #{apcCd}
					 ]]>
					 <if test='inptYmdFrom != null and inptYmdFrom != ""'>
					    AND RP.INPT_YMD <![CDATA[>=]]> #{inptYmdFrom}
					 </if>
					<if test='inptYmdTo != null and inptYmdTo != ""'>
					    AND RP.INPT_YMD <![CDATA[<=]]> #{inptYmdTo}
			    	</if>
					<if test='itemCd != null and itemCd != ""'>
					    AND RI.ITEM_CD = #{itemCd}
			    	</if>
			    	<if test='vrtyCd != null and vrtyCd != ""'>
					    AND RI.VRTY_CD = #{vrtyCd}
			    	</if>

					 <![CDATA[
					 GROUP BY
					 	  RP.APC_CD
						, RI.ITEM_CD
						, RI.VRTY_CD
						, RI.SPCFCT_CD
						, RI.GRD_CD
					) T
				  LEFT JOIN (
					  		SELECT
					  			  RI.ITEM_CD		AS ITEM_CD
					  			, RI.VRTY_CD		AS VRTY_CD
					  			, SUM(IP.QNTT)	AS INPT_QNTT
					  			, SUM(IP.WGHT)	AS INPT_WGHT
					  		  FROM TB_SORT_INPT_PRFMNC IP
					  		  JOIN TB_RAW_MTR_INVNTR RI
					  		    ON RI.APC_CD = IP.APC_CD
					  		   AND RI.WRHSNO = IP.WRHSNO
					  		   AND RI.DEL_YN = 'N'
							 WHERE IP.APC_CD = #{apcCd}
							   AND IP.DEL_YN = 'N'
							   ]]>
							   <if test='inptYmdFrom != null and inptYmdFrom != ""'>
								  AND IP.INPT_YMD <![CDATA[>=]]> #{inptYmdFrom}
    						   </if>
								<if test='inptYmdTo != null and inptYmdTo != ""'>
								  AND iP.INPT_YMD <![CDATA[<=]]> #{inptYmdTo}
						    	</if>
							 GROUP BY RI.ITEM_CD, RI.VRTY_CD
					  	) INP
					   ON INP.ITEM_CD = T.ITEM_CD
					  AND INP.VRTY_CD = T.VRTY_CD
							) A
						ORDER BY
							  APC_CD
							, ITEM_CD
							, VRTY_CD
							, SPCFCT_CD
							, GRD_CD

    </select>

     <!-- ==========================================================================	-->
	<!-- NAME : com.at.apcss.am.tot.mapper.totMngMapper.selectSortPrfmncAnls  	-->
	<!-- DESC : 선별 실적 분석                                             		-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.01.22  	박승진        	Initial Creation                            -->
	<!-- ==========================================================================	-->
    <select id="selectSortPrfmncAnls" parameterType="hashmap" resultType="hashmap">
    	<![CDATA[
    		SELECT
				  A.APC_CD			AS APC_CD
				, A.ITEM_CD			AS ITEM_CD
				, A.VRTY_CD			AS VRTY_CD
				, (SELECT FN_GET_ITEM_NM(A.ITEM_CD, A.APC_CD) FROM DUAL) AS ITEM_NM
				, (SELECT FN_GET_VRTY_NM(A.ITEM_CD, A.VRTY_CD, A.APC_CD) FROM DUAL) AS VRTY_NM
				, A.INPT_QNTT		AS INPT_QNTT
				, A.INPT_WGHT		AS INPT_WGHT
				, A.QNTT	AS QNTT
				, A.WGHT	AS WGHT
				, A.Q_0		AS Q_0
				, A.Q_1		AS Q_1
				, A.Q_2		AS Q_2
				, A.Q_3		AS Q_3
				, A.Q_4		AS Q_4
				, A.Q_5		AS Q_5
				, A.Q_6		AS Q_6
				, A.Q_7		AS Q_7
				, A.Q_8		AS Q_8
				, A.Q_9		AS Q_9
				, A.Q_10	    AS Q_10
				, A.Q_11	    AS Q_11
				, A.W_0		AS W_0
				, A.W_1		AS W_1
				, A.W_2		AS W_2
				, A.W_3		AS W_3
				, A.W_4		AS W_4
				, A.W_5		AS W_5
				, A.W_6		AS W_6
				, A.W_7		AS W_7
				, A.W_8		AS W_8
				, A.W_9		AS W_9
				, A.W_10	AS W_10
				, A.W_11	AS W_11
				, A.IQ_0	AS IQ_0
				, A.IQ_1	AS IQ_1
				, A.IQ_2	AS IQ_2
				, A.IQ_3	AS IQ_3
				, A.IQ_4	AS IQ_4
				, A.IQ_5	AS IQ_5
				, A.IQ_6	AS IQ_6
				, A.IQ_7	AS IQ_7
				, A.IQ_8	AS IQ_8
				, A.IQ_9	AS IQ_9
				, A.IQ_10	AS IQ_10
				, A.IQ_11	AS IQ_11
				, A.IW_0	AS IW_0
				, A.IW_1	AS IW_1
				, A.IW_2	AS IW_2
				, A.IW_3	AS IW_3
				, A.IW_4	AS IW_4
				, A.IW_5	AS IW_5
				, A.IW_6	AS IW_6
				, A.IW_7	AS IW_7
				, A.IW_8	AS IW_8
				, A.IW_9	AS IW_9
				, A.IW_10	AS W_10
				, A.IW_11	AS W_11

			  FROM (
			SELECT
				  T.APC_CD			AS APC_CD
				, T.ITEM_CD			AS ITEM_CD
				, T.VRTY_CD		AS VRTY_CD
				, SUM(T.QNTT)	AS QNTT
				, SUM(T.WGHT)	AS WGHT
				, SUM(INP.INPT_QNTT)	AS INPT_QNTT
				, SUM(INP.INPT_WGHT)	AS INPT_WGHT
				, SUM(CASE T.YM WHEN T.T_0 THEN T.QNTT ELSE 0 END)	AS Q_0
				, SUM(CASE T.YM WHEN T.T_1 THEN T.QNTT ELSE 0 END)	AS Q_1
				, SUM(CASE T.YM WHEN T.T_2 THEN T.QNTT ELSE 0 END)	AS Q_2
				, SUM(CASE T.YM WHEN T.T_3 THEN T.QNTT ELSE 0 END)	AS Q_3
				, SUM(CASE T.YM WHEN T.T_4 THEN T.QNTT ELSE 0 END)	AS Q_4
				, SUM(CASE T.YM WHEN T.T_5 THEN T.QNTT ELSE 0 END)	AS Q_5
				, SUM(CASE T.YM WHEN T.T_6 THEN T.QNTT ELSE 0 END)	AS Q_6
				, SUM(CASE T.YM WHEN T.T_7 THEN T.QNTT ELSE 0 END)	AS Q_7
				, SUM(CASE T.YM WHEN T.T_8 THEN T.QNTT ELSE 0 END)	AS Q_8
				, SUM(CASE T.YM WHEN T.T_9 THEN T.QNTT ELSE 0 END)	AS Q_9
				, SUM(CASE T.YM WHEN T.T_10 THEN T.QNTT ELSE 0 END)	AS Q_10
				, SUM(CASE T.YM WHEN T.T_11 THEN T.QNTT ELSE 0 END)	AS Q_11
				, SUM(CASE T.YM WHEN T.T_0 THEN T.WGHT ELSE 0 END)	AS W_0
				, SUM(CASE T.YM WHEN T.T_1 THEN T.WGHT ELSE 0 END)	AS W_1
				, SUM(CASE T.YM WHEN T.T_2 THEN T.WGHT ELSE 0 END)	AS W_2
				, SUM(CASE T.YM WHEN T.T_3 THEN T.WGHT ELSE 0 END)	AS W_3
				, SUM(CASE T.YM WHEN T.T_4 THEN T.WGHT ELSE 0 END)	AS W_4
				, SUM(CASE T.YM WHEN T.T_5 THEN T.WGHT ELSE 0 END)	AS W_5
				, SUM(CASE T.YM WHEN T.T_6 THEN T.WGHT ELSE 0 END)	AS W_6
				, SUM(CASE T.YM WHEN T.T_7 THEN T.WGHT ELSE 0 END)	AS W_7
				, SUM(CASE T.YM WHEN T.T_8 THEN T.WGHT ELSE 0 END)	AS W_8
				, SUM(CASE T.YM WHEN T.T_9 THEN T.WGHT ELSE 0 END)	AS W_9
				, SUM(CASE T.YM WHEN T.T_10 THEN T.WGHT ELSE 0 END)	AS W_10
				, SUM(CASE T.YM WHEN T.T_11 THEN T.WGHT ELSE 0 END)	AS W_11
				, SUM(CASE T.YM WHEN T.T_0 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_0
				, SUM(CASE T.YM WHEN T.T_1 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_1
				, SUM(CASE T.YM WHEN T.T_2 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_2
				, SUM(CASE T.YM WHEN T.T_3 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_3
				, SUM(CASE T.YM WHEN T.T_4 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_4
				, SUM(CASE T.YM WHEN T.T_5 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_5
				, SUM(CASE T.YM WHEN T.T_6 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_6
				, SUM(CASE T.YM WHEN T.T_7 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_7
				, SUM(CASE T.YM WHEN T.T_8 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_8
				, SUM(CASE T.YM WHEN T.T_9 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_9
				, SUM(CASE T.YM WHEN T.T_10 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_10
				, SUM(CASE T.YM WHEN T.T_11 THEN INP.INPT_QNTT ELSE 0 END)	AS IQ_11
				, SUM(CASE T.YM WHEN T.T_0 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_0
				, SUM(CASE T.YM WHEN T.T_1 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_1
				, SUM(CASE T.YM WHEN T.T_2 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_2
				, SUM(CASE T.YM WHEN T.T_3 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_3
				, SUM(CASE T.YM WHEN T.T_4 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_4
				, SUM(CASE T.YM WHEN T.T_5 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_5
				, SUM(CASE T.YM WHEN T.T_6 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_6
				, SUM(CASE T.YM WHEN T.T_7 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_7
				, SUM(CASE T.YM WHEN T.T_8 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_8
				, SUM(CASE T.YM WHEN T.T_9 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_9
				, SUM(CASE T.YM WHEN T.T_10 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_10
				, SUM(CASE T.YM WHEN T.T_11 THEN INP.INPT_WGHT ELSE 0 END)	AS IW_11
			  FROM (
							SELECT
								  RP.APC_CD		AS APC_CD
								, RI.ITEM_CD		AS ITEM_CD
								, RI.VRTY_CD		AS VRTY_CD
								, SUBSTR(RI.INPT_YMD, 1, 6)	AS YM
								, SUM(RP.SORT_QNTT)	AS QNTT
								, SUM(RP.SORT_WGHT)	AS WGHT
							  	, DL.DT				AS DT
								, TO_CHAR(DL.DT, 'YYYYMM')							AS T_0
								, TO_CHAR(ADD_MONTHS(DL.DT, -1), 'YYYYMM')			AS T_1
								, TO_CHAR(ADD_MONTHS(DL.DT, -2), 'YYYYMM')			AS T_2
								, TO_CHAR(ADD_MONTHS(DL.DT, -3), 'YYYYMM')			AS T_3
								, TO_CHAR(ADD_MONTHS(DL.DT, -4), 'YYYYMM')			AS T_4
								, TO_CHAR(ADD_MONTHS(DL.DT, -5), 'YYYYMM')			AS T_5
								, TO_CHAR(ADD_MONTHS(DL.DT, -6), 'YYYYMM')			AS T_6
								, TO_CHAR(ADD_MONTHS(DL.DT, -7), 'YYYYMM')			AS T_7
								, TO_CHAR(ADD_MONTHS(DL.DT, -8), 'YYYYMM')			AS T_8
								, TO_CHAR(ADD_MONTHS(DL.DT, -9), 'YYYYMM')			AS T_9
								, TO_CHAR(ADD_MONTHS(DL.DT, -10), 'YYYYMM')			AS T_10
								, TO_CHAR(ADD_MONTHS(DL.DT, -11), 'YYYYMM')			AS T_11
							  FROM TB_SORT_PRFMNC RP
							  JOIN TB_SORT_INVNTR RI
							    ON RI.APC_CD = RP.APC_CD
							   AND RI.SORTNO = RP.SORTNO
							   AND RI.SORT_SN = RP.SORT_SN
							   AND RI.DEL_YN = 'N'
							  , (
									SELECT
									  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
								  FROM DUAL
							  ) DL
							 WHERE RP.APC_CD = #{apcCd}
							   AND RP.INPT_YMD BETWEEN TO_CHAR(TRUNC(ADD_MONTHS(DL.DT, -11), 'MM'), 'YYYYMMDD') AND TO_CHAR(LAST_DAY(DL.DT), 'YYYYMMDD')
						 ]]>
							   <if test='itemCd != null and itemCd != ""'>
								  AND RI.ITEM_CD = #{itemCd}
    						   </if>
    						   <if test='vrtyCd != null and vrtyCd != ""'>
								  AND RI.VRTY_CD = #{vrtyCd}
    						   </if>

							 GROUP BY
							 	  RP.APC_CD
								, RI.ITEM_CD
								, RI.VRTY_CD
								, SUBSTR(RI.INPT_YMD, 1, 6)
								, DL.DT
							) T
						  LEFT JOIN (
						  		SELECT
						  			  RI.ITEM_CD		AS ITEM_CD
						  			, RI.VRTY_CD		AS VRTY_CD
						  			, SUBSTR(IP.INPT_YMD, 1, 6)	AS YM
						  			, SUM(IP.QNTT)	AS INPT_QNTT
						  			, SUM(IP.WGHT)	AS INPT_WGHT
						  		  FROM TB_SORT_INPT_PRFMNC IP
						  		  JOIN TB_RAW_MTR_INVNTR RI
						  		    ON RI.APC_CD = IP.APC_CD
						  		   AND RI.WRHSNO = IP.WRHSNO
						  		   AND RI.DEL_YN = 'N'
								  , (
										SELECT
										  TO_DATE(#{crtrYmd}, 'YYYYMMDD')	AS DT
									  FROM DUAL
								  ) DL
								 WHERE IP.APC_CD = #{apcCd}
								   AND IP.DEL_YN = 'N'
								   AND IP.INPT_YMD BETWEEN TO_CHAR(TRUNC(ADD_MONTHS(DL.DT, -11), 'MM'), 'YYYYMMDD') AND TO_CHAR(LAST_DAY(DL.DT), 'YYYYMMDD')
								 GROUP BY RI.ITEM_CD, RI.VRTY_CD, SUBSTR(IP.INPT_YMD, 1, 6)
						  	) INP
						   ON INP.ITEM_CD = T.ITEM_CD
						  AND INP.VRTY_CD = T.VRTY_CD
						  AND INP.YM = T.YM
					 GROUP BY
						  T.APC_CD
						, T.ITEM_CD
						, T.VRTY_CD
				) A
			ORDER BY
				  APC_CD
				, ITEM_CD
				, VRTY_CD

    </select>






</mapper>
