<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================================	-->
<!-- NAME : CnptSpmtPckgUnitMapper.xml                                   		-->
<!-- DESC : 출하상품거래처 mapper                                             	-->
<!-- ==========================================================================	-->
<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
<!-- ===========  	============  	===========================================	-->
<!-- 2025.09.01  	김은총        	Initial Creation	                        -->
<!-- ==========================================================================	-->

<mapper namespace="com.at.apcss.am.cmns.mapper.CnptSpmtPckgUnitMapper">

	<!-- ====================================================================================== -->
	<!-- NAME : com.at.apcss.am.cmns.mapper.CnptSpmtPckgUnitMapper.selectCnptSpmtPckgUnitList	-->
	<!-- DESC : 출하상품거래처 목록 조회.	                                   					-->
	<!-- ======================================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      						-->
	<!-- ===========  	============  	=======================================================	-->
	<!-- 2025.09.01  	김은총        	Initial Creation                            			-->
	<!-- ======================================================================================	-->
    <select id="selectCnptSpmtPckgUnitList" parameterType="com.at.apcss.am.cmns.vo.CnptSpmtPckgUnitVO" resultType="com.at.apcss.am.cmns.vo.CnptSpmtPckgUnitVO">
    	<![CDATA[
	    	SELECT /* com.at.apcss.am.cmns.mapper.CnptSpmtPckgUnitMapper.selectCnptSpmtPckgUnitList */
		     	   CSPU.APC_CD				AS APC_CD
				 , CSPU.CNPT_CD				AS CNPT_CD
	    	     , (SELECT FN_GET_CNPT_NM(CSPU.CNPT_CD, CSPU.APC_CD) FROM DUAL) 					AS CNPT_NM
				 , CSPU.SPMT_PCKG_UNIT_CD   AS SPMT_PCKG_UNIT_CD
	    		 , (SELECT FN_GET_SPMT_PCKG_UNIT_NM(CSPU.SPMT_PCKG_UNIT_CD, CSPU.APC_CD) FROM DUAL) AS SPMT_PCKG_UNIT_NM
				 , CSPU.RMRK                AS RMRK
				 , CSPU.USE_YN				AS USE_YN
			     , CSPU.DEL_YN              AS DEL_YN
	    	     , SPU.ITEM_CD              AS ITEM_CD
	    		 , SPU.VRTY_CD              AS VRTY_CD
	    		 , SPU.SPCFCT_CD            AS SPCFCT_CD
	    		 , (SELECT FN_GET_ITEM_NM(SPU.ITEM_CD, CSPU.APC_CD) FROM DUAL) AS ITEM_NM
				 , (SELECT FN_GET_VRTY_NM(SPU.ITEM_CD, SPU.VRTY_CD, CSPU.APC_CD) FROM DUAL) AS VRTY_NM
	    		 , (SELECT FN_GET_SPCFCT_NM(SPU.ITEM_CD, SPU.SPCFCT_CD, CSPU.APC_CD) FROM DUAL) AS SPCFCT_NM
			  FROM TB_CNPT_SPMT_PCKG_UNIT   CSPU
			  LEFT JOIN TB_SPMT_PCKG_UNIT	SPU
			    ON CSPU.APC_CD = SPU.APC_CD
			   AND CSPU.SPMT_PCKG_UNIT_CD = SPU.SPMT_PCKG_UNIT_CD
			   AND SPU.DEL_YN = 'N'
			 WHERE CSPU.DEL_YN = 'N'
			   AND CSPU.APC_CD = #{apcCd}
		]]>
		<if test='cnptCd != null and cnptCd != "" '>
			   AND CSPU.CNPT_CD	= #{cnptCd}
		</if>
		<if test='itemCd != null and itemCd != "" '>
			   AND SPU.ITEM_CD	= #{itemCd}
		</if>
		<if test='vrtyCd != null and vrtyCd != "" '>
			   AND SPU.VRTY_CD	= #{vrtyCd}
		</if>
		<if test='spmtPckgUnitCd != null and spmtPckgUnitCd != "" '>
			   AND CSPU.SPMT_PCKG_UNIT_CD= #{spmtPckgUnitCd}
		</if>
		<if test='spcfctCd != null and spcfctCd != "" '>
			   AND SPU.SPCFCT_CD	= #{spcfctCd}
		</if>
	    <![CDATA[
	    	ORDER BY SPU.ITEM_CD, CSPU.SPMT_PCKG_UNIT_CD
		 ]]>
    </select>

	<!-- ==================================================================================	-->
	<!-- NAME : com.at.apcss.am.cmns.mapper.CnptSpmtPckgUnitMapper.deleteCnptSpmtPckgUnit	-->
	<!-- DESC : 출하상품거래처 삭제.	                                  					-->
	<!-- ==================================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      					-->
	<!-- ===========  	============  	===================================================	-->
	<!-- 2025.09.01  	김은총        	Initial Creation                            		-->
	<!-- ==================================================================================	-->
	<update id="deleteCnptSpmtPckgUnit" parameterType="com.at.apcss.am.cmns.vo.CnptSpmtPckgUnitVO">
		<![CDATA[
			UPDATE TB_CNPT_SPMT_PCKG_UNIT /* com.at.apcss.am.cmns.mapper.CnptSpmtPckgUnitMapper.deleteCnptSpmtPckgUnit */
			   SET DEL_YN 				= 'Y'
			 WHERE APC_CD				= #{apcCd}
			   AND SPMT_PCKG_UNIT_CD 	= #{spmtPckgUnitCd}
			   AND CNPT_CD	= #{cnptCd}
		]]>
	</update>

	<!-- =========================================================================  -->
	<!-- NAME : com.at.apcss.am.cmns.mapper.CnptSpmtPckgUnitMapper.mergeCnptSpmtPckgUnitList	-->
	<!-- DESC : 출하상품거래처 상세 merge  		              				          	-->
	<!-- ==========================================================================	-->
	<!-- DATE   		AUTHOR        	DESCRIPTION                      			-->
	<!-- ===========  	============  	===========================================	-->
	<!-- 2025.09.01  	김은총        	Initial Creation                            -->
	<!-- ==========================================================================	-->
	<update id="mergeCnptSpmtPckgUnitList" parameterType="list">
		MERGE INTO TB_CNPT_SPMT_PCKG_UNIT CSPU
		USING (
		<foreach collection="list" item="item" separator="UNION ALL">
			SELECT
				#{item.apcCd}				AS APC_CD
			  , #{item.cnptCd}				AS CNPT_CD
			  , #{item.spmtPckgUnitCd}      AS SPMT_PCKG_UNIT_CD
			  , #{item.rmrk}				AS RMRK
			  , #{item.useYn}        		AS USE_YN
			  , #{item.delYn}        		AS DEL_YN
			  , #{item.sysFrstInptDt} 		AS SYS_FRST_INPT_DT
			  , #{item.sysFrstInptUserId} 	AS SYS_FRST_INPT_USER_ID
			  ,	#{item.sysFrstInptPrgrmId} 	AS SYS_FRST_INPT_PRGRM_ID
			  ,	#{item.sysLastChgDt} 		AS SYS_LAST_CHG_DT
			  ,	#{item.sysLastChgUserId} 	AS SYS_LAST_CHG_USER_ID
			  ,	#{item.sysLastChgPrgrmId} 	AS SYS_LAST_CHG_PRGRM_ID
			FROM DUAL
		</foreach>
		) source
		ON (
			CSPU.APC_CD = source.APC_CD
		AND CSPU.CNPT_CD = source.CNPT_CD
		AND CSPU.SPMT_PCKG_UNIT_CD = source.SPMT_PCKG_UNIT_CD
		)
		WHEN MATCHED THEN
		UPDATE SET
			CSPU.RMRK = source.RMRK
		  ,	CSPU.USE_YN = source.USE_YN
		  ,	CSPU.DEL_YN = source.DEL_YN
		  ,	CSPU.SYS_LAST_CHG_DT = SYSDATE
		  ,	CSPU.SYS_LAST_CHG_USER_ID = source.SYS_LAST_CHG_USER_ID
		  ,	CSPU.SYS_LAST_CHG_PRGRM_ID = source.SYS_LAST_CHG_PRGRM_ID
		WHEN NOT MATCHED THEN
		INSERT (
			APC_CD
		  ,	SPMT_PCKG_UNIT_CD
		  ,	CNPT_CD
		  ,	RMRK
		  ,	USE_YN
		  ,	DEL_YN
		  ,	SYS_FRST_INPT_DT
		  ,	SYS_FRST_INPT_USER_ID
		  ,	SYS_FRST_INPT_PRGRM_ID
		  ,	SYS_LAST_CHG_DT
		  ,	SYS_LAST_CHG_USER_ID
		  ,	SYS_LAST_CHG_PRGRM_ID
		)
		VALUES (
			source.APC_CD
		  ,	source.SPMT_PCKG_UNIT_CD
		  ,	source.CNPT_CD
		  ,	source.RMRK
		  ,	source.USE_YN
		  ,	source.DEL_YN
		  ,	SYSDATE
		  ,	source.SYS_FRST_INPT_USER_ID
		  ,	source.SYS_FRST_INPT_PRGRM_ID
		  ,	SYSDATE
		  ,	source.SYS_LAST_CHG_USER_ID
		  ,	source.SYS_LAST_CHG_PRGRM_ID
		);
	</update>

</mapper>