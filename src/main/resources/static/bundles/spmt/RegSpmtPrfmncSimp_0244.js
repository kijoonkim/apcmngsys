import{j as e,r as b,R as k,a as Y}from"../keen-slider.min-De-sc4ii.js";import{Q as K,M as T,c as W,d as z}from"../create-theme-DIjA598r.js";import{M as B,A as P}from"../main.esm-DowEJWUN.js";import"../_commonjsHelpers-CE1G-McA.js";const Q=GroupOverlay=({gradeId:n,lotData:r,containerRef:i})=>{const[x,a]=useState([]),[d,c]=useState(null);return useLayoutEffect(()=>{if(!i.current)return;const l={};PRODUCERS.forEach((p,g)=>{const I=`${p}_${n}`;(r[I]||[]).forEach((h,y)=>{h.groupId&&(l[h.groupId]||(l[h.groupId]={firstRow:g,lastRow:g,firstLotIdx:y,lastLotIdx:y,total:0}),l[h.groupId].lastRow=g,l[h.groupId].lastLotIdx=y,l[h.groupId].total+=h.qty)})});const m=GRADES.findIndex(p=>p.id===n),f=i.current.querySelectorAll(".cell-container"),v=Object.entries(l).map(([p,g])=>{const I=g.firstRow*GRADES.length+m,N=g.lastRow*GRADES.length+m,h=f[I],y=f[N];if(!h||!y)return null;const E=h.querySelectorAll(".lot-item")[g.firstLotIdx],S=y.querySelectorAll(".lot-item")[g.lastLotIdx];if(!E||!S)return null;const w=E.getBoundingClientRect(),$=S.getBoundingClientRect(),M=i.current.getBoundingClientRect();return{groupId:p,left:w.left-M.left,top:w.top-M.top,width:w.width,height:$.bottom-w.top,total:g.total}}).filter(Boolean);a(v)},[n,r,i]),e.jsx(e.Fragment,{children:x.map(l=>e.jsx("div",{style:{position:"absolute",left:`${l.left}px`,top:`${l.top}px`,width:`${l.width}px`,height:`${l.height}px`,border:"4px solid rgb(147, 51, 234)",borderRadius:"8px",zIndex:20,pointerEvents:"auto",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:()=>c(l.groupId),onMouseLeave:()=>c(null),onTouchStart:()=>c(l.groupId),onTouchEnd:()=>setTimeout(()=>c(null),2e3),children:d===l.groupId&&e.jsxs("div",{style:{position:"absolute",bottom:"-35px",right:"5px",background:"rgb(147, 51, 234)",color:"white",padding:"6px 12px",borderRadius:"6px",fontSize:"13px",fontWeight:"bold",whiteSpace:"nowrap",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",animation:"fadeIn 0.2s"},children:["í•©ê³„: ",l.total,"ê°œ"]})},l.groupId))})},F=LotComponent=({lot:n,client:r,onClick:i,mode:x,isShipmentActiveInThisColumn:a,isPending:d})=>{const c=r?`${r.color} ${r.bgColor} ${r.borderStyle}`:"border-gray-200 bg-white";let l=x==="view"?"cursor-default":"cursor-pointer";a&&!d&&!n.shipmentId&&(l+=" opacity-30 scale-95");const m=d?"ring-2 ring-blue-600 ring-inset":"";return e.jsxs("div",{className:`lot-item relative flex items-center justify-center h-12 border ${c} ${l} hover:brightness-90 transition-all duration-150`,onClick:()=>i(n),children:[e.jsx("span",{className:"text-sm font-medium text-gray-800",children:n.qty}),m&&e.jsx("div",{className:`absolute inset-0 ${m} pointer-events-none`})]})},H=CellContainer=({lots:n=[],clients:r,onLotClick:i,onEmptyCellClick:x,mode:a,cellKey:d,activeShipmentGrade:c,pendingLotIds:l})=>{const m=n.length<=1?"grid-cols-1":n.length===2?"grid-cols-2":n.length===3?"grid-cols-3":n.length===4?"grid-cols-4":n.length===5?"grid-cols-5":"grid-cols-6",f=d.split("_")[1],v=a==="shipment"&&c===f;return n.length===0?e.jsx("div",{className:"cell-container flex items-center justify-center min-h-12 text-gray-300 cursor-pointer hover:bg-gray-100",onClick:()=>x(d),children:"-"}):e.jsx("div",{className:`cell-container grid ${m} w-full`,children:n.map(p=>e.jsx(F,{lot:p,client:r[p.shipmentId],onClick:i,mode:a,isShipmentActiveInThisColumn:v,isPending:l.has(p.id)},p.id))})},q=["541","458","327","533","485","324","601","602"],C=[{id:"gasan",name:"ê°€ë¡œì "},{id:"jeoksang",name:"ì íŠ¹ìƒ"},{id:"teuksang",name:"íŠ¹ìƒ"},{id:"sang",name:"ìƒ"},{id:"geomteuk",name:"ê²€íŠ¹"},{id:"cheongsang",name:"ì²­ìƒ"},{id:"geom",name:"ê²€ìƒ"},{id:"gam",name:"ê°"}],O={C_YELLOW:{name:"(ì£¼)ê°€ë½ì‹œìž¥",color:"border-yellow-400",bgColor:"bg-yellow-50",borderStyle:"border-4"},C_RED:{name:"ì²­ê³¼ë¬¼ìœ í†µ",color:"border-red-400",bgColor:"bg-red-50",borderStyle:"border-4"},C_GREEN:{name:"í•˜ë‚˜ë¡œë§ˆíŠ¸",color:"border-green-400",bgColor:"bg-green-50",borderStyle:"border-4"}},U={"541_gasan":[{id:"L1",qty:7,shipmentId:"C_YELLOW",groupId:null}],"541_jeoksang":[{id:"L2",qty:1,shipmentId:"C_YELLOW",groupId:null}],"541_teuksang":[{id:"L3",qty:10,shipmentId:"C_YELLOW",groupId:null},{id:"L4",qty:6,shipmentId:null,groupId:null}],"541_sang":[{id:"L5",qty:2,shipmentId:"C_YELLOW",groupId:null}],"541_geomteuk":[{id:"L6",qty:10,shipmentId:"C_YELLOW",groupId:null}],"458_teuksang":[{id:"L7",qty:2,shipmentId:"C_YELLOW",groupId:null},{id:"L8",qty:3,shipmentId:"C_RED",groupId:null},{id:"L9",qty:1,shipmentId:null,groupId:null},{id:"L10",qty:4,shipmentId:null,groupId:null}],"327_gasan":[{id:"L11",qty:2,shipmentId:"C_RED",groupId:null}],"327_jeoksang":[{id:"L12",qty:3,shipmentId:"C_RED",groupId:null}]},L=(n,r=null,i=null)=>({id:`L-${Math.random().toString(36).substring(2,9)}`,qty:n,shipmentId:r,groupId:i}),J=n=>{const r={...n};return q.forEach(i=>{C.forEach(x=>{const a=`${i}_${x.id}`;if(r[a])return;const d=Math.random();d<.3?r[a]=[]:d<.7?r[a]=[L(Math.floor(Math.random()*20)+1)]:d<.9?r[a]=[L(Math.floor(Math.random()*10)+1),L(Math.floor(Math.random()*10)+1)]:r[a]=[L(Math.floor(Math.random()*5)+1),L(Math.floor(Math.random()*5)+1),L(Math.floor(Math.random()*5)+1),L(Math.floor(Math.random()*5)+1)]})}),r},V=({isOpen:n,lots:r,onClose:i,onMerge:x})=>{if(!n||!r||r.length===0)return null;const a=r.reduce((d,c)=>d+c.qty,0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"ìž¬ê³  ë³‘í•©"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"ì•„ëž˜ ìž¬ê³ ë“¤ì„ í•˜ë‚˜ë¡œ ë³‘í•©í•©ë‹ˆë‹¤."}),e.jsx("div",{className:"border border-gray-300 rounded-md p-3 space-y-2 mb-4",children:r.map((d,c)=>e.jsx("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:e.jsxs("span",{className:"text-sm",children:["Lot ",c+1,": ",e.jsx("strong",{children:d.qty}),"ê°œ"]})},d.id))}),e.jsxs("p",{className:"text-sm font-semibold text-green-600 mb-4",children:["ë³‘í•© í›„ ì´ ìˆ˜ëŸ‰: ",e.jsx("strong",{children:a}),"ê°œ"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:x,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"ë³‘í•© í™•ì¸"})]})]})})};function X(){const[n,r]=b.useState(()=>J(U)),[i,x]=b.useState("view"),[a,d]=b.useState(null),[c,l]=b.useState(null),[m,f]=b.useState(new Set),[v,p]=b.useState({isOpen:!1,lot:null,cellKey:null}),[g,I]=b.useState({isOpen:!1,lots:[],cellKey:null}),N=b.useRef(null),h=b.useMemo(()=>{const t={C_YELLOW:0,C_RED:0,C_GREEN:0};for(const s in n)(n[s]||[]).forEach(o=>{o.shipmentId&&t[o.shipmentId]!==void 0&&(t[o.shipmentId]+=o.qty)});return t},[n]),y=b.useMemo(()=>{const t={};C.forEach(s=>t[s.id]=0);for(const s in n){const o=s.split("_")[1];t[o]!==void 0&&(t[o]+=(n[s]||[]).reduce((u,j)=>u+j.qty,0))}return t},[n]),E=t=>{x(t),t!=="shipment"&&(d(null),l(null),f(new Set))},S=t=>{d(t),f(new Set),l(null)},w=(t,s)=>{if(i!=="view"){if(i==="split"){const o=n[s]||[];o.length===1?p({isOpen:!0,lot:t,cellKey:s}):I({isOpen:!0,lots:o,cellKey:s});return}if(i==="shipment"){if(!a){alert("ë¨¼ì € ê±°ëž˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.");return}const o=s.split("_")[1];if(!c)l(o);else if(c!==o){alert(`í˜„ìž¬ "${C.find(j=>j.id===c)?.name}" ì—´ì—ë§Œ ë“±ë¡í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.`);return}if(t.shipmentId){alert("ì´ë¯¸ ì¶œí•˜ ë“±ë¡ëœ ìž¬ê³ ìž…ë‹ˆë‹¤.");return}const u=new Set(m);u.has(t.id)?u.delete(t.id):u.add(t.id),f(u)}}},$=t=>{i==="split"&&alert("ë¹ˆ ì…€ì€ ë¶„ë¦¬/ë³‘í•©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")},M=()=>{if(m.size===0||!a)return;const t=`G-${Date.now()}`,s={...n};let o=0,u=0;for(const j in s)s[j]=s[j].map(R=>m.has(R.id)?(o++,u+=R.qty,{...R,shipmentId:a,groupId:t}):R);r(s),f(new Set),l(null),alert(`ì¶œí•˜ ë“±ë¡ ì™„ë£Œ! (${o}ê°œ ìž¬ê³ , ì´ ${u}ê°œ)`)},D=t=>{const{cellKey:s}=v;r(o=>({...o,[s]:t.map(u=>L(u))})),p({isOpen:!1,lot:null,cellKey:null})},G=()=>{const{lots:t,cellKey:s}=g,o=t.reduce((u,j)=>u+j.qty,0);r(u=>({...u,[s]:[{id:`L-merged-${Date.now()}`,qty:o,shipmentId:null,groupId:null}]})),I({isOpen:!1,lots:[],cellKey:null})},_=t=>i===t?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-100",A=t=>{const s="px-4 py-2 rounded-md font-medium text-sm";return t==="C_YELLOW"?`${s} bg-yellow-400 text-yellow-900`:t==="C_RED"?`${s} bg-red-400 text-red-900`:t==="C_GREEN"?`${s} bg-green-400 text-green-900`:`${s} bg-gray-200 text-gray-800`};return e.jsxs("div",{className:"p-8 bg-gray-100 min-h-screen flex flex-col",children:[e.jsx("style",{children:"@keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }"}),e.jsxs("header",{className:"bg-white p-4 rounded-lg shadow-md mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ì¶œí•˜ì‹¤ì  ê·¸ë£¹í•‘ (Grid + Overlay)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>E("view"),className:`px-4 py-2 rounded-md ${_("view")}`,children:"ë³´ê¸°"}),e.jsx("button",{onClick:()=>E("split"),className:`px-4 py-2 rounded-md ${_("split")}`,children:"ìž¬ê³  ë¶„ë¦¬/ë³‘í•©"}),e.jsx("button",{onClick:()=>E("shipment"),className:`px-4 py-2 rounded-md ${_("shipment")}`,children:"ì¶œí•˜ ë“±ë¡"})]})]}),i==="shipment"&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-md border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"1. ê±°ëž˜ì²˜(ì¶œí•˜) ì„ íƒ:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[["C_YELLOW","C_RED","C_GREEN"].map(t=>e.jsxs("button",{onClick:()=>S(t),className:`${A(t)} ${a===t?"ring-2 ring-offset-2":""}`,children:[O[t].name," (ì´ ",h[t]||0,"ê°œ)"]},t)),e.jsxs("button",{onClick:M,disabled:m.size===0,className:"ml-auto px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400",children:["ì¶œí•˜ ì €ìž¥ (",m.size,"ê°œ)"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["2. ê°™ì€ ë“±ê¸‰(ì—´)ì—ì„œ ì—¬ëŸ¬ ìž¬ê³ ë¥¼ í´ë¦­í•˜ì„¸ìš”."," ",c&&e.jsxs("span",{className:"font-bold text-blue-600",children:["(í˜„ìž¬ '",C.find(t=>t.id===c)?.name,"' ì—´)"]})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-1 font-semibold",children:"ðŸ’¡ ì €ìž¥ ì‹œ ë³´ë¼ìƒ‰ í…Œë‘ë¦¬ë¡œ ë¬¶ìž…ë‹ˆë‹¤. Hoverí•˜ë©´ í•©ê³„ í‘œì‹œ!"})]}),i==="split"&&e.jsx("div",{className:"mt-4 p-3 bg-purple-50 rounded-md border border-purple-200",children:e.jsx("p",{className:"text-sm text-gray-600",children:"ë¶„ë¦¬í•  ìž¬ê³ (ë‹¨ì¼)ë¥¼ í´ë¦­í•˜ë©´ ë¶„ë¦¬ ëª¨ë‹¬ì´, ì´ë¯¸ ë¶„ë¦¬ëœ ìž¬ê³ ë¥¼ í´ë¦­í•˜ë©´ ë³‘í•© ëª¨ë‹¬ì´ ëœ¹ë‹ˆë‹¤."})})]}),e.jsxs("div",{className:"flex-1 shadow-lg border border-gray-300 rounded-lg overflow-auto bg-white relative",ref:N,children:[e.jsxs("div",{className:"grid",style:{gridTemplateColumns:`100px repeat(${C.length}, 160px)`},children:[e.jsx("div",{className:"sticky top-0 z-10 bg-gray-100 px-4 py-3 border-b-2 border-r border-gray-300 font-semibold text-gray-700",children:"ìƒì‚°ìž"}),C.map(t=>e.jsx("div",{className:"sticky top-0 z-10 bg-gray-100 px-4 py-3 border-b-2 border-r border-gray-300 font-semibold text-gray-700 text-center",children:t.name},t.id)),q.map(t=>e.jsxs(k.Fragment,{children:[e.jsx("div",{className:"px-4 py-3 border-b border-r border-gray-200 font-bold text-lg text-center",children:t}),C.map(s=>{const o=`${t}_${s.id}`;return e.jsx("div",{className:"p-0 border-b border-r border-gray-200",children:e.jsx(H,{cellKey:o,lots:n[o],clients:O,onLotClick:u=>w(u,o),onEmptyCellClick:$,mode:i,activeShipmentGrade:c,pendingLotIds:m})},s.id)})]},t)),e.jsx("div",{className:"sticky bottom-0 z-10 bg-gray-200 px-4 py-3 border-t-4 border-r border-gray-400 font-bold text-lg text-center",children:"í•©ê³„"}),C.map(t=>e.jsx("div",{className:"sticky bottom-0 z-10 bg-gray-200 px-4 py-3 border-t-4 border-r border-gray-400 font-bold text-lg text-blue-700 text-center",children:y[t.id]>0?y[t.id]:"-"},t.id))]}),C.map(t=>e.jsx(Q,{gradeId:t.id,lotData:n,containerRef:N},t.id))]}),e.jsx(SplitModal,{isOpen:v.isOpen,lot:v.lot,onClose:()=>p({isOpen:!1,lot:null,cellKey:null}),onSplit:D}),e.jsx(V,{isOpen:g.isOpen,lots:g.lots,onClose:()=>I({isOpen:!1,lots:[],cellKey:null}),onMerge:G})]})}B.registerModules([P]);const Z=W({primaryColor:"blue",defaultRadius:"xl"}),ee=new K,te=document.getElementById("root"),ne=te.dataset.apcCd;Y.createRoot(document.getElementById("root")).render(e.jsx(k.StrictMode,{children:e.jsx(T,{theme:Z,children:e.jsx(z,{client:ee,children:e.jsx(X,{apcCd:ne})})})}));
