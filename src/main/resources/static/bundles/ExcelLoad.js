import{r as f,j as e,a as A,R as _}from"./keen-slider.min-De-sc4ii.js";import{A as F}from"./ag-theme-alpine-urkB2o-b.js";import{r as $,u as p,w as O}from"./xlsx-JnrCtiof.js";import"./_commonjsHelpers-CE1G-McA.js";import"./main.esm-DowEJWUN.js";import"./index-Cs4f-BPH.js";const I=({columns:c,initialData:x=[],onDataChange:u})=>{const[n,m]=f.useState(x),[h,N]=f.useState(c||[]),g=f.useRef(null),w=f.useRef(null),y=t=>{const s=t.target.files?.[0];if(!s)return;const r=new FileReader;r.onload=o=>{try{const i=new Uint8Array(o.target?.result),a=$(i,{type:"array"}),d=a.Sheets[a.SheetNames[0]],l=p.sheet_to_json(d);if(l.length===0){alert("데이터가 없습니다.");return}if(!c||c.length===0){const k=Object.keys(l[0]).map(b=>({field:b,headerName:b,editable:!0,sortable:!0,filter:!0,resizable:!0}));N(k)}m(l),u?.(l),console.log("✅ 엑셀 업로드 완료:",l.length,"건")}catch(i){console.error("❌ 엑셀 읽기 실패:",i),alert("엑셀 파일을 읽는 중 오류가 발생했습니다.")}finally{g.current&&(g.current.value="")}},r.readAsArrayBuffer(s)},v=()=>{if(n.length===0){alert("다운로드할 데이터가 없습니다.");return}const t=n.map(a=>{const d={};return h.forEach(l=>{l.field&&(d[l.headerName||l.field]=a[l.field])}),d}),s=p.json_to_sheet(t),r=h.map(a=>({wch:Math.max((a.headerName||a.field||"").length,15)}));s["!cols"]=r;const o=p.book_new();p.book_append_sheet(o,s,"Sheet1");const i=`export_${new Date().toISOString().split("T")[0]}.xlsx`;O(o,i),console.log("✅ 엑셀 다운로드 완료:",i)},C=()=>{if(n.length===0){alert("다운로드할 데이터가 없습니다.");return}const t=h.map(a=>a.headerName||a.field).join(","),s=n.map(a=>h.map(d=>{if(!d.field)return"";const l=a[d.field];return typeof l=="string"&&(l.includes(",")||l.includes('"'))?`"${l.replace(/"/g,'""')}"`:l??""}).join(",")).join(`
`),r=`${t}
${s}`,o=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(o),i.download=`export_${new Date().toISOString().split("T")[0]}.csv`,i.click(),console.log("✅ CSV 다운로드 완료")},R=()=>{const t={};h.forEach(r=>{r.field&&(t[r.field]="")});const s=[...n,t];m(s),u?.(s)},S=()=>{const t=w.current?.api?.getSelectedNodes();if(!t||t.length===0){alert("삭제할 행을 선택하세요.");return}const s=t.map(o=>o.data),r=n.filter(o=>!s.includes(o));m(r),u?.(r),console.log("✅ 삭제 완료:",t.length,"건")},D=()=>{n.length!==0&&window.confirm("모든 데이터를 삭제하시겠습니까?")&&(m([]),u?.([]))},E=()=>{const t=[];w.current?.api?.forEachNode(s=>{t.push(s.data)}),u?.(t)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("label",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer flex items-center space-x-2",children:[e.jsx("span",{children:"📤"}),e.jsx("span",{children:"엑셀 업로드"}),e.jsx("input",{ref:g,type:"file",accept:".xlsx,.xls",onChange:y,className:"hidden"})]}),e.jsxs("button",{onClick:v,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center space-x-2",disabled:n.length===0,children:[e.jsx("span",{children:"📥"}),e.jsx("span",{children:"엑셀 다운로드"})]}),e.jsxs("button",{onClick:C,className:"px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700 flex items-center space-x-2",disabled:n.length===0,children:[e.jsx("span",{children:"📄"}),e.jsx("span",{children:"CSV 다운로드"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"+ 행 추가"}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700",disabled:n.length===0,children:"선택 삭제"}),e.jsx("button",{onClick:D,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:n.length===0,children:"전체 삭제"})]})]}),e.jsxs("div",{className:"mb-2 text-sm text-gray-600",children:["총 ",e.jsx("span",{className:"font-bold text-blue-600",children:n.length}),"건"]}),e.jsx("div",{className:"ag-theme-alpine",style:{height:500,width:"100%"},children:e.jsx(F,{ref:w,rowData:n,columnDefs:h,defaultColDef:{sortable:!0,filter:!0,resizable:!0,editable:!0},rowSelection:"multiple",suppressRowClickSelection:!0,animateRows:!0,onCellValueChanged:E,localeText:{noRowsToShow:"데이터가 없습니다. 엑셀 파일을 업로드하거나 행을 추가하세요."}})})]})},T=[{field:"apcCd",headerName:"APC코드",width:120,editable:!0},{field:"apcNm",headerName:"APC거래처",width:150,editable:!0},{field:"ordererCd",headerName:"발주업자코드",width:120,editable:!0},{field:"ordererNm",headerName:"발주업자",width:150,editable:!0},{field:"itemNm",headerName:"상품명",width:200,editable:!0},{field:"qty",headerName:"수량",width:100,editable:!0,type:"numericColumn",valueFormatter:c=>c.value?`${c.value.toLocaleString()}`:""},{field:"expectedDate",headerName:"입고예정일자",width:130,editable:!0}],U=()=>{const c=x=>{console.log("📊 데이터 변경:",x.length,"건"),window.onExcelDataChange&&window.onExcelDataChange(x)};return e.jsxs("div",{className:"p-6 bg-white min-h-screen",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"📊 엑셀 데이터 관리"}),e.jsx("p",{className:"text-sm text-gray-600",children:"엑셀 파일을 업로드하거나 직접 입력하세요"})]}),e.jsx(I,{columns:T,onDataChange:c})]})},j=document.getElementById("root");j?(A.createRoot(j).render(e.jsx(_.StrictMode,{children:e.jsx(U,{})})),console.log("✅ React 앱이 마운트되었습니다!")):console.error('❌ id="root" 요소를 찾을 수 없습니다!');window.getExcelData=()=>(console.log("JSP에서 데이터 요청"),[]);
